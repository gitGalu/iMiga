Math.truncate||(Math.truncate=function(e){return 0<e?this.floor(e):e<0?this.ceil(e):0}),Math.decimalRandom||(Math.decimalRandom=function(){return 4294967295*this.random()>>>0}),Date.now||(console.warn("This browser does not support 'Date.now()'. Falling back to 'Date.getTime()'..."),Date.now=function(){return(new Date).getTime()}),window.performance||(console.warn("This browser does not support 'window.performance'. Falling back to 'Date'..."),window.performance={}),performance.timing||(performance.timing={navigationStart:Date.now()}),performance.now||(performance.webkitNow?performance.now=performance.webkitNow:performance.now=function(){return Date.now()-this.timing.navigationStart}),function(){var a=0;window.requestAnimationFrame||(console.warn("This browser does not support 'window.requestAnimationFrame'. Falling back to 'setTimeout'..."),window.requestAnimationFrame=function(e,t){var n=(new Date).getTime(),r=Math.max(0,16-(n-a)),i=window.setTimeout(function(){e(n+r)},r);return a=n+r,i}),window.cancelAnimationFrame||(console.warn("This browser does not support 'window.cancelAnimationFrame'. Falling back to 'clearTimeout'..."),window.cancelAnimationFrame=function(e){clearTimeout(e)})}();const SAEC_LITTLE_ENDIAN=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}();function SAEF_bswap16(e){return(255&e)<<8|(65280&e)>>8}function SAEF_bswap32(e){return((255&e)<<24|(65280&e)<<8|(16711680&e)>>>8|(4278190080&e)>>>24)>>>0}function SAEF_be16toh(e){return SAEC_LITTLE_ENDIAN?(255&e)<<8|(65280&e)>>8:e}function SAEF_be32toh(e){return SAEC_LITTLE_ENDIAN?((255&e)<<24|(65280&e)<<8|(16711680&e)>>>8|(4278190080&e)>>>24)>>>0:e}function SAEF_le32toh(e){return SAEC_LITTLE_ENDIAN?e:((255&e)<<24|(65280&e)<<8|(16711680&e)>>>8|(4278190080&e)>>>24)>>>0}function SAEF_le16toh(e){return SAEC_LITTLE_ENDIAN?e:(255&e)<<8|(65280&e)>>8}function SAEO_MAvg(t){var n=new Array(t),t=t,r=0,i=0,a=0;this.clr=function(){a=i=r=0},this.get=function(){return a/r},this.set=function(e){return r<t?(n[r++]=e,a+=e):(a-=n[i],n[i]=e,a+=e,++i>=t&&(i-=t)),a/r}}for(var c,w,k,SAEV_crc32Table=new Uint32Array(256),SAEV_crc16Table=new Uint16Array(256),n=0;n<256;n++){for(w=(c=n)<<8,k=0;k<8;k++)c=(c>>>1^(1&c?3988292384:0))>>>0,w=w<<1&65535^(32768&w?4129:0);SAEV_crc32Table[n]=c,SAEV_crc16Table[n]=w}function SAEF_crc32(e,t,n){var r=4294967295;if("string"==typeof e)for(;0<n--;)r=SAEV_crc32Table[255&(r^e.charCodeAt(t++))]^r>>>8;else for(;0<n--;)r=SAEV_crc32Table[255&(r^e[t++])]^r>>>8;return(4294967295^r)>>>0}function SAEF_crc16(e,t,n){for(var r=65535;0<n--;)r=r<<8&65535^SAEV_crc16Table[255&(r>>8^e[t++])];return r}function SAEF_gettimeofday(e,t){var n=performance.now();n+=performance.timing.navigationStart,n=Math.floor(1e3*n),e.tv_sec=Math.floor(n/1e6),e.tv_usec=n%1e6}function SAEF_timeval_to_amiga(e,t,n){e=1e3*e.tv_sec+Math.floor(e.tv_usec/1e3);(e-=2524608e5)<0&&(e=0),t.days=Math.floor(e/864e5),e-=864e5*t.days,t.mins=Math.floor(e/6e4),e-=6e4*t.mins,t.ticks=Math.floor(e/(1e3/n))}function SAEF_memset(e,t,n,r){for(var i=t,a=t+r;i<a;i++)e[i]=n}function SAEF_memcpy(e,t,n,r,i){for(var a=0;a<i;a++)e[t+a]=n[r+a]}function SAEF_CloneObject(e){return Object.assign({},e)}function SAEF_Array2String(e,t,n){void 0===n&&(n=e.length);for(var r="",i=t=void 0===t?0:t;i<n;i++)r+=String.fromCharCode(e[i]);return r}function SAEF_String2Array(e,t,n){void 0===n&&(n=e.length),void 0===t&&(t=0);for(var r=new Uint8Array(n-t),i=t;i<n;i++)r[i-t]=e.charCodeAt(i);return r}function SAEF_CompareArray(e,t,n){void 0===n&&(n=t.length);for(var r=0;r<n;r++){if(void 0===e[r]||void 0===t[r])return 1;if(e[r]!=t[r])return 1}return 0}function SAEF_CompareArrayAfter(e,t,n,r){void 0===r&&(r=n.length);for(var i=0;i<r;i++){if(void 0===e[t+i]||void 0===n[i])return 1;if(e[t+i]!=n[i])return 1}return 0}var sprintfWrapper={init:function(){if(void 0===arguments)return null;if(arguments.length<1)return null;if("string"!=typeof arguments[0])return null;if("undefined"==typeof RegExp)return null;for(var e,t,n,r=arguments[0],i=new RegExp(/(%([%]|(\-)?(\+|\x20)?(0)?(\d+)?(\.(\d)?)?([bcdfosxX])))/g),a=[],o=[],s=0,c=0,_="";n=i.exec(r);)n[9]&&(s+=1),e=c,t=i.lastIndex-n[0].length,o[o.length]=r.substring(e,t),c=i.lastIndex,a[a.length]={match:n[0],left:!!n[3],sign:n[4]||"",pad:n[5]||" ",min:n[6]||0,precision:n[8],code:n[9]||"%",negative:!!(parseInt(arguments[s])<0),argument:String(arguments[s])};if(o[o.length]=r.substring(c),0==a.length)return r;if(arguments.length-1<s)return null;for(var f=0;f<a.length;f++){var l="%"==a[f].code?"%":"b"==a[f].code?(a[f].argument=String(Math.abs(parseInt(a[f].argument)).toString(2)),sprintfWrapper.convert(a[f],!0)):"c"==a[f].code?(a[f].argument=String(String.fromCharCode(parseInt(Math.abs(parseInt(a[f].argument))))),sprintfWrapper.convert(a[f],!0)):"d"==a[f].code?(a[f].argument=String(Math.abs(parseInt(a[f].argument))),sprintfWrapper.convert(a[f])):"f"==a[f].code?(a[f].argument=String(Math.abs(parseFloat(a[f].argument)).toFixed(a[f].precision||6)),sprintfWrapper.convert(a[f])):"o"==a[f].code?(a[f].argument=String(Math.abs(parseInt(a[f].argument)).toString(8)),sprintfWrapper.convert(a[f])):"s"==a[f].code?(a[f].argument=a[f].argument.substring(0,a[f].precision||a[f].argument.length),sprintfWrapper.convert(a[f],!0)):"x"==a[f].code?(a[f].argument=String(Math.abs(parseInt(a[f].argument)).toString(16)),sprintfWrapper.convert(a[f])):"X"==a[f].code?(a[f].argument=String(Math.abs(parseInt(a[f].argument)).toString(16)),sprintfWrapper.convert(a[f]).toUpperCase()):a[f].match;_+=o[f],_+=l}return _+=o[f]},convert:function(e,t){e.sign=t?"":e.negative?"-":e.sign;var n=e.min-e.argument.length+1-e.sign.length,n=new Array(n<0?0:n).join(e.pad);return e.left?"0"==e.pad||t?e.sign+e.argument+n.replace(/0/g," "):e.sign+e.argument+n:"0"==e.pad||t?e.sign+n+e.argument:n+e.sign+e.argument}},sprintf=sprintfWrapper.init;const SEEK_SET=0,SEEK_CUR=1,SEEK_END=2;function SAEO_ZFile(){this.name="",this.originalname="",this.data=null,this.dataseek=0,this.size=0,this.datasize=0,this.allocsize=0,this.seek=0,this.opencnt=0}function SAEF_ZFile_create(e,t){var n=new SAEO_ZFile;return n.opencnt=1,null!==e&&e.originalname?n.originalname=e.originalname:t.length&&(n.originalname=t),n}function SAEF_ZFile_free(e){e.name="",e.originalname="",e.data=null}function SAEF_ZFile_fopen_empty(e,t,n){e=SAEF_ZFile_create(e,"");return e.name=t.length?t:"",n?(e.data=new Uint8Array(n),e.size=n,e.datasize=n,e.allocsize=n):(e.data=new Uint8Array(1e3),e.size=0,e.allocsize=1e3),e}function SAEF_ZFile_fopen_load_zfile(e){var t=SAEF_ZFile_fopen_empty(e,e.name,e.size);return null===t?null:(SAEF_ZFile_fseek(e,0,SEEK_SET),SAEF_ZFile_fread(t.data,0,e.size,1,e),t)}function SAEF_ZFile_fopen_file(e){if(e.size){var t=SAEF_ZFile_create(null,e.name);t.name=e.name.length?e.name:"",t.data=new Uint8Array(e.size),"string"==typeof e.data?t.data.set(SAEF_String2Array(e.data,0,e.size)):t.data.set(e.data),t.size=e.size,t.datasize=e.size,t.allocsize=e.size;var n,r=(t.data[0]<<24|t.data[1]<<16|t.data[2]<<8|t.data[3])>>>0;if(1347093252!=r&&67324752!=r||SAEF_fatal(SAEE_Config_Compressed,"A ZIP file was detected. Compressed files are not yet supported."),0==SAEF_CompareArray(t.data,SAEF_String2Array("DMS!"),4)){if(null!==(n=(new SAEO_DMS).DMS2ADF(t))){var i=SAEF_ZFile_getdata(n,0,-1);return e.name=SAEF_ZFile_getname(n),e.data=SAEF_Array2String(i),e.size=SAEF_ZFile_size(n),e.prot=!1,n}}else if(0==SAEF_CompareArray(t.data,[0,0,3,243,0,0,0,0],8))if(null!==(n=SAER.disk.EXE2ADF(t))){i=SAEF_ZFile_getdata(n,0,-1);return e.name=SAEF_ZFile_getname(n),e.data=SAEF_Array2String(i),e.size=SAEF_ZFile_size(n),e.prot=!1,n}return t}return null}function SAEF_ZFile_fclose(e){e&&(e.opencnt<0?SAEF_warn("SAEF_ZFile_fclose() tried to free already closed filehandle!"):(e.opencnt--,0<e.opencnt||(e.opencnt=-100,SAEF_ZFile_free(e))))}function SAEF_ZFile_iscompressed(e){return!1}function SAEF_ZFile_resize(e,t){var n;return t>e.allocsize?(e.allocsize=t,SAEF_log("SAEF_ZFile_resize() increase %d -> %d bytes",e.size,e.allocsize),(n=new Uint8Array(e.allocsize)).set(e.data),e.data=n,e.datasize=e.size=t,1):t<e.allocsize?(e.allocsize=t,SAEF_log("SAEF_ZFile_resize() decrease %d -> %d bytes",e.size,e.allocsize),(n=new Uint8Array(e.allocsize)).set(e.data.subarray(0,e.allocsize)),e.data=n,e.datasize=e.size=t,1):0}function SAEF_ZFile_size(e){return e.size}function SAEF_ZFile_ftell(e){return e.seek}function SAEF_ZFile_fseek(e,t,n){var r=0;switch(n){case SEEK_SET:e.seek=t;break;case SEEK_CUR:e.seek+=t;break;case SEEK_END:e.seek=e.size+t}return e.seek<0&&(e.seek=0,r=1),e.seek>e.size&&(e.seek=e.size,r=1),r}function SAEF_ZFile_fread(e,t,n,r,i){return i.datasize<i.size&&i.seek+n*r>i.datasize?(SAEF_warn("SAEF_ZFile_fread() read beyond size"),0):(i.seek+n*r>i.size&&(r=n?Math.truncate((i.size-i.seek)/n):0)<0&&(r=0),e.set(i.data.subarray(i.seek,i.seek+n*r),t),i.seek+=n*r,r)}function SAEF_ZFile_fwrite(e,t,n,r,i){var a,o=i.seek+n*r;return 0==i.allocsize?(SAEF_warn("SAEF_ZFile_fwrite() allocsize == 0, aborting..."),0):(o>i.allocsize&&(i.allocsize<o&&(i.allocsize=o),i.allocsize+=i.size>>1,i.allocsize<1e4&&(i.allocsize=1e4),SAEF_log("SAEF_ZFile_fwrite() relocate %d -> %d bytes",i.size,i.allocsize),(a=new Uint8Array(i.allocsize)).set(i.data),i.data=a,i.datasize=i.size=o),i.data.set(e.subarray(t,t+n*r),i.seek),i.seek+=n*r,i.seek>i.size&&(i.size=i.seek),i.size>i.datasize&&(i.datasize=i.size),r)}function SAEF_ZFile_getdata(e,t,n){var r=SAEF_ZFile_ftell(e);n<0&&(SAEF_ZFile_fseek(e,0,SEEK_END),n=SAEF_ZFile_ftell(e),SAEF_ZFile_fseek(e,0,SEEK_SET));var i=new Uint8Array(n);return SAEF_ZFile_fseek(e,t,SEEK_SET),SAEF_ZFile_fread(i,0,n,1,e),SAEF_ZFile_fseek(e,r,SEEK_SET),i}function SAEF_ZFile_getname(e){return e?e.name:null}function SAEF_ZFile_getoriginalname(e){return e?e.originalname:null}function SAEF_ZFile_getfilename(e){return e.name}function SAEF_ZFile_crc32(e){return null===e?0:SAEF_crc32(e.data,0,e.size)}function CreateEvent(e,t,n,r){var i=new uae_sem_t;return i.manual=0!=t,i.signaled=0!=n,i}function SetEvent(e){return e.signaled=!0}function ResetEvent(e){return!(e.signaled=!1)}const INFINITE=4294967295,WAIT_ABANDONED=128,WAIT_OBJECT_0=0,WAIT_TIMEOUT=258,WAIT_FAILED=4294967295;function WaitForSingleObject(e,t){if(!e.signaled)if(t==INFINITE)for(var n=0;!e.signaled&&n++<200;)SAEF_sleep(5);else 0<t&&SAEF_sleep(t);return e.signaled?(e.manual||ResetEvent(e),WAIT_OBJECT_0):WAIT_TIMEOUT}function uae_sem_init(e,t,n){e.handle?(n?SetEvent:ResetEvent)(e.handle):e.handle=CreateEvent(null,t,n,null)}function uae_sem_wait(e){WaitForSingleObject(e.handle,INFINITE)}function uae_sem_post(e){SetEvent(e.handle)}function uae_sem_t(){this.value=null,this.manual=!1,this.signaled=!1}function smp_comm_pipe(){this.lock={handle:null},this.reader_wait={handle:null},this.writer_wait={handle:null},this.data=null,this.dataView=null,this.size=0,this.chunks=0,this.rdp=0,this.wrp=0,this.reader_waiting=0,this.writer_waiting=0}function init_comm_pipe(e,t,n){e.lock={handle:null},e.reader_wait={handle:null},e.writer_wait={handle:null},e.data=new ArrayBuffer(4*t),e.dataView=new DataView(e.data),e.size=t,e.chunks=n,e.rdp=e.wrp=0,e.reader_waiting=0,e.writer_waiting=0,uae_sem_init(e.lock,0,1),uae_sem_init(e.reader_wait,0,0),uae_sem_init(e.writer_wait,0,0)}function read_comm_pipe_pt_blocking(e,t){var n;switch(uae_sem_wait(e.lock),e.rdp==e.wrp&&(e.reader_waiting=1,uae_sem_post(e.lock),uae_sem_wait(e.reader_wait),uae_sem_wait(e.lock)),t){case 1:n=e.dataView.getInt32(e.rdp<<2,!1);break;case 2:case 3:n=e.dataView.getUint32(e.rdp<<2,!1)}return e.rdp=(e.rdp+1)%e.size,e.writer_waiting&&(e.writer_waiting=0,uae_sem_post(e.writer_wait)),uae_sem_post(e.lock),n}function read_comm_pipe_int_blocking(e){return read_comm_pipe_pt_blocking(e,1)}function read_comm_pipe_u32_blocking(e){return read_comm_pipe_pt_blocking(e,2)}function read_comm_pipe_pvoid_blocking(e){return read_comm_pipe_pt_blocking(e,3)}function maybe_wake_reader(e,t){e.reader_waiting&&(t||(e.wrp-e.rdp+e.size)%e.size>=e.chunks)&&(e.reader_waiting=0,uae_sem_post(e.reader_wait))}function write_comm_pipe_pt(e,t,n,r){var i=(e.wrp+1)%e.size;if(e.reader_waiting){switch(t){case 1:e.dataView.setInt32(e.wrp<<2,n,SAEC_LITTLE_ENDIAN);break;case 2:case 3:e.dataView.setUint32(e.wrp<<2,n,SAEC_LITTLE_ENDIAN)}return e.wrp=i,void maybe_wake_reader(e,r)}switch(uae_sem_wait(e.lock),i==e.rdp&&(e.writer_waiting=1,uae_sem_post(e.lock),uae_sem_wait(e.writer_wait),uae_sem_wait(e.lock)),t){case 1:e.dataView.setInt32(e.wrp<<2,n,SAEC_LITTLE_ENDIAN);break;case 2:case 3:e.dataView.setUint32(e.wrp<<2,n,SAEC_LITTLE_ENDIAN)}e.wrp=i,maybe_wake_reader(e,r),uae_sem_post(e.lock)}function write_comm_pipe_int(e,t,n){write_comm_pipe_pt(e,1,t,n)}function write_comm_pipe_u32(e,t,n){write_comm_pipe_pt(e,2,t,n)}function write_comm_pipe_pvoid(e,t,n){write_comm_pipe_pt(e,3,t,n)}function SAEO_DMS(){const v=!1,b=0,C=1;const k=5,R=6,w=7,x=8,h=9,g=10;const E=12,y=13,o=14,s=15;const D=18;const M=1,F=2,T=3,V=4;const I=6;const c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,22,22,22,22,23,23,23,23,24,24,25,25,26,26,27,27,28,28,29,29,30,30,31,31,32,32,33,33,34,34,35,35,36,36,37,37,38,38,39,39,40,40,41,41,42,42,43,43,44,44,45,45,46,46,47,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63],_=[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],f=0,l=1,d=2,p=3;var A=new Uint16Array(4);const t=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215];var n=null,r=0,i=0,a=0;function S(e){return a>>>i-e&65535}function m(e){for(i-=e,a&=t[i];i<16;)a=(a<<8|n[r++])>>>0,i+=8}function P(e){n=e,m(r=i=a=0)}function z(e,t,n){for(var r,i=0,a=0,o=0,s=0;a<n;)if(144!=(s=e[i++]))t[a++]=s;else if(r=e[i++]){if(s=e[i++],n<a+(o=255==r?((o=e[i++])<<8)+e[i++]:r))return 1;SAEF_memset(t,a,s,o),a+=o}else t[a++]=s}const O=255;const L=16383;const N=16383;const B=2,U=256-B+60,K=2*U-1,G=K-1,H=32768;var X=new Uint16Array(K+1),q=new Uint16Array(K+U),Z=new Uint16Array(K),j=!0;function Y(e){var t,n,r,i=0;X[G]==H&&function(){for(var e,t,n=0,r=0,i=0,a=0,n=0;n<K;n++)Z[n]>=K&&(X[r]=X[n]+1>>1,Z[r]=Z[n],r++);for(n=0,r=U;r<K;n+=2,r++){for(e=X[r]=X[n]+X[i=n+1],i=r-1;e<X[i];i--);for(a=(t=r-++i)-1;0<=a;a--)X[i+a+1]=X[i+a];for(X[i]=e,a=t-1;0<=a;a--)Z[i+a+1]=Z[i+a];Z[i]=n}for(n=0;n<K;n++)(i=Z[n])>=K?q[i]=n:q[i]=q[i+1]=n}(),e=q[e+K];do{if((r=++X[e])>X[i=e+1]){for(;r>X[++i];);i--,X[e]=X[i],X[i]=r,t=Z[e],q[t]=i,t<K&&(q[t+1]=i),n=Z[i],Z[i]=t,q[n]=e,n<K&&(q[n+1]=e),Z[e]=n,e=i}}while(0!=(e=q[e]))}function W(e,t,n){var r,i=0,a=0,o=0;for(P(e),j&&function(){for(var e=0;e<U;e++)X[e]=1,Z[e]=e+K,q[e+K]=e;for(var e=0,t=U;t<=G;)X[t]=X[e]+X[e+1],Z[t]=e,q[e]=q[e+1]=t,e+=2,t++;X[K]=65535,q[G]=0,j=!1}();i<n;)if((r=function(){for(var e=Z[G];e<K;)e=Z[e+S(1)],m(1);return Y(e-=K),e}())<256)t[i++]=ye[A[p]++&N]=255&r;else for(o=r-255+B,a=A[p]-function(){var e=S(8);m(8);var t=c[e]<<8,n=_[e],e=255&(e<<n|S(n));return m(n),t|e}()-1;o--;)t[i++]=ye[A[p]++&N]=ye[a++&N];A[p]=A[p]+60&N}const J=510,Q=253;var $=new Uint8Array(510),ee=new Uint16Array(4096),te=new Uint8Array(20),ne=new Uint16Array(256),re=new Uint16Array(1019),ie=new Uint16Array(1028),ae=0,oe=0;function se(e,t,n,r){var i=0,a=0,o=0,s=0,c=0,_=0,f=0,l=0,u=0,d=null,p=0,E=null;function A(){var e=0;if(p)return 0;if(s==c){for(;++i<a;)if(E[i]==s){if(e=l,o<(l+=u))return p=1,0;for(;e<l;)d[e++]=i;return i}i=-1,s++,u>>=1}if(++c<_)A(),A();else{if(32<c)return p=2,0;if((e=f++)>=2*a-1)return p=3,0;if(re[e]=A(),ie[e]=A(),o<=l)return p=4,0;c==_&&(d[l++]=e)}return c--,e}return a=f=e,E=t,d=r,u=(o=1<<n)>>1,_=n+1,c=s=1,i=-1,p=l=0,A(),p||(A(),p||l!=o)}function ce(e,t,n,r){var i;if(i=8&n?(oe=15,8191):(oe=14,4095),P(e),2&n){if(function(){var e=S(9);if(m(9),0<e){for(var t=0;t<e;t++)$[t]=255&S(5),m(5);for(t=e;t<510;t++)$[t]=0;if(se(510,$,12,ee))return 1}else{e=S(9),m(9);for(t=0;t<510;t++)$[t]=0;for(t=0;t<4096;t++)ee[t]=e}}())return 1;if(function(){var e=S(5);if(m(5),0<e){for(var t=0;t<e;t++)te[t]=255&S(4),m(4);for(t=e;t<oe;t++)te[t]=0;if(se(oe,te,8,ne))return 1}else{e=S(5),m(5);for(t=0;t<oe;t++)te[t]=0;for(t=0;t<256;t++)ne[t]=e}}())return 1}for(var a=0;a<r;){var o=function(){var e=ee[S(12)];if(e<J)m($[e]);else{m(12);for(var t=S(16),n=32768;e=(t&n?ie:re)[e],n>>=1,e>=J;);m($[e]-12)}return e}();if(o<256)t[a++]=ye[A[d]++&i]=o;else for(var s=o-Q,c=A[d]-function(){var e=ne[S(8)];if(e<oe)m(te[e]);else{m(8);for(var t=S(16),n=32768;e=(t&n?ie:re)[e],n>>=1,oe<=e;);m(te[e]-8)}return e!=oe-1&&(0<e&&(e=S(t=e-1)|1<<e-1,m(t)),ae=e),ae}()-1;s--;)t[a++]=ye[A[d]++&i]=ye[c++&i]}}function _e(){A[f]=251,A[l]=16318,A[d]=0,oe=ae=0,A[p]=16324,j=!0,SAEF_memset(ye,0,0,16328)}const fe=56,le=20,ue=32e3,de=32e3,pe=2,Ee=16,Ae=10,Se=["NOCOMP","SIMPLE","QUICK ","MEDIUM","DEEP  ","HEAVY1","HEAVY2"];var me=0,he=0,ge=0,ye=null;function ve(e){SAEF_warn("DMS() Ignored error on track %d!\n",e)}function be(e,t){v&&SAEF_log(SAEF_Array2String(e,0,t))}function Ce(e,t){for(var n=0,r=0;t--;)65535<(n+=e[r++])&&(n-=65536);return n}const ke=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function Re(e,t,n){for(var r=0;n--;)r=ke[255&(r^e[t++])]^r>>8&255;return r}function we(e,t,n,r){if(null!==t){for(var i=0;i<Ae&&null!==t[i];i++);i==Ae||null!==(e=SAEF_ZFile_fopen_empty(null,e,r))&&(SAEF_ZFile_fwrite(n,0,r,1,e),SAEF_ZFile_fseek(e,0,SEEK_SET),t[i]=e)}}function xe(e,t,n){for(var r,i=0,a=0;t--;)r=n[i++],e[a++]=r^255&me,me=(me>>1)+r&65535}function De(e,t,n,r,i,a){switch(i){case 0:t.set(e.subarray(0,r));break;case 1:if(z(e,t,r))return o;break;case 2:if(function(e,t,n){var r=0,i=0,a=0;for(P(e);r<n;)if(0!=S(1))m(1),t[r++]=ye[A[f]++&O]=255&S(8),m(8);else for(m(1),a=S(2)+2,m(2),i=A[f]-S(8)-1,m(8);a--;)t[r++]=ye[A[f]++&O]=ye[i++&O];A[f]=A[f]+5&O}(e,t,n),z(t,e,r))return o;t.set(e.subarray(0,r));break;case 3:if(function(e,t,n){var r,i=0,a=0,o=0;for(P(e);i<n;)if(0!=S(1))m(1),t[i++]=ye[A[l]++&L]=255&S(8),m(8);else for(m(1),r=S(8),m(8),o=c[r]+3,u=_[r],r=255&(r<<u|S(u)),m(u),u=_[r],r=c[r]<<8|255&(r<<u|S(u)),m(u),a=A[l]-r-1;o--;)t[i++]=ye[A[l]++&L]=ye[a++&L];A[l]=A[l]+66&L}(e,t,n),z(t,e,r))return o;t.set(e.subarray(0,r));break;case 4:if(W(e,t,n),z(t,e,r))return o;t.set(e.subarray(0,r));break;case 5:case 6:if(5==i){if(ce(e,t,7&a,n))return o}else if(ce(e,t,8|a,n))return o;if(4&a){if(SAEF_memset(e,0,0,r),z(t,e,r))return o;t.set(e.subarray(0,r))}break;default:return s}return 1&a||_e(),b}var Me=0;function Fe(e,t,n,r,i,a,o,s,c,_){var f=b,l=0;if(he){if(80!=o&&xe(e,s,e),De(e,t,n,r,i,a)==b&&c==Ce(t,r))return b;if(ve(o),ge<=0)return E}ge--;var u=0,d=0,p=new Uint8Array(s);for(p.set(e.subarray(0,s)),SAEF_memset(t,0,0,r);;){if(De(e,t,n,r,i,a)==b&&c==Ce(t,r)){(he=d)&&SAEF_log("DMS() decryption key = 0x%04X\n",l),f=b,Me=l;break}if(80==o||!_){f=E;break}if(d=1,me=l=Me,Me++,xe(e,s,p),65536==++u){f=E,he=0;break}}return f}function Te(e,t,n,r,i,a,o,s){var c=0,_=SAEF_ZFile_fread(n,0,1,le,e);if(_!=le)return 0==_?C:R;if(84!=n[0]||82!=n[1])return x;var f=n[le-2]<<8|n[le-1];if(Re(n,0,le-2)!=f)return g;var l=n[2]<<8|n[3],u=n[6]<<8|n[7],d=n[8]<<8|n[9],p=n[10]<<8|n[11],E=n[12],A=n[13],S=n[14]<<8|n[15],m=n[16]<<8|n[17];if(v&&(_="",_+=80==l?" FileID   ":65535==l?" Banner   ":0==l&&1024==p?" FakeBB   ":sprintf("   %2d     ",l),SAEF_log(_+=sprintf("%5d    %5d   %s  %04X  %04X  %04X    %0d",u,p,Se[A],S,f,m,E))),u>ue||d>ue||p>ue)return h;if(SAEF_ZFile_fread(n,0,1,u,e)!=u)return R;Re(n,0,u)!=m&&(ve(l),c=1);m=!1;if(i==I&&l<80&&2048<p){if(SAEF_memset(r,0,0,p),c||Fe(n,r,d,p,A,E,l,u,S,o&pe),0==l&&11264==SAEF_ZFile_ftell(t)&&(SAEF_ZFile_fseek(t,0,SEEK_SET),SAEF_ZFile_fread(i=new Uint8Array(11264),0,11264,1,t),we("BigFakeBootBlock",s,i,11264),delete i),SAEF_ZFile_fseek(t,512*l*22*(o&Ee?2:1),SEEK_SET),SAEF_ZFile_fwrite(r,0,1,p,t)!=p)return y;m=!0}else 0==l&&1024==p&&(r.set(0,0,p),c||Fe(n,r,d,p,A,E,l,u,S,o&pe),we("FakeBootBlock",s,r,p));return c||(65535==l&&(Fe(n,r,d,p,A,E,l,u,S,o&pe),s&&we("Banner",s,r,p),be(r,p)),80==l&&(Fe(n,r,d,p,A,E,l,u,S,o&pe),s&&we("FILEID.DIZ",s,r,p),be(r,p)),m||_e()),b}function Ve(e,t,n,r,i,a,o,s){if(he=0,ge=2,b1=new Uint8Array(ue),b2=new Uint8Array(ue),ye=new Uint8Array(de),SAEF_ZFile_fread(b1,0,1,fe,e)!=fe)return ye=null,R;if(68!=b1[0]||77!=b1[1]||83!=b1[2]||33!=b1[3])return ye=null,k;var c=b1[fe-2]<<8|b1[fe-1];if(c!=Re(b1,4,fe-6))return ye=null,w;var _=b1[10]<<8|b1[11],f=(b1[12]<<24|b1[13]<<16|b1[14]<<8|b1[15])>>>0,l=b1[16]<<8|b1[17],u=b1[18]<<8|b1[19];if(o&&l<30)return ye=null,C;var d,p=(b1[21]<<16|b1[22]<<8|b1[23])>>>0,E=(b1[25]<<16|b1[26]<<8|b1[27])>>>0,A=b1[46]<<8|b1[47],S=b1[50]<<8|b1[51],m=b1[52]<<8|b1[53];if(me=i,v){var h=Math.floor(A/100);SAEF_log(" Created with DMS version %d.%02d %s\n",h,A-100*h,128&_?"Registered":"Evaluation"),SAEF_log(" Creation date : %s",(d=f,i=(o=new Date(1e3*d)).getFullYear(),A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][o.getMonth()],h=o.getDate(),f=o.getHours(),d=o.getMinutes(),o=o.getSeconds(),h+" "+A+" "+i+" "+sprintf("%02d:%02d:%02d",f,d,o))),SAEF_log(" Lowest track in archive : %d\n",l),SAEF_log(" Highest track in archive : %d\n",u),SAEF_log(" Packed data size : %d\n",p),SAEF_log(" Unpacked data size : %d\n",E);var g=" Disk type of archive : ";switch(S){case 0:case 1:g+="AmigaOS 1.0 OFS\n";break;case 2:g+="AmigaOS 2.0 FFS\n";break;case 3:g+="AmigaOS 3.0 OFS / International\n";break;case 4:g+="AmigaOS 3.0 FFS / International\n";break;case 5:g+="AmigaOS 3.0 OFS / Dir Cache\n";break;case 6:g+="AmigaOS 3.0 FFS / Dir Cache\n";break;case 7:g+="FMS Amiga System File\n";break;default:g+="Unknown\n"}SAEF_log(g),g=" Compression mode used : ",SAEF_log(g+=6<m?"Unknown !\n":Se[m]+"\n"),g=" General info : ",0!=_&&128!=_||(g+="None"),1&_&&(g+="NoZero "),2&_&&(g+="Encrypted "),4&_&&(g+="Appends "),8&_&&(g+="Banner "),16&_&&(g+="HD "),32&_&&(g+="MS-DOS "),64&_&&(g+="DMS_DEV_Fixed "),256&_&&(g+="FILEID.DIZ"),SAEF_log(g+="\n"),SAEF_log(" Info Header CRC : %04X\n\n",c)}if(7==S)return ye=null,D;v&&(SAEF_log(" Track   Plength  Ulength  Cmode   USUM  HCRC  DCRC Cflag\n"),SAEF_log(" ------  -------  -------  ------  ----  ----  ---- -----\n"));var y=b;if(_e(),n!=M)if(n==V)y=Te(e,null,b1,b2,n,0,_,s);else for(_e();(y=Te(e,t,b1,b2,n,0,_,s))!=C&&y==b;);return n!=F&&n!=T&&n!=V||SAEF_log("\n"),(y=y==C?b:y)==x&&(y=b),ye=null,y}this.DMS2ADF=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=null);for(var r=SAEF_ZFile_getname(e),i="",a=new Array(Ae),o=0;o<Ae;o++)a[o]=null;var s=r.lastIndexOf(".");if(-1!=s?(i=r.substr(0,s),i+=".ADF"):i=r+".ADF",null===(n=SAEF_ZFile_fopen_empty(e,i,901120)))return null;Me=0;s=Ve(e,n,I,0,0,0,!1,a);if(s==b){if(SAEF_ZFile_fseek(n,0,SEEK_SET),0<t){SAEF_ZFile_fclose(n);for(var n=null,c=0;c<Ae&&a[c];c++);if(c<t){for(c=0;c<Ae;c++)SAEF_ZFile_fclose(a[c]);return n}n=a[t-1],a[t-1]=null}SAEF_ZFile_fclose(e),e=null,SAEF_log("DMS() converted '%s' to '%s'",r,i)}else SAEF_ZFile_fclose(n),n=null,alert(sprintf("Can't convert '%s' to ADF. (error %d)",r,s));for(c=0;c<Ae;c++)SAEF_ZFile_fclose(a[c]);return n}}var SAEV_config={};const SAEC_Model_A500=1,SAEC_Model_A500P=2,SAEC_Model_A600=3,SAEC_Model_A1000=4,SAEC_Model_A1200=5,SAEC_Model_A2000=6,SAEC_Model_A3000=7,SAEC_Model_A4000=8,SAEC_Model_A4000T=9,SAEC_Model_CDTV=10,SAEC_Model_CD32=11;function SAEO_Config_File(){this.name="",this.data="",this.size=0,this.crc32=!1,this.prot=!1,this.clr=function(){this.name="",this.data="",this.size=0,this.crc32=!1,this.prot=!1}}const SAEC_Config_CPU_Model_68000=68e3,SAEC_Config_CPU_Model_68010=68010,SAEC_Config_CPU_Model_68020=68020,SAEC_Config_CPU_Model_68030=68030,SAEC_Config_CPU_Model_68040=68040,SAEC_Config_CPU_Model_68060=68060,SAEC_Config_CPU_Speed_Maximum=-1,SAEC_Config_CPU_Speed_Original=0,SAEC_Config_Chipset_Mask_OCS=0,SAEC_Config_Chipset_Mask_ECS_AGNUS=1,SAEC_Config_Chipset_Mask_ECS_DENISE=2,SAEC_Config_Chipset_Mask_AGA=4,SAEC_Config_Chipset_ColLevel_None=0,SAEC_Config_Chipset_ColLevel_Sprite_Sprite=1,SAEC_Config_Chipset_ColLevel_Sprite_Playfield=2,SAEC_Config_Chipset_ColLevel_Full=3,SAEC_Config_Chipset_CR_MAX=10,SAEC_Config_Chipset_CR_PAL=SAEC_Config_Chipset_CR_MAX+0,SAEC_Config_Chipset_CR_NTSC=SAEC_Config_Chipset_CR_MAX+1,SAEC_Config_Chipset_CR_TOTAL=SAEC_Config_Chipset_CR_MAX+2;function SAEO_Config_Chipset_Refresh(){this.index=0,this.locked=!1,this.rtg=!1,this.horiz=0,this.vert=0,this.lace=0,this.ntsc=!1,this.vsync=0,this.framelength=0,this.rate=0,this.label="",this.commands=""}const SAEC_Config_Chipset_Compatible_Manual=0,SAEC_Config_Chipset_Compatible_Generic=1,SAEC_Config_Chipset_Compatible_A500=2,SAEC_Config_Chipset_Compatible_A500P=3,SAEC_Config_Chipset_Compatible_A600=4,SAEC_Config_Chipset_Compatible_A1000=5,SAEC_Config_Chipset_Compatible_A1000V=6,SAEC_Config_Chipset_Compatible_A1200=7,SAEC_Config_Chipset_Compatible_A2000=8,SAEC_Config_Chipset_Compatible_A3000=9,SAEC_Config_Chipset_Compatible_A4000=10,SAEC_Config_Chipset_Compatible_A4000T=11,SAEC_Config_Chipset_Compatible_CDTV=12,SAEC_Config_Chipset_Compatible_CDTVCR=13,SAEC_Config_Chipset_Compatible_CD32=14,SAEC_Config_Chipset_CIA_TOD_VSync=0,SAEC_Config_Chipset_CIA_TOD_50Hz=1,SAEC_Config_Chipset_CIA_TOD_60Hz=2,SAEC_Config_RTC_Type_None=0,SAEC_Config_RTC_Type_MSM6242B=1,SAEC_Config_RTC_Type_RF5C01A=2,SAEC_Config_RTC_Type_MSM6242B_A2000=3,SAEC_Config_Chipset_IDE_A600A1200=1,SAEC_Config_Chipset_IDE_A4000=2,SAEC_Config_Memory_z3Mapping_Auto=0,SAEC_Config_Memory_z3Mapping_SAE=1,SAEC_Config_Memory_z3Mapping_Real=2,SAEC_Config_Floppy_Type_None=0,SAEC_Config_Floppy_Type_35_DD=1,SAEC_Config_Floppy_Type_35_HD=2,SAEC_Config_Floppy_Type_35_DD_ESCOM=3,SAEC_Config_Floppy_Type_35_DD_PC=4,SAEC_Config_Floppy_Type_35_HD_PC=5,SAEC_Config_Floppy_Type_525_SD=6,SAEC_Config_Floppy_Speed_Turbo=0,SAEC_Config_Floppy_Speed_Original=100;function SAEO_Config_Floppy_Drive(){this.type=SAEC_Config_Floppy_Type_None,this.file=new SAEO_Config_File}const SAEC_Config_Mount_Controller_Type_MB_IDE=1,SAEC_Config_Mount_Controller_Type_PCMCIA_SRAM=2,SAEC_Config_Mount_Controller_Type_PCMCIA_IDE=3,SAEC_Config_Mount_Controller_Level_ATA_1=0,SAEC_Config_Mount_Controller_Level_ATA_2=1,SAEC_Config_Mount_Controller_Level_ATA_2S=2,SAEC_Config_Mount_Controller_Level_SCSI_1=0,SAEC_Config_Mount_Controller_Level_SCSI_2=1,SAEC_Config_Mount_Controller_Level_SASI=2,SAEC_Config_Mount_Controller_Level_SASI_ENHANCED=2,SAEC_Config_Mount_Controller_Level_SASI_CHS=3,SAEC_Config_Mount_Bootpri_NOAUTOBOOT=-128,SAEC_Config_Mount_Bootpri_NOAUTOMOUNT=-129;function SAEO_Config_Mount_Info(){this.controller_type=0,this.controller_unit=0,this.controller_media_type=0,this.unit_feature_level=0,this.unit_special_flags=0,this.type=0,this.file=new SAEO_Config_File,this.readonly=!1,this.blocksize=0,this.cyls=0,this.surfaces=0,this.sectors=0,this.interleave=!1,this.physical_geometry=!1,this.pcyls=0,this.pheads=0,this.psecs=0,this.bootable=!1,this.automount=!1,this.unit=0,this.flags=0,this.devname="",this.sectorsperblock=0,this.reserved=0,this.lowcyl=0,this.highcyl=0,this.buffers=0,this.bufmemtype=0,this.maxtransfer=0,this.mask=0,this.bootpri=0,this.dostype=0,this.filesys="",this.stacksize=0,this.priority=0}function SAEO_Config_Mount_Data(){this.ci=new SAEO_Config_Mount_Info,this.configoffset=0,this.unitnum=0}const SAEC_Config_Video_API_Canvas=0,SAEC_Config_Video_API_WebGL=1,SAEC_Config_Video_Cursor_Show=0,SAEC_Config_Video_Cursor_Hide=1,SAEC_Config_Video_Cursor_Lock=2,SAEC_Config_Video_HResolution_LoRes=0,SAEC_Config_Video_HResolution_HiRes=1,SAEC_Config_Video_HResolution_SuperHiRes=2,SAEC_Config_Video_VResolution_NonDouble=0,SAEC_Config_Video_VResolution_Double=1,SAEC_Config_Video_AP_Fullscreen_WINDOW=0,SAEC_Config_Video_AP_Fullscreen_FULLSCREEN=1,SAEC_Config_Video_AP_Fullscreen_FULLWINDOW=2;function SAEO_Config_Video_WH(){this.x=0,this.y=0,this.width=0,this.height=0,this.special=!1}function SAEO_Config_Video_APMode(){this.gfx_fullscreen=0,this.gfx_display=0,this.gfx_vsync=0,this.gfx_vflip=0,this.gfx_strobo=!1,this.gfx_vsyncmode=0,this.gfx_backbuffers=0,this.gfx_interlaced=!1,this.gfx_refreshrate=0}const MAX_FILTERSHADERS=4;function SAEO_Config_Video_FilterData(){this.gfx_filter=0,this.gfx_filtershader=new Array(2*MAX_FILTERSHADERS+1),this.gfx_filtermask=new Array(2*MAX_FILTERSHADERS+1),this.gfx_filteroverlay="",this.gfx_filteroverlay_pos=new SAEO_Config_Video_WH,this.gfx_filteroverlay_overscan=0,this.gfx_filter_scanlines=0,this.gfx_filter_scanlineratio=0,this.gfx_filter_scanlinelevel=0,this.gfx_filter_horiz_zoom=0,this.gfx_filter_vert_zoom=0,this.gfx_filter_horiz_zoom_mult=0,this.gfx_filter_vert_zoom_mult=0,this.gfx_filter_horiz_offset=0,this.gfx_filter_vert_offset=0,this.gfx_filter_left_border=0,this.gfx_filter_right_border=0,this.gfx_filter_top_border=0,this.gfx_filter_bottom_border=0,this.gfx_filter_filtermode=0,this.gfx_filter_bilinear=0,this.gfx_filter_noise=0,this.gfx_filter_blur=0,this.gfx_filter_saturation=0,this.gfx_filter_luminance=0,this.gfx_filter_contrast=0,this.gfx_filter_gamma=0,this.gfx_filter_gamma_ch=[0,0,0],this.gfx_filter_keep_aspect=0,this.gfx_filter_aspect=0,this.gfx_filter_autoscale=0,this.gfx_filter_integerscalelimit=0;for(var e=this.gfx_filter_keep_autoscale_aspect=0;e<2*MAX_FILTERSHADERS+1;e++)this.gfx_filtershader[e]="",this.gfx_filtermask[e]=""}const SAEC_Config_Audio_Mode_Off=0,SAEC_Config_Audio_Mode_Off_Emul=1,SAEC_Config_Audio_Mode_On=2,SAEC_Config_Audio_Mode_On_Best=3,SAEC_Config_Audio_Freq_Auto=0,SAEC_Config_Audio_Freq_11025=11025,SAEC_Config_Audio_Freq_22050=22050,SAEC_Config_Audio_Freq_44100=44100,SAEC_Config_Audio_Freq_48000=48e3,SAEC_Config_Audio_Channels_Mono=1,SAEC_Config_Audio_Channels_Stereo=2,SAEC_Config_Audio_Filter_Off=0,SAEC_Config_Audio_Filter_Emul=1,SAEC_Config_Audio_Filter_On=2,SAEC_Config_Audio_FilterType_A500=0,SAEC_Config_Audio_FilterType_A1200=1,SAEC_Config_Audio_Interpol_None=0,SAEC_Config_Audio_Interpol_Anti=1,SAEC_Config_Audio_Interpol_RH=2,SAEC_Config_Audio_Interpol_Crux=3,SAEC_Config_Ports_Type_None=0,SAEC_Config_Ports_Type_Mouse=1,SAEC_Config_Ports_Type_Joy=2,SAEC_Config_Ports_Type_JoyEmu=3,SAEC_Config_Ports_Move_None=0,SAEC_Config_Ports_Move_Arrows=1,SAEC_Config_Ports_Move_Numpad=2,SAEC_Config_Ports_Move_WASD=3,SAEC_Config_Ports_Fire_None=0,SAEC_Config_Ports_Device_None=-1,SAEC_Config_Debug_Level_Fatal=0,SAEC_Config_Debug_Level_Error=1,SAEC_Config_Debug_Level_Warn=2,SAEC_Config_Debug_Level_Info=3,SAEC_Config_Debug_Level_Log=4;function SAEO_Config(){this.cpu={model:0,speed:0,speedThrottle:0,clock:{multiplier:0,frequency:0},compatible:!1,addressSpace24:!1,resetDelay:!1},this.chipset={mask:0,ntsc:!1,genlock:!1,colLevel:0,refreshRate:0,refresh:null,blitter:{immediate:!1,waiting:0,cycle_exact:!1},cia:{todHack:!1,todBug:!1,tod:0,overlay:!1,type6526:!1},rtc:{type:0,adjust:0},compatible:0,mirrorE0:!1,mirrorA8:!1,a1000ram:!1,agnusRev:0,agnusDIP:!1,agnusBltBusyBug:!1,deniseRev:0,deniseNoEHB:!1,fatGaryRev:0,ramseyRev:0,df0idhw:!1,ide:0,pcmcia:!1,mbdmac:0,jumper1MbChip:!1,bogomemIsFast:!1,z3AutoConfig:!1},this.memory={rom:new SAEO_Config_File,extRom:new SAEO_Config_File,romKey:new SAEO_Config_File,amaxRom:new SAEO_Config_File,kickShifter:!1,chipSize:0,bogoSize:0,z2FastSize:0,z2FastAutoConfig:!1,z3FastSize:0,z3Mapping:0,z3AutoConfigStart:0,ramsey:{lowSize:0,highSize:0},custom:[{addr:0,size:0,mask:0},{addr:0,size:0,mask:0}],logIllegal:!1},this.floppy={drive:null,readOnly:!1,randomBitsMin:0,randomBitsMax:0,speed:0,autoEXT2:0},this.mount={items:0,config:null},this.video={id:"",enabled:!1,cursor:0,scandoubler:!1,framerate:0,hresolution:0,vresolution:0,pscanlines:0,iscanlines:0,xcenter:0,ycenter:0,lores_mode:!1,extrawidth:0,backgroundColor:0,luminance:0,contrast:0,gamma:0,gammaCh:[0,0,0],alpha:0,antialias:!1,size:new SAEO_Config_Video_WH,size_win:new SAEO_Config_Video_WH,size_fs:new SAEO_Config_Video_WH,apmode:null,gf:null,api:0,colorMode:0,blackerThanBlack:!1,refreshIndicator:!1},this.audio={bufferFrames:0,mode:0,channels:0,freq:0,stereoSeparation:0,stereoDelay:0,interpol:0,filter:0,filterType:0},this.dongle=0,this.ports=[{type:SAEC_Config_Ports_Type_Mouse,move:SAEC_Config_Ports_Move_WASD,fire:[49,50],device:SAEC_Config_Ports_Device_None},{type:SAEC_Config_Ports_Type_JoyEmu,move:SAEC_Config_Ports_Move_Arrows,fire:[16,17],device:SAEC_Config_Ports_Device_None}],this.keyboard={enabled:!0},this.serial={enabled:!1},this.parallel={enabled:!1},this.hook={log:{error:function(e,t){}},led:{power:function(e){},hd:function(e){},df:function(e,t,n,r,i){},fps:function(e,t){},cpu:function(e,t){}},event:{started:function(){},stopped:function(){},reseted:function(e){},paused:function(e){},screened:function(e){}},serial:{get:function(){return-1},put:function(e){}},parallel:{get:function(){return 0},put:function(e){}}},this.debug={level:0},this.chipset.refresh=new Array(SAEC_Config_Chipset_CR_TOTAL);for(var e=0;e<SAEC_Config_Chipset_CR_TOTAL;e++)this.chipset.refresh[e]=new SAEO_Config_Chipset_Refresh;for(this.floppy.drive=new Array(4),e=0;e<4;e++)this.floppy.drive[e]=new SAEO_Config_Floppy_Drive;for(this.mount.config=new Array(6),e=0;e<6;e++)this.mount.config[e]=new SAEO_Config_Mount_Data;for(this.video.apmode=new Array(2),e=0;e<2;e++)this.video.apmode[e]=new SAEO_Config_Video_APMode;for(this.video.gf=new Array(2),e=0;e<2;e++)this.video.gf[e]=new SAEO_Config_Video_FilterData}function SAEO_Configuration(){function e(e){var t;e.cpu.model=SAEC_Config_CPU_Model_68000,e.cpu.speed=SAEC_Config_CPU_Speed_Original,e.cpu.speedThrottle=0,e.cpu.clock.multiplier=0,e.cpu.clock.frequency=0,e.cpu.compatible=!1,e.cpu.addressSpace24=!0,e.chipset.mask=SAEC_Config_Chipset_Mask_ECS_AGNUS,e.chipset.colLevel=SAEC_Config_Chipset_ColLevel_Sprite_Playfield,e.chipset.ntsc=!1,e.chipset.genlock=!1;for(var n=0;n<e.chipset.refresh.length;n++)(t=e.chipset.refresh[n]).index=n,t.rate=-1;(t=e.chipset.refresh[SAEC_Config_Chipset_CR_PAL]).index=SAEC_Config_Chipset_CR_PAL,t.horiz=-1,t.vert=-1,t.lace=-1,t.vsync=-1,t.framelength=-1,t.rate=50,t.ntsc=!1,t.locked=!1,t.label="PAL",(t=e.chipset.refresh[SAEC_Config_Chipset_CR_NTSC]).index=SAEC_Config_Chipset_CR_NTSC,t.horiz=-1,t.vert=-1,t.lace=-1,t.vsync=-1,t.framelength=-1,t.rate=60,t.ntsc=!0,t.locked=!1,t.label="NTSC",e.chipset.blitter.immediate=!1,e.chipset.blitter.waiting=0,e.chipset.blitter.cycle_exact=!1,e.chipset.cia.todHack=!1,e.chipset.cia.todBug=!1,e.chipset.cia.tod=SAEC_Config_Chipset_CIA_TOD_VSync,e.chipset.cia.overlay=!0,e.chipset.rtc.type=SAEC_Config_RTC_Type_None,e.chipset.compatible=SAEC_Config_Chipset_Compatible_Generic,e.chipset.a1000ram=0,e.chipset.mirrorE0=!0,e.chipset.mirrorA8=!1,e.chipset.agnusRev=-1,e.chipset.deniseRev=-1,e.chipset.fatGaryRev=-1,e.chipset.ramseyRev=-1,e.chipset.df0idhw=!0,e.chipset.ide=0,e.chipset.pcmcia=!1,e.chipset.mbdmac=0,e.chipset.z3AutoConfig=!1,e.chipset.bogomemIsFast=!1,e.memory.rom.clr(),e.memory.extRom.clr(),e.memory.romKey.clr(),e.memory.amaxRom.clr(),e.memory.chipSize=524288,e.memory.bogoSize=524288,e.memory.z2FastSize=0,e.memory.z2FastAutoConfig=!0,e.memory.z3FastSize=0,e.memory.z3Mapping=SAEC_Config_Memory_z3Mapping_Auto,e.memory.z3AutoConfigStart=268435456,e.memory.ramsey.lowSize=0,e.memory.ramsey.highSize=0,e.memory.custom[0].addr=0,e.memory.custom[0].size=0,e.memory.custom[1].addr=0,e.memory.custom[1].size=0,e.logIllegal=!1,e.floppy.drive[0].type=SAEC_Config_Floppy_Type_35_DD,e.floppy.drive[1].type=SAEC_Config_Floppy_Type_35_DD,e.floppy.drive[2].type=SAEC_Config_Floppy_Type_None,e.floppy.drive[3].type=SAEC_Config_Floppy_Type_None,e.floppy.drive[0].file.clr(),e.floppy.drive[1].file.clr(),e.floppy.drive[2].file.clr(),e.floppy.drive[3].file.clr(),e.floppy.readOnly=!1,e.floppy.randomBitsMin=1,e.floppy.randomBitsMax=3,e.floppy.speed=100;for(n=e.floppy.autoEXT2=0;n<6;n++)e.mount.config[n].configoffset=-1,e.mount.config[n].unitnum=-1;e.video.id="video",e.video.enabled=!0,e.video.cursor=SAEC_Config_Video_Cursor_Lock,e.video.scandoubler=!1,e.video.framerate=1,e.video.hresolution=SAEC_Config_Video_HResolution_HiRes,e.video.vresolution=SAEC_Config_Video_VResolution_Double,e.video.pscanlines=0,e.video.iscanlines=0,e.video.xcenter=0,e.video.ycenter=0,e.video.backgroundColor=0,e.video.luminance=0,e.video.contrast=0,e.video.gamma=0,e.video.alpha=255,e.video.antialias=!0,e.video.size_fs.width=screen.width,e.video.size_fs.height=screen.height,e.video.size_win.width=SAEC_Video_DEF_AMIGA_WIDTH<<1,e.video.size_win.height=SAEC_Video_DEF_AMIGA_HEIGHT<<1,e.video.apmode[0].gfx_display=1,e.video.apmode[0].gfx_fullscreen=SAEC_Config_Video_AP_Fullscreen_WINDOW,e.video.apmode[1].gfx_fullscreen=SAEC_Config_Video_AP_Fullscreen_WINDOW,e.video.apmode[0].gfx_backbuffers=0;for(n=e.video.apmode[1].gfx_backbuffers=0;n<=1;n++){var r=e.video.gf[n];r.gfx_filter=0,r.gfx_filter_scanlineratio=17;for(var i=0;i<=2*MAX_FILTERSHADERS;i++)r.gfx_filtershader[n][0]=0,r.gfx_filtermask[n][0]=0;r.gfx_filter_horiz_zoom_mult=1,r.gfx_filter_vert_zoom_mult=1,r.gfx_filter_bilinear=0,r.gfx_filter_filtermode=0,r.gfx_filter_keep_aspect=0,r.gfx_filter_autoscale=0,r.gfx_filter_keep_autoscale_aspect=!1,r.gfx_filteroverlay_overscan=0}e.video.api=SAEC_Config_Video_API_WebGL,e.video.colorMode=2,e.video.blackerThanBlack=!1,e.audio.bufferFrames=4096,e.audio.mode=SAEC_Config_Audio_Mode_On_Best,e.audio.channels=SAEC_Config_Audio_Channels_Stereo,e.audio.stereoSeparation=10,e.audio.stereoDelay=0,e.audio.freq=SAEC_Config_Audio_Freq_Auto,e.audio.interpol=SAEC_Config_Audio_Interpol_None,e.audio.filter=SAEC_Config_Audio_Filter_Emul,e.audio.filterType=0,e.dongle=0,e.ports[0].type=SAEC_Config_Ports_Type_Mouse,e.ports[0].move=SAEC_Config_Ports_Move_WASD,e.ports[0].fire=[49,50],e.ports[0].device=SAEC_Config_Ports_Device_None,e.ports[1].type=SAEC_Config_Ports_Type_JoyEmu,e.ports[1].move=SAEC_Config_Ports_Move_Arrows,e.ports[1].fire=[16,17],e.ports[1].device=SAEC_Config_Ports_Device_None,e.keyboard.enabled=!0,e.serial.enabled=!1,e.parallel.enabled=!1,e.debug.level=SAEC_Config_Debug_Level_Warn}function a(e){e.cpu.model=SAEC_Config_CPU_Model_68020,e.cpu.speed=SAEC_Config_CPU_Speed_Original,e.cpu.compatible=!1,e.cpu.addressSpace24=!0,e.chipset.mask=SAEC_Config_Chipset_Mask_ECS_AGNUS|SAEC_Config_Chipset_Mask_ECS_DENISE|SAEC_Config_Chipset_Mask_AGA,e.memory.chipSize=2097152,e.memory.bogoSize=0}function o(e){if(e.chipset.compatible==SAEC_Config_Chipset_Compatible_Manual)return 1;switch(e.chipset.cia.todBug=!1,e.chipset.cia.tod=SAEC_Config_Chipset_CIA_TOD_VSync,e.chipset.cia.overlay=!0,e.chipset.cia.type6526=!1,e.chipset.rtc.type=SAEC_Config_RTC_Type_None,e.chipset.rtc.adjust=0,e.chipset.a1000ram=0,e.chipset.mirrorE0=!0,e.chipset.mirrorA8=!1,e.chipset.agnusRev=-1,e.chipset.agnusDIP=!1,e.chipset.agnusBltBusyBug=!1,e.chipset.deniseRev=-1,e.chipset.deniseNoEHB=!1,e.chipset.fatGaryRev=-1,e.chipset.ramseyRev=-1,e.chipset.df0idhw=!0,e.chipset.ide=0,e.chipset.pcmcia=!1,e.chipset.mbdmac=0,e.chipset.z3AutoConfig=!1,e.chipset.bogomemIsFast=!1,e.chipset.compatible){case SAEC_Config_Chipset_Compatible_Generic:e.cpu.model>=SAEC_Config_CPU_Model_68020?(e.chipset.rtc.type=SAEC_Config_RTC_Type_RF5C01A,e.chipset.fatGaryRev=0,e.chipset.ramseyRev=15,e.chipset.ide=-1,e.chipset.mbdmac=-1):e.cpu.compatible?(e.chipset.df0idhw=!1,(e.memory.bogoSize||524288<e.memory.chipSize||e.memory.z2FastSize)&&(e.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B),e.chipset.cia.todBug=!0):(e.chipset.ide=-1,e.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B);break;case SAEC_Config_Chipset_Compatible_CDTV:e.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B,e.chipset.df0idhw=!0,e.chipset.mirrorE0=!1;break;case SAEC_Config_Chipset_Compatible_CDTVCR:e.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B,e.chipset.df0idhw=!0,e.chipset.mirrorE0=!1,e.chipset.ide=SAEC_Config_Chipset_IDE_A600A1200,e.chipset.pcmcia=!0,e.chipset.mirrorA8=!0,e.chipset.cia.overlay=!1,e.chipset.cia.todBug=!0;break;case SAEC_Config_Chipset_Compatible_CD32:e.chipset.mirrorE0=!1,e.chipset.mirrorA8=!0,e.chipset.cia.overlay=!1;break;case SAEC_Config_Chipset_Compatible_A500:e.chipset.df0idhw=!1,(e.memory.bogoSize||524288<e.memory.chipSize||e.memory.z2FastSize)&&(e.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B),e.chipset.cia.todBug=!0;break;case SAEC_Config_Chipset_Compatible_A500P:e.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B,e.chipset.cia.todBug=!0;break;case SAEC_Config_Chipset_Compatible_A600:e.chipset.ide=SAEC_Config_Chipset_IDE_A600A1200,e.chipset.pcmcia=!0,e.chipset.mirrorA8=!0,e.chipset.cia.overlay=!1,e.chipset.cia.todBug=!0;break;case SAEC_Config_Chipset_Compatible_A1000:e.chipset.a1000ram=1,e.chipset.cia.tod=e.chipset.ntsc?SAEC_Config_Chipset_CIA_TOD_60Hz:SAEC_Config_Chipset_CIA_TOD_50Hz,e.chipset.mirrorE0=!1,e.chipset.agnusBltBusyBug=!0,e.chipset.agnusDIP=!0,e.chipset.cia.todBug=!0;break;case SAEC_Config_Chipset_Compatible_A1000V:e.chipset.cia.tod=e.chipset.ntsc?SAEC_Config_Chipset_CIA_TOD_60Hz:SAEC_Config_Chipset_CIA_TOD_50Hz,e.chipset.mirrorE0=!1,e.chipset.agnusBltBusyBug=!0,e.chipset.agnusDIP=!0,e.chipset.deniseNoEHB=!0;break;case SAEC_Config_Chipset_Compatible_A1200:e.chipset.ide=SAEC_Config_Chipset_IDE_A600A1200,e.chipset.pcmcia=!0,e.chipset.mirrorA8=!0,e.chipset.cia.overlay=!1,(e.memory.z2FastSize||e.memory.z3FastSize)&&(e.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B);break;case SAEC_Config_Chipset_Compatible_A2000:e.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B_A2000,e.chipset.cia.tod=e.chipset.ntsc?SAEC_Config_Chipset_CIA_TOD_60Hz:SAEC_Config_Chipset_CIA_TOD_50Hz,e.chipset.cia.todBug=!0;break;case SAEC_Config_Chipset_Compatible_A3000:e.chipset.rtc.type=SAEC_Config_RTC_Type_RF5C01A,e.chipset.fatGaryRev=0,e.chipset.ramseyRev=13,e.chipset.mbdmac=1,e.chipset.mirrorE0=!1,e.chipset.cia.tod=e.chipset.ntsc?SAEC_Config_Chipset_CIA_TOD_60Hz:SAEC_Config_Chipset_CIA_TOD_50Hz,e.chipset.z3AutoConfig=!0;break;case SAEC_Config_Chipset_Compatible_A4000:e.chipset.rtc.type=SAEC_Config_RTC_Type_RF5C01A,e.chipset.fatGaryRev=0,e.chipset.ramseyRev=15,e.chipset.ide=SAEC_Config_Chipset_IDE_A4000,e.chipset.mbdmac=0,e.chipset.mirrorA8=!1,e.chipset.mirrorE0=!1,e.chipset.cia.overlay=!1,e.chipset.z3AutoConfig=!0;break;case SAEC_Config_Chipset_Compatible_A4000T:e.chipset.rtc.type=SAEC_Config_RTC_Type_RF5C01A,e.chipset.fatGaryRev=0,e.chipset.ramseyRev=15,e.chipset.ide=SAEC_Config_Chipset_IDE_A4000,e.chipset.mbdmac=2,e.chipset.mirrorA8=!1,e.chipset.mirrorE0=!1,e.chipset.cia.overlay=!1,e.chipset.z3AutoConfig=!0}return 1}function s(e,t){switch(e.cpu.clock.multiplier=512,t){case 0:e.chipset.blitter.cycle_exact=!0;break;case 1:e.cpu.compatible=!0;break;case 2:e.cpu.compatible=!1}}function c(e,t){switch(t){case 0:e.chipset.blitter.cycle_exact=!0;break;case 1:e.cpu.compatible=!0;break;case 2:e.cpu.compatible=!1}}function r(e){e.special||(e.width<SAEC_Video_MIN_UAE_WIDTH&&(SAEF_warn("config.fixup_prefs_dim2() Width (%d) min is %d.",e.width,SAEC_Video_MIN_UAE_WIDTH),e.width=SAEC_Video_MIN_UAE_WIDTH),e.height<SAEC_Video_MIN_UAE_HEIGHT&&(SAEF_warn("config.fixup_prefs_dim2() Height (%d) min is %d.",e.height,SAEC_Video_MIN_UAE_HEIGHT),e.height=SAEC_Video_MIN_UAE_HEIGHT),e.width>SAEC_Video_MAX_UAE_WIDTH&&(SAEF_warn("config.fixup_prefs_dim2() Width (%d) max is %d.",e.width,SAEC_Video_MAX_UAE_WIDTH),e.width=SAEC_Video_MAX_UAE_WIDTH),e.height>SAEC_Video_MAX_UAE_HEIGHT&&(SAEF_warn("config.fixup_prefs_dim2() Height (%d) max is %d.",e.height,SAEC_Video_MAX_UAE_HEIGHT),e.height=SAEC_Video_MAX_UAE_HEIGHT))}function t(e){r(e.video.size_win),r(e.video.size_fs),e.video.apmode[1].gfx_vsync&&(e.video.apmode[1].gfx_vsyncmode=1);for(var t=0;t<2;t++){var n=e.video.apmode[t];n.gfx_vflip=0,n.gfx_strobo=!1,n.gfx_vsync?n.gfx_vsyncmode?(1<=n.gfx_backbuffers&&(n.gfx_vflip=1),t||2!=n.gfx_backbuffers||(n.gfx_vflip=1),n.gfx_strobo=e.lightboost_strobo):(n.gfx_vflip=-1,e.video.api==SAEC_Config_Video_API_WebGL&&n.gfx_backbuffers<1&&(n.gfx_backbuffers=1),n.gfx_vflip&&(n.gfx_strobo=e.lightboost_strobo)):2<=n.gfx_backbuffers&&(n.gfx_vflip=-1)}}e(SAEV_config=new SAEO_Config),this.setup=function(){return function(e){o(e),function(e){switch(e.cpu.model){case SAEC_Config_CPU_Model_68000:case SAEC_Config_CPU_Model_68010:e.cpu.clock.multiplier=512;break;case SAEC_Config_CPU_Model_68020:e.cpu.clock.multiplier=1024;break;case SAEC_Config_CPU_Model_68030:e.cpu.clock.multiplier=2048}1e6==e.cpu.clock.frequency&&(e.cpu.clock.frequency=0);e.chipset.blitter.immediate&&e.chipset.blitter.waiting&&(SAEF_warn("config.fixup_cpu() Immediate blitter and waiting blits can't be enabled simultaneously. Disabling waiting blits..."),e.chipset.blitter.waiting=0)}(e),(0!=(e.memory.chipSize&e.memory.chipSize-1)&&1572864!=e.memory.chipSize||e.memory.chipSize<131072||8388608<e.memory.chipSize)&&(SAEF_warn("config.fixup_prefs() Unsupported chipmem size %d (0x%x). Setting to 2M...",e.memory.chipSize,e.memory.chipSize),e.memory.chipSize=2097152);(0!=(e.memory.z2FastSize&e.memory.z2FastSize-1)||0!=e.memory.z2FastSize&&(e.memory.z2FastSize<65536||8388608<e.memory.z2FastSize))&&(SAEF_warn("config.fixup_prefs() Unsupported Zorro II fastmem size %d (0x%x). Disabling fastmem...",e.memory.z2FastSize,e.memory.z2FastSize),e.memory.z2FastSize=0);(0!=(e.memory.z3FastSize&e.memory.z3FastSize-1)||0!=e.memory.z3FastSize&&e.memory.z3FastSize<1048576)&&(SAEF_warn("config.fixup_prefs() Unsupported Zorro III fastmem size %d (0x%x). Disabling fastmem...",e.memory.z3FastSize,e.memory.z3FastSize),e.memory.z3FastSize=0);e.memory.z3AutoConfigStart=(4294901760&e.memory.z3AutoConfigStart)>>>0,e.memory.z3AutoConfigStart<16777216&&(e.memory.z3AutoConfigStart=16777216);e.cpu.addressSpace24&&0!=e.memory.z3FastSize&&(e.memory.z3FastSize=0,SAEF_warn("config.fixup_prefs() Can't use Zorro III memory when using a 24 bit address space. Disabling memory..."));0!=e.memory.bogoSize&&524288!=e.memory.bogoSize&&1048576!=e.memory.bogoSize&&1572864!=e.memory.bogoSize&&1835008!=e.memory.bogoSize&&(SAEF_warn("config.fixup_prefs() Unsupported bogomem size %d (0x%x). Disabling bogomem...",e.memory.bogoSize,e.memory.bogoSize),e.memory.bogoSize=0);1572864<e.memory.bogoSize&&(0<=e.chipset.fatGaryRev||e.chipset.ide||0<=e.chipset.ramseyRev)&&(e.memory.bogoSize=1572864,SAEF_warn("config.fixup_prefs() Possible Gayle bogomem conflict fixed."));2097152<e.memory.chipSize&&262144<e.memory.z2FastSize&&(SAEF_warn("config.fixup_prefs() Can't use Zorro II fastmem and more than 2M chipmem at the same time. Limiting chipmem to 2M..."),e.memory.chipSize=2097152);(e.memory.ramsey.lowSize>64<<20||1048575&e.memory.ramsey.lowSize)&&(e.memory.ramsey.lowSize=0,SAEF_warn("config.fixup_prefs() Unsupported Mainboard fastmem size. Disabling fastmem... (RAMSEY low)"));(e.memory.ramsey.highSize>128<<20||1048575&e.memory.ramsey.highSize)&&(e.memory.ramsey.highSize=0,SAEF_warn("config.fixup_prefs() Unsupported CPU-Board fastmem size. Disabling fastmem... (RAMSEY high)"));(e.audio.mode<SAEC_Config_Audio_Mode_Off||e.audio.mode>SAEC_Config_Audio_Mode_On_Best)&&(SAEF_warn("config.fixup_prefs() Bad 'config.audio.mode'. Disabling audio..."),e.audio.mode=SAEC_Config_Audio_Mode_Off);e.chipset.z3AutoConfig&&e.cpu.addressSpace24&&(e.chipset.z3AutoConfig=!1,SAEF_warn("config.fixup_prefs() Zorro III autoconfig and 24bit address space are not compatible. Disabling Zorro III autoconfig..."));e.memory.z3FastSize&&e.cpu.addressSpace24&&(SAEF_warn("config.fixup_prefs() Zorro III memory can't be used if address space is 24-bit., Disabling Zorro III memory..."),e.memory.z3FastSize=0);0<e.floppy.speed&&e.floppy.speed<10&&(SAEF_warn("config.fixup_prefs() Invalid floppy speed. Setting to 'Turbo' (100)..."),e.floppy.speed=100);(e.chipset.colLevel<SAEC_Config_Chipset_ColLevel_None||e.chipset.colLevel>SAEC_Config_Chipset_ColLevel_Full)&&(SAEF_warn("config.fixup_prefs() Invalid collision support level. Using Sprite-Sprite..."),e.chipset.colLevel=SAEC_Config_Chipset_ColLevel_Sprite_Sprite);e.chipset.compatible==SAEC_Config_Chipset_Compatible_Generic?(e.chipset.fatGaryRev=e.chipset.ramseyRev=-1,e.chipset.ide=0,e.chipset.mbdmac=-1,e.cpu.model>=SAEC_Config_CPU_Model_68020&&(e.chipset.fatGaryRev=0,e.chipset.ramseyRev=15,e.chipset.ide=-1,e.chipset.mbdmac=0)):e.chipset.compatible==SAEC_Config_Chipset_Compatible_Manual&&e.chipset.ide==SAEC_Config_Chipset_IDE_A4000&&(e.chipset.fatGaryRev<0&&(e.chipset.fatGaryRev=0),e.chipset.ramseyRev<0&&(e.chipset.ramseyRev=15));1048576<=e.memory.chipSize&&(e.chipset.jumper1MbChip=!0);t(e),e.video.api==SAEC_Config_Video_API_Canvas&&5!=e.video.colorMode&&(e.video.colorMode=5,SAEF_warn("config.fixup_prefs() p.video.colorMode must 5 if 'Canvas' is used. (set to 5)"));(e.video.luminance<-1e3||1e3<e.video.luminance)&&(e.video.luminance=0,SAEF_warn("config.fixup_prefs() p.video.luminance must be between -1000 and 1000. (reset to 0)"));(e.video.contrast<-1e3||1e3<e.video.contrast)&&(e.video.contrast=0,SAEF_warn("config.fixup_prefs() p.video.contrast must be between -1000 and 1000. (reset to 0)"));(e.video.gamma<-1e3||1e3<e.video.gamma)&&(e.video.gamma=0,SAEF_warn("config.fixup_prefs() p.video.gamma must be between -1000 and 1000. (reset to 0)"));(e.video.alpha<0||255<e.video.alpha)&&(e.video.alpha=255,SAEF_warn("config.fixup_prefs() p.video.gamma must be between 0 and 255. (reset to 255)"));e.chipset.cia.todHack&&e.chipset.cia.tod==SAEC_Config_Chipset_CIA_TOD_VSync&&(e.chipset.cia.tod=e.chipset.ntsc?SAEC_Config_Chipset_CIA_TOD_60Hz:SAEC_Config_Chipset_CIA_TOD_50Hz);o(e),e.ports[0].type==SAEC_Config_Ports_Type_Joy&&e.ports[0].device==SAEC_Config_Ports_Device_None&&(e.ports[0].type=SAEC_Config_Ports_Type_JoyEmu,SAEF_warn("config.fixup_prefs() p.ports[0].device is invalid. (falling back to joystick-emulation)"));e.ports[1].type==SAEC_Config_Ports_Type_Joy&&e.ports[1].device==SAEC_Config_Ports_Device_None&&(e.ports[1].type=SAEC_Config_Ports_Type_JoyEmu,SAEF_warn("config.fixup_prefs() p.ports[1].device is invalid. (falling back to joystick-emulation)"));return!0}(SAEV_config)?SAEE_None:SAEE_Config_Invalid},this.setModel=function(e,t){return function(e,t,n,r){var i=0;switch(function(e){e.cpu.model=SAEC_Config_CPU_Model_68000,e.cpu.speed=SAEC_Config_CPU_Speed_Original,e.cpu.clock.multiplier=0,e.cpu.clock.frequency=0,e.cpu.compatible=!1,e.cpu.addressSpace24=!0,e.chipset.mask=SAEC_Config_Chipset_Mask_ECS_AGNUS,e.chipset.colLevel=SAEC_Config_Chipset_ColLevel_Sprite_Playfield,e.chipset.blitter.immediate=!1,e.chipset.blitter.waiting=0,e.chipset.blitter.cycle_exact=!1,e.chipset.cia.todHack=!1,e.chipset.cia.todBug=!1,e.chipset.cia.tod=SAEC_Config_Chipset_CIA_TOD_VSync,e.chipset.cia.overlay=!0,e.chipset.rtc.type=SAEC_Config_RTC_Type_None,e.chipset.compatible=SAEC_Config_Chipset_Compatible_Generic,e.chipset.a1000ram=!1,e.chipset.mirrorE0=!0,e.chipset.mirrorA8=!1,e.chipset.agnusRev=-1,e.chipset.deniseRev=-1,e.chipset.fatGaryRev=-1,e.chipset.ramseyRev=-1,e.chipset.df0idhw=!0,e.chipset.ide=0,e.chipset.pcmcia=!1,e.chipset.mbdmac=0,e.chipset.jumper1MbChip=!1,e.memory.chipSize=524288,e.memory.bogoSize=524288,e.memory.z2FastSize=0,e.memory.z3FastSize=0,e.memory.ramsey.lowSize=0,e.memory.ramsey.highSize=0,e.floppy.drive[0].type=SAEC_Config_Floppy_Type_35_DD,e.floppy.drive[1].type=SAEC_Config_Floppy_Type_35_DD,e.floppy.drive[2].type=SAEC_Config_Floppy_Type_None,e.floppy.drive[3].type=SAEC_Config_Floppy_Type_None,e.floppy.speed=100,e.audio.mode==SAEC_Config_Audio_Mode_Off&&(e.audio.mode=SAEC_Config_Audio_Mode_Off_Emul)}(e),t){case SAEC_Model_A500:i=function(e,t,n){switch(t){case 0:e.chipset.mask=0;break;case 1:break;case 2:e.memory.bogoSize=0,e.memory.chipSize=1048576}return s(e,n),e.chipset.compatible=SAEC_Config_Chipset_Compatible_A500,o(e),1}(e,n,r);break;case SAEC_Model_A500P:i=function(e,t,n){s(e,n),e.chipset.compatible=SAEC_Config_Chipset_Compatible_A500P,o(e),e.memory.bogoSize=0,e.memory.chipSize=1048576,1==t?e.memory.chipSize=2097152:2==t&&(e.memory.chipSize=2097152,e.memory.z2FastSize=4194304);return e.chipset.mask=SAEC_Config_Chipset_Mask_ECS_AGNUS|SAEC_Config_Chipset_Mask_ECS_DENISE,1}(e,n,r);break;case SAEC_Model_A600:i=function(e,t,n){s(e,n),e.chipset.compatible=SAEC_Config_Chipset_Compatible_A600,o(e),e.memory.bogoSize=0,e.memory.chipSize=1048576,1==t?(e.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B,e.memory.chipSize=2097152):2==t&&(e.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B,e.memory.chipSize=2097152,e.memory.z2FastSize=4194304);return e.chipset.mask=SAEC_Config_Chipset_Mask_ECS_AGNUS|SAEC_Config_Chipset_Mask_ECS_DENISE,1}(e,n,r);break;case SAEC_Model_A1000:i=function(e,t,n){e.chipset.mask=0,e.memory.bogoSize=0,e.audio.filter=SAEC_Config_Audio_Filter_On,s(e,n),e.floppy.drive[1].type=SAEC_Config_Floppy_Type_None,e.chipset.bogomemIsFast=!0,e.chipset.agnusDIP=!0,e.chipset.agnusBltBusyBug=!0,e.chipset.compatible=SAEC_Config_Chipset_Compatible_A1000,o(e),1==t?e.memory.chipSize=262144:2==t?(e.chipset.deniseNoEHB=!0,e.memory.chipSize=262144):3==t&&function(e,t){e.chipset.mask=0,e.memory.bogoSize=0,e.audio.filter=SAEC_Config_Audio_Filter_On,s(e,t),e.floppy.drive[1].type=SAEC_Config_Floppy_Type_None,e.chipset.bogomemIsFast=!0,e.chipset.agnusDIP=!0,e.chipset.agnusBltBusyBug=!0,e.chipset.compatible=SAEC_Config_Chipset_Compatible_A1000V,o(e),e.chipset.deniseNoEHB=!0,e.chipset.cia.type6526=!0,e.memory.chipSize=262144}(e,n);return 1}(e,n,r);break;case SAEC_Model_A1200:i=function(e,t,n){a(e),e.chipset.rtc.type=SAEC_Config_RTC_Type_None,e.chipset.compatible=SAEC_Config_Chipset_Compatible_A1200,o(e),1==t&&(e.memory.z2FastSize=4194304,e.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B);return c(e,n),1}(e,n,r);break;case SAEC_Model_A2000:i=function(e){return e.chipset.compatible=SAEC_Config_Chipset_Compatible_A2000,o(e),1}(e);break;case SAEC_Model_A3000:i=function(e){return e.memory.bogoSize=0,e.memory.chipSize=2097152,e.memory.ramsey.lowSize=2097152,e.cpu.model=SAEC_Config_CPU_Model_68030,e.cpu.compatible=e.cpu.addressSpace24=!1,e.chipset.mask=SAEC_Config_Chipset_Mask_ECS_AGNUS|SAEC_Config_Chipset_Mask_ECS_DENISE,e.chipset.blitter.immediate=!1,e.audio.mode=SAEC_Config_Audio_Mode_On,e.floppy.drive[0].type=SAEC_Config_Floppy_Type_35_HD,e.floppy.speed=0,e.chipset.compatible=SAEC_Config_Chipset_Compatible_A3000,o(e),e.chipset.cia.tod=e.chipset.ntsc?SAEC_Config_Chipset_CIA_TOD_60Hz:SAEC_Config_Chipset_CIA_TOD_50Hz,1}(e);break;case SAEC_Model_A4000:i=function(e){return e.memory.bogoSize=0,e.memory.chipSize=2097152,e.memory.ramsey.lowSize=8388608,e.cpu.model=SAEC_Config_CPU_Model_68030,e.cpu.compatible=e.cpu.addressSpace24=!1,e.chipset.mask=SAEC_Config_Chipset_Mask_AGA|SAEC_Config_Chipset_Mask_ECS_AGNUS|SAEC_Config_Chipset_Mask_ECS_DENISE,e.chipset.blitter.immediate=!1,e.audio.mode=SAEC_Config_Audio_Mode_On,e.floppy.drive[0].type=SAEC_Config_Floppy_Type_35_HD,e.floppy.drive[1].type=SAEC_Config_Floppy_Type_35_HD,e.floppy.speed=0,e.chipset.compatible=SAEC_Config_Chipset_Compatible_A4000,o(e),e.chipset.cia.tod=e.chipset.ntsc?SAEC_Config_Chipset_CIA_TOD_60Hz:SAEC_Config_Chipset_CIA_TOD_50Hz,1}(e);break;case SAEC_Model_A4000T:i=function(e){return e.memory.bogoSize=0,e.memory.chipSize=2097152,e.memory.ramsey.lowSize=8388608,e.cpu.model=SAEC_Config_CPU_Model_68030,e.cpu.compatible=e.cpu.addressSpace24=!1,e.chipset.mask=SAEC_Config_Chipset_Mask_AGA|SAEC_Config_Chipset_Mask_ECS_AGNUS|SAEC_Config_Chipset_Mask_ECS_DENISE,e.chipset.blitter.immediate=!1,e.audio.mode=SAEC_Config_Audio_Mode_On,e.floppy.drive[0].type=SAEC_Config_Floppy_Type_35_HD,e.floppy.drive[1].type=SAEC_Config_Floppy_Type_35_HD,e.floppy.speed=0,e.chipset.compatible=SAEC_Config_Chipset_Compatible_A4000T,o(e),e.chipset.cia.tod=e.chipset.ntsc?SAEC_Config_Chipset_CIA_TOD_60Hz:SAEC_Config_Chipset_CIA_TOD_50Hz,1}(e);break;case SAEC_Model_CD32:i=function(e,t){return a(e),e.floppy.drive[0].type=SAEC_Config_Floppy_Type_None,e.floppy.drive[1].type=SAEC_Config_Floppy_Type_None,c(e,t),e.chipset.compatible=SAEC_Config_Chipset_Compatible_CD32,o(e),1}(e,r);break;case SAEC_Model_CDTV:i=function(e,t,n){return 1==t?function(e,t){return e.memory.bogoSize=0,e.memory.chipSize=1048576,e.chipset.mask=SAEC_Config_Chipset_Mask_ECS_AGNUS|SAEC_Config_Chipset_Mask_ECS_DENISE,e.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B,e.floppy.drive[0].type=SAEC_Config_Floppy_Type_None,e.floppy.drive[1].type=SAEC_Config_Floppy_Type_None,s(e,t),e.chipset.compatible=SAEC_Config_Chipset_Compatible_CDTVCR,o(e),1}(e,n):(e.memory.bogoSize=0,e.memory.chipSize=1048576,e.chipset.mask=SAEC_Config_Chipset_Mask_ECS_AGNUS,e.chipset.rtc.type=SAEC_Config_RTC_Type_MSM6242B,e.floppy.drive[0].type=SAEC_Config_Floppy_Type_None,e.floppy.drive[1].type=SAEC_Config_Floppy_Type_None,s(e,n),e.chipset.compatible=SAEC_Config_Chipset_Compatible_CDTV,o(e),1)}(e,n,r)}e.cpu.model>=SAEC_Config_CPU_Model_68020&&!e.chipset.blitter.immediate&&(e.chipset.blitter.waiting=1);e.audio.filterType==SAEC_Config_Audio_FilterType_A500&&e.chipset.mask&SAEC_Config_Chipset_Mask_AGA?e.audio.filterType=SAEC_Config_Audio_FilterType_A1200:e.audio.filterType!=SAEC_Config_Audio_FilterType_A1200||e.chipset.mask&SAEC_Config_Chipset_Mask_AGA||(e.audio.filterType=SAEC_Config_Audio_FilterType_A500)}(SAEV_config,e,t,2),SAEE_None},this.setDefaults=function(){return e(SAEV_config),SAEE_None},this.fixup_prefs_dimensions_ext=function(e){t(e)}}const SAEC_RomType_KICK=256,SAEC_RomType_KICKCD32=512,SAEC_RomType_EXTCD32=1024,SAEC_RomType_EXTCDTV=2048,SAEC_RomType_KEY=4096,SAEC_RomType_CD32CART=32768,SAEC_RomType_AMAX=1048585,SAEC_RomType_NOT=8388608,SAEC_RomType_QUAD=16777216,SAEC_RomType_EVEN=33554432,SAEC_RomType_ODD=67108864,SAEC_RomType_8BIT=134217728,SAEC_RomType_BYTESWAP=268435456,SAEC_RomType_CD32=536870912,SAEC_RomType_SCRAMBLED=1073741824,SAEC_RomType_NONE=2147483648,SAEC_RomType_ALL_KICK=(SAEC_RomType_KICK|SAEC_RomType_KICKCD32|SAEC_RomType_CD32)>>>0,SAEC_RomType_ALL_EXT=(SAEC_RomType_EXTCD32|SAEC_RomType_EXTCDTV)>>>0,SAEC_RomType_ALL_CART=SAEC_RomType_CD32CART>>>0;function SAEO_RomInfo(){this.name=0,this.models="",this.ver=0,this.rev=0,this.subVer=0,this.subRev=0,this.cpu=0,this.cpuExact=!1,this.addressSpace24=!1,this.cloanto=!1,this.type=0,this.partNumber="",this.crc32=0,this.checksum=!1,this.checksumValid=!1}function SAEO_Roms(){const s=524288,c=262144;var e=131072;function u(e,t,n,r,i,a,o,s,c,_,f,l,u,d,p,E,A,S,m,h,g,y){this.num=-1,this.name=e,this.ver=t,this.rev=n,this.subver=r,this.subrev=i,this.model=a,this.size=o,this.id=s,this.cpu=c,this.cloanto=_,this.type=f,this.group=l,this.title=u,this.partnumber=d,this.crc32=p,this.sha1=[E,A,S,m,h],this.configname=void 0===g?"":g,this.defaultfilename=void 0===y?"":y}function t(e,t,n,r,i,a,o,s,c,_,f){return new u("X",0,0,0,0,0,r,e,0,0,i,t<<16|n,"","",a,o,s,c,_,f)}function n(e,t,n,r,i,a,o,s,c,_,f,l){return new u("X",0,0,0,0,0,r,e,0,0,i,t<<16|n,"",a,o,s,c,_,f,l)}const d=[new u("AROS KS ROM (built-in)",0,0,0,0,"AROS",s,66,0,0,SAEC_RomType_KICK,0,"","",1062194186,0,0,0,0,0,"AROS"),new u("AROS extended ROM (built-in)",0,0,0,0,"AROS",s,66,0,0,0,0,"","",4075105031,0,0,0,0,0,"AROS"),new u("Cloanto Amiga Forever ROM key",0,0,0,0,"",2069,0,0,1,SAEC_RomType_KEY,0,"","",2258297265,2149300915,775763768,1842439021,1327329191,3793574004),new u("Cloanto Amiga Forever 2006 ROM key",0,0,0,0,"",750,48,0,1,SAEC_RomType_KEY,0,"","",2954644310,3148408269,294358418,2951566995,1592498032,711339407),new u("Cloanto Amiga Forever 2010 ROM key",0,0,0,0,"",1544,73,0,1,SAEC_RomType_KEY,0,"","",2353909852,84103010,190560178,2257931945,374332304,4213741476),new u("KS ROM Velvet 23.93",23,93,23,93,"VELVET",e,125,0,0,SAEC_RomType_KICK,0,"","",2915779785,2083959482,697148378,3462451386,2232538224,1990462812),n(125,1,1,32768,SAEC_RomType_QUAD|SAEC_RomType_EVEN|SAEC_RomType_8BIT,"",496536248,3996747938,2993238836,37343705,4111290291,3772445628),n(125,1,2,32768,SAEC_RomType_QUAD|SAEC_RomType_ODD|SAEC_RomType_8BIT,"",3831935631,1041857897,3489283610,204021079,3040836895,3414527223),n(125,1,3,32768,SAEC_RomType_QUAD|SAEC_RomType_EVEN|SAEC_RomType_8BIT,"",1901693097,147023360,961070277,1108799372,401334636,3374136186),n(125,1,4,32768,SAEC_RomType_QUAD|SAEC_RomType_ODD|SAEC_RomType_8BIT,"",3302784618,1722954192,2217068632,3754768082,3549040120,1368262308),new u("KS ROM v1.0 (A1000)(NTSC)",1,0,1,0,"A1000",c,1,0,0,SAEC_RomType_KICK,0,"","",697798911,12669958,3199514795,437693030,3227017441,2814487929),new u("KS ROM v1.1 (A1000)(NTSC)",1,1,31,34,"A1000",c,2,0,0,SAEC_RomType_KICK,0,"","",3495974698,1100137733,3509646406,2997724861,3374165619,181074764),new u("KS ROM v1.1 (A1000)(PAL)",1,1,31,34,"A1000",c,3,0,0,SAEC_RomType_KICK,0,"","",3968260834,383748959,3575956897,3344452388,1470895535,4192447853),new u("KS ROM v1.2 (A1000)",1,2,33,166,"A1000",c,4,0,0,SAEC_RomType_KICK,0,"","",2664924112,1786510173,3177942807,2667829892,3638121090,1739990843),new u("KS ROM v1.2 (A500,A1000,A2000)",1,2,33,180,"A500|A1000|A2000",c,5,0,0,SAEC_RomType_KICK,0,"","315093-01",2798523958,301590060,4070176545,2223201147,712024419,872156552),new u("KS ROM v1.3 (A500,A1000,A2000)",1,3,34,5,"A500|A1000|A2000",c,6,0,0,SAEC_RomType_KICK,0,"","315093-02",3304125791,2300484180,2004024844,1813624336,3136863310,2818357125),new u("KS ROM v1.3 (A3000)(SK)",1,3,34,5,"A3000",c,32,0,0,SAEC_RomType_KICK,0,"","",3774050904,3281770761,1296981838,683753759,814126340,101068423),new u("KS ROM v1.4 (A3000)",1,4,36,16,"A3000",s,59,3,0,SAEC_RomType_KICK,0,"","",3155083583,4150466239,920645963,553268382,3492694801,3717409543),n(59,1,1,c,SAEC_RomType_EVEN,"390629-02",1479701814,3513859455,826755673,1223087240,3812001286,485741026),n(59,1,2,c,SAEC_RomType_ODD,"390630-02",4264525753,3227294802,3491022447,2417562923,1059728092,744982420),new u("KS ROM v2.04 (A500+)",2,4,37,175,"A500+",s,7,0,0,SAEC_RomType_KICK,0,"","390979-01",3283989056,3313737564,3112860297,1191599166,3539029855,1122186401),new u("KS ROM v2.05 (A600)",2,5,37,299,"A600",s,8,0,0,SAEC_RomType_KICK,0,"","391388-01",2197983157,2270203368,886865588,1935265502,1926423496,2732972251),new u("KS ROM v2.05 (A600HD)",2,5,37,300,"A600HD|A600",s,9,0,0,SAEC_RomType_KICK,0,"","391304-01",1682336810,4146956564,2376874438,2531461904,2241772677,2451989371),new u("KS ROM v2.05 (A600HD)",2,5,37,350,"A600HD|A600",s,10,0,0,SAEC_RomType_KICK,0,"","391304-02",1135665019,42220610,1404818074,3126024970,2747112069,55496164),new u("KS ROM v2.04 (A3000)",2,4,37,175,"A3000",s,71,8,0,SAEC_RomType_KICK,0,"","",592081459,3626941273,2948937024,3723679512,2127504283,2125010320),n(71,1,1,c,SAEC_RomType_EVEN,"390629-03",2722487263,2210052329,1563921237,2965810789,1631083158,4130888079),n(71,1,2,c,SAEC_RomType_ODD,"390630-03",2108764971,1223772977,664643189,2018041711,3948091521,2408535916),new u("KS ROM v3.0 (A1200)",3,0,39,106,"A1200",s,11,0,0,SAEC_RomType_KICK,0,"","",1822099410,1879259176,405798855,3977277011,1940437149,3665230501),n(11,1,1,c,SAEC_RomType_EVEN,"391523-01",3343033362,2577315868,1709166714,1911429425,1570359275,2240459142),n(11,1,2,c,SAEC_RomType_ODD,"391524-01",3579604678,859902093,977283202,3052379451,606912316,2326897641),new u("KS ROM v3.0 (A4000)",3,0,39,106,"A4000",s,12,6,0,SAEC_RomType_KICK,0,"","",2657796434,4038388194,2651988364,760993538,240023634,2547589079),n(12,1,1,c,SAEC_RomType_EVEN,"391513-02",922111440,426680127,2628621134,404490202,856177439,171733039),n(12,1,2,c,SAEC_RomType_ODD,"391514-02",388393557,1123806516,1406267676,3420359081,2188324113,1976346060),new u("KS ROM v3.1 (A4000)",3,1,40,70,"A4000",s,13,6,0,SAEC_RomType_KICK,0,"","",725968625,2177249757,158055217,3534721065,2625025908,3681814380),t(13,1,1,c,SAEC_RomType_EVEN,4190891209,328043700,998445822,383160432,3730863209,3017017230),t(13,1,2,c,SAEC_RomType_ODD,4163142485,3258422599,2678995216,3246739756,2724771887,451214853),new u("KS ROM v3.1 (A500,A600,A2000)",3,1,40,63,"A500|A600|A2000",s,14,0,0,SAEC_RomType_KICK,0,"","",4230262285,998184083,2994610472,821660146,1822911490,77531594),new u("KS ROM v3.1 (A1200)",3,1,40,68,"A1200",s,15,1,0,SAEC_RomType_KICK,0,"","",344170641,3793044850,1072183118,2436113943,1615797053,1882232049),n(15,1,1,c,SAEC_RomType_EVEN,"391773-01",148632181,3095400287,2425526288,2661717648,2981646911,2720914231),n(15,1,2,c,SAEC_RomType_ODD,"391774-01",381713400,2430808510,426815717,1062447536,957043125,2604165570),new u("KS ROM v3.1 (A3000)",3,1,40,68,"A3000",s,61,2,0,SAEC_RomType_KICK,0,"","",4021434828,4175565015,726419539,3771316317,574333454,1025193710),t(61,1,1,c,SAEC_RomType_EVEN,678140429,1734582821,2395247607,1082979939,286109338,394279633),t(61,1,2,c,SAEC_RomType_ODD,193781354,1594026363,1223408552,2102487638,2956987503,3275967885),new u("KS ROM v3.1 (A4000)(Cloanto)",3,1,40,68,"A4000",s,31,6,1,SAEC_RomType_KICK,0,"","",1136057634,3284435222,140961293,140395370,618346007,4284528121),new u("KS ROM v3.1 (A4000)",3,1,40,68,"A4000",s,16,6,0,SAEC_RomType_KICK,0,"","",3602572084,1608534082,3494529175,552662203,239506561,2571136841),t(16,1,1,c,SAEC_RomType_EVEN,2997826808,618998622,4227990677,389577399,2980136799,3309319438),t(16,1,2,c,SAEC_RomType_ODD,3864409763,826047677,2776079958,4053418451,1316360017,1982257282),new u("KS ROM v3.1 (A4000T)",3,1,40,70,"A4000T",s,17,6,0,SAEC_RomType_KICK,0,"","",1972579386,2968292228,3598091041,3759278577,509757682,4113046049),n(17,1,1,c,SAEC_RomType_EVEN,"391657-01",212422512,3011538650,3409142524,379671758,518964671,1539458953),n(17,1,2,c,SAEC_RomType_ODD,"391658-01",3756011808,3447353452,1125844184,2014630818,3635648272,217336844),new u("KS ROM v3.X (A4000)(Cloanto)",3,10,45,57,"A4000",s,46,6,1,SAEC_RomType_KICK,0,"","",986291932,1019202017,4265173856,360436065,3732208784,448718828),new u("KS ROM v3.1.4 (A4000T)(Hyperion)",3,1,46,143,"A4000T",s,0,6,0,SAEC_RomType_KICK,0,"","",3604016958,3446910718,2629812824,3885395153,1249587014,1204402757),new u("CD32 KS ROM v3.1",3,1,40,60,"CD32",s,18,1,0,SAEC_RomType_KICKCD32,0,"","",509793445,891666056,2281151321,702551988,595634078,3756938285),new u("CD32 extended ROM",3,1,40,60,"CD32",s,19,1,0,SAEC_RomType_EXTCD32,0,"","",2272553954,1542405474,2363858112,711386852,2920129679,1625788287),new u("CD32 ROM (KS + extended)",3,1,40,60,"CD32",1048576,64,1,0,SAEC_RomType_KICKCD32|SAEC_RomType_EXTCD32|SAEC_RomType_CD32,0,"","",4124373960,2678147109,3288999029,2733352399,844878979,3293046721),n(64,1,1,1048576,SAEC_RomType_CD32,"391640-03",2767964490,2171397829,125334917,209535813,573614522,975766235),new u("CD32 Full Motion Video Cartridge ROM",3,1,40,30,"CD32FMV",c,23,1,0,SAEC_RomType_CD32CART,0,"","",3277600703,63603143,2813483471,1690080642,2252261903,1697248309),new u("CD32 Full Motion Video Cartridge ROM",3,1,40,22,"CD32FMV",c,74,1,0,SAEC_RomType_CD32CART,0,"","391777-01",4044445931,2497997223,1613814962,2582366034,179236765,3041035471),new u("CDTV extended ROM v1.00",1,0,1,0,"CDTV",c,20,0,0,SAEC_RomType_EXTCDTV,0,"","",1119527204,2074349562,400883949,2683110431,874823041,3653830590),n(20,1,1,e,SAEC_RomType_EVEN|SAEC_RomType_8BIT,"252606-01",2031923531,662312824,2453968437,1073632958,1745239338,860053732),n(20,1,2,e,SAEC_RomType_ODD|SAEC_RomType_8BIT,"252607-01",2899033134,1102081302,2043078291,1010006199,1650468343,1679735900),new u("CDTV extended ROM v2.07",2,7,2,7,"CDTV",c,22,0,0,SAEC_RomType_EXTCDTV,0,"","",3467536594,1539380411,2728353958,346231156,1530799204,3214960710),t(22,1,1,e,SAEC_RomType_EVEN|SAEC_RomType_8BIT,920075448,2507466054,1262028439,4069497411,1314934366,4125444362),t(22,1,2,e,SAEC_RomType_ODD|SAEC_RomType_8BIT,1854201063,27289502,2304383503,1436316243,4114178155,3561469263),new u("CDTV/A570 extended ROM v2.30",2,30,2,30,"CDTV",c,21,0,0,SAEC_RomType_EXTCDTV,0,"","391298-01",817185330,3984475677,536820954,840315310,1119358524,3573178043),t(21,1,1,e,SAEC_RomType_EVEN|SAEC_RomType_8BIT,1222956879,1419010132,577365008,906068994,3791042645,4253616427),t(21,1,2,e,SAEC_RomType_ODD|SAEC_RomType_8BIT,2320823138,64978959,52446973,2301587070,3959994221,865607308),new u("CDTV-CR extended ROM v3.32",3,32,3,32,"CDTVCR",c,107,0,0,SAEC_RomType_EXTCDTV,0,"","",1478133199,3602437106,2236529307,760300921,2502551731,998629556),new u("CDTV-CR extended ROM v3.44",3,44,3,44,"CDTVCR",c,108,0,0,SAEC_RomType_EXTCDTV,0,"","",192665167,991300698,3195662602,3868345138,2147793822,828552776),new u("A1000 bootstrap ROM",0,0,0,0,"A1000",65536,24,0,0,SAEC_RomType_KICK,0,"","",186307280,3130243256,1554044986,1747082435,999621901,1926430167),t(24,1,1,8192,0,1659968516,3363807149,2767081065,4090273987,1637072514,731865062),n(24,2,1,4096,SAEC_RomType_EVEN|SAEC_RomType_8BIT,"252179-01",1112882116,2287315327,2051335158,756844761,956228084,3322326875),n(24,2,2,4096,SAEC_RomType_ODD|SAEC_RomType_8BIT,"252180-01",2388367927,3507426660,3114229758,277848130,909019007,1453187779),new u("Macintosh 128K",0,0,0,0,"128K",65536,200,0,0,SAEC_RomType_AMAX,0,"","",1829538344,0,0,0,0,0),new u("Macintosh 512K",0,0,0,0,"512K",65536,200,0,0,SAEC_RomType_AMAX,0,"","",3480591885,0,0,0,0,0),new u("Macintosh Plus (version 1)",0,0,0,0,"Plus",e,200,0,0,SAEC_RomType_AMAX,0,"","",1336259481,3772412261,3106795152,3635499556,700461938,2678538194),new u("Macintosh Plus (version 2)",0,0,0,0,"Plus",e,200,0,0,SAEC_RomType_AMAX,0,"","",2091700623,1941909170,358903312,2376731869,2270063748,1015866401),new u("Macintosh Plus (version 3)",0,0,0,0,"Plus",e,200,0,0,SAEC_RomType_AMAX,0,"","",2987404942,2100265098,73048993,2990700111,237796627,3800612639),new u("Macintosh SE",0,0,0,0,"SE",c,200,0,0,SAEC_RomType_AMAX,0,"","",260044812,0,0,0,0,0),new u("Macintosh SE (FDHD)",0,0,0,0,"SE",c,200,0,0,SAEC_RomType_AMAX,0,"","",4113615632,0,0,0,0,0),new u("Macintosh Classic",0,0,0,0,"Classic",c,200,0,0,SAEC_RomType_AMAX,0,"","",2974670046,0,0,0,0,0),new u("Macintosh Portable",0,0,0,0,"Portable",c,200,0,0,SAEC_RomType_AMAX,0,"","",1232292088,0,0,0,0,0),new u("PowerBook 100",0,0,0,0,"100",c,200,0,0,SAEC_RomType_AMAX,0,"","",699170537,0,0,0,0,0),new u("Macintosh II (version 1)",0,0,0,0,"II",c,200,2,0,SAEC_RomType_AMAX,0,"","",2357959939,0,0,0,0,0),new u("Macintosh II (version 2)",0,0,0,0,"II",c,200,2,0,SAEC_RomType_AMAX,0,"","",1308020820,0,0,0,0,0),new u("Macintosh LC",0,0,0,0,"LC",s,200,2,0,SAEC_RomType_AMAX,0,"","",1902647078,0,0,0,0,0)];for(var r=0;r<d.length;r++)d[r].num=r;function i(e){return 4294967295==e||0==e}function p(e,t,n){for(var r=0;r<d.length;r++)if(!i(d[r].crc32)&&d[r].size>=t&&d[r].type&n&&e==d[r].crc32)return d[r];return null}function E(e,t,n){for(var r=0,i=0,a=0;a<n;a+=4)4294967295<(r+=(e[t+a]<<24|e[t+a+1]<<16|e[t+a+2]<<8|e[t+a+3])>>>0)&&(r-=4294967296),r<i&&4294967295<++r&&(r-=4294967296),i=r;return r}this.getromname=function(e){var t="";if(null===e)return t;for(;e.group;)e=d[e.num-1];return t+=e.name,(e.subrev||e.subver)&&e.subver!=e.ver&&(t+=sprintf(" rev %d.%d",e.subver,e.subrev)),0<e.size&&(t+=sprintf(" (%dK)",e.size+1023>>10)),e.partnumber&&0<e.partnumber.length&&(t+=sprintf(" [%s]",e.partnumber)),t},this.getromdatabycrc=function(e,t){void 0===t&&(t=!1);for(var n=d.length,r=0;r<n;r++)if(0==d[r].group&&e==d[r].crc32&&!i(e))return d[r];if(t)for(r=0;r<n;r++)if(0!=d[r].group&&e==d[r].crc32&&!i(e))return d[r];return null},this.getromdatabydata=function(e,t){if(11<t&&0==SAEF_CompareArray(e,SAEF_String2Array("AMIROMTYPE1"),11)){var n=new Uint8Array(t),r=t-11;if(n.set(e.subarray(11)),0!=this.decode_rom(n,0,r,1,r))return null;e=n,t=r}r=p(SAEF_crc32(e,0,t),t,4294967295);return r=null===r?p(SAEF_crc32(e,0,t>>1),t>>1,4294967295):r},this.kickstart_fix_checksum=function(e,t,n){var r,i=0,a=0,o=n==s?524264:n==c?262120:62;for(e[t+o]=0,e[t+o+1]=0,e[t+o+2]=0,r=e[t+o+3]=0;r<n;r+=4)4294967295<(i+=(e[t+r]<<24|e[t+r+1]<<16|e[t+r+2]<<8|e[t+r+3])>>>0)&&(i-=4294967296),i<a&&4294967295<++i&&(i-=4294967296),a=i;e[t+o]=(i=(4294967295^i)>>>0)>>>24,e[t+o+1]=i>>>16&255,e[t+o+2]=i>>>8&255,e[t+o+3]=255&i,SAEF_log("roms.kickstart_fix_checksum() %08X",i)},this.kickstart_verify_checksum=function(e,t,n){n=E(e,t,n);return SAEF_log("roms.kickstart_verify_checksum() %08X",n),4294967295==n},this.decode_rom=function(e,t,n,r,i){return 1==r?function(e,t,n,r){var i=SAEV_config.memory.romKey;if(i.name.length&&i.data.length){for(var a,o=i.data,s=i.data.length,c=a=0;a<n;a++,c=(c+1)%s)e[t+a]^=o.charCodeAt(c),r==a+1&&(c=s-1);return 78==e[t+2]&&249==e[t+3]||17==e[t]&&(17==e[t+1]||20==e[t+1])?0:-1}return-2}(e,t,n,i):2==r?function(e,t,n){for(var r,i=3735944941,a=t;a<t+(n>>3);a++)r=(e[8*a+0]<<24|e[8*a+1]<<16|e[8*a+2]<<8|e[8*a+3])>>>0,e[8*a+0]=(i=(i^r)>>>0)>>>24,e[8*a+1]=i>>>16&255,e[8*a+2]=i>>>8&255,e[8*a+3]=255&i,i=(e[8*a+4]<<24|e[8*a+5]<<16|e[8*a+6]<<8|e[8*a+7])>>>0,e[8*a+4]=(r=(r^i)>>>0)>>>24,e[8*a+5]=r>>>16&255,e[8*a+6]=r>>>8&255,e[8*a+7]=255&r;return 0}(e,t,n):-3},this.examine=function(e,t){var n=SAEF_String2Array(t.data),r=t.size,i=!1;if(11<r&&0==SAEF_CompareArray(n,SAEF_String2Array("AMIROMTYPE1"),11)){var a=new Uint8Array(r),o=r-11;a.set(n.subarray(11));var s=this.decode_rom(a,0,o,1,o);if(-1==s)return SAEE_Memory_RomDecode;if(-2==s)return SAEE_Memory_RomKey;n=a,r=o,i=!0}o=t.crc32;!1!==o&&!i||(o=SAEF_crc32(n,0,r),i||(t.crc32=o));var c,_,f,l=p(o,r,4294967295);if(null===l)return SAEE_Memory_RomUnknown;for(;l.group;)l=d[l.num-1];return e.name=l.name,l.type&SAEC_RomType_AMAX?(c=n.subarray(8,10),_=n.subarray(18,20),f=n.subarray(76,78),e.ver=c[0]<<8|c[1],e.rev=_[0]<<8|_[1],e.subVer=f[0]<<8|f[1],e.subRev=0):(e.ver=l.ver,e.rev=l.rev,e.subVer=l.subver,e.subRev=l.subrev),e.models=(c=l.model,_="|",f=", ",c.split(_).join(f)),e.size=l.size,8&l.cpu?e.cpu=68030:3==(3&l.cpu)?(e.cpu=68030,e.cpuExact=!0):2==(3&l.cpu)?e.cpu=68020:(1==(3&l.cpu)?e.cpu=68020:e.cpu=68e3,e.addressSpace24=!0),e.cloanto=i,e.type=l.type,e.partNumber=l.partnumber,e.crc32=l.crc32,l.type&(SAEC_RomType_ALL_KICK|SAEC_RomType_ALL_EXT)?(e.checksum=E(n,0,r),e.checksumValid=4294967295==e.checksum):l.type&SAEC_RomType_AMAX?(i=n.subarray(0,4),e.checksum=function(e,t,n){var r=0;4194304==n&&(n-=1048576);for(var i=4;i<n;i+=2)4294967295<(r+=e[t+i]<<8|e[t+i+1])&&(r-=4294967296);return r}(n,0,r),e.checksumValid=e.checksum==(i[0]<<24|i[1]<<16|i[2]<<8|i[3])>>>0):(e.checksum=!1,e.checksumValid=!1),SAEE_None}}const SAEC_Memory_addrbank_flag_UNK=0,SAEC_Memory_addrbank_flag_RAM=1,SAEC_Memory_addrbank_flag_ROM=2,SAEC_Memory_addrbank_flag_ROMIN=4,SAEC_Memory_addrbank_flag_IO=8,SAEC_Memory_addrbank_flag_NONE=16,SAEC_Memory_addrbank_flag_SAFE=32,SAEC_Memory_addrbank_flag_NOALLOC=128,SAEC_Memory_addrbank_flag_THREADSAFE=512,SAEC_Memory_addrbank_flag_ALLOCINDIRECT=2048,SAEC_Memory_addrbank_flag_CHIPRAM=4096,SAEC_Memory_addrbank_flag_CIA=8192,SAEC_Memory_addrbank_flag_PPCIOSPACE=16384,SAEC_Memory_addrbank_READ=1,SAEC_Memory_addrbank_WRITE=2,SAEC_Memory_banktype_FAST32=0,SAEC_Memory_banktype_CHIP16=1,SAEC_Memory_banktype_CHIP32=2,SAEC_Memory_banktype_CIA=3,SAEC_Memory_banktype_FAST16=4;var SAER_Memory_banks=null,SAER_Memory_banktype=null,SAER_Memory_cachable=null,SAER_Memory_getBank=null,SAER_Memory_get8=null,SAER_Memory_get16=null,SAER_Memory_getInst16=null,SAER_Memory_get32=null,SAER_Memory_getInst32=null,SAER_Memory_put8=null,SAER_Memory_put16=null,SAER_Memory_put32=null,SAER_Memory_check=null,SAER_Memory_chipData=null,SAER_Memory_chipGet8_indirect=null,SAER_Memory_chipGet16_indirect=null,SAER_Memory_chipGet32_indirect=null,SAER_Memory_chipPut8_indirect=null,SAER_Memory_chipPut16_indirect=null,SAER_Memory_chipPut32_indirect=null,SAER_Memory_chipCheck_indirect=null,SAER_Memory_chipXLate_indirect=null,SAER_Memory_mapBanks=null,SAEV_Memory_chipMask=0,SAEV_Memory_cloantoRom=!1;function SAEO_Memory_addrbank_sub(e,t){this.bank=e,this.offset=t,this.suboffset=0,this.mask=0,this.maskval=0}function SAEO_Memory_addrbank(e,t,n,r,i,a,o,s,c,_,f,l,u,d,p,E,A){void 0===p&&(p=null),void 0===E&&(E=0),void 0===A&&(A=0),this.get32=e,this.get16=t,this.get8=n,this.put32=r,this.put16=i,this.put8=a,this.xlateaddr=o,this.check=s,this.baseaddr=c,this.label=_,this.name=f,this.getInst32=l,this.getInst16=u,this.flags=d,this.sub_banks=p,this.mask=E,this.startmask=A,this.start=0,this.allocated=0}function SAEF_Memory_defaultCheck(e,t){return 0}var SAEV_Memory_defaultXLate_cnt=0,SAEV_Memory_defaultXLate_recursive=0;function SAEF_Memory_defaultXLate(e){if(SAEV_Memory_defaultXLate_recursive)return SAER.m68k.cpu_halt(SAEC_CPU_halt_OPCODE_FETCH_FROM_NON_EXISTING_ADDRESS),kickmem_xlate(2);SAEV_Memory_defaultXLate_recursive++;SAEV_config.cpu.model,SAEC_Config_CPU_Model_68020;return 0==SAEV_command&&(SAEV_config.cpu.model>SAEC_Config_CPU_Model_68000||!SAEV_config.cpu.compatible)&&(++SAEV_Memory_defaultXLate_cnt<=5&&(SAEF_warn("memory.default_xlate() Your Amiga program just did something terribly stupid %08X PC=%08X",e,SAER_CPU_getPC()),SAER.memory.map_dump()),SAER.m68k.cpu_halt(SAEC_CPU_halt_OPCODE_FETCH_FROM_NON_EXISTING_ADDRESS)),SAEV_Memory_defaultXLate_recursive--,kickmem_xlate(2)}const SAEC_Memory_dummyGet_NONEXISTINGDATA=0;function SAEF_Memory_dummyGet32(e){return SAER.memory.dummylog(0,e,4,0,0),SAER.memory.dummyGet(e,4,!1,SAEC_Memory_dummyGet_NONEXISTINGDATA)}function SAEF_Memory_dummyGetInst32(e){return SAER.memory.dummylog(0,e,4,0,1),SAER.memory.dummyGet(e,4,!0,SAEC_Memory_dummyGet_NONEXISTINGDATA)}function SAEF_Memory_dummyGet16(e){return SAER.memory.dummylog(0,e,2,0,0),SAER.memory.dummyGet(e,2,!1,SAEC_Memory_dummyGet_NONEXISTINGDATA)}function SAEF_Memory_dummyGetInst16(e){return SAER.memory.dummylog(0,e,2,0,1),SAER.memory.dummyGet(e,2,!0,SAEC_Memory_dummyGet_NONEXISTINGDATA)}function SAEF_Memory_dummyGet8(e){return SAER.memory.dummylog(0,e,1,0,0),SAER.memory.dummyGet(e,1,!1,SAEC_Memory_dummyGet_NONEXISTINGDATA)}function SAEF_Memory_dummyPut32(e,t){SAER.memory.dummylog(1,e,4,t,0),SAER.memory.dummyPut(e,4,t)}function SAEF_Memory_dummyPut16(e,t){SAER.memory.dummylog(1,e,2,t,0),SAER.memory.dummyPut(e,2,t)}function SAEF_Memory_dummyPut8(e,t){SAER.memory.dummylog(1,e,1,t,0),SAER.memory.dummyPut(e,1,t)}function SAEF_Memory_dummyCheck(e,t){return 0}var SAEV_Memory_dummyBank=new SAEO_Memory_addrbank(SAEF_Memory_dummyGet32,SAEF_Memory_dummyGet16,SAEF_Memory_dummyGet8,SAEF_Memory_dummyPut32,SAEF_Memory_dummyPut16,SAEF_Memory_dummyPut8,SAEF_Memory_defaultXLate,SAEF_Memory_dummyCheck,null,null,null,SAEF_Memory_dummyGetInst32,SAEF_Memory_dummyGetInst16,SAEC_Memory_addrbank_flag_NONE);function SAEF_Memory_subBankGet32(e){e={value:e};return SAER.memory.getSubBank(e).get32(e.value)}function SAEF_Memory_subBankGet16(e){e={value:e};return SAER.memory.getSubBank(e).get16(e.value)}function SAEF_Memory_subBankGet8(e){e={value:e};return SAER.memory.getSubBank(e).get8(e.value)}function SAEF_Memory_subBankPut32(e,t){e={value:e};SAER.memory.getSubBank(e).put32(e.value,t)}function SAEF_Memory_subBankPut16(e,t){e={value:e};SAER.memory.getSubBank(e).put16(e.value,t)}function SAEF_Memory_subBankPut8(e,t){e={value:e};SAER.memory.getSubBank(e).put8(e.value,t)}function SAEF_Memory_subBankGetInst32(e){e={value:e};return SAER.memory.getSubBank(e).getInst32(e.value)}function SAEF_Memory_subBankGetInst16(e){e={value:e};return SAER.memory.getSubBank(e).getInst16(e.value)}function SAEF_Memory_subBankCheck(e,t){e={value:e};return SAER.memory.getSubBank(e).check(e.value,t)}function SAEF_Memory_subBankXLate(e){e={value:e};return SAER.memory.getSubBank(e).xlateaddr(e.value)}function SAEO_Memory(){const c=!1,t=c?256:65536;c;const E=524288,A=262144;const f=0,l=12582912;for(var a=0,u=!1,d=0,p=0,S=0,y=new Array(t),e=0;e<t;e++)y[e]=null;SAER_Memory_banks=y;var n=new Uint8Array(65536);SAER_Memory_banktype=n;var r=new Uint8Array(65536);SAER_Memory_cachable=r;var o=!0;function i(e){return y[e>>>16].get16(e)}function s(e,t){return y[e>>>16].check(e,t)}SAER_Memory_getBank=function(e){return y[e>>>16]},SAER_Memory_get8=function(e){return y[e>>>16].get8(e)},SAER_Memory_get16=i,SAER_Memory_getInst16=function(e){return y[e>>>16].getInst16(e)},SAER_Memory_get32=function(e){return y[e>>>16].get32(e)},SAER_Memory_getInst32=function(e){return y[e>>>16].getInst32(e)},SAER_Memory_put8=function(e,t){y[e>>>16].put8(e,t)},SAER_Memory_put16=function(e,t){y[e>>>16].put16(e,t)},SAER_Memory_put32=function(e,t){y[e>>>16].put32(e,t)},SAER_Memory_check=s;var m=0;this.dummylog=function(e,t,n,r,i){SAEV_config.memory.logIllegal&&(1e3<=m||4278190080<=t&&t<=4278190592||14680064<=t&&t<=16252927||134217728<=t&&t<=134217735||133169152<=t&&t<=133169159||133693424<=t&&t<=134217727||(m++,i?SAEF_log("memory.geti%s(0x%08x) illegal access (PC 0x%x)",2==n?"16":"32",t,SAER_CPU_getPC()):e?SAEF_log("memory.put%s(0x%08x, 0x%x) illegal access (PC 0x%x)",1==n?"8":2==n?"16":"32",t,r,SAER_CPU_getPC()):SAEF_log("memory.get%s(0x%08x) illegal access (PC 0x%x)",1==n?"8":2==n?"16":"32",t,SAER_CPU_getPC())))};var h=50;function _(e,t,n){0<h&&(SAEF_log("memory.gary_wait() Gary timeout: %08x %d %s PC=%08x",e,t,n?"W":"R",SAER_CPU_getPC()),h--)}function g(e){return!(SAEV_config.chipset.fatGaryRev<0)&&(!(e<12058624)&&(13631488<=e&&e<14417920||(14483456<=e&&e<14548992||!(14647296<=e&&e<14680064)&&!(15204352<=e&&e<16252928))))}function v(){return(65535&~(1<<(31&Math.decimalRandom())|1<<(31&Math.decimalRandom())))>>>0}this.dummyGet=function(e,t,n,r){var i=r;return g(e)||1<t&&g(e+t-1)?(SAEV_MBRes_gary_timeout&&_(e,t,!1),SAEV_MBRes_gary_toenb&&SAER.cpu.exception2(e,!1,t,(SAER_CPU_regs.s?4:0)|(n?0:1)),i):(e=e,t=t,r=r,!(SAEV_config.cpu.model>=SAEC_Config_CPU_Model_68040)&&SAEV_config.cpu.compatible?(SAEV_config.cpu.addressSpace24&&(e&=16777215),268435456<=e||(SAEV_config.cpu.model<=SAEC_Config_CPU_Model_68010||SAEV_config.cpu.model==SAEC_Config_CPU_Model_68020&&0!=(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)&&SAEV_config.cpu.addressSpace24)&&(4==t?(r=65535&SAER_CPU_regs.db,r=((r=1&e?r<<8&65535|r>>8:r)<<16|r)>>>0):2==t?(r=65535&SAER_CPU_regs.db,1&e&&(r=r<<8&65535|r>>8)):(r=SAER_CPU_regs.db,r=1&e?255&r:r>>8&255)),r):r)},this.dummyPut=function(e,t,n){(g(e)||1<t&&g(e+t-1))&&SAEV_MBRes_gary_timeout&&_(e,t,!0)},this.getSubBank=function(e){var t,n=e.value,r=y[n>>>16].sub_banks;if(null===r)return SAEV_Memory_dummyBank;for(t=0;null!==r[t].bank;t++){var i=65535&n;if(i<r[t+1].offset)if((i&r[t].mask)>>>0==r[t].maskval)return e.value=n-r[t].suboffset,r[t].bank}return e.value=n-r[t-1].suboffset,r[t-1].bank};var b=new SAEO_Memory_addrbank(function(e){return(v()<<16|v())>>>0},v,function(e){return v()},function(e,t){},function(e,t){},function(e,t){},SAEF_Memory_defaultXLate,SAEF_Memory_defaultXLate,null,null,"Dummy Chip memory",SAEF_Memory_dummyGetInst32,SAEF_Memory_dummyGetInst16,SAEC_Memory_addrbank_flag_IO|SAEC_Memory_addrbank_flag_CHIPRAM),C=0,k=0;function R(e){return e=(e&F.mask)>>>0,(F.baseaddr[e]<<24|F.baseaddr[e+1]<<16|F.baseaddr[e+2]<<8|F.baseaddr[e+3])>>>0}function w(e){return e=(e&F.mask)>>>0,F.baseaddr[e]<<8|F.baseaddr[e+1]}function x(e,t){e=(e&F.mask)>>>0,F.baseaddr[e]=t>>>24,F.baseaddr[e+1]=t>>>16&255,F.baseaddr[e+2]=t>>>8&255,F.baseaddr[e+3]=255&t}function D(e,t){return(e=(e&F.mask)>>>0)+t<=k}function M(e){return e=(e&F.mask)>>>0}var F=new SAEO_Memory_addrbank(R,w,function(e){return e=(e&F.mask)>>>0,F.baseaddr[e]},x,function(e,t){e=(e&F.mask)>>>0,F.baseaddr[e]=t>>8,F.baseaddr[e+1]=255&t},function(e,t){e=(e&F.mask)>>>0,F.baseaddr[e]=t},M,D,null,"chip","Chip memory",R,w,SAEC_Memory_addrbank_flag_RAM|SAEC_Memory_addrbank_flag_THREADSAFE|SAEC_Memory_addrbank_flag_CHIPRAM);function T(e){return k-1<=(e=(e&C)>>>0)?0:F.baseaddr[e]<<8|F.baseaddr[e+1]}function V(e){return k<=(e=(e&C)>>>0)?0:F.baseaddr[e]}function I(e,t){k-1<=(e=(e&C)>>>0)||(F.baseaddr[e]=t>>8,F.baseaddr[e+1]=255&t)}function P(e,t){k<=(e=(e&C)>>>0)||(F.baseaddr[e]=t)}function z(e){return e=(e&L.mask)+S,(L.baseaddr[e]<<24|L.baseaddr[e+1]<<16|L.baseaddr[e+2]<<8|L.baseaddr[e+3])>>>0}function O(e){return e=(e&L.mask)+S,L.baseaddr[e]<<8|L.baseaddr[e+1]}var L=new SAEO_Memory_addrbank(z,O,function(e){return e=(e&L.mask)+S,L.baseaddr[e]},function(e,t){e=(e&L.mask)+S,L.baseaddr[e]=t>>>24,L.baseaddr[e+1]=t>>>16&255,L.baseaddr[e+2]=t>>>8&255,L.baseaddr[e+3]=255&t},function(e,t){e=(e&L.mask)+S,L.baseaddr[e]=t>>8,L.baseaddr[e+1]=255&t},function(e,t){e=(e&L.mask)+S,L.baseaddr[e]=t},function(e){return e=(e&L.mask)+S},function(e,t){return(e&=L.mask)+t<=L.allocated},null,"bogo","Slow memory",z,O,SAEC_Memory_addrbank_flag_RAM|SAEC_Memory_addrbank_flag_THREADSAFE);function N(e){return e=(e&U.mask)>>>0,(U.baseaddr[e]<<24|U.baseaddr[e+1]<<16|U.baseaddr[e+2]<<8|U.baseaddr[e+3])>>>0}function B(e){return e=(e&U.mask)>>>0,U.baseaddr[e]<<8|U.baseaddr[e+1]}var U=new SAEO_Memory_addrbank(N,B,function(e){return e=(e&U.mask)>>>0,U.baseaddr[e]},function(e,t){e=(e&U.mask)>>>0,U.baseaddr[e]=t>>>24,U.baseaddr[e+1]=t>>>16&255,U.baseaddr[e+2]=t>>>8&255,U.baseaddr[e+3]=255&t},function(e,t){e=(e&U.mask)>>>0,U.baseaddr[e]=t>>8,U.baseaddr[e+1]=255&t},function(e,t){e=(e&U.mask)>>>0,U.baseaddr[e]=t},function(e){return e=(e&U.mask)>>>0},function(e,t){return(e=(e&U.mask)>>>0)+t<=U.allocated},null,"ramsey_low","RAMSEY memory (low)",N,B,SAEC_Memory_addrbank_flag_RAM|SAEC_Memory_addrbank_flag_THREADSAFE);function K(e){return e=(e&H.mask)>>>0,(H.baseaddr[e]<<24|H.baseaddr[e+1]<<16|H.baseaddr[e+2]<<8|H.baseaddr[e+3])>>>0}function G(e){return e=(e&H.mask)>>>0,H.baseaddr[e]<<8|H.baseaddr[e+1]}var H=new SAEO_Memory_addrbank(K,G,function(e){return e=(e&H.mask)>>>0,H.baseaddr[e]},function(e,t){e=(e&H.mask)>>>0,H.baseaddr[e]=t>>>24,H.baseaddr[e+1]=t>>>16&255,H.baseaddr[e+2]=t>>>8&255,H.baseaddr[e+3]=255&t},function(e,t){e=(e&H.mask)>>>0,H.baseaddr[e]=t>>8,H.baseaddr[e+1]=255&t},function(e,t){e=(e&H.mask)>>>0,H.baseaddr[e]=t},function(e){return e=(e&H.mask)>>>0},function(e,t){return(e=(e&H.mask)>>>0)+t<=H.allocated},null,"ramsey_high","RAMSEY memory (high)",K,G,SAEC_Memory_addrbank_flag_RAM|SAEC_Memory_addrbank_flag_THREADSAFE),X=!1,q=null;function Z(e){null!==q&&65535==(a=0==e?(X=!1,SAEF_memcpy(W.baseaddr,0,W.baseaddr,A,A),W.baseaddr[A+12]<<8|W.baseaddr[A+13]):(X=!0,W.baseaddr.set(q),0))&&(a=0)}function j(e){return e=(e&W.mask)>>>0,(W.baseaddr[e]<<24|W.baseaddr[e+1]<<16|W.baseaddr[e+2]<<8|W.baseaddr[e+3])>>>0}function Y(e){return e=(e&W.mask)>>>0,W.baseaddr[e]<<8|W.baseaddr[e+1]}this.a1000_reset=function(){Z(1)};var W=new SAEO_Memory_addrbank(j,Y,function(e){return e=(e&W.mask)>>>0,W.baseaddr[e]},function(e,t){u?(e=(e&W.mask)>>>0,W.baseaddr[e]=t>>>24,W.baseaddr[e+1]=t>>>16&255,W.baseaddr[e+2]=t>>>8&255,W.baseaddr[e+3]=255&t):X?16515072<=e?(e=(e&W.mask)>>>0,W.baseaddr[e]=t>>>24,W.baseaddr[e+1]=t>>>16&255,W.baseaddr[e+2]=t>>>8&255,W.baseaddr[e+3]=255&t):Z(0):SAEV_config.memory.logIllegal&&SAEF_warn("Illegal kickmem put32 at %08x",e)},function(e,t){u?(e=(e&W.mask)>>>0,W.baseaddr[e]=t>>8,W.baseaddr[e+1]=255&t):X?16515072<=e?(e=(e&W.mask)>>>0,W.baseaddr[e]=t>>8,W.baseaddr[e+1]=255&t):Z(0):SAEV_config.memory.logIllegal&&SAEF_warn("Illegal kickmem put16 at %08x",e)},function(e,t){u?(e=(e&W.mask)>>>0,W.baseaddr[e]=t):X?16515072<=e?(e=(e&W.mask)>>>0,W.baseaddr[e]=t):Z(0):SAEV_config.memory.logIllegal&&SAEF_warn("Illegal kickmem put8 at %08x",e)},function(e){return e=(e&W.mask)>>>0},function(e,t){return(e=(e&W.mask)>>>0)+t<=W.allocated},null,"kick","Kickstart ROM",j,Y,SAEC_Memory_addrbank_flag_ROM|SAEC_Memory_addrbank_flag_THREADSAFE),J=0;const Q=1,$=2,ee=3;function te(e){return e=(e&re.mask)>>>0,(re.baseaddr[e]<<24|re.baseaddr[e+1]<<16|re.baseaddr[e+2]<<8|re.baseaddr[e+3])>>>0}function ne(e){return e=(e&re.mask)>>>0,re.baseaddr[e]<<8|re.baseaddr[e+1]}var re=new SAEO_Memory_addrbank(te,ne,function(e){return e=(e&re.mask)>>>0,re.baseaddr[e]},function(e,t){SAEV_config.memory.logIllegal&&SAEF_warn("Illegal extendedkickmem put32 at %08x",e)},function(e,t){SAEV_config.memory.logIllegal&&SAEF_warn("Illegal extendedkickmem put16 at %08x",e)},function(e,t){SAEV_config.memory.logIllegal&&SAEF_warn("Illegal extendedkickmem put32 at %08x",e)},function(e){return e=(e&re.mask)>>>0},function(e,t){return(e=(e&re.mask)>>>0)+t<=re.allocated},null,null,"Extended Kickstart ROM",te,ne,SAEC_Memory_addrbank_flag_ROM|SAEC_Memory_addrbank_flag_THREADSAFE);function ie(e){return e=(e-oe.start&oe.mask)>>>0,(oe.baseaddr[e]<<24|oe.baseaddr[e+1]<<16|oe.baseaddr[e+2]<<8|oe.baseaddr[e+3])>>>0}function ae(e){return e=(e-oe.start&oe.mask)>>>0,oe.baseaddr[e]<<8|oe.baseaddr[e+1]}var oe=new SAEO_Memory_addrbank(ie,ae,function(e){return e=(e-oe.start&oe.mask)>>>0,oe.baseaddr[e]},function(e,t){SAEV_config.memory.logIllegal&&SAEF_warn("Illegal extendedkickmem2 put32 at %08x",e)},function(e,t){SAEV_config.memory.logIllegal&&SAEF_warn("Illegal extendedkickmem2 put16 at %08x",e)},function(e,t){SAEV_config.memory.logIllegal&&SAEF_warn("Illegal extendedkickmem2 put32 at %08x",e)},function(e){return e=(e-oe.start&oe.mask)>>>0},function(e,t){return(e=(e-oe.start&oe.mask)>>>0)+t<=oe.allocated},null,"rom_a8","Extended 2nd Kickstart ROM",ie,ae,SAEC_Memory_addrbank_flag_ROM|SAEC_Memory_addrbank_flag_THREADSAFE);function se(e){return e=(e&_e.mask)>>>0,(_e.baseaddr[e]<<24|_e.baseaddr[e+1]<<16|_e.baseaddr[e+2]<<8|_e.baseaddr[e+3])>>>0}function ce(e){return e=(e&_e.mask)>>>0,_e.baseaddr[e]<<8|_e.baseaddr[e+1]}var _e=new SAEO_Memory_addrbank(se,ce,function(e){return e=(e&_e.mask)>>>0,_e.baseaddr[e]},function(e,t){e=(e&_e.mask)>>>0,_e.baseaddr[e]=t>>>24,_e.baseaddr[e+1]=t>>>16&255,_e.baseaddr[e+2]=t>>>8&255,_e.baseaddr[e+3]=255&t},function(e,t){e=(e&_e.mask)>>>0,_e.baseaddr[e]=t>>8,_e.baseaddr[e+1]=255&t},function(e,t){e=(e&_e.mask)>>>0,_e.baseaddr[e]=t},function(e){return e=(e&_e.mask)>>>0},function(e,t){return(e=(e&_e.mask)>>>0)+t<=_e.allocated},null,"custmem1","Non-autoconfig RAM #1",se,ce,SAEC_Memory_addrbank_flag_RAM|SAEC_Memory_addrbank_flag_THREADSAFE);function fe(e){return e=(e&ue.mask)>>>0,(ue.baseaddr[e]<<24|ue.baseaddr[e+1]<<16|ue.baseaddr[e+2]<<8|ue.baseaddr[e+3])>>>0}function le(e){return e=(e&ue.mask)>>>0,ue.baseaddr[e]<<8|ue.baseaddr[e+1]}var ue=new SAEO_Memory_addrbank(fe,le,function(e){return e=(e&ue.mask)>>>0,ue.baseaddr[e]},function(e,t){e=(e&ue.mask)>>>0,ue.baseaddr[e]=t>>>24,ue.baseaddr[e+1]=t>>>16&255,ue.baseaddr[e+2]=t>>>8&255,ue.baseaddr[e+3]=255&t},function(e,t){e=(e&ue.mask)>>>0,ue.baseaddr[e]=t>>8,ue.baseaddr[e+1]=255&t},function(e,t){e=(e&ue.mask)>>>0,ue.baseaddr[e]=t},function(e){return e=(e&ue.mask)>>>0},function(e,t){return(e=(e&ue.mask)>>>0)+t<=ue.allocated},null,"custmem2","Non-autoconfig RAM #2",fe,le,SAEC_Memory_addrbank_flag_RAM|SAEC_Memory_addrbank_flag_THREADSAFE);const de=E,pe=de>>1;var Ee=null,Ae=!1;function Se(e,t,n,r,i,a){var o,s,c,_=SAEF_String2Array("exec.library"),f=_.length,l=new Uint8Array(20),u=0,d=0;for(r<0&&(SAEF_ZFile_fseek(e,0,SEEK_END),r=SAEF_ZFile_ftell(e)&-1024>>>0,SAEF_ZFile_fseek(e,0,SEEK_SET)),c=SAEF_ZFile_ftell(e),o=SAEF_ZFile_fread(l,0,1,11,e),0==SAEF_CompareArray(l,SAEF_String2Array("KICK"),4)?(SAEF_ZFile_fseek(e,512,SEEK_SET),d=1):0==SAEF_CompareArray(l,SAEF_String2Array("AMIROMTYPE1"),11)?(SAEV_Memory_cloantoRom=!0,u=1):SAEF_ZFile_fseek(e,c,SEEK_SET),SAEF_memset(t,n,0,r),o=0;o<8;o++)t[n+r-16+2*o+1]=24+o;for(t[n+r-20]=r>>>24,t[n+r-19]=r>>>16&255,t[n+r-18]=r>>>8&255,t[n+r-17]=255&r,o=SAEF_ZFile_fread(t,n,1,r,e),(o=d&&o>A?A:o)<r-20&&SAER.roms.kickstart_fix_checksum(t,n,r),s=1;s<o;)s<<=1;if(o=s,a||o!=r>>1||SAEF_memcpy(t,r>>1,t,0,r>>1),u){u=SAER.roms.decode_rom(t,n,r,u,o);if(-1==u)return-SAEE_Memory_RomDecode;if(-2==u)return-SAEE_Memory_RomKey}if(SAEV_config.chipset.a1000ram&&o<A){var p=0;for(null===q&&(q=new Uint8Array(A));p+o<A;)q.set(W.baseaddr.subarray(0,o),p),p+=o;SAEF_memset(W.baseaddr,0,0,W.allocated),Z(1),i=0,o=E}for(s=0;s<256&&o>=A&&0!=SAEF_CompareArrayAfter(t,n+s,_,f);s++);return(i=256==s||o<A?0:i)&&!SAER.roms.kickstart_verify_checksum(t,n,r)?-SAEE_Memory_RomChecksum:0<o?o:-SAEE_Memory_RomSize}function me(e,t){var n,r,i=[],a=t==E?16252928:16515072,o=0;if(1&SAEV_config.chipset.mbdmac&&i.push(SAEF_String2Array("scsi.device")),2&SAEV_config.chipset.mbdmac&&i.push(SAEF_String2Array("NCR scsi.device")),i.length)for(n=0;n<t-100;n++)if(74==e[n]&&252==e[n+1]){var s=e[n+2]<<24|e[n+3]<<16|e[n+4]<<8|e[n+5]<<0;if(s==n+a&&(a<=(s=e[n+14]<<24|e[n+15]<<16|e[n+16]<<8|e[n+17]<<0)&&s<a+t))for(r=0;r<i.length;r++)if(0==SAEF_CompareArrayAfter(e,s-a,i[r])){SAEF_log("memory.patch_residents() '%s' at %08X disabled",SAEF_Array2String(i[r]),n+a),e[n]=75,o++;break}}return o}function he(){var e=0;W.allocated>=E&&SAEV_config.memory.kickShifter&&(e+=function(e){for(var t=[65,248,4,0],n=[65,248,16,0],r=[67,248,4,0],i=0,a=512;a<768;a++)SAEF_CompareArrayAfter(e,a,t,4)&&SAEF_CompareArrayAfter(e,a,n,4)&&SAEF_CompareArrayAfter(e,a,r,4)||(e[a+2]=48,SAEF_log("memory.patch_shapeshifter() KickShifted at %04X",a),i++);return i}(W.baseaddr)),e+=me(W.baseaddr,W.allocated),null!==re.baseaddr&&(e+=me(re.baseaddr,re.allocated))&&SAER.roms.kickstart_fix_checksum(re.baseaddr,0,re.allocated),e&&SAER.roms.kickstart_fix_checksum(W.baseaddr,0,W.allocated)}function ge(){if(o=SAEV_Memory_cloantoRom=!1,-1!=SAEV_config.memory.rom.name.indexOf("aros"))return function(){var e=SAEF_ZFile_fopen_file(SAEV_config.memory.extRom);if(!e)return SAEE_Memory_NoExtendedRom;re.allocated=E,re.mask=E-1,re.label="rom_e0",J=ee,ye(re);var t=Se(e,re.baseaddr,0,E,0,1);return SAEF_ZFile_fclose(e),t<0?-t:(e=SAEF_ZFile_fopen_file(SAEV_config.memory.rom),W.allocated=E,W.mask=E-1,t=Se(e,W.baseaddr,0,E,1,0),SAEF_ZFile_fclose(e),t<0?-t:(SAEV_config.cpu.model<=SAEC_Config_CPU_Model_68020&&0==SAEV_config.memory.z2FastSize&&0==SAEV_config.memory.z3FastSize&&0==SAEV_config.memory.ramsey.highSize&&0==SAEV_config.memory.ramsey.lowSize&&((t=SAEV_config.memory.custom[0]).addr=11010048,t.size=524288,t.mask=0,(t=SAEV_config.memory.custom[1]).addr=11534336,t.size=524288,t.mask=0,SAEF_log("memory.load_kickstart_replacement() enabled 1M extra-memory")),o=!0,SAEE_None))}();var e=SAEF_ZFile_fopen_file(SAEV_config.memory.rom);if(null===e)return SAEE_Memory_NoKickstartRom;var t,n=E,r=0,i=E;if(SAEF_ZFile_fseek(e,0,SEEK_END),t=SAEF_ZFile_ftell(e),SAEF_ZFile_fseek(e,0,SEEK_SET),901120==t&&(t=A,i=A),t==E+8&&SAEF_ZFile_fseek(e,8,SEEK_SET),t>=2*E&&SAEF_ZFile_fseek(e,n,SEEK_SET),t>=4*E&&(r=0,SAEF_ZFile_fseek(e,n=3*E,SEEK_SET)),(i=Se(e,W.baseaddr,0,i,1,0))<0)return SAEF_ZFile_fclose(e),-i;if(W.mask=i-1,W.allocated=i,t>=2*E&&!J){if(re.allocated=E,J=ee,re.label="rom_e0",re.start=14680064,ye(re),SAEF_ZFile_fseek(e,r,SEEK_SET),(i=Se(e,re.baseaddr,0,re.allocated,0,1))<0)return SAEF_ZFile_fclose(e),-i;re.mask=re.allocated-1}if(t>2*E){if(oe.allocated=2*E,ye(oe),SAEF_ZFile_fseek(e,r+E,SEEK_SET),(i=Se(e,oe.baseaddr,0,E,0,1))<0)return SAEF_ZFile_fclose(e),-i;if(SAEF_ZFile_fseek(e,r+2*E,SEEK_SET),(i=Se(e,oe.baseaddr,E,E,0,1))<0)return SAEF_ZFile_fclose(e),-i;oe.mask=oe.allocated-1,oe.start=11010048}return SAEF_log("memory.load_kickstart() kickstart version %d",a=65535==(a=W.baseaddr[12]<<8|W.baseaddr[13])&&33<(a=W.baseaddr[16]<<8|W.baseaddr[17])?0:a),SAEF_ZFile_fclose(e),SAEE_None}function ye(t){t.startmask=t.start;try{return t.baseaddr=new Uint8Array(t.allocated+4),1}catch(e){return void(t.baseaddr=null)}}function ve(e){e.baseaddr=null,S&&"bogo"==e.label&&(S=0)}function be(){for(var e=0;e<t;e++)y[e]=SAEV_Memory_dummyBank}function Ce(e){for(;e&&!(1&e);)e>>>=1;return(-2&e)>>>0==0}function ke(){var e=0;if(SAEV_config.cpu.model<=SAEC_Config_CPU_Model_68010?SAEF_memset(n,0,SAEC_Memory_banktype_FAST16,65536):SAEF_memset(n,0,SAEC_Memory_banktype_FAST32,65536),SAEF_memset(r,0,0,65536),SAEF_memset(r,32,3,SAEV_config.memory.z2FastSize>>>16),SAEF_memset(r,192,1,SAEV_config.memory.bogoSize>>>16),SAEF_memset(r,SAER_Expansion_z3fastmem_bank.start>>>16,3,SAEV_config.memory.z3FastSize>>>16),SAEF_memset(r,H.start>>>16,3,SAEV_config.memory.ramsey.highSize>>>16),SAEF_memset(r,U.start>>>16,3,SAEV_config.memory.ramsey.lowSize>>>16),y[0].flags&SAEC_Memory_addrbank_flag_CHIPRAM)for(e=0;e<32;e++)n[e]=SAEV_config.chipset.mbdmac||SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?SAEC_Memory_banktype_CHIP32:SAEC_Memory_banktype_CHIP16;if(!SAEV_config.chipset.bogomemIsFast){for(e=192;e<224;e++)n[e]=n[0];for(e=L.start>>>16;e<L.start+L.allocated>>>16;e++)n[e]=n[0]}for(e=208;e<224;e++)n[e]=SAEC_Memory_banktype_CHIP16;for(e=160;e<192;e++)n[e]=SAEC_Memory_banktype_CIA,y[e].flags&SAEC_Memory_addrbank_flag_CIA||(n[e]=SAEC_Memory_banktype_FAST32,r[e]=1);if(2==SAEV_config.chipset.mbdmac&&(n[221]=SAEC_Memory_banktype_FAST32),SAEV_config.cpu.addressSpace24)for(e=1;e<256;e++)for(var t=0;t<256;t++)n[256*e+t]=n[t]}function Re(){var e;if(SAEF_log("memory.restore_roms() loading '%s'...",SAEV_config.memory.rom.name),Z(0),q=null,X=!1,ve(re),re.allocated=0,ve(oe),oe.allocated=0,J=0,(e=function(e,t){var n=SAEE_None;if(0==e.size)return n;var r=SAEF_ZFile_fopen_file(e);if(null===r)return SAEE_Memory_NoExtendedRom;if(SAEF_ZFile_fseek(r,0,SEEK_END),e=SAEF_ZFile_ftell(r),re.allocated=E,0==t?3e5<e?J=Q:15728640!=SAER.autoconf.need_uae_boot_rom()&&(J=$):J=t,SAEF_log("memory.load_extendedkickstart() type %d",J),J){switch(SAEF_ZFile_fseek(r,0,SEEK_SET),J){case $:re.label="rom_f0",ye(re),re.start=15728640;break;case Q:re.label="rom_e0",ye(re),re.start=14680064}null!==re.baseaddr&&(re.mask=re.allocated-1,(e=Se(r,re.baseaddr,0,re.allocated,0,1))<0&&(n=-e))}return SAEF_ZFile_fclose(r),n}(SAEV_config.memory.extRom,0))!=SAEE_None)return e;if(W.mask=E-1,(e=ge())==SAEE_None&&!o){var t=SAER.roms.getromdatabydata(W.baseaddr,W.allocated);if(null!==t){if(SAEF_log("memory.restore_roms() identified rom as '%s'",t.name),8&t.cpu&&SAEV_config.cpu.model<SAEC_Config_CPU_Model_68030)return SAEE_CPU_Requires68030;if(3==(3&t.cpu)&&SAEV_config.cpu.model!=SAEC_Config_CPU_Model_68030)return SAEE_CPU_Requires68030;if(1==(3&t.cpu)&&SAEV_config.cpu.model<SAEC_Config_CPU_Model_68020)return SAEE_CPU_Requires680EC20;if(2==(3&t.cpu)&&(SAEV_config.cpu.model<SAEC_Config_CPU_Model_68020||SAEV_config.cpu.addressSpace24))return SAEE_CPU_Requires68020;t.cloanto&&(SAEV_Memory_cloantoRom=!0),4&t.cpu&&SAEV_config.chipset.compatible!=SAEC_Config_Chipset_Compatible_Manual&&(SAEV_config.chipset.ramseyRev<0&&(SAEV_config.chipset.ramseyRev=15),SAEV_config.chipset.fatGaryRev=0,SAEV_config.chipset.ide!=SAEC_Config_Chipset_IDE_A4000&&(SAEV_config.chipset.ide=-1))}else SAEF_log("memory.restore_roms() unknown rom '%s' loaded",SAEV_config.memory.rom.name)}return e==SAEE_None&&he(),SAEF_log("memory.restore_roms() ...done."),e}function we(e,t,n,r){e.start=t<<16,e.startmask=t<<16,xe(e,t,n,r)}function xe(e,t,n,r){!function(e,t,n,r){var i=0,a=256;if(n<<16<(r=r||n<<16)&&SAEF_warn("memory.map_banks2() Broken mapping, size=%x, realsize=%x, start=%x",n,r,t),!c&&256<=t)for(var o=0,s=t;s<t+n;s++)o||(o=r>>>16),y[s]=e,o--;else{for(SAEV_config.cpu.addressSpace24&&(a=65536),c&&(a=256),i=0;i<a;i+=256){o=0;for(s=t;s<t+n;s++)o||(o=r>>>16),y[s+i]=e,o--}ke()}}(e,t,n,r)}function De(e){return y[e>>>16].check(e,1)?y[e>>>16].xlateaddr(e):null}this.a3000_fakekick=function(e){var t;SAEF_log("memory.a3000_fakekick() map %d",e?1:0),e?78==(t=U.baseaddr)[2+(e=U.allocated-de)]&&249==t[3+e]&&0==t[4+e]&&((Ee=null===Ee?new Uint8Array(de):Ee).set(W.baseaddr.subarray(0,de)),252==t[5+e]?(W.baseaddr.set(t.subarray(0,pe)),W.baseaddr.set(t.subarray(0,pe),pe),re.allocated=65536,re.label="rom_f0",re.mask=re.allocated-1,ye(re),re.baseaddr.set(t.subarray(pe,65536+pe)),xe(re,240,1,1),Ae=!0):W.baseaddr.set(t.subarray(0,de))):(Ae&&(xe(SAEV_Memory_dummyBank,240,1,1),ve(re),Ae=!1),null!==Ee&&(W.baseaddr.set(Ee),Ee=null))},this.mapOverlay=function(e){var t=1572864<=F.allocated?F.allocated>>>16:32;p&&(t=8);var n,r=F;e?(xe(SAEV_Memory_dummyBank,0,t,0),SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS&&0==L.allocated?(xe(r,0,t,F.allocated),e=F.allocated>>>16,F.allocated<1048576?SAEV_config.chipset.jumper1MbChip&&(n=1048576-F.allocated>>>16,xe(b,e,n,0),xe(b,16+e,n,0)):F.allocated<2097152&&1048576<F.allocated&&(n=2097152-F.allocated>>>16,xe(b,e,n,0))):xe(r,0,32,F.allocated)):(t<32&&0==p&&(t=32),r=y[240],(n=null)===n&&r&&r.flags&SAEC_Memory_addrbank_flag_ROM&&4372==i(15728640)&&(n=r),r=y[224],xe(n=null===(n=null===n&&r&&r.flags&SAEC_Memory_addrbank_flag_ROM&&4372==i(14680064)?r:n)?W:n,0,t,524288)),ke(),s(SAER_CPU_regs.pc,4)&&SAER.cpu.setPC_normal(SAER_CPU_getPC())},this.getz2size=function(e){return e.memory.z2FastSize},this.getz2endaddr=function(){return SAEV_config.memory.z2FastSize+2097152},this.cleanup=function(){ve(U),U.baseaddr=null,ve(H),H.baseaddr=null,ve(L),L.baseaddr=null,ve(W),W.baseaddr=null,q=null,X=!1,ve(F),F.baseaddr=null,ve(_e),_e.baseaddr=null,ve(ue),ue.baseaddr=null},this.reset=function(e){u=!0,2<d&&(be(),SAER.devices.virtualdevice_init(),F.allocated=0,F.baseaddr=null,L.allocated=0,L.baseaddr=null,re.allocated=0,re.baseaddr=null,oe.allocated=0,oe.baseaddr=null,J=0,U.allocated=0,U.baseaddr=null,H.allocated=0,H.baseaddr=null,_e.allocated=0,_e.baseaddr=null,ue.allocated=0,ue.baseaddr=null,W.allocated=E,W.baseaddr=null,ye(W),SAEF_memset(W.baseaddr,0,0,E)),h=50;var t,n,r,i=(m=SAEV_Memory_defaultXLate_recursive=SAEV_Memory_defaultXLate_cnt=0)!=(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)||SAEV_config.chipset.pcmcia||0<SAEV_config.chipset.ide||SAEV_config.chipset.mbdmac;if(be(),(r=(p=0)!=(L.flags&SAEC_Memory_addrbank_flag_NOALLOC)&&(F.allocated!=SAEV_config.memory.chipSize||L.allocated!=SAEV_config.memory.bogoSize))&&(ve(F),ve(L)),524288==SAEV_config.memory.chipSize&&524288<=SAEV_config.memory.bogoSize&&SAEV_config.cpu.model<68020&&(0!=(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS)&&0==(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)?(F.allocated==SAEV_config.memory.chipSize&&L.allocated==SAEV_config.memory.bogoSize||(ve(F),ve(L),n=F.allocated=SAEV_config.memory.chipSize,t=L.allocated=SAEV_config.memory.bogoSize,F.mask=F.allocated-1,F.start=f,C=2*L.allocated-1,k=1048576,F.allocated=n+t,ye(F),F.allocated=SAEV_config.memory.chipSize,L.baseaddr=F.baseaddr,L.mask=L.allocated-1,L.start=l,L.flags|=SAEC_Memory_addrbank_flag_NOALLOC,S=n),p=1):0==(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS)&&SAEV_config.chipset.jumper1MbChip&&(F.allocated==SAEV_config.memory.chipSize&&L.allocated==SAEV_config.memory.bogoSize||(ve(F),ve(L),n=F.allocated=SAEV_config.memory.chipSize,t=L.allocated=SAEV_config.memory.bogoSize,F.mask=F.allocated-1,F.start=f,C=F.allocated-1,k=F.allocated,F.allocated=n+t,ye(F),F.allocated=SAEV_config.memory.chipSize,L.baseaddr=F.baseaddr,L.mask=L.allocated-1,L.start=F.start+SAEV_config.memory.chipSize,L.flags|=SAEC_Memory_addrbank_flag_NOALLOC,S=n),p=2)),p&&SAEF_log("memory.allocate() %dK chip/%dK bogo-ram to %dK chip-ram aliasing enabled",SAEV_config.memory.chipSize>>10,SAEV_config.memory.bogoSize>>10,k>>10),F.allocated==SAEV_config.memory.chipSize&&!r||(ve(F),F.flags&=~SAEC_Memory_addrbank_flag_NOALLOC,2097152<SAEV_config.memory.chipSize&&524288<=SAEV_config.memory.z2FastSize&&SAER.expansion.free_fastmemory_ext(0),n=F.allocated=k=SAEV_config.memory.chipSize,C=F.mask=F.allocated-1,F.start=f,F.allocated=n=1048576<(n=n<1048576?1048576:n)&&n<2097152?2097152:n,ye(F),F.allocated=SAEV_config.memory.chipSize,n>F.allocated&&SAEF_memset(F.baseaddr,F.allocated,255,n-F.allocated),C=F.allocated-1,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS?(F.allocated<1048576&&(C=1048575),1048576<F.allocated&&F.allocated<2097152&&(C=F.mask=2097151)):SAEV_config.chipset.jumper1MbChip&&(C=524287)),SAER_Memory_chipData=F.baseaddr,SAEV_Memory_chipMask=C,L.allocated==SAEV_config.memory.bogoSize&&!r||2097152==L.allocated&&1572864==SAEV_config.memory.bogoSize||(ve(L),L.flags&=~SAEC_Memory_addrbank_flag_NOALLOC,L.allocated=0,L.allocated=SAEV_config.memory.bogoSize,1572864<=L.allocated&&(L.allocated=2097152),L.mask=L.allocated-1,L.start=l,L.allocated&&ye(L)),U.allocated!=SAEV_config.memory.ramsey.lowSize&&(ve(U),U.allocated=SAEV_config.memory.ramsey.lowSize,U.mask=U.allocated-1,U.start=134217728-U.allocated,U.allocated&&ye(U)),H.allocated!=SAEV_config.memory.ramsey.highSize&&(ve(H),H.allocated=SAEV_config.memory.ramsey.highSize,H.mask=H.allocated-1,H.start=134217728,H.allocated&&ye(H)),_e.allocated!=SAEV_config.memory.custom[0].size&&(ve(_e),_e.allocated=SAEV_config.memory.custom[0].size,_e.mask=Ce(_e.allocated)?_e.allocated-1:-1,_e.start=SAEV_config.memory.custom[0].addr,_e.allocated&&(ye(_e)||(_e.allocated=0))),ue.allocated!=SAEV_config.memory.custom[1].size&&(ve(ue),ue.allocated=SAEV_config.memory.custom[1].size,ue.mask=Ce(ue.allocated)?ue.allocated-1:-1,ue.start=SAEV_config.memory.custom[1].addr,ue.allocated&&(ye(ue)||(ue.allocated=0))),SAER_Memory_chipGet8_indirect=V,SAER_Memory_chipGet16_indirect=T,SAER_Memory_chipGet32_indirect=R,SAER_Memory_chipPut8_indirect=P,SAER_Memory_chipPut16_indirect=I,SAER_Memory_chipPut32_indirect=x,SAER_Memory_chipCheck_indirect=D,SAER_Memory_chipXLate_indirect=M,1<d||null!==q&&e&&SAER.m68k.is_hardreset()){var a=Re();if(a!=SAEE_None)return a}xe(SAEV_Custom_bank,192,32,0),xe(SAEV_CIA_bank,160,32,0),SAEV_config.chipset.a1000ram||SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_MSM6242B_A2000||xe(SAEV_Memory_dummyBank,216,6,0);var o,a=F.allocated>>>16;switch(a<32+(SAEV_config.memory.z2FastSize>>>16)&&(a=32+(SAEV_config.memory.z2FastSize>>>16)),xe(SAEV_Memory_dummyBank,a,(i?191:160)-a,0),i&&(SAEV_config.chipset.ide==SAEC_Config_Chipset_IDE_A4000||SAEV_config.chipset.mbdmac?xe(SAEV_Memory_dummyBank,208,8,0):xe(SAEV_Memory_dummyBank,192,24,0)),null!==L.baseaddr&&(24<(o=28<(o=SAEV_config.memory.bogoSize>>>16)?28:o)&&(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA||SAEV_config.cpu.model>=SAEC_Config_CPU_Model_68020&&0==SAEV_config.cpu.addressSpace24)&&(o=24),xe(L,2==p?8:192,o,0)),(SAEV_config.chipset.ide||SAEV_config.chipset.pcmcia)&&(SAEV_config.chipset.ide!=SAEC_Config_Chipset_IDE_A600A1200&&!SAEV_config.chipset.pcmcia||(xe(SAEV_Gayle_bank,216,6,0),xe(SAEV_Gayle2_bank,221,2,0)),SAER.gayle.map_pcmcia(),SAEV_config.chipset.ide!=SAEC_Config_Chipset_IDE_A4000&&2!=SAEV_config.chipset.mbdmac||xe(SAEV_Gayle_bank,221,1,0),SAEV_config.chipset.ide<0&&!SAEV_config.chipset.pcmcia&&xe(SAEV_Gayle_bank,216,6,0),SAEV_config.chipset.ide<0&&xe(SAEV_Gayle_bank,221,1,0)),SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_MSM6242B_A2000&&xe(SAEV_RTC_bank,216,4,0),(SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_MSM6242B||SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_RF5C01A||SAEV_config.chipset.mirrorA8||0<SAEV_config.chipset.ide||SAEV_config.chipset.pcmcia)&&xe(SAEV_RTC_bank,220,1,0),(0<=SAEV_config.chipset.fatGaryRev||0<=SAEV_config.chipset.ramseyRev)&&xe(SAEV_MBRes_bank,222,1,0),null!==U.baseaddr&&xe(U,U.start>>>16,U.allocated>>>16,0),null!==H.baseaddr&&xe(H,H.start>>>16,H.allocated>>>16,0),we(W,248,8,0),17==W.baseaddr[0]&&78==W.baseaddr[2]&&249==W.baseaddr[3]&&0==W.baseaddr[4]&&(32==(o=W.baseaddr[5])&&SAEV_config.memory.chipSize<=2097152&&0==SAEV_config.memory.z2FastSize&&we(W,o,8,0),192==o&&0==SAEV_config.memory.bogoSize&&we(W,o,8,0),240==o&&we(W,o,8,0)),null!==q&&Z(1),xe(SAER_Expansion_expamem_bank,232,1,0),Ae&&we(re,240,1,0),this.mapOverlay(!0),J){case ee:we(re,224,8,0);break;case $:we(re,240,re.allocated==2*E?16:8,0);break;case Q:we(re,224,8,0)}SAER.autoconf.need_uae_boot_rom()&&we(SAER_AutoConf_bank,SAEV_AutoConf_base>>>16,1,0),!SAEV_Memory_cloantoRom&&!SAEV_config.chipset.mirrorE0||J||xe(W,224,8,0),SAEV_config.chipset.mirrorA8&&(oe.allocated?we(oe,168,16,0):(J==Q||J==ee?xe(re,176,8,0):xe(W,176,8,0),xe(W,168,8,0)));for(var s=0;s<2;s++){var c=SAEV_config.memory.custom[s];if(c.size&&(xe(0==s?_e:ue,c.addr>>>16,c.size>>>16,0),c.mask))for(var _=c.addr;_&c.mask;_+=c.size)xe(0==s?_e:ue,_>>>16,c.size>>>16,0)}return d&&this.clear(),SAEE_None},this.clear=function(){d=0,null!==F.baseaddr&&SAEF_memset(F.baseaddr,0,0,F.allocated),null!==L.baseaddr&&SAEF_memset(L.baseaddr,0,0,L.allocated),null!==U.baseaddr&&SAEF_memset(U.baseaddr,0,0,U.allocated),null!==H.baseaddr&&SAEF_memset(H.baseaddr,0,0,H.allocated),SAER.expansion.clear()},this.hardreset=function(e){d<e+1&&(d=e+1)},this.ks12orolder=function(){return 0<a&&a<34},this.ks11orolder=function(){return 0<a&&a<33},this.map_banks_cond=function(e,t,n,r){for(var i=0;i<SAEV_config.memory.custom.length;i++){var a=SAEV_config.memory.custom[i].addr>>>16;if(a)if(SAEV_config.memory.custom[i].size>>>16){if(t<=a&&a<=t+n)return;if(a<=t&&(t<=a+n||a<t+n))return}}xe(e,t,n,r)},SAER_Memory_mapBanks=xe,this.map_banks_z2=function(e,t,n){!function(e,t,n){if(t<32||160<=t&&t<233||240<=t)return SAEF_error("memory.validate_banks_z2() bank '%s' with invalid start address %08X",e.name,t<<16),void SAER.m68k.cpu_halt(SAEC_CPU_halt_AUTOCONFIG_CONFLICT);if(233<=t){if(240<t+n)return SAEF_error("memory.validate_banks_z2() bank '%s' with invalid region %08x - %08X",e.name,t<<16,t+n<<16),void SAER.m68k.cpu_halt(SAEC_CPU_halt_AUTOCONFIG_CONFLICT)}else if(160<t+n)return SAEF_error("memory.validate_banks_z2() bank '%s' with invalid region %08x - %08X",e.name,t<<16,t+n<<16),void SAER.m68k.cpu_halt(SAEC_CPU_halt_AUTOCONFIG_CONFLICT);if(n<=0||128<n)return SAEF_error("memory.validate_banks_z2() bank '%s' with invalid size %08x",e.name,n),void SAER.m68k.cpu_halt(SAEC_CPU_halt_AUTOCONFIG_CONFLICT);for(var r=t;r<t+n;r++){var i=y[t];if(i!==SAEV_Memory_dummyBank)return void SAEF_error("memory.validate_banks_z2() bank '%s' attempting to override existing memory bank '%s' at %08X",e.name,i.name,r<<16)}return 1}(e,t,n)||xe(e,t,n,0)},this.map_banks_z3=function(e,t,n){!function(e,t,n){if(t<4096||n<=0)return SAEF_error("memory.validate_banks_z3() invalid bank '%s' start=%08x size=%08x",e.name,t<<16,n<<16),void SAER.m68k.cpu_halt(SAEC_CPU_halt_AUTOCONFIG_CONFLICT);if(!(16384<n||61440<t+n)){for(var r=t;r<t+n;r++){var i=y[t];if(i!==SAEV_Memory_dummyBank&&i!==e)return void SAEF_error("memory.validate_banks_z3() bank '%s' attempting to override existing memory bank '%s' at %08X",e.name,i.name,r<<16)}return 1}SAEF_error("memory.validate_banks_z3() invalid bank '%s' start=%08x size=%08x",e.name,t<<16,n<<16)}(e,t,n)||xe(e,t,n,0)};const Me=64;const Fe=1024;function Te(){this.regions=new Array(Me),this.num_regions=0}function Ve(e){!function(e,t){var n,r=y[0],i="",a=SAEV_config.memory.logIllegal;SAEV_config.memory.logIllegal=!1;for(var o=SAEV_config.cpu.addressSpace24?256:65536,s=n=e.num_regions=0;s<1+o;s++){var c=null;if(r!==(c=s<o?y[s]:c)){var _,f,l,u,d=r.name,p=r.sub_banks,E=0,A=0,S=n,m=De(S<<16),h=null!==m?1:0;for(S++;S<s&&null!==m;)De(S<<16)===m&&h++,S++;for(0==(_=h)&&(_=1);A<65536;){var g=A;if(null!==p){if(null===p[E].bank)break;for(d=(r=SAER.memory.getSubBank({value:(n<<16|A)>>>0})).name;!(65536<=(g+=Fe));)if(SAER.memory.getSubBank({value:(n<<16|g)>>>0})!==r)break;E++,f=g-A>>10}else f=s-n<<6,Math.floor((s-n<<16)/_);if(null===d&&(d="<none>"),l=f,u="K",256<=n&&1024<=Math.floor(l/_)&&!(1023&Math.floor(l/_))&&(l>>=10,u="M"),i=sprintf("%08X %7d%s/%d = %7d%s %s",(n<<16|A)>>>0,l,u,h,h?Math.floor(l/h):l,u,d),i+="\n",0<t?SAEF_log(i):0==t&&console.log(i),"".length&&(0<t?SAEF_log(""):0==t&&console.log("")),null===p)break;A=g}n=s,r=c}}SAEV_config.memory.logIllegal=a}(new Te,e)}this.map_dump=function(){SAEV_config.debug.level==SAEC_Config_Debug_Level_Log&&Ve(1)}}var SAER_AutoConf_bank=null;const SAEC_AutoConf_RTS=20085;var SAEV_AutoConf_base=15728640,SAEV_AutoConf_boot_rom_type=0,SAEV_AutoConf_boot_rom_size=0;function SAEO_AutoConf(){const r=15728640,i=15663104;const a=65532,n=16384,o=32768;const s=61440,c=8,_=4;const f=16380,t=o/8192;var l=new Array(o/8192),u=0,d=0;this.need_uae_boot_rom=function(){var e,t,n={type:0},e=(e=n,t=r,(e.type=1)==SAEV_config.chipset.mbdmac&&(t=i),null!==SAER_Memory_getBank(r)&&SAER_Memory_check(r,65536)&&(t=i),2097152<SAEV_config.memory.chipSize?t:e.type=0);return SAEF_log("autoconf.need_uae_boot_rom() type %d",SAEV_AutoConf_boot_rom_type=n.type),SAEV_AutoConf_base||(SAEV_AutoConf_boot_rom_type=e=0),e},this.rethink_traps=function(){return!1};const p=65520;function E(e){return e>=s&&e<s+t*c}function e(e){return(h.baseaddr[e&=65535]<<24|h.baseaddr[e+1]<<16|h.baseaddr[e+2]<<8|h.baseaddr[e+3])>>>0}function A(e){return(h.baseaddr[e&=65535]<<8)+h.baseaddr[e+1]}function S(e){return e>=p||(e>=f&&e<f+4||((t=e)>=n&&t<n+o||E(e)));var t}function m(e,t){var n;S(e&=65535)&&(h.baseaddr[e]=t,E(e)&&(n=(e-=s)&c-1,e=Math.floor(e/c),n==_+3&&(255!=(t=t)&&254!=t&&1!=t&&2!=t&&SAEF_log("autoconf.rtarea_put8() TRAP %d (%02x)",e,t),254==t&&atomic_dec(k),1==t&&atomic_dec(k),1!=t&&2!=t||SetEvent(l[e]))))}var h=new SAEO_Memory_addrbank(e,A,function(e){var t,n;return E(e&=65535)?(n=(t=e-s)&c-1,Math.floor(t/c),0==n&&(h.baseaddr[e]=u?1:0)):e==a+0?h.baseaddr[e]=atomic_bit_test_and_reset(d,0):e==a+1?h.baseaddr[e]=0!=k:e==a+2&&(h.baseaddr[e]=0),0==k?atomic_and(d,-8193):(atomic_or(d,8192),set_special_exter(SPCFLAG_UAEINT)),h.baseaddr[e]},function(e,t){S(e&=65535)&&(h.baseaddr[e+0]=t>>>24,h.baseaddr[e+1]=t>>>16&255,h.baseaddr[e+2]=t>>>8&255,h.baseaddr[e+3]=255&t)},function(e,t){var n;t&=65535,S(e&=65535)&&(m(e,t>>8),m(e+1,255&t),E(e)&&(n=(e-=s)&c-1,e=Math.floor(e/c),0==n&&(SAEF_log("autoconf.rtarea_put16() TRAP %d (%04x)",e,t),call_hardware_trap(h.baseaddr,SAEV_AutoConf_base,e))))},m,function(e){return e&=65535},function(e,t){return(e&=65535)+t<=65535},null,"rtarea","UAE Boot ROM",e,A,SAEC_Memory_addrbank_flag_ROMIN|SAEC_Memory_addrbank_flag_PPCIOSPACE);SAER_AutoConf_bank=h,this.reset=function(){SAEF_memset(h.baseaddr,n,0,o),SAEF_memset(h.baseaddr,s,0,c*t)};var g=0;this.db=function(e){h.baseaddr[g++]=e},this.dw=function(e){h.baseaddr[g++]=e>>8,h.baseaddr[g++]=255&e},this.dl=function(e){h.baseaddr[g++]=e>>24,h.baseaddr[g++]=e>>16&255,h.baseaddr[g++]=e>>8&255,h.baseaddr[g++]=255&e},this.calltrap=function(e){this.dw(40960+e)},this.org=function(e){(4294901760&e)>>>0!=15728640&&(4294901760&e)>>>0!=SAEV_AutoConf_base&&SAEF_warn("autoconf.org() corrupt address %08X",e),g=65535&e},this.here=function(){return g+SAEV_AutoConf_base},this.setup=function(){g=0,this.init_traps(),this.need_uae_boot_rom()?h.flags&=~SAEC_Memory_addrbank_flag_ALLOCINDIRECT:h.flags|=SAEC_Memory_addrbank_flag_ALLOCINDIRECT,h.allocated=65536,function(t){t.startmask=t.start;try{return t.baseaddr=new Uint8Array(t.allocated+4),1}catch(e){return void(t.baseaddr=null)}}(h)||SAEF_fatal(SAEE_NoMemory,"autoconf.init_mem() memory exhausted"),SAEF_memset(h.baseaddr,0,0,65536),this.dw(0),this.dw(0),this.define_trap(null,0,"null"),SAEF_log("autoconf.setup() boot_rom_size %d/%d",SAEV_AutoConf_boot_rom_size=this.here()-SAEV_AutoConf_base,12288),12288<=SAEV_AutoConf_boot_rom_size&&SAEF_fatal(SAEE_NoMemory,"autoconf.setup() RTAREA_TRAPS needs to be increased!"),this.org(12288|SAEV_AutoConf_base),this.init_extended_traps()},this.cleanup=function(){h.baseaddr=null,this.free_traps()},this.init=function(){var e=this.need_uae_boot_rom();e&&(SAEF_log("autoconf.init() RTAREA located at %08X",e),SAEV_AutoConf_base=e)},this.makedatatable=function(e,t,n,r,i,a){var o=this.here();return this.dw(57344),this.dw(8),this.dw(n<<8),this.dw(57344),this.dw(9),this.dw(r<<8),this.dw(49152),this.dw(10),this.dl(t),this.dw(57344),this.dw(14),this.dw(1536),this.dw(53248),this.dw(20),this.dw(i),this.dw(53248),this.dw(22),this.dw(a),this.dw(49152),this.dw(24),this.dl(e),this.dw(0),o};function y(){this.handler=null,this.flags=0,this.name="",this.addr=0}for(var v=1,b=new Array(16),C=0;C<16;C++)b[C]=new y;var k=0;this.find_trap=function(e){for(var t=0;t<v;t++){var n=b[t];if(16&n.flags&&n.name.length&&n.name==e)return n.addr}return 0},this.define_trap=function(e,t,n){if(16!=v){for(var r=this.here(),i=0;i<v;i++)if(r==b[i].addr)return i;var a=v++,o=b[a];return o.handler=e,o.flags=t,o.name=n,o.addr=r,a}SAEF_fatal(SAEE_Internal,"define_trap() Ran out of emulator traps. (increase MAX_TRAPS)")},this.m68k_handle_trap=function(e){var t=b[e],n=0,r=0==(2&t.flags),i=0!=(8&t.flags);t.name.length&&SAEF_log("m68k_handle_trap() TRAP '%s'",t.name),e<v?4&t.flags?SAEF_fatal(SAEE_Internal,"m68k_handle_trap() Extended-traps are not implemented."):(n=t.handler(null),r&&SAEF_log("m68k_handle_trap() D0 = %d",SAER_CPU_regs.d[0]=n),i&&(i=SAER_Memory_get32(SAER_CPU_regs.a[7]),SAER_CPU_setPC(i),SAER_CPU_regs.a[7]+=4,SAER_CPU_fill_prefetch())):SAEF_warn("m68k_handle_trap() illegal emulator trap")},this.init_traps=function(){k=v=0},this.free_traps=function(){},this.init_extended_traps=function(){}}var SAER_Expansion_expamem_bank=null,SAER_Expansion_z3fastmem_bank=null;function SAEO_Expansion(){const r=2,o=3,i=4,a=5,s=6;const c=0,_=7,f=6,l=5,u=4,d=3,p=2,E=1,A=0,S=1,m=2,h=3,g=4,y=5,v=6;const b=16,C=32,n=64,k=192,R=128;const w=0;const x=6,D=7,M=8;const F=10;const T=16,V=32;const I=128;function e(){this.initrc=null,this.initnum=null,this.map=null,this.rc=null,this.name="",this.flags=0,this.zorro=0}for(var P=new Array(16),t=0;t<16;t++)P[t]=new e;var z=0,O=0,L=0;const N=268435456,B=1073741824;var U=new Uint8Array(65536),K=0,G=0,H=0,X=0,q=0,Z=0,j=0,Y=0,W=null,J=!1;function Q(e){return!J&&(e.memory.z3Mapping==SAEC_Config_Memory_z3Mapping_Auto||e.memory.z3Mapping==SAEC_Config_Memory_z3Mapping_SAE)}function $(){SAEF_memset(U,0,255,65536)}function ee(){SAER_Memory_mapBanks(SAEV_Memory_dummyBank,232,1,0),SAEV_config.cpu.addressSpace24||SAER_Memory_mapBanks(SAEV_Memory_dummyBank,65280,1,0)}function te(){ke.name="Autoconfig Z2",xe.name="Autoconfig Z3",ee(),z=O}function ne(e){var t=240&U[e]|U[e+2]>>4;return 0==e||2==e||64==e||66==e?t:255&(t=~t)}function re(e,t){0==(e&=65535)||2==e||64==e||66==e?(U[e]=240&t,U[e+2]=(15&t)<<4):(U[e]=~(240&t),U[e+2]=~((15&t)<<4))}function ie(){return 192&ne(0)}function ae(){var e;if(ke.name=P[z].name||"None",e=P[z].initnum?P[z].initnum(0):P[z].initrc(P[z].rc),q=0,!1!==e){var t=e;if((t=null===e?ke:e)!==ke)for(var n=0;n<64;n++)U[n]=t.get8(n);var r,i=ne(0);(192&i)==k?(j=0==(i&=7)?8388608:32768<<i,Y=H):(192&i)==R?(Z<N&&(Z=SAEV_config.memory.z3AutoConfigStart,134217728<=SAEV_config.memory.ramsey.highSize&&Z==N&&(Z+=SAEV_config.memory.ramsey.highSize-134217728+16777216),Q(SAEV_config)||(Z=B)),X=Z,i&=7,q=ne(8)&V?16777216<<i:16777216,Z+=q,r=X,Z+=(X=q<=33554432?(X+q-1&~(q-1))>>>0:X)-r,j=q,Y=X):64==(192&i)&&(j=65536,Y=H),null!==e?(W=e,1&P[z].flags&&SAEV_config.chipset.z3AutoConfig&&!SAEV_config.cpu.addressSpace24?(SAER_Memory_mapBanks(xe,65280,1,0),SAER_Memory_mapBanks(SAEV_Memory_dummyBank,232,1,0)):(SAER_Memory_mapBanks(ke,232,1,0),SAEV_config.cpu.addressSpace24||SAER_Memory_mapBanks(SAEV_Memory_dummyBank,65280,1,0))):1&P[z].flags&&SAEV_config.chipset.z3AutoConfig&&!SAEV_config.cpu.addressSpace24?(W=ke,SAER_Memory_mapBanks(xe,65280,1,0),SAER_Memory_mapBanks(SAEV_Memory_dummyBank,232,1,0)):(W=null,SAER_Memory_mapBanks(ke,232,1,0),SAEV_config.cpu.addressSpace24||SAER_Memory_mapBanks(SAEV_Memory_dummyBank,65280,1,0))}else se(null)}function oe(e,t){var n=ne(0),r=j,i="K";8192<(r>>>=10)&&(i="M",r>>>=10),SAEF_log("memory.boardmessage() Card %d: Z%d 0x%08x %4d%s %s %s%s",z+1,(192&n)==k?2:(192&n)==R?3:1,Y,r,i,n&b?"ROM":n&C?"RAM":"IO ",e.name,t?"":" SHUT UP")}function se(e){for(e&&oe(e,!0),$(),ee();!(O<=++z);){var t=P[z];if(!t.initrc||(n=t.zorro)!=a&&n!=s&&n!=i){ae();break}t.initrc(P[z].rc)}var n;O<=z&&(te(),te(),SAEF_log("Memory map after autoconfig:"),SAER.memory.map_dump())}function ce(e){return e=(e&fe.mask)>>>0,(fe.baseaddr[e]<<24|fe.baseaddr[e+1]<<16|fe.baseaddr[e+2]<<8|fe.baseaddr[e+3])>>>0}function _e(e){return e=(e&fe.mask)>>>0,fe.baseaddr[e]<<8|fe.baseaddr[e+1]}var fe=new SAEO_Memory_addrbank(ce,_e,function(e){return e=(e&fe.mask)>>>0,fe.baseaddr[e]},function(e,t){e=(e&fe.mask)>>>0,fe.baseaddr[e]=t>>>24,fe.baseaddr[e+1]=t>>>16&255,fe.baseaddr[e+2]=t>>>8&255,fe.baseaddr[e+3]=255&t},function(e,t){e=(e&fe.mask)>>>0,fe.baseaddr[e]=t>>8,fe.baseaddr[e+1]=255&t},function(e,t){e=(e&fe.mask)>>>0,fe.baseaddr[e]=t},function(e){return e=(e&fe.mask)>>>0},function(e,t){return(e=(e&fe.mask)>>>0)+t<=fe.allocated},null,"fast","Fast memory",ce,_e,SAEC_Memory_addrbank_flag_RAM|SAEC_Memory_addrbank_flag_THREADSAFE);function le(e,t,n,r,i){var a,o=0,s=I,c=new Uint8Array(16);o||(t<=2?a=81:(t=1048576==i?x:2097152==i?D:4194304==i?M:8388608==i?F:w,a=83,s|=T|(8388608<i?V:t)),o=L),c[0]=n,c[1]=a,c[2]=s,c[4]=o>>8,c[5]=255&o,c[6]=r>>>24,c[7]=r>>>16&255,c[8]=r>>>8&255,c[9]=255&r,re(0,c[0]),re(4,c[1]),re(8,c[2]),re(16,c[4]),re(20,c[5]),re(24,c[6]),re(28,c[7]),re(32,c[8]),re(36,c[9]),re(40,0),re(44,0),re(64,0)}function ue(e){return t=C|k,0!=(n=fe.allocated)&&($(),65536==n?t|=E:131072==n?t|=p:262144==n?t|=d:524288==n?t|=u:1048576==n?t|=l:2097152==n?t|=f:4194304==n?t|=_:8388608==n&&(t|=c),le(0,r,t,1,n),le(0,-1,t,1,n),null);var t,n}function de(){return e=(G|K>>4)<<16>>>0,n=(t=fe).allocated,t.start=e,t.start&&SAER.memory.map_banks_z2(t,t.start>>>16,n>>>16),t;var e,t,n}function pe(){var e,t,n,r,i,a,o={start:me.start},e=(e=me,t=o,n=SAEV_config.memory.z3FastSize,r=me.allocated,i=X,a=t.start,Q(SAEV_config)?i&&a!=i&&(SAEF_warn("memory.expamem_map_z3fastmem_2() Z3MEM mapping changed from $%08x to $%08x",a,i),map_banks(SAEV_Memory_dummyBank,a>>>16,n>>>16,r),t.start=i,SAER.memory.map_banks_z3(e,a>>>16,n>>>16)):(SAER.memory.map_banks_z3(e,i>>>16,n>>>16),t.start=i),e);return me.start=o.start,e}function Ee(e){return n=(t=me).start,r=SAEV_config.memory.z3FastSize,i=me.allocated,a=1048576==i?l:2097152==i?f:4194304==i?_:8388608==i?c:16777216==i?A:33554432==i?S:67108864==i?m:134217728==i?h:268435456==i?g:536870912==i?y:v,i<16777216&&(a=A),$(),le(0,o,C|R|a,1,i),SAER.memory.map_banks_z3(t,n>>>16,r>>>16),null;var t,n,r,i,a}function Ae(e){return e=(e&me.mask)>>>0,(me.baseaddr[e]<<24|me.baseaddr[e+1]<<16|me.baseaddr[e+2]<<8|me.baseaddr[e+3])>>>0}function Se(e){return e=(e&me.mask)>>>0,me.baseaddr[e]<<8|me.baseaddr[e+1]}var me=new SAEO_Memory_addrbank(Ae,Se,function(e){return e=(e&me.mask)>>>0,me.baseaddr[e]},function(e,t){e=(e&me.mask)>>>0,me.baseaddr[e]=t>>>24,me.baseaddr[e+1]=t>>>16&255,me.baseaddr[e+2]=t>>>8&255,me.baseaddr[e+3]=255&t},function(e,t){e=(e&me.mask)>>>0,me.baseaddr[e]=t>>8,me.baseaddr[e+1]=255&t},function(e,t){e=(e&me.mask)>>>0,me.baseaddr[e]=t},function(e){return e=(e&me.mask)>>>0},function(e,t){return(e=(e&me.mask)>>>0)+t<=me.allocated},null,"z3","Zorro III Fast RAM",Ae,Se,SAEC_Memory_addrbank_flag_RAM|SAEC_Memory_addrbank_flag_THREADSAFE);function he(t){t.startmask=t.start;try{return t.baseaddr=new Uint8Array(t.allocated+4),1}catch(e){return void(t.baseaddr=null)}}function ge(e){e.baseaddr=null}function ye(e){0==e&&ge(fe)}function ve(){var e;me.start=SAEV_config.memory.z3AutoConfigStart,Q(SAEV_config)||(me.start=B),me.start==N&&134217728<=SAEV_config.memory.ramsey.highSize&&(me.start+=SAEV_config.memory.ramsey.highSize-134217728+16777216),fe.allocated!=SAEV_config.memory.z2FastSize&&(ye(0),fe.allocated=SAEV_config.memory.z2FastSize,fe.mask=fe.allocated-1,fe.allocated&&he(fe),SAER.memory.hardreset(1)),me.allocated!=SAEV_config.memory.z3FastSize&&(ge(me),function(e,t,n,r){var i=e.size;if(t.allocated=0,t.baseaddr=null,t.mask=0,i)for(;1024*n*1024<=i;){if(t.mask=i-1,t.allocated=i,t.label=r,he(t))return e.size=i;SAEF_warn("expansion.mapped_malloc_dynamic() out of memory for '%s'. (%d bytes)",r,i),i>>>=1}}(e={size:SAEV_config.memory.z3FastSize},me,1,"z3"),SAEV_config.memory.z3FastSize=e.size,SAER.memory.hardreset(1))}function be(e){return W&&W!==ke?W.get16(e):ie()!=R&&W&&W!==ke?W.get8(e)<<8:(SAEF_warn("expamem_get16() READ.W from address $%08x PC=%x",e,SAER_CPU_getPC()),Ce(e)<<8|Ce(e+1))}function Ce(e){return W&&W!==ke?W.get8(e):U[65535&e]}SAER_Expansion_z3fastmem_bank=me,this.free_fastmemory_ext=function(e){ye(e)},this.reset=function(){var e=1;O=z=0,L=514,ve(),ke.name="Autoconfig [reset]",0==SAER.autoconf.need_uae_boot_rom()&&(e=0),SAEV_AutoConf_boot_rom_type<=0&&(e=0),SAER.memory.ks12orolder()&&e&&(SAEF_log("expansion.reset() Kickstart version is below 1.3! Disabling automount devices."),e=0);SAEV_config.memory.z2FastAutoConfig?null!==fe.baseaddr&&(fe.allocated<=262144||SAEV_config.memory.chipSize<=2097152)&&(P[O].flags=0,P[O].name="Z2Fast",P[O].initnum=ue,P[O++].map=de):null!==fe.baseaddr&&(fe.name="Fast memory (non-autoconfig)",SAER_Memory_mapBanks(fe,32,fe.allocated>>>16,0)),SAEV_config.cpu.addressSpace24||null!==me.baseaddr&&(e=SAEV_config.memory.z3Mapping!=SAEC_Config_Memory_z3Mapping_Real,z3num=0,P[O].flags=3,P[O].name="Z3Fast",P[O].initnum=Ee,P[O++].map=pe,(e||Q(SAEV_config))&&SAER.memory.map_banks_z3(me,me.start>>>16,SAEV_config.memory.z3FastSize>>>16)),((Z=X=H=0)==O?ee:ae)()},this.setup=function(){fe.allocated=0,fe.mask=fe.start=0,fe.baseaddr=null,ve()},this.cleanup=function(){ge(fe)},this.clear=function(){var e;null!==(e=fe).baseaddr&&e.allocated&&SAEF_memset(e.baseaddr,0,0,8388608<e.allocated?8388608:e.allocated)};var ke=new SAEO_Memory_addrbank(function(e){return W&&W!==ke?W.get32(e):(SAEF_warn("expamem_get32() Z2 READ.L from address $%08x PC=%x",e,SAER_CPU_getPC()),(be(e)<<16|be(e+2))>>>0)},be,Ce,function(e,t){W&&W!==ke?W.put32(e,t):SAEF_warn("expamem_put32() Z2 WRITE.L to address $%08x : value $%08x",e,t)},function(e,t){if(t&=65535,!(O<=z)){switch(ie()!=R&&SAEF_warn("expamem_put16() WRITE.W to address $%08x : value $%x PC=%08x",e,t,SAER_CPU_getPC()),255&e){case 72:if(ie()==k){if(Y=H=((G=t>>8&255)|(K=0)>>4)<<16,P[z].map)return void se(P[z].map());if(W&&W!==ke)return void W.put8(e,t>>8)}break;case 68:if(ie()==R&&(e=((G=65280&t)|K>>4)<<16>>>0,Q(SAEV_config)?e!=X&&(SAEF_warn("expansion.expamem_put16() hack %08x %08x",e,X),SAER_Memory_put16(SAER_CPU_regs.a[3]+32,X>>>16),SAER_Memory_put16(SAER_CPU_regs.a[3]+40,X>>>16)):X=e,Y=X),P[z].map)return void se(P[z].map());break;case 76:if(P[z].map)return void se(null)}W&&W!==ke&&W.put16(e,t)}},function(e,t){if(t&=255,!(O<=z)){if(ie()==n){if(34==(255&e))if(Y=H=15204352|4096*(G=127&t),P[z].map)return void se(P[z].map())}else switch(255&e){case 72:if(ie()==k){if(Y=H=((G=255&t)|K>>4)<<16,P[z].map)return void se(P[z].map())}else K=255&t;break;case 74:ie()==k&&(K=255&t);break;case 76:if(P[z].map)return void se(W)}W&&W!==ke&&W.put8(e,t)}},SAEF_Memory_defaultXLate,SAEF_Memory_defaultCheck,null,null,"Autoconfig Z2",SAEF_Memory_dummyGetInst32,SAEF_Memory_dummyGetInst16,SAEC_Memory_addrbank_flag_IO|SAEC_Memory_addrbank_flag_SAFE|SAEC_Memory_addrbank_flag_PPCIOSPACE);function Re(e){if(!W)return 0;var t=255&e;return 256&e&&(t+=2),W.get8(t)}function we(e){return SAEF_warn("expansion.expamemz3_get16() READ.W from address $%08x PC=%x",e,SAER_CPU_getPC()),Re(e)<<8|Re(e+1)}SAER_Expansion_expamem_bank=ke;var xe=new SAEO_Memory_addrbank(function(e){return SAEF_warn("expansion.expamemz3_get32() READ.L from address $%08x PC=%x",e,SAER_CPU_getPC()),(we(e)<<16|we(e+2))>>>0},we,Re,function(e,t){SAEF_warn("expansion.expamemz3_put32() WRITE.L to address $%08x, value $%08x",e,t)},function(e,t){var n,r;W&&(n=255&e,256&e&&(n+=2),68==n&&ie()==R&&(r=((G=65280&t)|K>>4)<<16>>>0,Q(SAEV_config)?r!=X&&(SAEF_warn("expansion.expamemz3_put16() hack %08x %08x",e,X),SAER_Memory_put16(SAER_CPU_regs.a[3]+32,X>>>16),SAER_Memory_put16(SAER_CPU_regs.a[3]+40,X>>>16)):X=r,Y=X),W.put16(n,t))},function(e,t){var n;W&&(n=255&e,256&e&&(n+=2),72==n?ie()==k?Y=H=((G=255&t)|K>>4)<<16>>>0:K=255&t:74==n&&ie()==k&&(K=255&t),W.put8(n,t))},SAEF_Memory_defaultXLate,SAEF_Memory_defaultCheck,null,null,"Autoconfig Z3",SAEF_Memory_dummyGetInst32,SAEF_Memory_dummyGetInst16,SAEC_Memory_addrbank_flag_IO|SAEC_Memory_addrbank_flag_SAFE|SAEC_Memory_addrbank_flag_PPCIOSPACE)}const SAEC_Events_CYCLE_UNIT=512,SAEC_Events_CYCLE_UNIT_INV=1/SAEC_Events_CYCLE_UNIT,SAEC_Events_CYCLE_MAX=4294967296*SAEC_Events_CYCLE_UNIT,SAEC_Events_EV_CIA=0,SAEC_Events_EV_AUDIO=1,SAEC_Events_EV_HSYNC=2,SAEC_Events_EV2_BLITTER=0,SAEC_Events_EV2_DISK=1,SAEC_Events_syncbase=1e6;var SAER_Events_eventtab=null,SAEV_Events_currcycle=0,SAEV_Events_bogusframe=0,SAEV_Events_timeframes=0,SAEV_Events_hsync_counter=0,SAEV_Events_vsync_counter=0,SAEV_Events_frameskiptime=0,SAEV_Events_reflowtime=0;function SAEO_Events(){const a=3;function e(){this.active=!1,this.evtime=0,this.oldcycles=0,this.handler=null}var o=new Array(4);for(i=0;i<4;i++)o[i]=new e;SAER_Events_eventtab=o;const s=12;function t(){this.active=!1,this.evtime=0,this.data=null,this.handler=null}var c=new Array(s);for(i=0;i<s;i++)c[i]=new t;var _=0,f=0,l=0,n=0,u=0,d=0,p=0,E=0,A=0,S=0,m=0,h=new SAEO_MAvg(128),g=new SAEO_MAvg(10),y=!1,v=0,r=new SAEO_MAvg(10),b=new SAEO_MAvg(10),C=0,k=0,R=2;const w=256*SAEC_Events_CYCLE_UNIT;var x=0;function D(){var e=SAEC_Events_CYCLE_MAX,t=SAEV_Events_currcycle;if(v)y=!0;else{v++;for(var n=!(SAER_Events_eventtab[a].active=!1);n;)for(var r,n=!1,e=SAEC_Events_CYCLE_MAX,i=0;i<s;i++)c[i].active&&(c[i].evtime==t?(c[i].active=!1,c[i].handler(c[i].data),(y||c[i].active)&&(y=!(n=!0))):(r=c[i].evtime-t)<e&&(e=r));e!=SAEC_Events_CYCLE_MAX&&(SAER_Events_eventtab[a].active=!0,SAER_Events_eventtab[a].oldcycles=t,SAER_Events_eventtab[a].evtime=t+e,SAER.events.schedule()),v--}}function M(){r.clr(),b.clr(),SAEV_Events_bogusframe=2,SAEV_Events_timeframes=0,C=SAEF_now(),k=0}function F(e){var t=SAEF_now(),e=t-p+e;return(e>SAEC_Events_syncbase||e<-SAEC_Events_syncbase)&&(u=d=p=t,e=0),e}this.reset=function(){null===o[SAEC_Events_EV_HSYNC].handler&&(o[SAEC_Events_EV_CIA].handler=function(){SAER.cia.handler()},o[SAEC_Events_EV_HSYNC].handler=function(){SAER.playfield.hsync_handler()},o[SAEC_Events_EV_AUDIO].handler=function(){SAER.audio.handler()},o[a].handler=D,c[SAEC_Events_EV2_BLITTER].handler=function(e){SAER.blitter.handler(e)},c[SAEC_Events_EV2_DISK].handler=function(e){SAER.disk.handler(e)}),R=2;for(var e=_=0;e<4;e++)o[e].active=!1,o[e].oldcycles=SAEV_Events_currcycle;for(o[SAEC_Events_EV_HSYNC].evtime=SAEV_Events_currcycle+SAER.playfield.get_maxhpos()*SAEC_Events_CYCLE_UNIT,o[SAEC_Events_EV_HSYNC].active=!0,e=0;e<s;e++)c[e].active=!1;this.schedule(),y=!1,v=0,M(),h.clr(),g.clr(),n=0},this.clr_dmal=function(){S=0},this.pauseResume=function(e){e?(SAER.gui.data.fps=0,SAER.gui.data.idle=0,SAER.gui.fps(0,0,1)):(S=0,M(),h.clr())},this.reset_frame_rate_hack=function(){SAEV_config.cpu.speed<0&&(f=0,u=SAEF_now()+E)},this.calc_vsynctimebase=function(e){return SAEF_log("events.calc_vsynctimebase() %d us (%f)",E=SAEC_Events_syncbase/e>>>0,e),this.reset_frame_rate_hack(),E},this.schedule=function(){for(var e,t=SAEC_Events_CYCLE_MAX,n=0;n<4;n++)!o[n].active||(e=o[n].evtime-SAEV_Events_currcycle)<t&&(t=e);_=SAEV_Events_currcycle+t},this.current_hpos=function(){var e=(SAEV_Events_currcycle-o[SAEC_Events_EV_HSYNC].oldcycles)*SAEC_Events_CYCLE_UNIT_INV>>>0;return(e<0||256<e)&&(SAEF_error("events.current_hpos() hpos = %d !?",e),e=0),e},this.do_cycles=function(e){if(!(0<=(x-=e))){for(e=-x,x=0;_-SAEV_Events_currcycle<=e;){if(f){if(0<f){var t=SAEF_now();if((n=E<(n=t-u)||n<-E?0:n)<0&&t-l<0)return void(x=w)}else if(f<0){var n;if((n=(t=SAEF_now())-l)<0)return void(x=w)}f=0}e-=_-SAEV_Events_currcycle,SAEV_Events_currcycle=_;for(var r=0;r<4;r++)o[r].active&&o[r].evtime==SAEV_Events_currcycle&&o[r].handler();this.schedule()}SAEV_Events_currcycle+=e}},this.do_cycles_post=function(e,t){this.do_cycles(e)},this.event2_newevent_xx=function(e,t,n,r){var i=SAEV_Events_currcycle+t;if(e<0){for(e=R;c[e].active&&(c[e].evtime!=i||c[e].data!=n||c[e].handler!==r);)if((e=++e==s?2:e)==R)return void SAEF_error("events.event2_newevent_xx() out of events!");R=e}c[e].active=!0,c[e].evtime=i,c[e].handler=r,c[e].data=n,D()},this.event2_newevent=function(e,t,n){var r;r=t,t=n,e=c[n=e].handler,r<=0?e(t):SAER.events.event2_newevent_xx(n,r*SAEC_Events_CYCLE_UNIT,t,e)},this.event2_remevent=function(e){c[e].active=!1},this.events_dmal_hsync=function(){S&&SAEF_error("events.events_dmal_hsync() DMAL error!? %04x",S),S=(S=SAER.audio.dmal())<<6&65535,(S|=SAER.disk.dmal())&&(m=0,SAER.events.event2_newevent_xx(-1,7*SAEC_Events_CYCLE_UNIT,13,function(e){for(;S;)3&S&&(t=m+(2&S?1:0),i=r=n=void 0,SAEV_Custom_dmacon&SAEC_Custom_DMAF_DMAEN&&(SAER.events.current_hpos(),6<=t?(n=(t-=6)>>1,r=SAER.audio.getpt(n,0!=(1&t)),i=SAER_Memory_chipGet16_indirect(r),SAEV_Custom_last_value=i,SAER.audio.AUDxDAT(n,i)):(t=1&t,r=SAER.disk.getpt(),t?SAER.disk.fifostatus()<=0&&(i=SAER_Memory_chipGet16_indirect(r),SAEV_Custom_last_value=i,SAER.disk.DSKDAT(i)):0<=SAER.disk.fifostatus()&&(i=SAER.disk.DSKDATR(),SAER_Memory_chipPut16_indirect(r,i))))),m+=2,S>>>=2;var t,n,r,i}))},this.fpscounter=function(e){var t=SAEF_now(),n=t-C;C=t,SAEV_Events_bogusframe||n<0||(r.set(n),b.set(k),(k=0)==(7&++SAEV_Events_timeframes)&&((n=100-(0==(t=b.get())?0:100*t/E))<0?n=0:100<n&&(n=100),(t=999<(t=0==(t=r.get())?0:SAEC_Events_syncbase/t)?999:t)<SAEV_Playfield_fake_vblank_hz&&(n*=SAEV_Playfield_fake_vblank_hz/t),SAER.gui.data.fps=t,SAER.gui.data.idle=n,SAER.gui.data.fps_color=e?0:1,0==(15&SAEV_Events_timeframes)&&SAER.gui.fps(t,n,e?0:1)))},this.framewait2_maximum=function(e){e?f=SAEV_config.cpu.speedThrottle?(u=SAEF_now(),0):(u=d,l=SAEF_now()+E,2):(n++,(f=0)<d-(u+=A)&&(0<p-u&&(e=SAEF_now(),0<u-e&&(f=1,l=e+A,n=0)),SAER_Playfield_isvsync()||!f&&10<=n&&!SAER.m68k.stopped&&(f=-1,l=SAEF_now()+A,n=0)))},this.framewait2_normal=function(){u+=A;for(var e=SAEF_now();0<u-Math.floor(e+E/10)&&u-e<E;)SAEF_sleep(1),e=SAEF_now()},this.framewait=function(){var e,t;SAER_Playfield_isvsync_chipset();f=0;var n=~~h.set(SAEV_Events_frameskiptime);SAEV_Events_frameskiptime=0;var r=~~g.set(SAEV_Events_reflowtime),i=E;if(SAEV_config.cpu.speed<0){if(SAEV_Playfield_frame_rendered||SAEV_Playfield_picasso_on||(SAEV_Playfield_frame_rendered=SAER.video.render_screen(!1)),SAEV_config.cpu.speedThrottle)for(;e=SAEF_now(),!(p-e<=0||2*E<p-e);)SAEF_sleep(1);else e=SAEF_now();var a,o=0;0<e-p&&e-p<i>>1&&(o+=e-p),o+=0,a=SAEV_config.cpu.speedThrottle?Math.truncate(i*(1e3+SAEV_config.cpu.speedThrottle)/1e3-o):i-o,p=e+i-o,u=e,A=a<0?(a=0,1):a/(SAER.playfield.get_maxvpos_display()+1)>>>0,d=e+a}else{var s=1/(SAEC_Events_syncbase/1e3),r=r;for(SAEV_Playfield_frame_rendered||SAEV_Playfield_picasso_on||(t=SAEF_now(),SAEV_Playfield_frame_rendered=SAER.video.render_screen(!1),r+=SAEF_now()-t),t=SAEF_now();;){if(-4<=F(0)*s)break;SAEF_sleep(2)}for(;F(0)<0;);e=SAEF_now(),k+=e-t,d=p=(u=e)+i,SAEV_Playfield_frame_rendered&&(SAER.video.show_screen(0),r+=SAEF_now()-e),(A=~~((i-(r+=n))/3))<0?A=0:i/3>>>0<A&&(A=i/3>>>0),SAEV_Playfield_frame_shown=!0}return!0}}var SAEV_Gayle_bank=null,SAEV_Gayle2_bank=null,SAEV_MBRes_bank=null,SAEV_MBRes_gary_timeout=0,SAEV_MBRes_gary_toenb=0;function SAEO_Gayle(){const n=6291456,r=4194304,a=0,o=1,s=0,c=1,_=2;const f=12320,l=32768,u=36864,d=40960,p=45056;const i=64,t=32;const E=16;const A=8,S=4;const m=1,h=128;const g=4;const y=2,v=1;const b=8;const C=3,k=0,R=2,w=0,x=1,D=7,M=1024,F=1030,T=1031;for(var V=new Array(2*C),e=0;e<2*C;e++)V[e]=null;var I=null,P=0,z=!1,O=0,L=new Uint8Array(20),N=0,B=0,U=0,K=0,G=0,H=0,X=0,q=0,Z=null,j=0;function Y(){SAEF_memset(L,0,0,20),N=-1,0<s&&SAEF_log("gayle.pcmcia_reset()")}function W(){return!(null===V[2*R]||O!=_||N<0)&&!(null===V[2*R].regs0||2&V[2*R].regs0.ide_devcon)&&V[2*R].irq?g:0}function J(){var e=!1;if(j)return U&=~h,0;for(var t=0;t<2;t++)null!==V[t]&&(2&V[t].regs.ide_devcon||!(V[t].irq||V[t+2]&&V[t+2].irq)||(e=!0),V[t].irq&&!SAER.ide.ide_isdrive(V[t])&&(V[t].irq=0),V[t+2]&&V[t+2].irq&&!SAER.ide.ide_isdrive(V[t+2])&&(V[t+2].irq=0));return e?h:0}function Q(e,t){var n=!1;G&e&&!t?(G&=~e,n=!0):G&e||!t||(G|=e,n=!0),n&&(U|=e,SAER.gayle.rethink(),e&i&&(U&(y|v))!=(y|v)&&(U&y&&SAER.reset(0,0),U&v&&SAER_CPU_exception(2)))}function $(e){e?P&&(Q(i,1),X=b,z||Q(A,1)):(X=0,Q(i,0),Q(E,0),Q(t,0),Q(A,0),Q(S,0)),SAER.gayle.rethink()}function ee(e){((U=U&e|e&(y|v))&(y|v))==(y|v)&&Y()}function te(e){K=e}function ne(e){if((e&=65535)>=f&&e<=f+1&&SAEV_config.chipset.ide==SAEC_Config_Chipset_IDE_A4000)return{addr:-1,unit:-1};e&=-8225;var t=0;return(e>>=2)&M&&q&&(t=2,e&=~M),{addr:e,unit:t+V[t].ide_drv}}function re(e){var t,n=e,r=0,i=!1;return SAEV_config.chipset.ide==SAEC_Config_Chipset_IDE_A600A1200&&655360!=(655360&e)?0:(e&=65535,SAEV_config.chipset.pcmcia&&(SAEV_config.chipset.ide!=SAEC_Config_Chipset_IDE_A600A1200&&(e==u?(r=U,i=!0):e==d&&(r=K,i=!0)),e==l?(t=H|G,t|=J(),r=t|=W(),i=!0,s&&SAEF_log("gayle.gayle_read(%08x) PCMCIA STATUS %02x, PC %x",n,255&r,SAER_CPU_getPC())):e==p&&(r=15&X,i=!0,s&&SAEF_log("gayle.gayle_read(%08x) PCMCIA CONFIG %02x, PC %x",n,255&r,SAER_CPU_getPC()))),i||(r=function(e){if(e&=65535,(3<a&&8192!=e&&8193!=e&&12320!=e&&12321!=e&&e!=u||5<a)&&SAEF_log("gayle.gayle_read2(%08x) PC %x",e,SAER_CPU_getPC()),SAEV_config.chipset.ide<=0)return 8220==e?127:255;if(e>=f&&e<=f+1&&SAEV_config.chipset.ide==SAEC_Config_Chipset_IDE_A4000){var t=U;return U=0,t}return 16384<=e?e==u?SAEV_config.chipset.ide==SAEC_Config_Chipset_IDE_A600A1200?U:0:e==d&&SAEV_config.chipset.ide==SAEC_Config_Chipset_IDE_A600A1200?K:0:(e=ne(e),SAER.ide.ide_isdrive(V[0])||SAER.ide.ide_isdrive(V[1])||SAER.ide.ide_isdrive(V[2])||SAER.ide.ide_isdrive(V[3])?-1!=e.addr?SAER.ide.ide_read_reg(V[e.unit],e.addr):0:e.addr==D?127:255)}(e)),a&&SAEF_log("gayle.gayle_read(%08x) %02x, PC %x",n,255&r,SAER_CPU_getPC()),r)}function ie(e,t){var n,r=e,i=!1;SAEV_config.chipset.ide==SAEC_Config_Chipset_IDE_A600A1200&&655360!=(655360&e)||(e&=65535,SAEV_config.chipset.pcmcia&&(SAEV_config.chipset.ide!=SAEC_Config_Chipset_IDE_A600A1200&&(e==u?(ee(t),i=!0):e==d&&(te(t),i=!0)),e==l?(n=G,H=-4&t,G&=-4,(1&n)!=(1&(G|=3&t))&&(SAER.gayle.map_pcmcia(),$(G&m?0:1),s&&SAEF_log("gayle.write_gayle_cs() %s, PC %x",1&G?"disabled":"enabled",SAER_CPU_getPC())),i=!0,1<s&&SAEF_log("gayle.gayle_write(%08x, %02x) PCMCIA STATUS PC %x",r,255&t,SAER_CPU_getPC())):e==p&&(X=t,(i=1)<s&&SAEF_log("gayle.gayle_write(%08x, %02x) PCMCIA CONFIG PC %x",r,255&t,SAER_CPU_getPC()))),a&&SAEF_log("gayle.gayle_write(%08x, %02x) PC %x",r,255&t,SAER_CPU_getPC()),i||function(e,t){if((3<a&&8192!=e&&8193!=e&&12320!=e&&12321!=e&&e!=u||5<a)&&SAEF_log("gayle.gayle_write2(%08x, %02x) PC %x",e,255&t,SAER_CPU_getPC()),!(SAEV_config.chipset.ide<=0)){if(SAEV_config.chipset.ide==SAEC_Config_Chipset_IDE_A600A1200){if(e==u)return ee(t);if(e==d)return te(t)}16384<=e||-1!=(e=ne(e)).addr&&SAER.ide.ide_write_reg(V[e.unit],e.addr,t)}}(e,t))}function ae(e){var t=ne(e);if(t.addr!=w)return oe(e)<<8|oe(e+1);t=V[t.unit];return SAER.ide.ide_get_data(t)}function oe(e){return re(e)}function se(e,t){var n=ne(e);n.addr!=w?(ce(e,t>>8),ce(e+1,255&t)):(n=V[n.unit],SAER.ide.ide_put_data(n,t))}function ce(e,t){ie(e,t)}function _e(e){return fe(e)<<8|fe(e+1)}function fe(e){return t=0,4096==(65535&e)&&((0==B||1==B||3==B||SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA&&7==B)&&(t=128),B++),t;var t}function le(e,t){ue(),ue()}function ue(e,t){B=0}this.rethink=function(){var e,t=0,n=0;SAEV_config.chipset.ide!=SAEC_Config_Chipset_IDE_A4000?SAEV_config.chipset.ide!=SAEC_Config_Chipset_IDE_A600A1200&&!SAEV_config.chipset.pcmcia||(U|=J(),U|=W(),(e=K&U)&(8|h)&&(t=1),64&e&&(n=1),48&e&&(2&K?n=1:t=1),e&g&&(1&K?n=1:t=1),!t||8&SAEV_Custom_intreq||SAER.custom.INTREQ_0(32776),!n||8192&SAEV_Custom_intreq||SAER.custom.INTREQ_0(40960)):(U|=J())&h&&!(8&SAEV_Custom_intreq)&&SAER.custom.INTREQ_0(32776)},this.hsync=function(){(SAER.ide.ide_interrupt_hsync(V[0])||SAER.ide.ide_interrupt_hsync(V[2])||SAER.ide.ide_interrupt_hsync(V[4]))&&this.rethink()},this.gayle_dataflyer_enable=function(e){e?0:j=0},SAEV_Gayle_bank=new SAEO_Memory_addrbank(function(e){var t=ne(e);return t.addr!=w?(ae(e)<<16|ae(e+2))>>>0:(t=V[t.unit],(SAER.ide.ide_get_data(t)<<16|SAER.ide.ide_get_data(t))>>>0)},ae,oe,function(e,t){var n=ne(e);if(n.addr==w){n=V[n.unit];return SAER.ide.ide_put_data(n,t>>>16),void SAER.ide.ide_put_data(n,65535&t)}se(e,t>>>16),se(e+2,65535&t)},se,ce,SAEF_Memory_defaultXLate,SAEF_Memory_defaultCheck,null,null,"Gayle (low)",SAEF_Memory_dummyGetInst32,SAEF_Memory_dummyGetInst16,SAEC_Memory_addrbank_flag_IO),SAEV_Gayle2_bank=new SAEO_Memory_addrbank(function(e){return(_e(e)<<16|_e(e+2))>>>0},_e,fe,function(e,t){le(e,t>>>16),le(e+2,65535&t)},le,ue,SAEF_Memory_defaultXLate,SAEF_Memory_defaultCheck,null,null,"Gayle (high)",SAEF_Memory_dummyGetInst32,SAEF_Memory_dummyGetInst16,SAEC_Memory_addrbank_flag_IO);var de=0,pe=0,Ee=0;function Ae(e,t){var n=0,r=3&(e&=65535),i=e>>6&3;for(4098==e&&0<=SAEV_config.chipset.fatGaryRev&&(pe++,pe&=7,n=SAEV_config.chipset.fatGaryRev<<pe&128);;){if(1==i&&3==r){0<=SAEV_config.chipset.ramseyRev&&(n=SAEV_config.chipset.ramseyRev);break}if(0==i&&3==r){0<=SAEV_config.chipset.ramseyRev&&(n=de);break}if(3==r){n=255;break}2==r&&0<=SAEV_config.chipset.fatGaryRev&&(n=Ee?128:0),1==r&&0<=SAEV_config.chipset.fatGaryRev&&(n=SAEV_MBRes_gary_toenb?128:0),0==r&&0<=SAEV_config.chipset.fatGaryRev&&(n=SAEV_MBRes_gary_timeout?128:0),n|=127;break}return 0<o&&SAEF_log("gayle.mbres_read(%08x, %d) %08x, PC %x, S %d",e,t,n,SAER_CPU_getPC(),SAER_CPU_regs.s?1:0),n}function Se(e,t,n){e&=65535,0<o&&SAEF_log("gayle.mbres_write(%08x, %08x, %d) PC %x, S %d",e,t,n,SAER_CPU_getPC(),SAER_CPU_regs.s?1:0),e<32768&&(n=3&e,4098==e&&(pe=-1),0==(e>>6&3)&&3==n&&(de=t),2==n&&(Ee=128&t?1:0),1==n&&(SAEV_MBRes_gary_toenb=128&t?1:0),0==n&&(SAEV_MBRes_gary_timeout=128&t?1:0))}function me(e){return Ae(e,2)}function he(e,t){Se(e,t,2)}var ge=new SAEO_Memory_addrbank(function(e){return(me(e)<<16|me(e+2))>>>0},me,function(e){return Ae(e,1)},function(e,t){he(e,t>>>16),he(e+2,65535&t)},he,function(e,t){Se(e,t,1)},SAEF_Memory_defaultXLate,SAEF_Memory_defaultCheck,null,null,"Motherboard Resources",SAEF_Memory_dummyGetInst32,SAEF_Memory_dummyGetInst16,SAEC_Memory_addrbank_flag_IO);SAEV_MBRes_bank=new SAEO_Memory_addrbank(SAEF_Memory_subBankGet32,SAEF_Memory_subBankGet16,SAEF_Memory_subBankGet8,SAEF_Memory_subBankPut32,SAEF_Memory_subBankPut16,SAEF_Memory_subBankPut8,SAEF_Memory_subBankXLate,SAEF_Memory_subBankCheck,null,null,"Motherboard Resources",SAEF_Memory_subBankGetInst32,SAEF_Memory_subBankGetInst16,SAEC_Memory_addrbank_flag_IO,[new SAEO_Memory_addrbank_sub(ge,0),new SAEO_Memory_addrbank_sub(SAEV_Memory_dummyBank,32768),new SAEO_Memory_addrbank_sub(null,0)]);var ye=0,ve=0,be=null,Ce=null,ke=0,Re=0,we=0;function xe(e){if((e&=524287)<131072)return{reg:-1,unit:-1};if(262144<=e)return{reg:-1,unit:-1};65536<=(e-=131072)&&(e&=-65537,e|=1);var t=2*R;V[t].ide_drv&&(t=2*R+1);var n=-1;if(1==N){if((n=15&e)<8)return n;n=8==n||9==n?w:13==n?x:14==n?F:15==n?T:-1}else 2==N&&(n=496<=e&&e<=503?e-496:1014==e?F:1015==e?T:-1);return{reg:n,unit:t}}function De(e){var t,n;0!=P&&null!==I&&(0<=e&&0==be[0]&&0==be[1]&&0==be[2]||(e<0&&(ke=0,Re=ye),0<=ke&&(512<=Math.abs(ke-e)||512<=Math.abs(Re-e))&&(t=I.hfd.ci.blocksize,0<(n=((Re+t-1&(n=~(t-1)>>>0))>>>0)-(t=(ke&n)>>>0))&&(SAER.hardfile.hdf_write(I.hfd,be.subarray(t),t,n),Re=ke=-1)),(ke<0||e<ke)&&(ke=e),(Re<0||Re<e)&&(Re=e)))}function Me(e){return(Fe(e)<<16|Fe(e+2))>>>0}function Fe(e){return Te(e)<<8|Te(e+1)}function Te(e){return e=e,2<s&&SAEF_log("gayle.gayle_common_read(%x) PC %x",e,SAER_CPU_getPC()),ye?(e-=n&r-1,(e&=r-1)<ye?be[e]:0):0}function Ve(e,t){Ie(e,t>>8),Ie(e+1,255&t)}function Ie(e,t){e=e,t=t,2<s&&SAEF_log("gayle.gayle_common_write(%x, %x) PC %x",e,t,SAER_CPU_getPC()),ye&&(z||(e-=n&r-1,(e&=r-1)<ye&&be[e]!=t&&(De(e),be[e]=t)))}var Pe=new SAEO_Memory_addrbank(Me,Fe,Te,function(e,t){Ve(e,t>>>16),Ve(e+2,65535&t)},Ve,Ie,function(e){return e-=n&r-1,e&=r-1},function(e,t){return ye?(e-=n&r-1,(e&=r-1)+t<=r):0},null,null,"Gayle PCMCIA Common",Me,Fe,SAEC_Memory_addrbank_flag_RAM|SAEC_Memory_addrbank_flag_SAFE);function ze(e){if(O==_&&0<=N){var t=xe(e);if(t.reg==w)return we=SAER.ide.ide_get_data(V[t.unit])}return Oe(e)<<8|Oe(e+1)}function Oe(e){return function(e){if(1<s&&SAEF_log("gayle.gayle_attr_read(%x) PCMCIA ATTR, PC %x",e,SAER_CPU_getPC()),262144<=(e&=524287))return 0<s&&SAEF_log("gayle.gayle_attr_read() reset disabled"),0;if(ve<=e)return 0;if(O==_){if(512<=e&&e<512+2*L.length)return L[e-512>>1];if(0<=N){var t=xe(e);if(0<=t.reg){var n=V[t.unit];return 0==t.reg?196608<=e?255&we:(we=SAER.ide.ide_get_data(n))>>8&255:SAER.ide.ide_read_reg(n,t.reg)}}}return Ce[e>>1]}(e)}function Le(e,t){if(O==_&&0<=N){var n=xe(e);if(n.reg==w)return we=t,void SAER.ide.ide_put_data(V[n.unit],we)}Ne(e,t>>8),Ne(e+1,255&t)}function Ne(e,t){var n,r;e=e,t=t,1<s&&SAEF_log("gayle.gayle_attr_write(%x, %x) PCMCIA ATTR, PC %x",e,t,SAER_CPU_getPC()),262144<=(e&=524287)?(0<s&&SAEF_log("gayle.gayle_attr_write() reset enabled"),Y()):e<ve&&O==_&&(512<=e&&e<512+2*L.length&&(L[n=e-512>>1]=t,0==n&&(128&t?Y():1!=(r=63&t)&&2!=r?SAEF_warn("gayle.gayle_attr_write() only config index 1 and 2 emulated, attempted to select %d!",r):(N=r,SAEF_log("gayle.gayle_attr_write() PCMCIA IO configured = %02x",t)))),0<=N&&(0<=(n=xe(e)).reg&&(r=V[n.unit],0!=n.reg?SAER.ide.ide_write_reg(r,n.reg,t):196608<=e?we=(255&t)<<8:(we&=65280,we|=255&t,SAER.ide.ide_put_data(r,we)))))}var Be=new SAEO_Memory_addrbank(function(e){return(ze(e)<<16|ze(e+2))>>>0},ze,Oe,function(e,t){Le(e,t>>>16),Le(e+2,65535&t)},Le,Ne,SAEF_Memory_defaultXLate,SAEF_Memory_defaultCheck,null,null,"Gayle PCMCIA Attribute/Misc",SAEF_Memory_dummyGetInst32,SAEF_Memory_dummyGetInst16,SAEC_Memory_addrbank_flag_IO|SAEC_Memory_addrbank_flag_SAFE);function Ue(e,t,n){var r=n.length;return e.set(SAEF_String2Array(n,0,r),t),e[t+r]=0,r+1}function Ke(e,t,n,r,i,a){return SAEV_config.chipset.pcmcia?(Ge(i),(I=null===I?new SAEO_Hardfile_Data_HD:I).hfd.handle_valid||(i=!0),I.hfd.ci.file.name=e,I.hfd.ci.file.size=t.length,I.hfd.ci.file.data=t,I.hfd.ci.readonly=n,I.hfd.ci.blocksize=512,r==c?(i?e.length&&SAER.hardfile.hdf_hd_open(I):I.hfd.drive_empty=!1,I.hfd.ci.readonly&&(n=!0),ye=0,z=n,ve=256,Ce=new Uint8Array(ve),O=r,I.hfd.drive_empty||(ye=I.hfd.virtsize,4194304<I.hfd.virtsize&&(SAEF_warn("gayle.initpcmcia() PCMCIA SRAM: too large device (%d bytes)",I.hfd.virtsize),ye=4194304),be=new Uint8Array(ye),SAEF_log("gayle.initpcmcia() PCMCIA SRAM: '%s' open, size %d",e,ye),SAER.hardfile.hdf_read(I.hfd,be,0,ye),P=1,function(e,t){for(var n=Ce,r=0,i=(I.hfd,0),a=512,o=16384;o<e;)o*=4,a*=4,i++;var s=31-Math.floor((o-e)/a);n[r++]=1,n[r++]=3,n[r++]=100|(t?8:0),n[r++]=s<<3|i,n[r++]=255,n[r++]=30,n[r++]=7,n[r++]=2,n[r++]=0,n[r++]=1,n[r++]=1,n[r++]=1,n[r++]=1,n[r++]=255,n[r++]=21,s=r++,n[r++]=4,n[r++]=1,r+=Ue(n,r,"UAE"),r+=Ue(n,r,"68000"),r+=Ue(n,r,sprintf("Generic Emulated %dKB PCMCIA SRAM Card",e>>10)),n[r++]=255,n[s]=r-s-1,n[r++]=33,n[r++]=2,n[r++]=1,n[r++]=0,n[r++]=32,n[r++]=4,n[r++]=255,n[r++]=255,n[r++]=1,n[r++]=1,n[r++]=255}(ye,n),G&m||(SAER.gayle.map_pcmcia(),$(1)))):r==_&&(i&&e.length&&SAER.ide.add_ide_unit(V,2*C,2*R,a,null),SAER.ide.ide_initialize(V,R),ye=0,z=a.readonly,ve=262144,Ce=new Uint8Array(ve),O=r,SAEF_log("gayle.initpcmcia() PCMCIA IDE: '%s' open",e),P=1,r=0,(e=Ce)[r++]=1,e[r++]=4,e[r++]=223,e[r++]=74,e[r++]=1,e[r++]=255,e[r++]=28,e[r++]=4,e[r++]=2,e[r++]=217,e[r++]=1,e[r++]=255,e[r++]=24,e[r++]=2,e[r++]=223,e[r++]=1,e[r++]=21,r++,e[r++]=4,e[r++]=1,r+=Ue(e,20,"UAE"),r+=Ue(e,r,"68000"),r+=Ue(e,r,"Generic Emulated PCMCIA IDE"),e[r++]=255,e[17]=r-17-1,e[r++]=33,e[r++]=2,e[r++]=4,e[r++]=1,e[r++]=34,e[r++]=2,e[r++]=1,e[r++]=1,e[r++]=34,e[r++]=3,e[r++]=2,e[r++]=12,e[r++]=15,e[r++]=26,e[r++]=5,e[r++]=1,e[r++]=1,e[r++]=0,e[r++]=2,e[r++]=15,e[r++]=27,e[r++]=6,e[r++]=192,e[r++]=1,e[r++]=33,e[r++]=181,e[r++]=30,e[r++]=77,e[r++]=20,e[r++]=0,e[r]=255,G&m||(SAER.gayle.map_pcmcia(),$(1))),Re=ke=-1,1):0}function Ge(e){return SAEF_log("gayle.freepcmcia() reset %d",e?1:0),null!==I&&(De(-1),e?(SAER.hardfile.hdf_hd_close(I),I=null):I.hfd.drive_empty=!0),SAER.ide.remove_ide_unit(V,2*R),P&&Q(i,0),Y(),Ce=be=null,G=X=ve=ye=P=0,1}this.map_pcmcia=function(){SAEV_config.chipset.pcmcia&&(0==P||G&m?(SAER.memory.map_banks_cond(SAEV_Memory_dummyBank,160,8,0),SAEV_config.memory.chipSize<=4194304&&SAER.memory.getz2endaddr()<=4194304&&SAER.memory.map_banks_cond(SAEV_Memory_dummyBank,n>>16,r>>16,0)):(SAER.memory.map_banks_cond(Be,160,8,0),SAEV_config.memory.chipSize<=4194304&&SAER.memory.getz2endaddr()<=4194304&&SAER.memory.map_banks_cond(Pe,n>>16,r>>16,0)))},this.free_units=function(){for(var e=0;e<2*C;e++)SAER.ide.remove_ide_unit(V,e);Ge(!0)},this.gayle_add_ide_unit=function(e,t){return 4<=e?-1:null===SAER.ide.add_ide_unit(V,2*C,e,t,null)?0:1},this.gayle_add_pcmcia_sram_unit=function(e){return Ke(e.file.name,e.file.data,e.readonly,c,!0,null)},this.gayle_add_pcmcia_ide_unit=function(e){return Ke(e.file.name,e.file.data,!1,_,!0,e)},this.gayle_modify_pcmcia_sram_unit=function(e,t){return t?Ke(e.file.name,e.file.data,e.readonly,c,null===I,null):Ge(!1)},this.gayle_modify_pcmcia_ide_unit=function(e,t){return t?Ke(e.file.name,e.file.data,!1,_,null===I,e):Ge(!1)},this.cleanup=function(){},this.reset=function(e){SAER.ide.alloc_ide_mem(V,2*C,Z),SAER.ide.ide_initialize(V,k),SAER.ide.ide_initialize(V,k+1),q=0,(SAER.ide.ide_isdrive(V[2])||SAER.ide.ide_isdrive(V[3]))&&(q=1,SAEF_log("gayle.initide() IDE splitter enabled")),U=K=0,e&&(Ee=1,SAEV_MBRes_gary_toenb=SAEV_MBRes_gary_timeout=de=0);e="Gayle (low)";SAEV_config.chipset.ide==SAEC_Config_Chipset_IDE_A4000&&(e="A4000 IDE"),SAEV_Gayle_bank.name=e,this.gayle_dataflyer_enable(!1)}}function SAEO_IDE_threadState(){this.idetable=null,this.idetotal=0,this.state=0,this.requests=new smp_comm_pipe}function SAEO_IDE(){const o=0,i=1024,a=1;const s=8,c=128;const _=16;const f=4;const l=128;function e(){this.ide_select=0,this.ide_nsector=0,this.ide_sector=0,this.ide_lcyl=0,this.ide_hcyl=0,this.ide_devcon=0,this.ide_error=0,this.ide_feat=0,this.ide_nsector2=0,this.ide_sector2=0,this.ide_lcyl2=0,this.ide_hcyl2=0,this.ide_feat2=0,this.ide_status=0}function u(){this.hdhfd=new SAEO_Hardfile_Data_HD,this.regs=new e,this.regs0=null,this.regs1=null,this.pair=null,this.its=null,this.byteswap=!1,this.byteswapped_buffer=0,this.adide=!1,this.secbuf=null,this.secbuf_size=0,this.buffer_offset=0,this.data_offset=0,this.data_size=0,this.data_multi=0,this.direction=0,this.intdrq=!1,this.lba48=!1,this.lba48cmd=!1,this.start_lba=0,this.start_nsec=0,this.multiple_mode=0,this.irq_delay=0,this.irq=0,this.irq_new=!1,this.num=0,this.blocksize=0,this.maxtransferstate=0,this.ata_level=0,this.ide_drv=0,this.media_type=0,this.mode_8bit=!1,this.atapi=!1,this.atapi_drdy=!1,this.cd_unit_num=0,this.packet_state=0,this.packet_data_size=0,this.packet_data_offset=0,this.packet_transfer_size=0}function d(e,t,n){e.byteswap&&(n=n<<8&65535|n>>8),e.adide&&(n=SAER.ide.adide_decode_word(n)),e.secbuf[2*t+0]=255&n,e.secbuf[2*t+1]=n>>8}function p(e,t,n,r){for(var i=n,a=i.length,o=0;o<r;o+=2){var s=" ";o<a&&(s=i.charCodeAt(o));var c=" ",s=(c=o+1<a?i.charCodeAt(o+1):c)<<8|s;e.byteswap&&(s=s<<8&65535|s>>8),e.adide&&(s=SAER.ide.adide_decode_word(s)),e.secbuf[2*t+0]=s>>8,e.secbuf[2*t+1]=255&s,t++}}function E(e,t){var n,r;e.secbuf_size>=t||(n=e.secbuf,r=e.secbuf_size,e.secbuf_size=t+16384,e.secbuf=new Uint8Array(e.secbuf_size),r&&(e.secbuf.set(n),SAEF_log("ide.ide_grow_buffer() IDE%d buffer %d -> %d",e.num,r,e.secbuf_size)))}function A(e){e.regs.ide_status|=c,e.regs.ide_status&=~s,e.irq_delay=2}function S(e){e.regs.ide_status|=c,e.regs.ide_status&=~s,e.irq_delay=1}function m(e,t){e.regs.ide_error|=t,1!=e.ide_drv||SAER.ide.ide_isdrive(e.pair)||(e.pair.regs.ide_status|=a),e.regs.ide_status|=a,A(e)}function h(e){m(e,f)}function g(e){SAEF_memset(e.secbuf,0,0,e.blocksize),e.data_offset=0,e.data_size=e.blocksize,e.data_multi=1,e.intdrq=!0,A(e)}function y(e){var t,n=e.atapi,r=0<e.media_type;SAER.ide.ide_isdrive(e)?(SAEF_memset(e.secbuf,0,0,e.blocksize),e.byteswapped_buffer=1,0<o&&SAEF_log("ide.ide_identify_drive() IDE%d identify drive",e.num),g(e),e.direction=0,d(e,0,n?34240:r?33930:64),d(e,1,e.hdhfd.cyls_def),d(e,2,51255),d(e,3,e.hdhfd.heads_def),d(e,4,e.blocksize*e.hdhfd.secspertrack_def),d(e,5,e.blocksize),d(e,6,e.hdhfd.secspertrack_def),p(e,10,"68000",20),d(e,20,3),d(e,21,e.blocksize),d(e,22,4),p(e,23,"0.7",8),p(e,27,e.atapi?"UAE-ATAPI":sprintf("UAE-IDE %s",e.hdhfd.hfd.product_id),40),d(e,47,l>>e.blocksize/512-1),d(e,48,1),d(e,49,768),d(e,51,512),d(e,52,512),d(e,53,7),d(e,54,e.hdhfd.cyls),d(e,55,e.hdhfd.heads),d(e,56,e.hdhfd.secspertrack),d(e,57,65535&(t=e.hdhfd.cyls*e.hdhfd.heads*e.hdhfd.secspertrack)),d(e,58,t>>>16),d(e,59,(0<(r=e.multiple_mode)?256:0)|r),d(e,60,65535&(t=268435455<(t=e.blocksize?Math.floor(e.hdhfd.size/e.blocksize):0)?268435455:t)),d(e,61,t>>>16),d(e,62,15),d(e,63,15),e.ata_level&&(d(e,64,e.ata_level?3:0),d(e,65,120),d(e,66,120),d(e,67,120),d(e,68,120),d(e,80,126),d(e,81,28),d(e,82,16384|(n?20:0)),d(e,83,28672|(e.lba48?1024:0)),d(e,84,16384),d(e,85,16384),d(e,86,28672|(e.lba48?1024:0)),d(e,87,16384),d(e,88,63),d(e,93,24577),e.lba48&&(t=Math.floor(e.hdhfd.size/e.blocksize),n=Math.floor(t/4294967296),d(e,100,65535&(t=t%4294967296)),d(e,101,t>>>16),d(e,102,65535&n),d(e,103,n>>>16)))):h(e)}function n(e){e.atapi?(e.regs.ide_sector=1,e.regs.ide_nsector=1,e.regs.ide_lcyl=20,e.regs.ide_hcyl=235,e.regs.ide_status=0,e.atapi_drdy=!1):(e.regs.ide_nsector=1,e.regs.ide_sector=1,e.regs.ide_lcyl=0,e.regs.ide_hcyl=0,e.regs.ide_status=0),e.regs.ide_error=1,e.packet_state=0}function r(e,t){n(e),t&&n(e.pair)}function v(e,t){r(e,t),t?A(e):e.regs.ide_status&=~c}function b(e){return e.lba48&&e.lba48cmd?0==e.regs.ide_nsector&&0==e.regs.ide_nsector2?65536:e.regs.ide_nsector2<<8|e.regs.ide_nsector:0==e.regs.ide_nsector?256:e.regs.ide_nsector}function C(e,t){var n,r;e.lba48&&e.lba48cmd&&64&e.regs.ide_select?(n=e.regs.ide_hcyl<<16|e.regs.ide_lcyl<<8|e.regs.ide_sector,r=e.regs.ide_hcyl2<<16|e.regs.ide_lcyl2<<8|e.regs.ide_sector2,t.lba=16777216*r+n):64&e.regs.ide_select?t.lba=((15&e.regs.ide_select)<<24|e.regs.ide_hcyl<<16|e.regs.ide_lcyl<<8|e.regs.ide_sector)>>>0:(t.cyl=e.regs.ide_hcyl<<8|e.regs.ide_lcyl,t.head=15&e.regs.ide_select,t.sec=e.regs.ide_sector,t.lba=(t.cyl*e.hdhfd.heads+t.head)*e.hdhfd.secspertrack+t.sec-1)}function k(e,t){1==t?e.maxtransferstate<2&&0==e.regs.ide_nsector?e.maxtransferstate=1:(2==e.maxtransferstate&&SAEF_log("ide.check_maxtransfer() maxtransfer check detected split >256 block transfer"),e.maxtransferstate=0):2==t&&(1==e.maxtransferstate?e.maxtransferstate++:e.maxtransferstate=0)}function t(e){e.regs.ide_status|=c,e.regs.ide_status&=~s}function R(e){t(e),x(e)}function w(e){t(e),write_comm_pipe_u32(e.its.requests,128|e.num,1)}function x(e){var t={};e.data_offset=0;var n=b(e);if(C(e,t),1<o&&SAEF_log("ide.do_process_rw_command() IDE%d off=%d, nsec=%d (%d) lba48=%d bs=%d",e.num,t.lba,n,e.multiple_mode,e.lba48+e.lba48cmd,e.blocksize),n*e.blocksize>e.hdhfd.size-t.lba*e.blocksize&&(n=Math.truncate((e.hdhfd.size-t.lba*e.blocksize)/e.blocksize),1<o&&SAEF_log("ide.do_process_rw_command() IDE%d nsec changed to %d",e.num,n)),n<=0)return g(e),void m(e,_);var r=n;E(e,r*e.blocksize),n>e.data_multi&&(n=e.data_multi),0==e.buffer_offset&&(e.start_lba=t.lba,e.start_nsec=r),e.direction?1<o&&SAEF_log("ide.do_process_rw_command() IDE%d write, %d/%d bytes, buffer offset %d",e.num,n*e.blocksize,r*e.blocksize,e.buffer_offset):(0==e.buffer_offset&&(SAER.hardfile.hdf_read(e.hdhfd.hfd,e.secbuf,e.start_lba*e.blocksize,e.start_nsec*e.blocksize),1<o&&SAEF_log("ide.do_process_rw_command() IDE%d initial read, %d bytes",e.num,r*e.blocksize)),1<o&&SAEF_log("ide.do_process_rw_command() IDE%d read, read %d/%d bytes, buffer offset=%d",e.num,n*e.blocksize,r*e.blocksize,e.buffer_offset)),e.intdrq=!0;r=0==function(e,t){if(e.lba48&&e.lba48cmd){var n=e.regs.ide_nsector2<<8|e.regs.ide_nsector;return(n-=t)<0&&(n+=65536),e.regs.ide_nsector2=n>>8,e.regs.ide_nsector=255&n,n}return e.regs.ide_nsector-=t,e.regs.ide_nsector<0&&(e.regs.ide_nsector+=256),e.regs.ide_nsector}(e,n);e.ata_level==SAEC_Config_Mount_Controller_Level_ATA_2S&&r||function(e,t,n,r,i,a){if(e.lba48&&e.lba48cmd){var o=(t+=a)%16777216,s=Math.floor(t/16777216);e.regs.ide_hcyl=o>>>16&255,e.regs.ide_lcyl=o>>>8&255,e.regs.ide_sector=255&o,e.regs.ide_hcyl2=s>>>16&255,e.regs.ide_lcyl2=s>>>8&255,e.regs.ide_sector2=255&s}else if(64&e.regs.ide_select)t+=a,e.regs.ide_select&=-16,e.regs.ide_select|=t>>>24&15,e.regs.ide_hcyl=t>>>16&255,e.regs.ide_lcyl=t>>>8&255,e.regs.ide_sector=255&t;else{for(i+=a;i>=e.hdhfd.secspertrack;)i-=e.hdhfd.secspertrack,++r>=e.hdhfd.heads&&(r-=e.hdhfd.heads,n++);e.regs.ide_select&=-16,e.regs.ide_select|=r,e.regs.ide_sector=i,e.regs.ide_hcyl=n>>8,e.regs.ide_lcyl=255&n}}(e,t.lba,t.cyl,t.head,t.sec,r?n-1:n),r&&e.direction&&(1<o&&SAEF_log("ide.do_process_rw_command() IDE%d write finished, %d bytes",e.num,e.start_nsec*e.blocksize),e.intdrq=!1,SAER.hardfile.hdf_write(e.hdhfd.hfd,e.secbuf,e.start_lba*e.blocksize,e.start_nsec*e.blocksize)),e.direction?r?S(e):e.irq_delay=1:0==e.buffer_offset?S(e):e.irq_delay=1}function D(e,t){var n={},r=1&t;if(e.lba48cmd=0!=(2&t),r&&0==e.multiple_mode)h(e);else{k(e,1),SAER.gui.flicker_led(SAEC_GUI_LED_HD,e.num,1);var i=b(e);if(C(e,n),n.lba*e.blocksize>=e.hdhfd.size)return g(e),void m(e,_);0<o&&SAEF_log("ide.ide_read_sectors() IDE%d %s off=%d, sec=%d (%d) lba48=%d",e.num,4&t?"verify":"read",n.lba,i,e.multiple_mode,e.lba48+e.lba48cmd),4&t?A(e):(e.data_multi=r?e.multiple_mode:1,e.data_offset=0,e.data_size=i*e.blocksize,e.direction=0,e.buffer_offset=0,R(e))}}function M(e,t){var n={},r=1&t;if(e.lba48cmd=0!=(2&t),!r||0!=e.multiple_mode)return k(e,1),SAER.gui.flicker_led(SAEC_GUI_LED_HD,e.num,2),nsec=b(e),C(e,n),n.lba*e.blocksize>=e.hdhfd.size?(g(e),void m(e,_)):(0<o&&SAEF_log("ide.ide_write_sectors() IDE%d write off=%d, sec=%d (%d) lba48=%d",e.num,n.lba,nsec,e.multiple_mode,e.lba48+e.lba48cmd),nsec*e.blocksize>e.hdhfd.size-n.lba*e.blocksize&&(nsec=Math.truncate((e.hdhfd.size-n.lba*e.blocksize)/e.blocksize)),nsec<=0?(g(e),void m(e,_)):(e.data_multi=r?e.multiple_mode:1,e.data_offset=0,e.data_size=nsec*e.blocksize,e.direction=1,e.buffer_offset=0,e.regs.ide_status|=s,void(e.regs.ide_status&=~c)));h(e)}function F(e,t){var n,r,i=e.lba48;1<o&&SAEF_log("ide.ide_do_command() IDE%d command %02X",e.num,t),e.regs.ide_status&=~(64|s|a),e.regs.ide_error=0,e.intdrq=!1,e.lba48cmd=!1,e.byteswapped_buffer=0,e.atapi?(e.atapi_drdy=!0,0==t?A(e):8==t?v(e,!0):161==t?y(e):160==t?atapi_packet(e):144==t?v(e,!0):(v(e,!1),e.atapi_drdy=!1,h(e),SAEF_warn("ide.ide_do_command() IDE%d: unknown ATAPI command 0x%02x",e.num,t))):16==t?(SAEF_log("ide.ide_recalibrate() IDE%d recalibrate",(r=e).num),r.regs.ide_sector=0,r.regs.ide_lcyl=r.regs.ide_hcyl=0,A(r)):236==t?y(e):144==t?v(e,!0):145==t?((r=(n=e).hdhfd).size?(r.secspertrack=0==n.regs.ide_nsector?256:n.regs.ide_nsector,r.heads=1+(15&n.regs.ide_select),r.hfd.ci.pcyls?r.cyls=r.hfd.ci.pcyls:r.cyls=Math.floor(Math.floor(r.size/n.blocksize)/(r.secspertrack*r.heads)),(16515072<r.heads*r.cyls*r.secspertrack||n.lba48)&&(r.cyls=r.hfd.ci.pcyls||r.cyls_def,r.heads=r.heads_def,r.secspertrack=r.secspertrack_def)):(n.regs.ide_error|=f,n.regs.ide_status|=a),SAEF_log("ide.ide_initialize_drive_parameters() IDE%d initialize drive parameters, CYL=%d,SPT=%d,HEAD=%d",n.num,r.cyls,r.secspertrack,r.heads),A(n)):198==t?(SAEF_log("ide.ide_set_multiple_mode() IDE%d drive multiple mode = %d",(n=e).num,n.regs.ide_nsector),n.multiple_mode=n.regs.ide_nsector,A(n)):32==t||33==t?D(e,0):64==t||65==t?D(e,4):36==t&&i?D(e,2):196==t?D(e,1):41==t&&i?D(e,3):48==t||49==t?M(e,0):52==t&&i?M(e,2):197==t?M(e,1):57==t&&i?M(e,3):80==t?A(e):239==t?function(e){switch(e.regs.ide_nsector,e.regs.ide_nsector,SAEF_log("ide.ide_set_features() IDE%d set features %02X (%02X)",e.num,e.regs.ide_feat,e.regs.ide_nsector),e.regs.ide_feat){case 1:e.mode_8bit=!0,A(e);break;case 129:e.mode_8bit=!1,A(e);break;case 2:case 130:A(e);break;default:h(e)}}(e):0==t?h(e):112==t||224==t||225==t||231==t||234==t?A(e):229==t?(e.regs.ide_nsector=255,A(e)):(h(e),SAEF_warn("ide.ide_do_command() IDE%d: unknown ATA command 0x%02x",e.num,t))}function T(e,t,n){var r=n?2:1;4<o&&SAEF_log("ide.ide_put_data_2() IDE%d DATA write 0x%04x %d/%d",e.num,t,e.data_offset,e.data_size),0!=e.data_size?(E(e,e.packet_data_offset+e.data_offset+2),e.packet_state?n?(e.secbuf[e.packet_data_offset+e.data_offset+1]=255&t,e.secbuf[e.packet_data_offset+e.data_offset]=t>>8):e.secbuf[e.packet_data_offset+e.data_offset^1]=t:n?(e.secbuf[e.buffer_offset+e.data_offset+1]=255&t,e.secbuf[e.buffer_offset+e.data_offset]=t>>8):e.secbuf[e.buffer_offset+e.data_offset]=t,e.data_offset+=r,e.data_size-=r,e.packet_state?e.data_offset==e.packet_transfer_size&&(0<o&&SAEF_warn("ide.ide_put_data_2() Data size after command received = %d (%d)",t=e.regs.ide_hcyl<<8|e.regs.ide_lcyl,e.packet_data_size),w(e)):0==e.data_size?R(e):e.data_offset%e.blocksize==0&&Math.floor(e.data_offset/e.blocksize)%e.data_multi==0&&(t=e.data_offset,x(e),e.buffer_offset+=t)):0<o&&SAEF_warn("ide.ide_put_data_2() IDE%d DATA write without request!? 0x%02X, PC 0x%08X",e.num,e.regs.ide_status,SAER_CPU_getPC())}this.adide_decode_word=function(e){var t=0;return 32768&e&&(t|=1),1&e&&(t|=2),16384&e&&(t|=4),2&e&&(t|=8),8192&e&&(t|=16),4&e&&(t|=32),4096&e&&(t|=64),8&e&&(t|=128),2048&e&&(t|=256),16&e&&(t|=512),1024&e&&(t|=1024),32&e&&(t|=2048),512&e&&(t|=4096),64&e&&(t|=8192),256&e&&(t|=16384),128&e&&(t|=32768),t},this.adide_encode_word=function(e){var t=0;return 1&e&&(t|=32768),2&e&&(t|=1),4&e&&(t|=16384),8&e&&(t|=2),16&e&&(t|=8192),32&e&&(t|=4),64&e&&(t|=4096),128&e&&(t|=8),256&e&&(t|=2048),512&e&&(t|=16),1024&e&&(t|=1024),2048&e&&(t|=32),4096&e&&(t|=512),8192&e&&(t|=64),16384&e&&(t|=256),32768&e&&(t|=128),t},this.ide_isdrive=function(e){return null!==e&&(0!=e.hdhfd.size||e.atapi)},this.ide_interrupt_hsync=function(e){for(var t,n,r=!1,i=0;e&&i<2;i++){var a=0==i?e:e.pair;a&&(0<a.irq_delay&&(a.irq_delay--,0==a.irq_delay&&(n=void 0,n=(t=a).regs.ide_status,t.regs.ide_status&=~s,t.intdrq&&(t.regs.ide_status|=s),t.regs.ide_status&=~c,1<o&&SAEF_log("ide.ide_interrupt_do() INT %02X -> %02X",n,t.regs.ide_status),t.intdrq=!1,t.irq_delay=0,2&t.regs.ide_devcon||(t.irq_new=!0,t.irq=1))),!a.irq||2&a.regs.ide_devcon||(r=!0))}return r},this.ide_get_data=function(e){return r=!(t=1),i=t?2:1,0==(e=e).data_size?(0<o&&SAEF_warn("ide.ide_get_data_2() IDE%d DATA but no data left!? 0x%02X, PC 0x%08X",e.num,e.regs.ide_status,SAER_CPU_getPC()),SAER.ide.ide_isdrive(e)?0:65535):(e.packet_state?(n=t?e.secbuf[e.packet_data_offset+e.data_offset]<<8|e.secbuf[e.packet_data_offset+e.data_offset+1]:e.secbuf[e.packet_data_offset+e.data_offset],4<o&&SAEF_log("ide.ide_get_data_2() IDE%d DATA read 0x%04x",e.num,n),e.data_offset+=i,e.data_size<0?e.data_size+=i:e.data_size-=i,e.data_offset==e.packet_transfer_size&&(1<o&&SAEF_log("ide.ide_get_data_2() IDE%d ATAPI partial read finished, %d bytes remaining",e.num,e.data_size),0==e.data_size?(e.packet_state=0,atapi_data_done(e),1<o&&SAEF_log("ide.ide_get_data_2() IDE%d ATAPI read finished, %d bytes",e.num,e.packet_data_offset+e.data_offset),r=!0):w(e))):(n=t?e.secbuf[e.buffer_offset+e.data_offset]<<8|e.secbuf[e.buffer_offset+e.data_offset+1]:e.secbuf[e.buffer_offset+e.data_offset],4<o&&SAEF_log("ide.ide_get_data_2() IDE%d DATA read 0x%04x %d/%d",e.num,n,e.data_offset,e.data_size),e.data_offset+=i,e.data_size<0?e.data_size+=i:(e.data_size-=i,e.data_offset%e.blocksize==0&&Math.floor(e.data_offset/e.blocksize)%e.data_multi==0&&e.data_size&&(e.buffer_offset+=e.data_offset,x(e))),0==e.data_size&&(e.regs.ide_status&s||SAEF_warn("ide.ide_get_data_2() IDE%d read finished but DRQ was not active?",e.num),e.regs.ide_status&=~s,1<o&&SAEF_log("ide.ide_get_data_2() IDE%d read finished",e.num))),r&&S(e),n);var t,n,r,i},this.ide_put_data=function(e,t){T(e,t,1)},this.ide_put_data_8bit=function(e,t){T(e,t,0)},this.ide_read_reg=function(e,t){var n=this.ide_isdrive(e),r=0;if(null===e)return SAEF_warn("ide.ide_read_reg() no handle"),r;if(e.regs.ide_status&c&&(t=7),!this.ide_isdrive(e))return r=7==t?(e.pair.irq&&(e.pair.irq=0),this.ide_isdrive(e.pair)?1:255):0,2<o&&0<t&&SAEF_log("ide.ide_read_reg() IDE%d GET register %d=%02X (%08X)",e.num,t,255&r,SAER_CPU_getPC()),r;switch(t){case i:case 1025:case 1026:case 1027:case 1028:case 1029:r=255;break;case 1031:r=255^((e.ide_drv?2:1)|(15&e.regs.ide_select)<<2);break;case 0:break;case 1:r=e.regs.ide_error;break;case 2:n&&(r=128&e.regs.ide_devcon?e.regs.ide_nsector2:e.regs.ide_nsector);break;case 3:n&&(r=128&e.regs.ide_devcon?e.regs.ide_sector2:e.regs.ide_sector,k(e,2));break;case 4:n&&(r=128&e.regs.ide_devcon?e.regs.ide_lcyl2:e.regs.ide_lcyl);break;case 5:n&&(r=128&e.regs.ide_devcon?e.regs.ide_hcyl2:e.regs.ide_hcyl);break;case 6:r=e.regs.ide_select;break;case 7:e.irq=0,e.irq_new=!1;case 1030:n?(r=e.regs.ide_status,(!e.atapi||e.atapi&&e.atapi_drdy)&&(r|=80)):(r=0,e.regs.ide_error&&(r|=a))}return 2<o&&0<t&&SAEF_log("ide.ide_read_reg() IDE%d GET register %d=%02X (%08X)",e.num,t,255&r,SAER_CPU_getPC()),r},this.ide_write_reg=function(e,t,n){if(null!==e)switch(e.regs1.ide_devcon&=-129,e.regs0.ide_devcon&=-129,2<o&&0<t&&SAEF_log("ide.ide_write_reg() IDE%d PUT register %d=%02X (%08X)",e.num,t,255&n,SAER_CPU_getPC()),t){case 1031:break;case 1030:0==(4&e.regs.ide_devcon)&&0!=(4&n)&&(r(e,!0),1<o&&SAEF_log("ide.ide_write_reg() IDE%d: SRST",e.num)),e.regs0.ide_devcon=n,e.regs1.ide_devcon=n;break;case 0:break;case 1:e.regs0.ide_feat2=e.regs0.ide_feat,e.regs0.ide_feat=n,e.regs1.ide_feat2=e.regs1.ide_feat,e.regs1.ide_feat=n;break;case 2:e.regs0.ide_nsector2=e.regs0.ide_nsector,e.regs0.ide_nsector=n,e.regs1.ide_nsector2=e.regs1.ide_nsector,e.regs1.ide_nsector=n;break;case 3:e.regs0.ide_sector2=e.regs0.ide_sector,e.regs0.ide_sector=n,e.regs1.ide_sector2=e.regs1.ide_sector,e.regs1.ide_sector=n;break;case 4:e.regs0.ide_lcyl2=e.regs0.ide_lcyl,e.regs0.ide_lcyl=n,e.regs1.ide_lcyl2=e.regs1.ide_lcyl,e.regs1.ide_lcyl=n;break;case 5:e.regs0.ide_hcyl2=e.regs0.ide_hcyl,e.regs0.ide_hcyl=n,e.regs1.ide_hcyl2=e.regs1.ide_hcyl,e.regs1.ide_hcyl=n;break;case 6:e.regs0.ide_select=n,e.regs1.ide_select=n,2<o&&e.ide_drv!=(16&n)&&SAEF_log("ide.ide_write_reg() DRIVE=%d",16&n?1:0),e.pair.ide_drv=e.ide_drv=16&n?1:0;break;case 7:e.irq=0,e.irq_new=!1,this.ide_isdrive(e)&&(e.regs.ide_status|=c,F(e,n))}else SAEF_warn("ide.ide_write_reg() no handle")},this.ide_thread=function(e){var t,n=!1,r=read_comm_pipe_u32_blocking(e.requests);if(r&&SAEF_log("ide.ide_thread() unit 0x%08x",r),0==e.state||268435455==r?(SAEF_log("ide.ide_thread() QUIT"),n=!0):(t=e.idetable[127&r],SAER.ide.ide_isdrive(t)&&(128&r?do_process_packet_command:x)(t)),n)return e.state=-1,0;setTimeout(function(){SAER.ide.ide_thread(e)},10)},this.start_ide_thread=function(e){e.state||(SAEF_log("ide.start_ide_thread() state %d",e.state),e.state=1,init_comm_pipe(e.requests,100,1),setTimeout(function(){SAER.ide.ide_thread(e)},0))},this.stop_ide_thread=function(e){0<e.state&&(SAEF_log("ide.stop_ide_thread() state %d",e.state),e.state=0,write_comm_pipe_u32(e.requests,4294967295,1),e.state=0)},this.ide_initialize=function(e,t){var n=e[2*t+0],e=e[2*t+1];n.regs0=n.regs,n.regs1=e.regs,(n.pair=e).regs1=e.regs,e.regs0=n.regs,(e.pair=n).num=2*t+0,e.num=2*t+1,r(n,!0)},this.alloc_ide_mem=function(e,t,n){for(var r,i=0;i<t;i++)null===e[i]&&((r=e[i]=new u).cd_unit_num=-1),E(r=e[i],1024),null!==n&&(r.its=n)},this.add_ide_unit=function(e,t,n,r,i){if(this.alloc_ide_mem(e,t,null),n<0)return null;e=e[n];return null!==r&&(e.hdhfd.hfd.ci=SAEF_CloneObject(r)),SAER.hardfile.hdf_hd_open(e.hdhfd)?(e.blocksize=e.hdhfd.hfd.ci.blocksize,e.lba48=1&e.hdhfd.hfd.ci.unit_special_flags||137438953472<=e.hdhfd.size?1:0,SAER.gui.flicker_led(SAEC_GUI_LED_HD,n,-1),e.cd_unit_num=-1,e.media_type=r.controller_media_type,e.ata_level=r.unit_feature_level,e.ata_level==SAEC_Config_Mount_Controller_Level_ATA_1&&(4294967296<=e.hdhfd.size||e.media_type)&&(e.ata_level=SAEC_Config_Mount_Controller_Level_ATA_2),SAEF_log("ide.add_ide_unit() IDE%d HD '%s', LCHS=%d/%d/%d. PCHS=%d/%d/%d %dM. LBA48=%d",n,e.hdhfd.hfd.ci.file.name,e.hdhfd.cyls,e.hdhfd.heads,e.hdhfd.secspertrack,e.hdhfd.hfd.ci.pcyls,e.hdhfd.hfd.ci.pheads,e.hdhfd.hfd.ci.psecs,Math.floor(e.hdhfd.size/1048576),e.lba48),e.regs.ide_status=0,e.data_offset=0,e.data_size=0,e):null},this.remove_ide_unit=function(e,t){null===e||(e=e[t])&&(SAER.hardfile.hdf_hd_close(e.hdhfd),t=e.its,e.its=t)}}function SAEO_Filesys(){function s(){return 0!=SAEV_config.chipset.ide}function e(){s()&&(SAEF_log("filesys.add_mainboard_unit_init() Initializing mainboard IDE"),SAER.gayle.gayle_add_ide_unit(-1,null));for(var e,t,n=0;n<6;n++){var r=SAEV_config.mount.config[n].ci,i=r.controller_type,a=r.controller_unit,o=!1;0!=i&&0!=r.file.size&&(i==SAEC_Config_Mount_Controller_Type_MB_IDE?(e=a,t=r,a=void 0,a=!1,i==SAEC_Config_Mount_Controller_Type_MB_IDE&&s()&&(SAEF_log("filesys.add_ide_unit() Adding mainboard IDE %s unit %d ('%s')","HD",e,t.file.name),SAER.gayle.gayle_add_ide_unit(e,t),a=!0),o=a):i==SAEC_Config_Mount_Controller_Type_PCMCIA_SRAM?(SAER.gayle.gayle_add_pcmcia_sram_unit(r),o=!0):i==SAEC_Config_Mount_Controller_Type_PCMCIA_IDE&&(SAER.gayle.gayle_add_pcmcia_ide_unit(r),o=!0),o&&(i=n,r=-1,(o=void 0)===o&&(o=-1),i=SAEV_config.mount.config[i],0<=r?(i.configoffset=r,i.unitnum=o):(i.configoffset=-1,i.unitnum=-1)))}}function t(){SAER.gayle.free_units()}this.uci_set_defaults=function(e,t){e.controller_type=SAEC_Config_Mount_Controller_Type_MB_IDE,e.controller_unit=0,e.controller_media_type=0,e.unit_feature_level=SAEC_Config_Mount_Controller_Level_ATA_2,e.unit_special_flags=0,e.readonly=!1,e.blocksize=512,e.cyls=0,t||(e.surfaces=1,e.sectors=32),e.bootable=!0,e.automount=!0,e.unit=0,e.flags=0,e.devname="",e.sectorsperblock=1,t||(e.reserved=2),e.interleave=!1,e.lowcyl=0,e.highcyl=0,e.buffers=50,e.bufmemtype=1,e.maxtransfer=2147483647,e.mask=4294967295,e.bootpri=0,e.dostype=1146049281,e.filesys="",e.stacksize=4e3,e.priority=-129},this.start_threads=function(){},this.cleanup=function(){t()},this.reset=function(){t(),e()},this.prepare_reset=function(){}}function SAEO_Hardfile_Data(){this.virtsize=0,this.physsize=0,this.offset=0,this.ci=new SAEO_Config_Mount_Info,this.handle=null,this.handle_valid=0,this.cache=null,this.cache_valid=0,this.cache_offset=0,this.vendor_id="",this.product_id="",this.product_rev="",this.virtual_rdb=null,this.virtual_size=0,this.byteswap=!1,this.adide=!1,this.hfd_type=0,this.vhd_header=null,this.vhd_bamoffset=0,this.vhd_bamsize=0,this.vhd_blocksize=0,this.vhd_sectormap=null,this.vhd_sectormapblock=0,this.vhd_bitmapsize=0,this.vhd_footerblock=0,this.drive_empty=!1}function SAEO_Hardfile_Data_HD(){this.hfd=new SAEO_Hardfile_Data,this.size=0,this.cyls=0,this.heads=0,this.secspertrack=0,this.cyls_def=0,this.secspertrack_def=0,this.heads_def=0,this.ansi_version=0}function SAEO_Hardfile(){const i=2,a=3;function r(e,t,n){return blocks=Math.floor(e/512),16515072<blocks?(t.cyl=16383,t.head=16,void(t.sectorspertrack=63)):n?(t.head=16,t.sectorspertrack=63,void(t.cyl=Math.floor(blocks/(t.sectorspertrack*t.head)))):void function(e,t,n){var r,i=Math.floor(e/512);if(1==(n=void 0===n?0:n))_=1,c=32,r=Math.floor(i/(_*c));else{var a=new Array(4);a[0]=63,a[1]=127,a[2]=255,a[3]=-1;for(var o=0;0<=a[o];o++){for(var s=a[o]<255?16:255,c=a[o],_=4;_<=s;_++){if(r=Math.floor(i/(_*c)),e<=536870912){if(r<=1023)break}else{if(r<16383)break;if(r<32767&&5<=_)break;if(r<=65535)break}16<s&&(_*=2,_--)}if(_<=16)break}}16<_&&_--,t.cyl=r,t.head=_,t.sectorspertrack=c}(e,t)}function l(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function o(e,t){return(e[t<<=2]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function s(e,t,n){e[t<<=2]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=255&n}function c(e,t,n,r){var i=" ".charCodeAt(0),a=r.length;t<<=2,e[t++]=Math.min(a,n);for(var o=0;o<n;o++)e[t++]=o<a?r.charCodeAt(o):i}function _(e,t){for(var n=0,r=o(e,t+1),i=0;i<r;i++)4294967295<(n+=o(e,t+i))&&(n-=4294967296);(n=-n)<0&&(n+=4294967296),s(e,t+2,n)}function f(e){v(e),e.hfd_type=0,e.vhd_header=null,e.vhd_sectormap=null}function u(e,t){for(var n=0,r=0;r<512;r++)0<=t&&t<=r&&r<t+4||4294967295<(n+=e[r])&&(n-=4294967296);return~n>>>0}function d(e,t){var n=e.vhd_blocksize+e.vhd_bitmapsize+512;i=(r=e).physsize+n-512,SAEF_ZFile_resize(r.handle.zf,i),r.physsize=i;var r=new Uint8Array(n);SAEF_memset(r,0,0,n-512),r.set(e.vhd_header.subarray(0,512),n-512);var i=w(e,r,0,e.vhd_footerblock,n);if(delete r,i==n){i=Math.floor(e.vhd_footerblock/512);if(e.vhd_header[t+0]=i>>>24,e.vhd_header[t+1]=i>>>16&255,e.vhd_header[t+2]=i>>>8&255,e.vhd_header[t+3]=255&i,w(e,e.vhd_header,e.vhd_bamoffset,e.vhd_bamoffset,e.vhd_bamsize)==e.vhd_bamsize)return e.vhd_footerblock+=n-512,1;SAEF_warn("hardfile.vhd_write_enlarge() bam write error")}else SAEF_warn("hardfile.vhd_write_enlarge() footer write error")}function p(e,t,n,r){return e.hfd_type==a?function(e,t,n,r){var i=0,a=0;if(511&n)return a;if(511&r)return a;for(;0<r;){var o=4*Math.floor(n/e.vhd_blocksize)+e.vhd_bamoffset,s=l(e.vhd_header,o);if(4294967295==s)SAEF_memset(t,i,0,512),a+=512;else{var c=Math.floor(n/512)%(e.vhd_blocksize>>9),_=Math.floor(c/8),o=512*s+(-512&_);if(e.vhd_sectormapblock!=o){if(512!=R(e,e.vhd_sectormap,0,o,512))return SAEF_warn("hardfile.vhd_read() bitmap read error"),a;e.vhd_sectormapblock=o}if(e.vhd_sectormap[511&_]&1<<7-(7&c)){if(512!=R(e,t,i,512*s+e.vhd_bitmapsize+512*c,512))return SAEF_warn("hardfile.vhd_read() data read error"),a}else SAEF_memset(t,i,0,512);a+=512}r-=512,i+=512,n+=512}return a}(e,t,n,r):e.hfd_type==i?R(e,t,0,n+512,r):R(e,t,0,n,r)}function E(e,t,n,r){return e.hfd_type==a?function(e,t,n,r){var i=0,a=0;if(511&n)return a;if(511&r)return a;for(;0<r;){var o=4*Math.floor(n/e.vhd_blocksize)+e.vhd_bamoffset,s=l(e.vhd_header,o);if(4294967295!=s){var c=Math.floor(n/512)%(e.vhd_blocksize>>9),_=Math.floor(c/8),f=512*s+(-512&_);if(e.vhd_sectormapblock!=f){if(512!=R(e,e.vhd_sectormap,0,f,512))return SAEF_warn("hardfile.vhd_write() bitmap read error"),a;e.vhd_sectormapblock=f}if(512!=w(e,t,i,512*s+e.vhd_bitmapsize+512*c,512))return SAEF_warn("hardfile.vhd_write() data write error"),a;if(!(e.vhd_sectormap[511&_]&1<<7-(7&c))&&(e.vhd_sectormap[511&_]|=1<<7-(7&c),512!=w(e,e.vhd_sectormap,0,f,512)))return SAEF_warn("hardfile.vhd_write() bam write error"),a;a+=512,r-=512,i+=512,n+=512}else if(!d(e,o))return a}return a}(e,t,n,r):e.hfd_type==i?w(e,t,0,n+512,r):w(e,t,0,n,r)}function A(e,t,n,r){return p(e,t,n,r)}function S(e,t,n,r){return E(e,t,n,r)}function m(e,t){SAEF_warn("hardfile.adide_decode() 0x%04x %d",e,t)}function h(e,t){SAEF_warn("hardfile.hdf_byteswap() 0x%04x %d",e,t)}this.hdf_hd_open=function(e){if(function(e,t){void 0===t&&(t=null);if(null===t){if(0==e.ci.file.size)return 0;t=SAEF_CloneObject(e.ci.file)}e.byteswap=!1,e.adide=!1,e.hfd_type=0;var n=function(e,t){return e.drive_empty=!1,f(e),e.cache=new Uint8Array(g),e.cache_valid=0,e.virtual_size=0,e.virtual_rdb=null,e.vendor_id="UAE",e.product_id=t.name.substr(0,Math.min(t.name.length,15)),e.product_rev="0.1",SAEF_log("hardfile.hdf_open_target() attempting to open HDF '%s'... (%d bytes)",t.name,t.size),e.handle=new y,e.handle.zf=SAEF_ZFile_fopen_file(t),null!==e.handle.zf?(SAEF_ZFile_fseek(e.handle.zf,0,SEEK_END),e.physsize=e.virtsize=SAEF_ZFile_ftell(e.handle.zf),SAEF_ZFile_fseek(e.handle.zf,0,SEEK_SET),e.handle_valid=1,SAEF_log("hardfile.hdf_open_target() HDF '%s' opened (size %dK, empty %d)",t.name,Math.floor(e.physsize/1024),e.drive_empty?1:0),1):(f(e),-1)}(e,t);if(n<=0)return n;var r=new Uint8Array(512);if(512!=R(e,r,0,0,512))return SAEF_log("hardfile.hdf_open() no VHD-image, file samller than 512 bytes"),e.hfd_type=0,1;t=l(r,8);if(2!=(3&t))return SAEF_log("hardfile.hdf_open() no VHD-image, wrong file features %d != 2",3&t),e.hfd_type=0,1;if((t=l(r,12))>>>16!=1)return SAEF_log("hardfile.hdf_open() no VHD-image, wrong file version %d != 1",t>>>16),e.hfd_type=0,1;if(e.hfd_type=l(r,60),e.hfd_type!=i&&e.hfd_type!=a)return SAEF_log("hardfile.hdf_open() no VHD-image, wrong file type %d",e.hfd_type),e.hfd_type=0,1;if(0==(t=l(r,64)))return SAEF_log("hardfile.hdf_open() no VHD-image, error 1"),e.hfd_type=0,1;n=u(r,64);if(n!=t)return SAEF_log("hardfile.hdf_open() no VHD-image, wrong file checksum 0x%08x != 0x%08x",n,t),e.hfd_type=0,1;n=new Uint8Array(512);if(512!=R(e,n,0,e.physsize-n.length,512))return SAEF_warn("hardfile.hdf_open() file read error"),v(e),0;if(0!=SAEF_CompareArray(r,n))return SAEF_log("hardfile.hdf_open() no VHD-image, error 2"),e.hfd_type=0,1;if(e.vhd_footerblock=e.physsize-512,e.virtsize=4294967296*l(r,48),e.virtsize+=l(r,52),e.hfd_type==a){n=!0;if(e.vhd_bamoffset=l(r,20),0<e.vhd_bamoffset&&e.vhd_bamoffset<e.physsize&&512==R(e,r,0,e.vhd_bamoffset,512)&&(t=l(r,36),u(r,36)==t&&(t=l(r,24))>>>16==1&&(e.vhd_blocksize=l(r,32),e.vhd_bamoffset=l(r,20),e.vhd_bamsize=4*Math.floor((e.virtsize+e.vhd_blocksize-1)/e.vhd_blocksize)+511&-512,r=e.vhd_bamoffset+e.vhd_bamsize,e.vhd_header=new Uint8Array(r),R(e,e.vhd_header,0,0,r)==r&&(e.vhd_sectormap=new Uint8Array(512),e.vhd_sectormapblock=-1,e.vhd_bitmapsize=Math.floor(e.vhd_blocksize/4096)+511&-512,n=!1))),n)return v(e),0}return SAEF_log("hardfile.hdf_open() HDF is VHD %s image, virtual size=%dK (%x %d)",e.hfd_type==i?"fixed":"dynamic",Math.floor(e.virtsize/1024),e.virtsize,e.virtsize),void 0,1}(e.hfd)<=0)return 0;var t=e.hfd.ci;if(t.physical_geometry?(e.cyls=t.pcyls,e.heads=t.pheads,e.secspertrack=t.psecs):t.highcyl&&t.surfaces&&t.sectors?(e.cyls=t.highcyl,e.heads=t.surfaces,e.secspertrack=t.sectors):(r(e.hfd.virtsize,n={},!1),e.cyls=n.cyl,e.heads=n.head,e.secspertrack=n.sectorspertrack),e.cyls_def=e.cyls,e.secspertrack_def=e.secspertrack,e.heads_def=e.heads,t.surfaces&&t.sectors){var n=new Uint8Array(512);if(n[0]=0,this.hdf_read(e.hfd,n,0,512),0!=n[0]&&0!=SAEF_CompareArray(n,SAEF_String2Array("RDSK"),4))for(t.highcyl=Math.floor(Math.floor(e.hfd.virtsize/t.blocksize)/(t.sectors*t.surfaces)),t.dostype=o(n,0),SAEF_warn("hardfile.hdf_hd_open() no RDSK, dostype 0x%08x, highcyl %d",t.dostype,t.highcyl),function(e){var t=e.ci.surfaces*e.ci.sectors,n=262144/(512*t),r=t*n*512;SAEF_log("hardfile.create_virtual_rdb() cyl %d, cyls %d, size %d",t,n,r);var i=new Uint8Array(r);SAEF_memset(i,0,0,r),e.virtual_rdb=i,e.virtual_size=r,s(i,0,1380209483),s(i,1,64),s(i,2,0),s(i,3,7),s(i,4,512),s(i,5,0),s(i,6,-1),s(i,7,1),s(i,8,-1),s(i,9,-1),s(i,10,-1),s(i,11,-1),s(i,12,-1),s(i,13,-1),s(i,14,-1),s(i,15,-1),s(i,16,e.ci.highcyl),s(i,17,e.ci.sectors),s(i,18,e.ci.surfaces),s(i,19,e.ci.interleave?1:0),s(i,20,0),s(i,21,-1),s(i,22,-1),s(i,23,-1),s(i,24,0),s(i,25,0),s(i,26,0),s(i,27,-1),s(i,28,-1),s(i,29,-1),s(i,30,-1),s(i,31,-1),s(i,32,0),s(i,33,t*n),s(i,34,n),s(i,35,e.ci.highcyl+n),s(i,36,t),s(i,37,0),s(i,38,2),s(i,39,-1),c(i,40,8,e.vendor_id),c(i,42,16,e.product_id),c(i,46,4,e.product_rev),_(i,0);var a=128;s(i,a,1346458196),s(i,129,64),s(i,130,0),s(i,131,0),s(i,132,-1),s(i,133,1),s(i,134,-1),s(i,135,-1),s(i,136,0),c(i,137,30,e.ci.devname),s(i,t=160,80),s(i,161,128),s(i,162,0),s(i,163,e.ci.surfaces),s(i,164,e.ci.blocksize>>9),s(i,165,e.ci.sectors),s(i,166,e.ci.reserved),s(i,167,0),s(i,168,e.ci.interleave?1:0),s(i,169,n),s(i,170,e.ci.highcyl+n-1),s(i,171,e.ci.buffers),s(i,172,e.ci.bufmemtype),s(i,173,e.ci.maxtransfer),s(i,174,e.ci.mask),s(i,175,e.ci.bootpri),s(i,176,e.ci.dostype),_(i,a),e.virtsize+=r}(e.hfd);t.highcyl*t.surfaces*t.sectors>e.cyls_def*e.secspertrack_def*e.heads_def;)e.cyls_def++}return e.size=e.hfd.virtsize,1},this.hdf_hd_close=function(e){null!==e&&f(e.hfd)},this.hdf_read=function(e,t,n,r){var i;return e.adide?(i=A(e,t,n+=512,r),m(t,r)):i=A(e,t,n,r),e.byteswap&&h(t,r),i},this.hdf_write=function(e,t,n,r){var i;return e.byteswap&&h(t,r),e.adide?(n+=512,SAEF_warn("hardfile.adide_encode() 0x%04x %d",t,r),i=S(e,t,n,r),m(t,r)):i=S(e,t,n,r),e.byteswap&&h(t,r),i};const g=16384;function y(){this.zf=null,this.firstwrite=!1}function v(e){var t;null!==(t=e.handle)&&null!==t.zf&&(SAEF_ZFile_fclose(t.zf),t.zf=null),e.handle=null,e.handle_valid=0,e.cache=null,e.cache_valid=0,e.virtual_rdb=null,e.virtual_size=0,e.drive_empty=!1}function b(e,t){return 0==e.handle_valid?(SAEF_warn("hardfile.hdf_seek() hdf handle is not valid. bug."),-1):t>=e.physsize-e.virtual_size?(SAEF_warn("hardfile.hdf_seek() tried to seek out of bounds! (%X >= %X - %X)",t,e.physsize,e.virtual_size),-1):(t+=e.offset)&e.ci.blocksize-1?(SAEF_warn("hardfile.hdf_seek() fail, offset = %X not aligned to blocksize %d! (%X & %04X = %04X)",t,e.ci.blocksize,t,e.ci.blocksize,t&e.ci.blocksize-1),-1):0!=SAEF_ZFile_fseek(e.handle.zf,t,SEEK_SET)?(SAEF_warn("hardfile.hdf_seek() common seek error"),-1):0}function C(e,t){var n=SAEF_ZFile_ftell(e.handle.zf);return t<0?(SAEF_warn("hardfile.poscheck() fail, negative length! (%d)",t),-1):n<e.offset?(SAEF_warn("hardfile.poscheck() fail, offset out of bounds! (%d < %d)",n,e.offset),-1):n>=e.offset+e.physsize-e.virtual_size||n>=e.offset+e.physsize+t-e.virtual_size?(SAEF_warn("hardfile.poscheck() fail, offset out of bounds! (%d >= %d, LEN=%d)",n,e.offset+e.physsize,t),-1):n&e.ci.blocksize-1?(SAEF_warn("hardfile.poscheck() fail, offset not aligned to blocksize! (%X & %X = %04X)",n,e.ci.blocksize,n&e.ci.blocksize),-1):0}function k(e,t,n){return e.cache_valid&&t>=e.cache_offset&&t+n<=e.cache_offset+g?t-e.cache_offset:-1}function R(e,t,n,r,i){var a,o,s=0,c=n;if(e.drive_empty)return 0;if(r<e.virtual_size){n=r+i<=e.virtual_size?i:e.virtual_size-r;return e.virtual_rdb?(t.set(e.virtual_rdb.subarray(r,r+n),c),n):0}for(r-=e.virtual_size;0<i;){if(e.physsize<g){if(e.cache_valid=0,-1==b(e,r))return-1;if(-1==C(e,i))return-1;o=SAEF_ZFile_fread(t,c,1,i,e.handle.zf),a=i}else o=function(e,t,n,r,i){0==r&&(e.cache_valid=0);var a=k(e,r,i);if(0<=a)return t.set(e.cache.subarray(a,a+i),n),i;if((e.cache_offset=r)+g>e.offset+(e.physsize-e.virtual_size)&&(e.cache_offset=e.offset+(e.physsize-e.virtual_size)-g),-1==b(e,e.cache_offset))return-1;if(-1==C(e,g))return-1;var o=SAEF_ZFile_fread(e.cache,0,1,g,e.handle.zf);return e.cache_valid=0,o!=g?0:(e.cache_valid=1,0<=(a=k(e,r,i))?(t.set(e.cache.subarray(a,a+i),n),i):(SAEF_error("hardfile.hdf_read_target_2() cache bug! offset %d, len %d",r,i),e.cache_valid=0))}(e,t,c,r,a=i>g?g:i);if(o<0)return o;if(s+=o,o!=a)return s;r+=a,c+=a,i-=a}return s}function w(e,t,n,r,i){var a,o,s,c,_=0,f=n;if(e.drive_empty)return 0;if(r<e.virtual_size)return i;for(r-=e.virtual_size;0<i;){var l=i>g?g:i,u=(a=t,o=f,s=r,c=l,(u=e).ci.readonly?0:(u.cache_valid=0,-1==b(u,s)||-1==C(u,c)?-1:(u.cache.set(a.subarray(o,o+c)),SAEF_ZFile_fwrite(u.cache,0,1,c,u.handle.zf))));if(u<0)return u;if(_+=u,u!=l)return _;r+=l,f+=l,i-=l}return _}this.reset=function(){}}function SAEO_Dongle(){const r=200*SAEC_Events_CYCLE_UNIT;var i=0,a=0;this.cia_read=function(e,t,n){return 3===SAEV_config.dongle&&1==e&&0==t&&(0==i||SAEV_Events_currcycle>a+r?(n&=-17,i=0):n|=16),n},this.cia_write=function(e,t,n){switch(SAEV_config.dongle){case 0:return;case 1:0==e&&0==t&&128&n&&(i^=1);break;case 3:1!=e||0!=t||128&n||(i=1,a=SAEV_Events_currcycle)}},this.joytest=function(e){},this.joydat=function(e,t){switch(SAEV_config.dongle){case 0:break;case 1:1==e&&0!=i&&(t+=256);break;case 2:1==e&&(t&=-772,t|=257);break;case 8:0==e&&(t&=-772,t|=257);break;case 6:1==e&&(t&=-772,t|=769);break;case 7:0==e&&(t&=-4,t|=0==i?1:2),i^=1}return t},this.potgo=function(e){switch(SAEV_config.dongle){case 0:return;case 4:case 9:case 5:i=(8*Math.random()>>>0)-3}},this.potgor=function(e){return 9===SAEV_config.dongle&&(e|=16384),e},this.analogjoy=function(e,t){var n=-1;switch(SAEV_config.dongle){case 0:return-1;case 4:1==e&&0==t&&(n=73);break;case 9:1==e&&(0==t&&(n=21),1==t&&(n=10));break;case 5:1==e&&(1==t&&(n=80),0==t&&(n=43))}return n=0<=n&&(n+=i)<0?0:n},this.reset=function(){a=i=0}}const SAEC_Input_Event_Press=10,SAEC_Input_Event_MouseMove=20,SAEC_Input_Event_JoystickMove=30,SAEC_Input_Button_1=1,SAEC_Input_Button_2=2,SAEC_Input_Button_3=4,SAEC_Input_Direction_Left=1,SAEC_Input_Direction_Right=2,SAEC_Input_Direction_Up=4,SAEC_Input_Direction_Down=8;function SAEO_Mouse(e){var n=e,r=-1,i=-1;function a(e){if(void 0!==(e=e||window.event)){if(void 0!==e.movementX)var t=e.movementX,n=e.movementY;else{if(void 0===e.mozMovementX)return;t=e.mozMovementX,n=e.mozMovementY}SAER.input.registerEvent(0,SAEC_Input_Event_MouseMove,t,n)}}this.reset=function(){r=i=-1},this.attach=function(e,t){e.onmousedown=function(e){if(void 0!==(e=e||window.event))switch(e.button){case 0:SAER.input.registerEvent(n,SAEC_Input_Event_Press,SAEC_Input_Button_1,!0);break;case 2:SAER.input.registerEvent(n,SAEC_Input_Event_Press,SAEC_Input_Button_2,!0);break;case 1:SAER.input.registerEvent(n,SAEC_Input_Event_Press,SAEC_Input_Button_3,!0)}},e.onmouseup=function(e){if(void 0!==(e=e||window.event))switch(e.button){case 0:SAER.input.registerEvent(n,SAEC_Input_Event_Press,SAEC_Input_Button_1,!1);break;case 2:SAER.input.registerEvent(n,SAEC_Input_Event_Press,SAEC_Input_Button_2,!1);break;case 1:SAER.input.registerEvent(n,SAEC_Input_Event_Press,SAEC_Input_Button_3,!1)}},t?document.addEventListener("mousemove",a,!1):(e.onmouseover=function(e){void 0!==(e=e||window.event)&&SAEV_config.video.cursor==SAEC_Config_Video_Cursor_Hide&&SAER.video.hideCursor(!0)},e.onmouseout=function(e){void 0!==(e=e||window.event)&&SAEV_config.video.cursor==SAEC_Config_Video_Cursor_Hide&&SAER.video.hideCursor(!1)},e.onmousemove=function(e){!function(e){if(void 0!==(e=e||window.event)){if(void 0!==e.pageX)var t=e.pageX,n=e.pageY;else{if(void 0===e.clientX)return;t=e.clientX,n=e.clientY}-1!=r&&SAER.input.registerEvent(0,SAEC_Input_Event_MouseMove,t-r,n-i),r=t,i=n}}(e)})},this.dettach=function(e,t){e.onmousedown=function(e){},e.onmouseup=function(e){},t?document.removeEventListener("mousemove",a,!1):(e.onmouseover=function(e){},e.onmouseout=function(e){},e.onmousemove=function(e){})}}function SAEO_Joystick(e){var r=e,i=0,a=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],o=[!1,!1,!1,!1],s=null;function c(){var e,t=SAEV_config.ports[r].device;if((e=navigator.getGamepads?navigator.getGamepads()[t]:navigator.webkitGetGamepads?navigator.webkitGetGamepads()[t]:null)&&e.connected){for(var n=0;n<Math.min(i,10);n++)e.buttons[n].pressed!=a[n]&&(SAER.input.registerEvent(r,SAEC_Input_Event_Press,1<<n,e.buttons[n].pressed),a[n]=e.buttons[n].pressed);t=e.axes[0]<-.5;t!=o[0]&&(SAER.input.registerEvent(r,SAEC_Input_Event_JoystickMove,SAEC_Input_Direction_Left,t),o[0]=t),t||(t=.5<e.axes[0])!=o[1]&&(SAER.input.registerEvent(r,SAEC_Input_Event_JoystickMove,SAEC_Input_Direction_Right,t),o[1]=t),(t=e.axes[1]<-.5)!=o[2]&&(SAER.input.registerEvent(r,SAEC_Input_Event_JoystickMove,SAEC_Input_Direction_Up,t),o[2]=t),t||(t=.5<e.axes[1])!=o[3]&&(SAER.input.registerEvent(r,SAEC_Input_Event_JoystickMove,SAEC_Input_Direction_Down,t),o[3]=t),s=window.requestAnimationFrame(c)}}this.enable=function(){s=window.requestAnimationFrame(c)},this.disable=function(){null!==s&&(window.cancelAnimationFrame(s),s=null)},this.reset=function(){for(var e=0;e<a.length;e++)a[e]=!1;for(e=0;e<o.length;e++)o[e]=!1;s=null},this.setup=function(){if(SAEV_config.ports[r].type==SAEC_Config_Ports_Type_Joy){var e=SAEV_config.ports[r].device,t=navigator.getGamepads?navigator.getGamepads()[e]:navigator.webkitGetGamepads?navigator.webkitGetGamepads()[e]:null;if(!t||!t.connected)return SAEF_error("Joystick.setup() chosen gamepad device with index "+e+" was not detected."),SAEE_Input_GamepadNotReady;i=t.buttons.length,t.axes.length,SAEF_log("Joystick.setup() assigned controller "+t.id+" #"+t.index+" to port "+r)}return SAEE_None},this.cleanup=function(){this.disable(),i=0}}function SAEO_Keyboard(){const f=2,l=3;const u=67,d=68;const p=96,E=97;const A=100,S=101;const m={8:65,9:66,13:d,16:p,17:99,18:A,19:110,20:98,27:69,32:64,33:72,34:73,35:113,36:112,37:79,38:76,39:78,40:77,45:71,46:70,48:10,49:1,50:2,51:3,52:4,53:5,54:6,55:7,56:8,57:9,65:32,66:53,67:51,68:34,69:18,70:35,71:36,72:37,73:23,74:38,75:39,76:40,77:55,78:54,79:24,80:25,81:16,82:19,83:33,84:20,85:22,86:52,87:17,88:50,89:49,90:21,91:102,92:103,93:95,96:15,97:29,98:30,99:31,100:45,101:46,102:47,103:61,104:62,105:63,106:93,107:94,109:74,110:60,111:92,112:80,113:81,114:82,115:83,116:84,117:85,118:86,119:87,120:88,121:89,144:109,145:107,186:26,187:27,188:56,189:58,190:57,191:43,192:41,219:11,220:0,221:12,222:42,226:48},h={8:65,9:66,13:d,16:p,17:99,18:A,19:110,20:98,27:69,32:64,33:72,34:73,35:113,36:112,37:79,38:76,39:78,40:77,45:71,46:70,48:10,49:1,50:2,51:3,52:4,53:5,54:6,55:7,56:8,57:9,60:48,63:11,65:32,66:53,67:51,68:34,69:18,70:35,71:36,72:37,73:23,74:38,75:39,76:40,77:55,78:54,79:24,80:25,81:16,82:19,83:33,84:20,85:22,86:52,87:17,88:50,89:49,90:21,91:102,92:103,93:95,96:15,97:29,98:30,99:31,100:45,101:46,102:47,103:61,104:62,105:63,106:93,107:94,109:74,110:60,111:92,112:80,113:81,114:82,115:83,116:84,117:85,118:86,119:87,120:88,121:89,144:109,145:107,160:0,163:43,171:27,173:58,188:56,190:57,192:12};const n=512;for(var i=new Array(4),e=0;e<4;e++)i[e]=new Uint8Array(256);var r=new Uint8Array(n),a=0,o=0,g=!1;function t(e){_(e,!0)}function s(e){_(e,!1)}function y(e){var t=a+1;if((t=t==n?0:t)!=o)return r[a]=e,a=t,1;SAEF_warn("imput.recordKey() buffer overrun!")}function c(e,t,n){if(20==t)if(n){if(!(g=!g))return}else if(g)return;if(SAEV_config.ports[0].type==SAEC_Config_Ports_Type_JoyEmu){switch(SAEV_config.ports[0].move){case SAEC_Config_Ports_Move_Arrows:r=37,i=38,a=39,o=40;break;case SAEC_Config_Ports_Move_Numpad:r=100,i=104,a=102,o=101;break;case SAEC_Config_Ports_Move_WASD:r=65,i=87,a=68,o=83}switch(s=SAEV_config.ports[0].fire[0],c=SAEV_config.ports[0].fire[1],t){case s:SAER.input.registerEvent(0,SAEC_Input_Event_Press,SAEC_Input_Button_1,n);break;case c:SAER.input.registerEvent(0,SAEC_Input_Event_Press,SAEC_Input_Button_2,n);break;case r:SAER.input.registerEvent(0,SAEC_Input_Event_JoystickMove,SAEC_Input_Direction_Left,n);break;case i:SAER.input.registerEvent(0,SAEC_Input_Event_JoystickMove,SAEC_Input_Direction_Up,n);break;case a:SAER.input.registerEvent(0,SAEC_Input_Event_JoystickMove,SAEC_Input_Direction_Right,n);break;case o:SAER.input.registerEvent(0,SAEC_Input_Event_JoystickMove,SAEC_Input_Direction_Down,n)}}if(SAEV_config.ports[1].type==SAEC_Config_Ports_Type_JoyEmu){var r,i,a,o,s,c;switch(SAEV_config.ports[1].move){case SAEC_Config_Ports_Move_Arrows:r=37,i=38,a=39,o=40;break;case SAEC_Config_Ports_Move_Numpad:r=100,i=104,a=102,o=101;break;case SAEC_Config_Ports_Move_WASD:r=65,i=87,a=68,o=83}switch(s=SAEV_config.ports[1].fire[0],c=SAEV_config.ports[1].fire[1],t){case s:SAER.input.registerEvent(1,SAEC_Input_Event_Press,SAEC_Input_Button_1,n);break;case c:SAER.input.registerEvent(1,SAEC_Input_Event_Press,SAEC_Input_Button_2,n);break;case r:SAER.input.registerEvent(1,SAEC_Input_Event_JoystickMove,SAEC_Input_Direction_Left,n);break;case i:SAER.input.registerEvent(1,SAEC_Input_Event_JoystickMove,SAEC_Input_Direction_Up,n);break;case a:SAER.input.registerEvent(1,SAEC_Input_Event_JoystickMove,SAEC_Input_Direction_Right,n);break;case o:SAER.input.registerEvent(1,SAEC_Input_Event_JoystickMove,SAEC_Input_Direction_Down,n)}}if(SAEV_config.keyboard.enabled){var _=!1;if(SAEC_info.browser.id==SAEC_Info_Brower_ID_Firefox?void 0!==h[t]&&(_=h[t]):void 0!==m[t]&&(_=m[t]),!1!==_){switch(_){case p:e==f&&(_=E);break;case A:e==f&&(_=S);break;case d:e==l&&(_=u)}y(n?_<<1:_<<1|1)}}}function _(e,t){var n=void 0===(e=e||window.event).keyCode?e.which:e.keyCode,r=void 0===e.location?0:e.location;122!=n&&123!=n&&(e.preventDefault(),e=i[r][n],i[r][n]=t?1:0,i[r][n]!=e&&c(r,n,i[r][n]))}this.setup=function(){SAEV_config.keyboard.enabled&&(document.addEventListener("keydown",t,!1),document.addEventListener("keyup",s,!1))},this.cleanup=function(){SAEV_config.keyboard.enabled&&(document.removeEventListener("keydown",t,!1),document.removeEventListener("keyup",s,!1))},this.reset=function(){for(var e=0;e<i.length;e++)for(var t=0;t<i[e].length;t++)i[e][t]=0;a=o=0},this.keysAvail=function(){return a!=o},this.nextKey=function(){SAEF_assert(a!=o);var e=r[o];return++o==n&&(o=0),e},this.keyPress=function(e,t){_(e,t)},this.touchKey=function(e,t){c(0,e,t)}}function SAEO_Input(){this.mouse=new SAEO_Mouse(0),this.joystick=[new SAEO_Joystick(0),new SAEO_Joystick(1)],this.keyboard=new SAEO_Keyboard;var l=[0,0,0,0],u=[0,0,0,0],d=[0,0,0,0],p=[0,0,0,0],E=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],A=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],S=[0,0,0,0],m=[0,0,0,0],t=[[0,0],[0,0],[0,0],[0,0]],h=[0,0,0,0],g=[0,0,0,0],y=[0,0,0,0],v=[0,0,0,0],b=[!1,!1,!1,!1],C=[!1,!1,!1,!1],c=[!1,!1],n=[[!1,!1],[!1,!1]],_=[[!1,!1],[!1,!1]],f=0,k=[[0,0],[0,0]],R=[[0,0],[0,0]],w=[[0,0],[0,0]];const x=8,D=7;var r=0,i=0;function a(){this.port=0,this.id=0,this.arg1=0,this.arg2=0,this.linecnt=0,this.nextlinecnt=0}var o=null;function s(){for(var e=0;e<2;e++)for(var t=0;t<2;t++){var n=512<<(e<<2)+(t<<1),r=256<<(e<<2)+(t<<1),i=0!=(S[e]&(0==t?SAEC_Input_Button_3:SAEC_Input_Button_2)),a=SAER.dongle.analogjoy(e,t),o=0,s=0;0<=a?(i=0,k[e][t]<(s=a)&&(o=1)):(_[e][t]||c[e])&&(o=1),f&n?(o=f&r?2:-2,f&r&&(w[e][t]=0),i&&R[e][t]++):(w[e][t]&&R[e][t]++,1==w[e][t]&&(R[e][t]<(SAEV_config.chipset.ntsc?D:x)?o=-2:(w[e][t]=2,R[e][t]=0)),0<=a?2==w[e][t]&&k[e][t]>=s&&(w[e][t]=0):(_[e][t]||c[e])&&2==w[e][t]&&10<=k[e][t]&&!i&&(w[e][t]=0)),(o=0==(o=i?-2:o)&&a<0&&_[e][t]?2:o)&&((o<-1||1<o)&&(o*=80),k[e][t]+=o,k[e][t]<0&&(k[e][t]=0),511<k[e][t]&&(k[e][t]=511))}}function M(e,t,n){var r=E[e][t],i=~~(r*(n=1e3<n?1e3:n)/1e3);return i||(r<-(n=SAER.playfield.get_maxvpos())>>1?i=-2:r<0?i=-1:n>>1<r?i=2:0<r&&(i=1)),A[e][t]||(E[e][t]-=i),i}function F(e,t){for(var n,r=16384,i=120,a=0;a<2;a++)c[a]&&(n=M(a,0,e),l[a]+=n,l[a]<0&&(l[a]+=r,d[a]=l[a]-n),l[a]>=r&&(l[a]-=r,d[a]=l[a]-n),n=M(a,1,e),u[a]+=n,u[a]<0&&(u[a]+=r,p[a]=u[a]-n),u[a]>=r&&(u[a]-=r,p[a]=u[a]-n),A[a][2]||(E[a][2]=0),d[a]-l[a]>i&&(l[a]=d[a]-i,l[a]&=r-1),d[a]-l[a]<-i&&(l[a]=d[a]+i,l[a]&=r-1),p[a]-u[a]>i&&(u[a]=p[a]-i),p[a]-u[a]<-i&&(u[a]=p[a]+i)),t||(d[a]=l[a],p[a]=u[a])}function T(){var e=SAER.playfield.get_vpos(),t=SAER_Playfield_current_maxvpos(),n=i*t+e,e=n-r;0<e&&F(e<10?0:1e3*e/t>>>0,!1),r=n}function V(e){var t,n,r,i,a,o=e.port;switch(e.id){case SAEC_Input_Event_Press:e.arg2?S[o]|=e.arg1:S[o]&=~e.arg1;break;case SAEC_Input_Event_MouseMove:A[o][0]=0,A[o][1]=0,E[o][0]+=e.arg1,E[o][1]+=e.arg2;break;case SAEC_Input_Event_JoystickMove:var s=h[o],c=g[o],_=y[o],f=v[o];e.arg1&SAEC_Input_Direction_Left&&(s=h[o]=e.arg2?1:0,b[o]&&s&&(c=g[o]=0)),e.arg1&SAEC_Input_Direction_Right&&(c=g[o]=e.arg2?1:0,b[o]&&c&&(s=h[o]=0)),e.arg1&SAEC_Input_Direction_Up&&(_=y[o]=e.arg2?1:0,C[o]&&_&&(f=v[o]=0)),e.arg1&SAEC_Input_Direction_Down&&(f=v[o]=e.arg2?1:0,C[o]&&f&&(_=y[o]=0)),A[o][0]=1,A[o][1]=1,m[o]=0,s&&(m[o]|=SAEC_Input_Direction_Left),c&&(m[o]|=SAEC_Input_Direction_Right),_&&(m[o]|=SAEC_Input_Direction_Up),f&&(m[o]|=SAEC_Input_Direction_Down),0!=o&&1!=o||(n=m[t=o]&SAEC_Input_Direction_Left?0:1,r=m[t]&SAEC_Input_Direction_Right?0:1,i=m[t]&SAEC_Input_Direction_Up?0:1,a=m[t]&SAEC_Input_Direction_Down?0:1,s=(a^r?1:0)|(1^r?2:0),c=(i^n?1:0)|(1^n?2:0),_=3&l[t],f=3&u[t],3==s&&0==_?l[t]-=4:0==s&&3==_&&(l[t]+=4),l[t]=252&l[t]|s,3==c&&0==f?u[t]-=4:0==c&&3==f&&(u[t]+=4),u[t]=252&u[t]|c,n&&r&&i&&a||(d[t]=l[t],p[t]=u[t]))}}this.handle_joystick_buttons=function(e,t){var n=0;s();for(var r=0;r<2;r++){var i=64<<r;0==(S[r]&SAEC_Input_Button_1)&&(n|=i),t&i&&(n=n&~i|e&i)}return n},this.handle_parport_joystick=function(e,t,n){switch(e){case 0:return t&n|255^n;case 1:return 7&(t&n|255^n);default:return 0}},this.hsync=function(){s();for(var e=0;e<16;e++){var t=o[e];0<t.linecnt&&(t.linecnt--,0==t.linecnt&&(V(t),t.linecnt=t.nextlinecnt))}},this.vsync=function(){i++,F(0,!0)},this.touchKey=function(e,t){this.keyboard.touchKey(e,t)},this.registerEvent=function(e,t,n,r){if(null!==o&&!SAER.paused){for(var i,a=0;a<16&&!(o[a].linecnt<0);a++);16!=a?((i=o[a]).port=e,i.id=t,i.arg1=n,i.arg2=r,i.linecnt=1,i.nextlinecnt=-1):SAEF_warn("Input.registerEvent() queue overflow")}},this.keyPress=function(e,t){this.keyboard.keyPress(e,t)},this.setup=function(){var e;o=new Array(16);for(var t=0;t<16;t++)o[t]=new a;if((e=this.joystick[0].setup())==SAEE_None){if((e=this.joystick[1].setup())==SAEE_None)return c[0]=SAEV_config.ports[0].type==SAEC_Config_Ports_Type_Mouse,c[1]=!1,n[0][0]=n[0][1]=!1,n[1][0]=n[1][1]=!1,_[0][0]=_[0][1]=SAEV_config.ports[0].type==SAEC_Config_Ports_Type_Joy||SAEV_config.ports[0].type==SAEC_Config_Ports_Type_JoyEmu,_[1][0]=_[1][1]=SAEV_config.ports[1].type==SAEC_Config_Ports_Type_Joy||SAEV_config.ports[1].type==SAEC_Config_Ports_Type_JoyEmu,SAEE_None;this.joystick[0].cleanup()}return this.keyboard.cleanup(),e},this.cleanup=function(){this.joystick[1].cleanup(),this.joystick[0].cleanup(),this.keyboard.cleanup(),o=null},this.reset=function(){this.mouse.reset(),this.joystick[0].reset(),this.joystick[1].reset(),this.keyboard.reset();for(var e=0;e<4;e++)E[e][0]=A[e][0]=0,S[e]=0,m[e]=0,t[e][0]=t[e][1]=0,h[e]=g[e]=y[e]=v[e]=0,b[e]=C[e]=!0;for(e=f=0;e<2;e++)R[e][0]=R[e][1]=0;for(e=r=i=0;e<16;e++)o[e].linecnt=o[e].nextlinecnt=-1},this.POTGO=function(e){var t,n,r;for(SAER.dongle.potgo(e),f&=21760,f|=43520&e,t=0;t<8;t+=2)e&512<<t&&(f&=~(r=256<<t),f|=e&r);if(1&e)for(t=0;t<2;t++)for(n=0;n<2;n++)w[t][n]=1,R[t][n]=0},this.POTGOR=function(){var e=0,e=f;s();for(var t=0;t<2;t++){var n=1024<<(t<<2),r=512<<(t<<2),i=256<<(t<<2);e&=~i,100<k[t][0]&&(e|=i),f&r&&!(f&i&&f&r)||(e&=~n,100<k[t][1]&&(e|=n))}return e=SAER.dongle.potgor(e&=21760)},this.POT0DAT=function(){return(255&R[0][1])<<8|255&R[0][0]},this.POT1DAT=function(){return(255&R[1][1])<<8|255&R[1][0]},this.JOY0DAT=function(){T();var e=(255&u[0])<<8|255&l[0];return e=SAER.dongle.joydat(0,e)},this.JOY1DAT=function(){T();var e=(255&u[1])<<8|255&l[1];return e=SAER.dongle.joydat(1,e)},this.JOYTEST=function(e){l[0]&=3,u[0]&=3,l[1]&=3,u[1]&=3,l[0]|=252&e,l[1]|=252&e,u[0]|=e>>8&252,u[1]|=e>>8&252,d[0]=l[0],p[0]=u[0],d[1]=l[1],p[1]=u[1]}}function SAEO_Serial(){var t=0,n=0,r=0,e=0,i=!1,a=0,o=0,s=0,c=0;function _(){!r&&t&&(e=s&(1<<(128==(65408&s)?8:7))-1,r=1,t=0,SAEV_config.hook.serial.put(e),SAER.custom.INTREQ(SAEC_Custom_INTF_SETCLR|SAEC_Custom_INTF_TBE))}this.hsync=function(){var e;n||0<(e=SAEV_config.hook.serial.get())&&(c=256|(e&=255),n=1,this.check_irq()),r&&(r=0,_())},this.rbf_clear=function(){i=!1},this.check_irq=function(){n&&SAER.custom.INTREQ_0(SAEC_Custom_INTF_SETCLR|SAEC_Custom_INTF_RBF)},this.dtr_on=function(){0},this.dtr_off=function(){0},this.readstatus=function(e){var t=a;return a&=-57,a|=t&=56},this.writestatus=function(e,t){return a&=-193,a|=e&=192},this.SERPER=function(e){SAEV_config.serial.enabled&&o!=e&&(o=e)},this.SERDAT=function(e){SAEV_config.serial.enabled&&(_(),(s=e)&&(t=1,_()))},this.SERDATR=function(){return SAEV_config.serial.enabled?(c&=1023,t||(c|=8192),r||(c|=4096),n&&(c|=16384),i&&(c|=32768),n=0,c):8192},this.cleanup=function(){a=0}}function SAEO_Parallel(){this.direct_write_status=function(e,t){SAER.cia.parallelack()},this.direct_read_status=function(){return SAER.cia.parallelack(),4},this.direct_write_data=function(e,t){SAEV_config.hook.parallel.put(e),SAER.cia.parallelack()},this.direct_read_data=function(){var e=255&SAEV_config.hook.parallel.get();return SAER.cia.parallelack(),e}}const SAEC_Custom_DMAF_AUD0EN=1,SAEC_Custom_DMAF_AUD1EN=2,SAEC_Custom_DMAF_AUD2EN=4,SAEC_Custom_DMAF_AUD3EN=8,SAEC_Custom_DMAF_DSKEN=16,SAEC_Custom_DMAF_SPREN=32,SAEC_Custom_DMAF_BLTEN=64,SAEC_Custom_DMAF_COPEN=128,SAEC_Custom_DMAF_BPLEN=256,SAEC_Custom_DMAF_DMAEN=512,SAEC_Custom_DMAF_BLTPRI=1024,SAEC_Custom_DMAF_BZERO=8192,SAEC_Custom_DMAF_BBUSY=16384,SAEC_Custom_DMAF_SETCLR=32768,SAEC_Custom_INTF_TBE=1,SAEC_Custom_INTF_DSKBLK=2,SAEC_Custom_INTF_VERTB=32,SAEC_Custom_INTF_BLIT=64,SAEC_Custom_INTF_RBF=2048,SAEC_Custom_INTF_DSKSYN=4096,SAEC_Custom_INTF_INTEN=16384,SAEC_Custom_INTF_SETCLR=32768;var SAER_Custom_put16_real=null,SAEV_Custom_bank=null,SAEV_Custom_dmacon=0,SAEV_Custom_intreq=0,SAEV_Custom_intena=0,SAEV_Custom_adkcon=0,SAEV_Custom_last_value=0;function SAEF_Custom_dmaen(e){return 0!=(SAEV_Custom_dmacon&e)&&0!=(SAEV_Custom_dmacon&SAEC_Custom_DMAF_DMAEN)}function SAEO_Custom(){var a=null,i=null,r=0,o=0;SAEC_Events_CYCLE_UNIT;function t(e){return SAER.playfield.decide_line(e),SAER.playfield.decide_fetch_safe(e),SAEV_Custom_dmacon&=-24577,SAEV_Custom_dmacon|=(SAEV_Blitter_interrupt||!SAEV_Blitter_interrupt&&SAEV_config.chipset.agnusBltBusyBug&&!SAER_Blitter_blt_info.got_cycle?0:16384)|(SAER_Blitter_blt_info.blitzero?8192:0)}function n(e,t){var n=SAEV_Custom_dmacon;SAER.playfield.decide_line(t),SAER.playfield.decide_fetch_safe(t),32768&e?SAEV_Custom_dmacon|=32767&e:SAEV_Custom_dmacon&=~e;var r=(SAEV_Custom_dmacon&=2047)^n,i=0!=(n&SAEC_Custom_DMAF_COPEN)&&0!=(n&SAEC_Custom_DMAF_DMAEN),e=0!=(SAEV_Custom_dmacon&SAEC_Custom_DMAF_COPEN)&&0!=(SAEV_Custom_dmacon&SAEC_Custom_DMAF_DMAEN);i!=e&&(e&&!i?SAER.copper.compute_spcflag_copper(t):e||SAER.copper.copper_stop()),(SAEV_Custom_dmacon&SAEC_Custom_DMAF_BLTPRI)>(n&SAEC_Custom_DMAF_BLTPRI)&&SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEF_setSpcFlags(SAEC_spcflag_BLTNASTY),SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&SAEV_Blitter_bltstate==SAEC_Blitter_bltstate_INIT&&SAER.blitter.blitter_check_start(),(SAEV_Custom_dmacon&(SAEC_Custom_DMAF_BLTPRI|SAEC_Custom_DMAF_BLTEN|SAEC_Custom_DMAF_DMAEN))!=(SAEC_Custom_DMAF_BLTPRI|SAEC_Custom_DMAF_BLTEN|SAEC_Custom_DMAF_DMAEN)&&SAEF_clrSpcFlags(SAEC_spcflag_BLTNASTY),r&(15|SAEC_Custom_DMAF_DMAEN)&&SAER.audio.state_machine(),r&(SAEC_Custom_DMAF_DMAEN|SAEC_Custom_DMAF_BPLEN)&&SAER.playfield.set_bitplane_maybe_start_hpos(t)}function s(){return SAEV_Custom_intreq}function c(){return SAEV_Custom_intena}function _(e,t){var n=SAEV_Custom_intena;32768&e?SAEV_Custom_intena|=32767&e:SAEV_Custom_intena&=~e,(32768&e||n!=SAEV_Custom_intena||SAEV_Custom_intena!=o)&&(o=SAEV_Custom_intena,32768&e&&SAER.m68k.doint())}function f(){return SAEV_Custom_adkcon}function l(e,t){SAEV_config.audio.mode!=SAEC_Config_Audio_Mode_Off&&SAER.audio.update(),SAER.disk.update(t),SAER.disk.update_adkcon(t,e),32768&e?SAEV_Custom_adkcon|=32767&e:SAEV_Custom_adkcon&=~e,SAER.audio.update_adkmasks()}function u(t,n,r){var i=!1;n&=4095;try{i=a[(510&n)>>1](t)}catch(e){if(!(e instanceof Error))throw e;if(i=SAEV_Custom_last_value,SAER.playfield.set_line_cyclebased(),!r){r=(SAEV_config.chipset.mask,SAEC_Config_Chipset_Mask_AGA,0);SAER.playfield.decide_line(t),SAER.playfield.decide_fetch_safe(t);A(t,n,r,!0);t=SAER.playfield.is_bitplane_dma(t);return i=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?t?65535&SAEV_Custom_last_value:SAEV_Custom_last_value>>>(2&n?0:16)&65535:t?65535&SAEV_Custom_last_value:65535}}return i}function d(e){var t=SAER.events.current_hpos();return SAER.copper.sync_copper_with_cpu(t,1),u(t,e,!1)}function p(e){return(65535&e)<32768&&0<=SAEV_config.chipset.fatGaryRev?SAER.memory.dummyGet(e,2,!1,0):1&e?d(e&=-2)<<8&65280|d(e+2)>>8:d(e)}function E(e){return(65535&e)<32768&&0<=SAEV_config.chipset.fatGaryRev?SAER.memory.dummyGet(e,4,!1,0):(p(e)<<16|p(e+2))>>>0}function A(t,n,e,r){n&=510,e&=65535;try{i[n>>1](e,t)}catch(e){if(!(e instanceof Error))throw e;return r||u(t,n,!0),!0}return!1}function S(e,t){var n=SAER.events.current_hpos();if((65535&e)<32768&&0<=SAEV_config.chipset.fatGaryRev)SAER.memory.dummyPut(e,2,t);else{if(SAER.copper.sync_copper_with_cpu(n,1),1&e)return A(n,e&=-2,t>>8|65280&t,0),void A(n,e+2,t<<8&65280|255&t,0);A(n,e,t,0)}}this.setup=function(){!function(){var e;for(a=new Array(256),e=0;e<a.length;e++)a[e]=!1;a[1]=t,a[2]=function(){return SAER.playfield.VPOSR()},a[3]=function(){return SAER.playfield.VHPOSR()},a[5]=function(){return SAER.input.JOY0DAT()},a[6]=function(){return SAER.input.JOY1DAT()},a[7]=function(){return SAER.playfield.CLXDAT()},a[8]=f,a[9]=function(){return SAER.input.POT0DAT()},a[10]=function(){return SAER.input.POT1DAT()},a[11]=function(){return SAER.input.POTGOR()},a[12]=function(){return SAER.serial.SERDATR()},a[13]=function(e){return SAER.disk.DSKBYTR(e)},a[14]=c,a[15]=s,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE&&(a[62]=function(){return SAER.playfield.DENISEID()});SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA&&(a[192]=function(){return SAER.playfield.COLOR_READ(0)},a[193]=function(){return SAER.playfield.COLOR_READ(1)},a[194]=function(){return SAER.playfield.COLOR_READ(2)},a[195]=function(){return SAER.playfield.COLOR_READ(3)},a[196]=function(){return SAER.playfield.COLOR_READ(4)},a[197]=function(){return SAER.playfield.COLOR_READ(5)},a[198]=function(){return SAER.playfield.COLOR_READ(6)},a[199]=function(){return SAER.playfield.COLOR_READ(7)},a[200]=function(){return SAER.playfield.COLOR_READ(8)},a[201]=function(){return SAER.playfield.COLOR_READ(9)},a[202]=function(){return SAER.playfield.COLOR_READ(10)},a[203]=function(){return SAER.playfield.COLOR_READ(11)},a[204]=function(){return SAER.playfield.COLOR_READ(12)},a[205]=function(){return SAER.playfield.COLOR_READ(13)},a[206]=function(){return SAER.playfield.COLOR_READ(14)},a[207]=function(){return SAER.playfield.COLOR_READ(15)},a[208]=function(){return SAER.playfield.COLOR_READ(16)},a[209]=function(){return SAER.playfield.COLOR_READ(17)},a[210]=function(){return SAER.playfield.COLOR_READ(18)},a[211]=function(){return SAER.playfield.COLOR_READ(19)},a[212]=function(){return SAER.playfield.COLOR_READ(20)},a[213]=function(){return SAER.playfield.COLOR_READ(21)},a[214]=function(){return SAER.playfield.COLOR_READ(22)},a[215]=function(){return SAER.playfield.COLOR_READ(23)},a[216]=function(){return SAER.playfield.COLOR_READ(24)},a[217]=function(){return SAER.playfield.COLOR_READ(25)},a[218]=function(){return SAER.playfield.COLOR_READ(26)},a[219]=function(){return SAER.playfield.COLOR_READ(27)},a[220]=function(){return SAER.playfield.COLOR_READ(28)},a[221]=function(){return SAER.playfield.COLOR_READ(29)},a[222]=function(){return SAER.playfield.COLOR_READ(30)},a[223]=function(){return SAER.playfield.COLOR_READ(31)})}(),function(){var e;for(i=new Array(256),e=0;e<i.length;e++)i[e]=!1;i[7]=function(e,t){SAER.playfield.CLXDAT()},i[16]=function(e,t){SAER.disk.DSKPTH(e)},i[17]=function(e,t){SAER.disk.DSKPTL(e)},i[18]=function(e,t){SAER.disk.DSKLEN(e,t)},i[19]=function(e,t){},i[20]=function(e,t){SAER.playfield.REFPTR(e)},i[21]=function(e,t){SAER.playfield.VPOSW(e)},i[22]=function(e,t){SAER.playfield.VHPOSW(e)},i[23]=function(e,t){SAER.copper.COPCON(e)},i[24]=function(e,t){SAER.serial.SERDAT(e)},i[25]=function(e,t){SAER.serial.SERPER(e)},i[26]=function(e,t){SAER.input.POTGO(e)},i[27]=function(e,t){SAER.input.JOYTEST(e)},i[32]=function(e,t){SAER.blitter.BLTCON0(t,e)},i[33]=function(e,t){SAER.blitter.BLTCON1(t,e)},i[34]=function(e,t){SAER.blitter.BLTAFWM(t,e)},i[35]=function(e,t){SAER.blitter.BLTALWM(t,e)},i[36]=function(e,t){SAER.blitter.BLTCPTH(t,e)},i[37]=function(e,t){SAER.blitter.BLTCPTL(t,e)},i[38]=function(e,t){SAER.blitter.BLTBPTH(t,e)},i[39]=function(e,t){SAER.blitter.BLTBPTL(t,e)},i[40]=function(e,t){SAER.blitter.BLTAPTH(t,e)},i[41]=function(e,t){SAER.blitter.BLTAPTL(t,e)},i[42]=function(e,t){SAER.blitter.BLTDPTH(t,e)},i[43]=function(e,t){SAER.blitter.BLTDPTL(t,e)},i[44]=function(e,t){SAER.blitter.BLTSIZE(t,e)},SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS&&(i[45]=function(e,t){SAER.blitter.BLTCON0L(t,e)},i[46]=function(e,t){SAER.blitter.BLTSIZV(t,e)},i[47]=function(e,t){SAER.blitter.BLTSIZH(t,e)});i[48]=function(e,t){SAER.blitter.BLTCMOD(t,e)},i[49]=function(e,t){SAER.blitter.BLTBMOD(t,e)},i[50]=function(e,t){SAER.blitter.BLTAMOD(t,e)},i[51]=function(e,t){SAER.blitter.BLTDMOD(t,e)},i[56]=function(e,t){SAER.blitter.BLTCDAT(t,e)},i[57]=function(e,t){SAER.blitter.BLTBDAT(t,e)},i[58]=function(e,t){SAER.blitter.BLTADAT(t,e)},i[63]=function(e,t){SAER.disk.DSKSYNC(t,e)},i[64]=function(e,t){SAER.copper.COP1LCH(e)},i[65]=function(e,t){SAER.copper.COP1LCL(e)},i[66]=function(e,t){SAER.copper.COP2LCH(e)},i[67]=function(e,t){SAER.copper.COP2LCL(e)},i[68]=function(e,t){SAER.copper.COPJMP(1,0)},i[69]=function(e,t){SAER.copper.COPJMP(2,0)},i[71]=function(e,t){SAER.playfield.DIWSTRT(t,e)},i[72]=function(e,t){SAER.playfield.DIWSTOP(t,e)},i[73]=function(e,t){SAER.playfield.DDFSTRT(t,e)},i[74]=function(e,t){SAER.playfield.DDFSTOP(t,e)},i[75]=n,i[76]=function(e,t){SAER.playfield.CLXCON(e)},i[77]=_,i[78]=function(e,t){SAER.custom.INTREQ(e)},i[79]=l,i[80]=function(e,t){SAER.audio.AUDxLCH(0,e)},i[81]=function(e,t){SAER.audio.AUDxLCL(0,e)},i[82]=function(e,t){SAER.audio.AUDxLEN(0,e)},i[83]=function(e,t){SAER.audio.AUDxPER(0,e)},i[84]=function(e,t){SAER.audio.AUDxVOL(0,e)},i[85]=function(e,t){SAER.audio.AUDxDAT(0,e)},i[88]=function(e,t){SAER.audio.AUDxLCH(1,e)},i[89]=function(e,t){SAER.audio.AUDxLCL(1,e)},i[90]=function(e,t){SAER.audio.AUDxLEN(1,e)},i[91]=function(e,t){SAER.audio.AUDxPER(1,e)},i[92]=function(e,t){SAER.audio.AUDxVOL(1,e)},i[93]=function(e,t){SAER.audio.AUDxDAT(1,e)},i[96]=function(e,t){SAER.audio.AUDxLCH(2,e)},i[97]=function(e,t){SAER.audio.AUDxLCL(2,e)},i[98]=function(e,t){SAER.audio.AUDxLEN(2,e)},i[99]=function(e,t){SAER.audio.AUDxPER(2,e)},i[100]=function(e,t){SAER.audio.AUDxVOL(2,e)},i[101]=function(e,t){SAER.audio.AUDxDAT(2,e)},i[104]=function(e,t){SAER.audio.AUDxLCH(3,e)},i[105]=function(e,t){SAER.audio.AUDxLCL(3,e)},i[106]=function(e,t){SAER.audio.AUDxLEN(3,e)},i[107]=function(e,t){SAER.audio.AUDxPER(3,e)},i[108]=function(e,t){SAER.audio.AUDxVOL(3,e)},i[109]=function(e,t){SAER.audio.AUDxDAT(3,e)},i[112]=function(e,t){SAER.playfield.BPLxPTH(t,e,0)},i[113]=function(e,t){SAER.playfield.BPLxPTL(t,e,0)},i[114]=function(e,t){SAER.playfield.BPLxPTH(t,e,1)},i[115]=function(e,t){SAER.playfield.BPLxPTL(t,e,1)},i[116]=function(e,t){SAER.playfield.BPLxPTH(t,e,2)},i[117]=function(e,t){SAER.playfield.BPLxPTL(t,e,2)},i[118]=function(e,t){SAER.playfield.BPLxPTH(t,e,3)},i[119]=function(e,t){SAER.playfield.BPLxPTL(t,e,3)},i[120]=function(e,t){SAER.playfield.BPLxPTH(t,e,4)},i[121]=function(e,t){SAER.playfield.BPLxPTL(t,e,4)},i[122]=function(e,t){SAER.playfield.BPLxPTH(t,e,5)},i[123]=function(e,t){SAER.playfield.BPLxPTL(t,e,5)},SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA&&(i[124]=function(e,t){SAER.playfield.BPLxPTH(t,e,6)},i[125]=function(e,t){SAER.playfield.BPLxPTL(t,e,6)},i[126]=function(e,t){SAER.playfield.BPLxPTH(t,e,7)},i[127]=function(e,t){SAER.playfield.BPLxPTL(t,e,7)});i[128]=function(e,t){SAER.playfield.BPLCON0(t,e)},i[129]=function(e,t){SAER.playfield.BPLCON1(t,e)},i[130]=function(e,t){SAER.playfield.BPLCON2(t,e)},SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE&&(i[131]=function(e,t){SAER.playfield.BPLCON3(t,e)});i[132]=function(e,t){SAER.playfield.BPL1MOD(t,e)},i[133]=function(e,t){SAER.playfield.BPL2MOD(t,e)},SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA&&(i[134]=function(e,t){SAER.playfield.BPLCON4(t,e)},i[135]=function(e,t){SAER.playfield.CLXCON2(e)});i[136]=function(e,t){SAER.playfield.BPLxDAT(t,0,e)},i[137]=function(e,t){SAER.playfield.BPLxDAT(t,1,e)},i[138]=function(e,t){SAER.playfield.BPLxDAT(t,2,e)},i[139]=function(e,t){SAER.playfield.BPLxDAT(t,3,e)},i[140]=function(e,t){SAER.playfield.BPLxDAT(t,4,e)},i[141]=function(e,t){SAER.playfield.BPLxDAT(t,5,e)},SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA&&(i[142]=function(e,t){SAER.playfield.BPLxDAT(t,6,e)},i[143]=function(e,t){SAER.playfield.BPLxDAT(t,7,e)});i[144]=function(e,t){SAER.playfield.SPRxPTH(t,e,0)},i[145]=function(e,t){SAER.playfield.SPRxPTL(t,e,0)},i[146]=function(e,t){SAER.playfield.SPRxPTH(t,e,1)},i[147]=function(e,t){SAER.playfield.SPRxPTL(t,e,1)},i[148]=function(e,t){SAER.playfield.SPRxPTH(t,e,2)},i[149]=function(e,t){SAER.playfield.SPRxPTL(t,e,2)},i[150]=function(e,t){SAER.playfield.SPRxPTH(t,e,3)},i[151]=function(e,t){SAER.playfield.SPRxPTL(t,e,3)},i[152]=function(e,t){SAER.playfield.SPRxPTH(t,e,4)},i[153]=function(e,t){SAER.playfield.SPRxPTL(t,e,4)},i[154]=function(e,t){SAER.playfield.SPRxPTH(t,e,5)},i[155]=function(e,t){SAER.playfield.SPRxPTL(t,e,5)},i[156]=function(e,t){SAER.playfield.SPRxPTH(t,e,6)},i[157]=function(e,t){SAER.playfield.SPRxPTL(t,e,6)},i[158]=function(e,t){SAER.playfield.SPRxPTH(t,e,7)},i[159]=function(e,t){SAER.playfield.SPRxPTL(t,e,7)},i[160]=function(e,t){SAER.playfield.SPRxPOS(t,e,0)},i[161]=function(e,t){SAER.playfield.SPRxCTL(t,e,0)},i[162]=function(e,t){SAER.playfield.SPRxDATA(t,e,0)},i[163]=function(e,t){SAER.playfield.SPRxDATB(t,e,0)},i[164]=function(e,t){SAER.playfield.SPRxPOS(t,e,1)},i[165]=function(e,t){SAER.playfield.SPRxCTL(t,e,1)},i[166]=function(e,t){SAER.playfield.SPRxDATA(t,e,1)},i[167]=function(e,t){SAER.playfield.SPRxDATB(t,e,1)},i[168]=function(e,t){SAER.playfield.SPRxPOS(t,e,2)},i[169]=function(e,t){SAER.playfield.SPRxCTL(t,e,2)},i[170]=function(e,t){SAER.playfield.SPRxDATA(t,e,2)},i[171]=function(e,t){SAER.playfield.SPRxDATB(t,e,2)},i[172]=function(e,t){SAER.playfield.SPRxPOS(t,e,3)},i[173]=function(e,t){SAER.playfield.SPRxCTL(t,e,3)},i[174]=function(e,t){SAER.playfield.SPRxDATA(t,e,3)},i[175]=function(e,t){SAER.playfield.SPRxDATB(t,e,3)},i[176]=function(e,t){SAER.playfield.SPRxPOS(t,e,4)},i[177]=function(e,t){SAER.playfield.SPRxCTL(t,e,4)},i[178]=function(e,t){SAER.playfield.SPRxDATA(t,e,4)},i[179]=function(e,t){SAER.playfield.SPRxDATB(t,e,4)},i[180]=function(e,t){SAER.playfield.SPRxPOS(t,e,5)},i[181]=function(e,t){SAER.playfield.SPRxCTL(t,e,5)},i[182]=function(e,t){SAER.playfield.SPRxDATA(t,e,5)},i[183]=function(e,t){SAER.playfield.SPRxDATB(t,e,5)},i[184]=function(e,t){SAER.playfield.SPRxPOS(t,e,6)},i[185]=function(e,t){SAER.playfield.SPRxCTL(t,e,6)},i[186]=function(e,t){SAER.playfield.SPRxDATA(t,e,6)},i[187]=function(e,t){SAER.playfield.SPRxDATB(t,e,6)},i[188]=function(e,t){SAER.playfield.SPRxPOS(t,e,7)},i[189]=function(e,t){SAER.playfield.SPRxCTL(t,e,7)},i[190]=function(e,t){SAER.playfield.SPRxDATA(t,e,7)},i[191]=function(e,t){SAER.playfield.SPRxDATB(t,e,7)},i[192]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,0)},i[193]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,1)},i[194]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,2)},i[195]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,3)},i[196]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,4)},i[197]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,5)},i[198]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,6)},i[199]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,7)},i[200]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,8)},i[201]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,9)},i[202]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,10)},i[203]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,11)},i[204]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,12)},i[205]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,13)},i[206]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,14)},i[207]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,15)},i[208]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,16)},i[209]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,17)},i[210]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,18)},i[211]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,19)},i[212]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,20)},i[213]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,21)},i[214]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,22)},i[215]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,23)},i[216]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,24)},i[217]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,25)},i[218]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,26)},i[219]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,27)},i[220]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,28)},i[221]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,29)},i[222]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,30)},i[223]=function(e,t){SAER.playfield.COLOR_WRITE(t,4095&e,31)},SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS&&(i[224]=function(e,t){SAER.playfield.HTOTAL(e)},i[225]=function(e,t){SAER.playfield.HSSTOP(e)},i[226]=function(e,t){SAER.playfield.HBSTRT(e)},i[227]=function(e,t){SAER.playfield.HBSTOP(e)},i[228]=function(e,t){SAER.playfield.VTOTAL(e)},i[229]=function(e,t){SAER.playfield.VSSTOP(e)},i[230]=function(e,t){SAER.playfield.VBSTRT(e)},i[231]=function(e,t){SAER.playfield.VBSTOP(e)},i[238]=function(e,t){SAER.playfield.BEAMCON0(e)},i[239]=function(e,t){SAER.playfield.HSSTRT(e)},i[240]=function(e,t){SAER.playfield.VSSTRT(e)},i[241]=function(e,t){SAER.playfield.HCENTER(e)});SAEV_config.chipset.mask&(SAEC_Config_Chipset_Mask_ECS_AGNUS|SAEC_Config_Chipset_Mask_ECS_DENISE)&&(i[242]=function(e,t){SAER.playfield.DIWHIGH(t,e)});SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA&&(i[254]=function(e,t){SAER.playfield.FMODE(t,e)});i[255]=function(e,t){SAER.playfield.FNULL(e)}}()},this.reset=function(){SAEV_Custom_intena=o=SAEV_Custom_dmacon=0,r=0},this.INTREQ_0=function(e){var t=SAEV_Custom_intreq;32768&e?SAEV_Custom_intreq|=32767&e:SAEV_Custom_intreq&=~e,t&SAEC_Custom_INTF_RBF&&!(SAEV_Custom_intreq&SAEC_Custom_INTF_RBF)&&SAER.serial.rbf_clear();var n=r;return(t!=(r=SAEV_Custom_intreq)||n!=r)&&(32768&e&&SAER.m68k.doint(),!0)},this.INTREQ=function(e){this.INTREQ_0(e)&&(SAEV_config.serial.enabled&&SAER.serial.check_irq(),SAER.devices.rethink())},this.send_interrupt=function(e,t){this.INTREQ_0(SAEC_Custom_INTF_SETCLR|e)},this.intlev=function(){var e=r&o;if(e&&o&SAEC_Custom_INTF_INTEN){if(24576&e)return 6;if(6144&e)return 5;if(1920&e)return 4;if(112&e)return 3;if(8&e)return 2;if(7&e)return 1}return-1},SAER_Custom_put16_real=A,SAEV_Custom_bank=new SAEO_Memory_addrbank(E,p,function(e){return(65535&e)<32768&&0<=SAEV_config.chipset.fatGaryRev?SAER.memory.dummyGet(e,1,!1,0):d(-2&e)>>(1&e?0:8)&255},function(e,t){(65535&e)<32768&&0<=SAEV_config.chipset.fatGaryRev?SAER.memory.dummyPut(e,4,t):(S(65534&e,t>>>16),S(e+2&65534,65535&t))},S,function(e,t){(65535&e)<32768&&0<=SAEV_config.chipset.fatGaryRev?SAER.memory.dummyPut(e,1,t):S(-2&e,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA&&1&e?255&t:t<<8|255&t)},SAEF_Memory_defaultXLate,SAEF_Memory_defaultCheck,null,null,"Custom chipset",function(e){return(SAEV_config.cpu.model>=SAEC_Config_CPU_Model_68020?SAEF_Memory_dummyGetInst32:E)(e)},function(e){return(SAEV_config.cpu.model>=SAEC_Config_CPU_Model_68020?SAEF_Memory_dummyGetInst16:p)(e)},SAEC_Memory_addrbank_flag_IO,null,511,14675968)}function SAEO_Devices(){this.virtualdevice_init=function(){SAER.autoconf.init(),SAER.autoconf.setup(),SAER.expansion.setup()},this.reset=function(e){SAER.gayle.reset(e),SAER.memory.a1000_reset(),SAER.disk.reset(),SAER.cia.reset(),SAER.gayle.reset(0),SAER.expansion.reset(),SAER.autoconf.reset()},this.vsync_pre=function(){SAER.cia.vsync(),SAER.input.vsync()},this.vsync_post=function(){},this.hsync=function(e){SAER.blitter.decide_blitter(-1),SAER.disk.hsync(),SAEV_config.audio.mode!=SAEC_Config_Audio_Mode_Off&&SAER.audio.hsync(),SAEV_config.serial.enabled&&SAER.serial.hsync(),(0<=SAEV_config.chipset.ide||SAEV_config.chipset.pcmcia)&&SAER.gayle.hsync()},this.rethink=function(){SAER.cia.rethink(),SAER.gayle.rethink()},this.update_sound=function(e,t){SAER.audio.update_sound(e)}}var SAER_Blitter_blt_info=null;const SAEC_Blitter_bltstate_DONE=0,SAEC_Blitter_bltstate_INIT=1,SAEC_Blitter_bltstate_READ=2,SAEC_Blitter_bltstate_WORK=3,SAEC_Blitter_bltstate_WRITE=4,SAEC_Blitter_bltstate_NEXT=5;var SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_DONE,SAEV_Blitter_interrupt=!1,SAEV_Blitter_dangerous=!1;function SAEO_Blitter(){const o=[[2,0,0,0,0],[2,0,0,0,4],[2,0,3,0,3],[3,0,3,0,0,3,4],[3,0,2,0,0,2,0],[3,0,2,0,0,2,4],[3,0,2,3,0,2,3],[4,0,2,3,0,0,2,3,4],[2,1,0,1,0],[2,1,0,1,4],[2,1,3,1,3],[3,1,3,0,1,3,4],[3,1,2,0,1,2,0],[3,1,2,0,1,2,4],[3,1,2,3,1,2,3],[4,1,2,3,0,1,2,3,4]],s=[[0],[3,0,0,0,0,4,0],[0],[0],[0],[4,0,2,0,0,0,2,4,0],[0],[0],[0],[3,1,0,0,1,4,0],[0],[0],[0],[4,1,2,0,0,1,2,4,0],[0],[0]],c=[4,0,3,5,4,0,3,5,4],e=[2,0,4,0,4],t=[2,0,0,0,0],_=1,f=2,l=3;var A=new function(){this.blitzero=0,this.blitashift=0,this.blitbshift=0,this.blitdownashift=0,this.blitdownbshift=0,this.bltadat=0,this.bltbdat=0,this.bltcdat=0,this.bltddat=0,this.bltahold=0,this.bltbhold=0,this.bltafwm=0,this.bltalwm=0,this.vblitsize=0,this.hblitsize=0,this.bltamod=0,this.bltbmod=0,this.bltcmod=0,this.bltdmod=0,this.got_cycle=0};SAER_Blitter_blt_info=A;var u=!1,i=!1,S=0,m=0,h=0,g=0,y=0,v=0,n=0,r=0,a=0,d=0,p=0,E=0,b=0,C=0,k=0,R=0,w=0,x=0,D=0,M=0,F=0,T=0,V=!1,I=0,P=0,z=0,O=0,L=0,N=0,B=0,U=null,K=null,G=null,H=0,X=0,q=0,Z=0,j=0,Y=0,W=0,J=0,Q=0,$=0,ee=0,te=null,ne=0,re=0,ie=0,ae=0,oe=0,se=0,ce=0,_e=0,fe=0,le=0,ue=0,de=0;const pe=2;var Ee=0,Ae=0,Se=0,me=0,he=0,ge=0,ye=0,ve=0,be=0,Ce=0,ke=0,Re=new Uint8Array(1024),we=10,xe=10,De=10;function Me(){if(ie)switch(ne){case _:return o[0];case f:return s[0];case l:return c;default:return o[0]}return ae?k||ee?t:e:te}function Fe(e){if(e<0)return 0;var t=Me();return e<t[0]?t[1+e]:(e-=t[0],e%=t[0],t[1+t[0]+e])}function Te(e){return SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)?SAER.playfield.is_bitplane_dma(e)?0:1:-1}function Ve(){if(!(r<0))switch(r=-1,a){case 1:h=n;break;case 2:g=n;break;case 3:y=n;break;case 4:v=n}}function Ie(e,t){r==e&&t==a&&(r=-1,SAEF_warn("blitter.check_channel_mods() %08x write to %d ignored!",n,t))}function Pe(e,t){SAEV_Blitter_interrupt||!t&&(!u||i||SAEV_config.cpu.speed<0||SAEV_config.cpu.model>=SAEC_Config_CPU_Model_68030)||(SAEV_Blitter_interrupt=!0,SAER.custom.send_interrupt(SAEC_Custom_INTF_BLIT,4*SAEC_Events_CYCLE_UNIT))}function ze(e){_e=fe=0,SAEV_Blitter_bltstate=0==j||!u||i?SAEC_Blitter_bltstate_DONE:SAEC_Blitter_bltstate_INIT,Pe(0,1),SAER.copper.blitter_done_notify(e),SAER.events.event2_remevent(SAEC_Events_EV2_BLITTER),SAEF_clrSpcFlags(SAEC_spcflag_BLTNASTY),SAEV_Blitter_dangerous=!1}function Oe(){if(512&S){if(!SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN))return;A.bltcdat=SAER_Memory_chipData[y]<<8|SAER_Memory_chipData[y+1],SAEV_Custom_last_value=A.bltcdat}SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_WORK}function Le(){if(A.bltddat&&(A.blitzero=0),512&S){if(!SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN))return;SAER_Memory_chipData[v]=A.bltddat>>8,SAER_Memory_chipData[v+1]=255&A.bltddat}SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_NEXT}function Ne(){var e=(b&A.bltafwm)>>E,t=A.bltcdat;A.bltbhold=1&C?65535:0,I=!D||D&&!T,A.bltddat=65535&U[255&S](e,A.bltbhold,t),T++}function Be(){2048&S&&(h+=V?A.bltbmod:A.bltamod),V||(16&m?T=(8&m?y-=A.bltcmod:y+=A.bltcmod,0):8&m?0==E--&&(E=15,y-=2):16==++E&&(E=0,y+=2)),16&m?4&m?0==E--&&(E=15,y-=2):16==++E&&(E=0,y+=2):T=(4&m?y-=A.bltcmod:y+=A.bltcmod,0),V=0!=(32768&h),SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_WRITE}function Ue(){C=65535&(C<<1|C>>15),A.vblitsize--,SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_READ}function Ke(){if(k){for(;Oe(),_e&&(v=y),_e=1,Ne(),Be(),Ue(),I&&(Le(),I=0),(SAEV_Blitter_bltstate=0==A.vblitsize?SAEC_Blitter_bltstate_DONE:SAEV_Blitter_bltstate)!=SAEC_Blitter_bltstate_DONE;);v=y}else(M?function(){var e,t=0,n=0,r=0,i=0,a=255&S;if(G[0]=A.bltafwm,G[A.hblitsize-1]&=A.bltalwm,2048&S&&(t=h,h-=(2*A.hblitsize+A.bltamod)*A.vblitsize),1024&S&&(n=g,g-=(2*A.hblitsize+A.bltbmod)*A.vblitsize),512&S&&(r=y,y-=(2*A.hblitsize+A.bltcmod)*A.vblitsize),256&S&&(i=v,v-=(2*A.hblitsize+A.bltdmod)*A.vblitsize),0===$e[a]||w){for(var o,s,c,_,f=A.bltbhold,l=0,u=0,d=0,p=0,E=0;E<A.vblitsize;E++){for(R=!!(4&m),e=0;e<A.hblitsize;e++)t?(A.bltadat=o=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t-=2):o=A.bltadat,_=((o&=G[e])<<16|l)>>>0>>>A.blitdownashift,l=o,n&&(A.bltbdat=c=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n-=2,f=(c<<16|u)>>>0>>>A.blitdownbshift,u=c),r&&(A.bltcdat=SAER_Memory_chipData[r]<<8|SAER_Memory_chipData[r+1],r-=2),p&&(SAER_Memory_chipData[d]=A.bltddat>>8,SAER_Memory_chipData[d+1]=255&A.bltddat),A.bltddat=65535&U[a](_,f,A.bltcdat),w&&(s=A.bltddat,c=x?2:0,_=K[255&s][c+R][1],A.bltddat=K[255&s][c+R][0]+(K[s>>8][c+_][0]<<8),R=K[s>>8][c+_][1]),A.bltddat&&(A.blitzero=0),i&&(d=i,p=1,i-=2);t&&(t-=A.bltamod),n&&(n-=A.bltbmod),r&&(r-=A.bltcmod),i&&(i-=A.bltdmod)}p&&(SAER_Memory_chipData[d]=A.bltddat>>8,SAER_Memory_chipData[d+1]=255&A.bltddat),A.bltbhold=f}else $e[a](t,n,r,i,A);G[0]=65535,G[A.hblitsize-1]=65535,SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_DONE}:function(){var e,t=0,n=0,r=0,i=0,a=255&S;if(G[0]=A.bltafwm,G[A.hblitsize-1]&=A.bltalwm,2048&S&&(t=h,h+=(2*A.hblitsize+A.bltamod)*A.vblitsize),1024&S&&(n=g,g+=(2*A.hblitsize+A.bltbmod)*A.vblitsize),512&S&&(r=y,y+=(2*A.hblitsize+A.bltcmod)*A.vblitsize),256&S&&(i=v,v+=(2*A.hblitsize+A.bltdmod)*A.vblitsize),0===Qe[a]||w){for(var o,s,c,_,f=A.bltbhold,l=0,u=0,d=0,p=0,E=0;E<A.vblitsize;E++){for(R=!!(4&m),e=0;e<A.hblitsize;e++)t?(A.bltadat=o=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t+=2):o=A.bltadat,_=(l<<16|(o&=G[e]))>>>0>>>A.blitashift,l=o,n&&(A.bltbdat=c=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n+=2,f=(u<<16|c)>>>0>>>A.blitbshift,u=c),r&&(A.bltcdat=SAER_Memory_chipData[r]<<8|SAER_Memory_chipData[r+1],r+=2),p&&(SAER_Memory_chipData[d]=A.bltddat>>8,SAER_Memory_chipData[d+1]=255&A.bltddat),A.bltddat=65535&U[a](_,f,A.bltcdat),w&&(s=A.bltddat,c=x?2:0,_=K[255&s][c+R][1],A.bltddat=K[255&s][c+R][0]+(K[s>>8][c+_][0]<<8),R=K[s>>8][c+_][1]),A.bltddat&&(A.blitzero=0),i&&(p=1,d=i,i+=2);t&&(t+=A.bltamod),n&&(n+=A.bltbmod),r&&(r+=A.bltcmod),i&&(i+=A.bltdmod)}p&&(SAER_Memory_chipData[d]=A.bltddat>>8,SAER_Memory_chipData[d+1]=255&A.bltddat),A.bltbhold=f}else Qe[a](t,n,r,i,A);G[0]=65535,G[A.hblitsize-1]=65535,SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_DONE})(),SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_DONE}function Ge(){0==A.vblitsize||k&&2!=A.hblitsize||Ke(),ze(SAER.events.current_hpos())}function He(){var e,t,n,r=A.bltadat;return 0==Ae&&(r&=A.bltafwm),Ae==A.hblitsize-1&&(r&=A.bltalwm),t=M?(r<<16|le)>>>0>>>A.blitdownashift:(le<<16|r)>>>0>>>A.blitashift,le=r,n=65535&U[255&S](t,A.bltbhold,A.bltcdat),24&m&&(e=x?2:0,t=K[255&(r=n)][e+R][1],n=K[255&r][e+R][0]+(K[r>>8][e+t][0]<<8),R=K[r>>8][e+t][1]),n&&(A.blitzero=0),n}function Xe(e){var t,n,r=ne;if(2&e&&(M=2&m,A.blitbshift=m>>12,A.blitdownbshift=16-A.blitbshift,1&m&&!F))SAEF_warn("blitter.blit_bltset() linedraw enabled after starting normal blit!");else{1&e&&(A.blitashift=S>>12,A.blitdownashift=16-A.blitashift),B=(3840&S)>>8,k=1&m,w=!!(24&m),SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_INIT&&k&&F&&(k=0,SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_DONE,SAEV_Blitter_interrupt=!0,SAEF_warn("blitter.blit_bltset() register modification during linedraw!")),ne=k?(te=c,l):(2&e&&(R=!!(4&m),x=24==(24&m)?0:!!(8&m)),w&&s[B][0]?(te=s[B],f):(te=o[B],_)),SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_INIT&&(n=ne==f,(t=r==f)!=n&&0<we&&(SAEF_warn("blitter.blit_bltset() on the fly %d (%d) -> %d (%d) switch!",d,t,B,n),we--),p==n?re=0:t&&!n?(re=1,SAEF_warn("blitter.blit_bltset() frozen! %d (%d) -> %d (%d)",d,t,B,n)):!t&&n&&(SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)||(re=1))),SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_INIT&&((t=d+(p?16:0))!=(n=B+(w?16:0))&&Re[32*t+n]<10&&(Re[32*t+n]++,SAEF_warn("blitter.blit_bltset() channel mode changed while active (%02x->%02x)",t,n)),13==B&&1==d&&(ie=1)),ie&&(B=0,te=o[B],ne=_),Q=$=0,ee=1;for(var i=0;i<te[0];i++){var a=te[1+te[0]+i];a<=4&&Q++,0<a&&a<4&&$++,4==a&&(ee=0)}0==$&&(_e=fe=0)}}function qe(){P=M?-2:2;var e=M?-1:1;z=e*A.bltamod,O=e*A.bltbmod,L=e*A.bltcmod,N=e*A.bltdmod}function Ze(e){1&e&&(E=S>>12),2&e&&(V=!!(64&m)),SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&(e&&Xe(e),qe())}function je(){for(var e=!1;SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN);)e=!0,SAER.events.do_cycles(8*SAEC_Events_CYCLE_UNIT);return xe&&e&&(xe--,SAEF_warn("blitter.waitingblits() waiting blits detected")),SAEV_Blitter_bltstate==SAEC_Blitter_bltstate_DONE}function Ye(){A.blitzero=1,re=ue=le=0,F=1&m,Xe(3),qe(),_e=fe=0,SAEV_Blitter_interrupt=!1,k&&(b=A.bltadat,C=A.bltbdat>>A.blitbshift|A.bltbdat<<16-A.blitbshift&65535,I=T=0,D=2&m)}function We(e,t){SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&u?SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&A.got_cycle&&(j=pe,X=t):function(e,t){var n,r=0;if(SAEV_Blitter_bltstate==SAEC_Blitter_bltstate_DONE&&(0<ie&&(ie=0),r=1),SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_DONE,u=SAEV_config.chipset.blitter.cycle_exact,i=SAEV_config.chipset.blitter.immediate,A.got_cycle=0,de=e+1,Y=W=SAEV_Events_currcycle,H=q=J=0,Ye(),k?n=A.vblitsize:(n=A.vblitsize*A.hblitsize,Y=W+te[0]*A.hblitsize*SAEC_Events_CYCLE_UNIT+SAEV_CPU_cycles),r&&(d=B,p=w,0),SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_INIT,Z=0,SAEF_clrSpcFlags(SAEC_spcflag_BLTNASTY),SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTPRI)&&SAEF_setSpcFlags(SAEC_spcflag_BLTNASTY),SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&(SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_WORK),q=2147483647,X=0,u)return i?SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&Ge():(Ae=Se=0,me=he=0,ee&&(he=A.vblitsize),H=-pe,X=t,j=0,q=A.hblitsize*A.vblitsize+2);0==A.vblitsize||k&&2!=A.hblitsize?SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&ze(e):(SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&(A.got_cycle=1),i?SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&Ge():(H=n*($+(ee?0:1)),SAER.events.event2_newevent(SAEC_Events_EV2_BLITTER,H,0),SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&SAEV_config.chipset.blitter.waiting&&Q==te[0]&&SAEV_spcflags&SAEC_spcflag_BLTNASTY&&je()))}(e,t)}function Je(e,t){if(Ve(),SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE){if(SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)){var n=!1;if(3==SAEV_config.chipset.blitter.waiting?n=!0:2==SAEV_config.chipset.blitter.waiting?Q==te[0]&&SAEV_spcflags&SAEC_spcflag_BLTNASTY&&(n=!0):1==SAEV_config.chipset.blitter.waiting&&(Q==te[0]&&SAEV_spcflags&SAEC_spcflag_BLTNASTY||SAEV_config.cpu.speed<0)&&(n=!0),n&&je())return}De&&SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&A.got_cycle&&(De--,SAEF_warn("blitter.maybe_blit() program does not wait for blitter")),u?SAER.blitter.decide_blitter(e):1==t&&SAEV_Events_currcycle-Y<0||SAER.blitter.handler(0)}}this.setup=function(){var e;return function(){if(null===G){G=new Uint32Array(2048);for(var e=0;e<G.length;e++)G[e]=65535;K=new Array(256);for(var t=0;t<256;t++){K[t]=new Array(4);for(e=0;e<4;e++){var n=1&e,r=t;K[t][e]=new Uint8Array(2);for(var i=1;256!=i;i<<=1){var a=r;n&&(2&e?r|=i:r^=i),a&i&&(n=!n)}K[t][e][0]=r,K[t][e][1]=n}}}}(),null===U&&(e=0,(U=new Array(256))[e++]=function(e,t,n){return 0},U[e++]=function(e,t,n){return~n&~t&~e},U[e++]=function(e,t,n){return n&~t&~e},U[e++]=function(e,t,n){return~t&~e},U[e++]=function(e,t,n){return~n&t&~e},U[e++]=function(e,t,n){return~n&~e},U[e++]=function(e,t,n){return n&~t&~e|~n&t&~e},U[e++]=function(e,t,n){return~t&~e|~n&~e},U[e++]=function(e,t,n){return n&t&~e},U[e++]=function(e,t,n){return~n&~t&~e|n&t&~e},U[e++]=function(e,t,n){return n&~e},U[e++]=function(e,t,n){return~t&~e|n&~e},U[e++]=function(e,t,n){return t&~e},U[e++]=function(e,t,n){return~n&~e|t&~e},U[e++]=function(e,t,n){return n&~e|t&~e},U[e++]=function(e,t,n){return~e},U[e++]=function(e,t,n){return~n&~t&e},U[e++]=function(e,t,n){return~n&~t},U[e++]=function(e,t,n){return n&~t&~e|~n&~t&e},U[e++]=function(e,t,n){return~t&~e|~n&~t},U[e++]=function(e,t,n){return~n&t&~e|~n&~t&e},U[e++]=function(e,t,n){return~n&~e|~n&~t},U[e++]=function(e,t,n){return n&~t&~e|~n&t&~e|~n&~t&e},U[e++]=function(e,t,n){return~t&~e|~n&~e|~n&~t},U[e++]=function(e,t,n){return n&t&~e|~n&~t&e},U[e++]=function(e,t,n){return~n&~t|n&t&~e},U[e++]=function(e,t,n){return n&~e|~n&~t&e},U[e++]=function(e,t,n){return~t&~e|n&~e|~n&~t},U[e++]=function(e,t,n){return t&~e|~n&~t&e},U[e++]=function(e,t,n){return~n&~e|t&~e|~n&~t},U[e++]=function(e,t,n){return n&~e|t&~e|~n&~t&e},U[e++]=function(e,t,n){return~e|~n&~t},U[e++]=function(e,t,n){return n&~t&e},U[e++]=function(e,t,n){return~n&~t&~e|n&~t&e},U[e++]=function(e,t,n){return n&~t},U[e++]=function(e,t,n){return~t&~e|n&~t},U[e++]=function(e,t,n){return~n&t&~e|n&~t&e},U[e++]=function(e,t,n){return~n&~e|n&~t&e},U[e++]=function(e,t,n){return n&~t|~n&t&~e},U[e++]=function(e,t,n){return~t&~e|~n&~e|n&~t},U[e++]=function(e,t,n){return n&t&~e|n&~t&e},U[e++]=function(e,t,n){return~n&~t&~e|n&t&~e|n&~t&e},U[e++]=function(e,t,n){return n&~e|n&~t},U[e++]=function(e,t,n){return~t&~e|n&~e|n&~t},U[e++]=function(e,t,n){return t&~e|n&~t&e},U[e++]=function(e,t,n){return~n&~e|t&~e|n&~t&e},U[e++]=function(e,t,n){return n&~e|t&~e|n&~t},U[e++]=function(e,t,n){return~e|n&~t},U[e++]=function(e,t,n){return~t&e},U[e++]=function(e,t,n){return~n&~t|~t&e},U[e++]=function(e,t,n){return n&~t|~t&e},U[e++]=function(e,t,n){return~t},U[e++]=function(e,t,n){return~n&t&~e|~t&e},U[e++]=function(e,t,n){return~n&~e|~t&e},U[e++]=function(e,t,n){return n&~t|~n&t&~e|~t&e},U[e++]=function(e,t,n){return~t|~n&~e},U[e++]=function(e,t,n){return n&t&~e|~t&e},U[e++]=function(e,t,n){return~n&~t|n&t&~e|~t&e},U[e++]=function(e,t,n){return n&~e|~t&e},U[e++]=function(e,t,n){return~t|n&~e},U[e++]=function(e,t,n){return t&~e|~t&e},U[e++]=function(e,t,n){return~n&~e|t&~e|~t&e},U[e++]=function(e,t,n){return n&~e|t&~e|~t&e},U[e++]=function(e,t,n){return~e|~t},U[e++]=function(e,t,n){return~n&t&e},U[e++]=function(e,t,n){return~n&~t&~e|~n&t&e},U[e++]=function(e,t,n){return n&~t&~e|~n&t&e},U[e++]=function(e,t,n){return~t&~e|~n&t&e},U[e++]=function(e,t,n){return~n&t},U[e++]=function(e,t,n){return~n&~e|~n&t},U[e++]=function(e,t,n){return n&~t&~e|~n&t},U[e++]=function(e,t,n){return~t&~e|~n&~e|~n&t},U[e++]=function(e,t,n){return n&t&~e|~n&t&e},U[e++]=function(e,t,n){return~n&~t&~e|n&t&~e|~n&t&e},U[e++]=function(e,t,n){return n&~e|~n&t&e},U[e++]=function(e,t,n){return~t&~e|n&~e|~n&t&e},U[e++]=function(e,t,n){return t&~e|~n&t},U[e++]=function(e,t,n){return~n&~e|t&~e|~n&t},U[e++]=function(e,t,n){return n&~e|t&~e|~n&t},U[e++]=function(e,t,n){return~e|~n&t},U[e++]=function(e,t,n){return~n&e},U[e++]=function(e,t,n){return~n&~t|~n&e},U[e++]=function(e,t,n){return n&~t&~e|~n&e},U[e++]=function(e,t,n){return~t&~e|~n&e},U[e++]=function(e,t,n){return~n&t|~n&e},U[e++]=function(e,t,n){return~n},U[e++]=function(e,t,n){return n&~t&~e|~n&t|~n&e},U[e++]=function(e,t,n){return~t&~e|~n},U[e++]=function(e,t,n){return n&t&~e|~n&e},U[e++]=function(e,t,n){return~n&~t|n&t&~e|~n&e},U[e++]=function(e,t,n){return n&~e|~n&e},U[e++]=function(e,t,n){return~t&~e|n&~e|~n&e},U[e++]=function(e,t,n){return t&~e|~n&e},U[e++]=function(e,t,n){return~n|t&~e},U[e++]=function(e,t,n){return n&~e|t&~e|~n&e},U[e++]=function(e,t,n){return~e|~n},U[e++]=function(e,t,n){return n&~t&e|~n&t&e},U[e++]=function(e,t,n){return~n&~t&~e|n&~t&e|~n&t&e},U[e++]=function(e,t,n){return n&~t|~n&t&e},U[e++]=function(e,t,n){return~t&~e|n&~t|~n&t&e},U[e++]=function(e,t,n){return~n&t|n&~t&e},U[e++]=function(e,t,n){return~n&~e|n&~t&e|~n&t},U[e++]=function(e,t,n){return n&~t|~n&t},U[e++]=function(e,t,n){return~t&~e|~n&~e|n&~t|~n&t},U[e++]=function(e,t,n){return n&t&~e|n&~t&e|~n&t&e},U[e++]=function(e,t,n){return~n&~t&~e|n&t&~e|n&~t&e|~n&t&e},U[e++]=function(e,t,n){return n&~e|n&~t|~n&t&e},U[e++]=function(e,t,n){return~t&~e|n&~e|n&~t|~n&t&e},U[e++]=function(e,t,n){return t&~e|n&~t&e|~n&t},U[e++]=function(e,t,n){return~n&~e|t&~e|n&~t&e|~n&t},U[e++]=function(e,t,n){return n&~e|t&~e|n&~t|~n&t},U[e++]=function(e,t,n){return~e|n&~t|~n&t},U[e++]=function(e,t,n){return~t&e|~n&e},U[e++]=function(e,t,n){return~n&~t|~t&e|~n&e},U[e++]=function(e,t,n){return n&~t|~t&e|~n&e},U[e++]=function(e,t,n){return~t|~n&e},U[e++]=function(e,t,n){return~n&t|~t&e},U[e++]=function(e,t,n){return~n|~t&e},U[e++]=function(e,t,n){return n&~t|~n&t|~t&e},U[e++]=function(e,t,n){return~t|~n},U[e++]=function(e,t,n){return n&t&~e|~t&e|~n&e},U[e++]=function(e,t,n){return~n&~t|n&t&~e|~t&e|~n&e},U[e++]=function(e,t,n){return n&~e|~t&e|~n&e},U[e++]=function(e,t,n){return~t|n&~e|~n&e},U[e++]=function(e,t,n){return t&~e|~t&e|~n&e},U[e++]=function(e,t,n){return~n|t&~e|~t&e},U[e++]=function(e,t,n){return n&~e|t&~e|~t&e|~n&e},U[e++]=function(e,t,n){return~e|~t|~n},U[e++]=function(e,t,n){return n&t&e},U[e++]=function(e,t,n){return~n&~t&~e|n&t&e},U[e++]=function(e,t,n){return n&~t&~e|n&t&e},U[e++]=function(e,t,n){return~t&~e|n&t&e},U[e++]=function(e,t,n){return~n&t&~e|n&t&e},U[e++]=function(e,t,n){return~n&~e|n&t&e},U[e++]=function(e,t,n){return n&~t&~e|~n&t&~e|n&t&e},U[e++]=function(e,t,n){return~t&~e|~n&~e|n&t&e},U[e++]=function(e,t,n){return n&t},U[e++]=function(e,t,n){return~n&~t&~e|n&t},U[e++]=function(e,t,n){return n&~e|n&t},U[e++]=function(e,t,n){return~t&~e|n&~e|n&t},U[e++]=function(e,t,n){return t&~e|n&t},U[e++]=function(e,t,n){return~n&~e|t&~e|n&t},U[e++]=function(e,t,n){return n&~e|t&~e|n&t},U[e++]=function(e,t,n){return~e|n&t},U[e++]=function(e,t,n){return~n&~t&e|n&t&e},U[e++]=function(e,t,n){return~n&~t|n&t&e},U[e++]=function(e,t,n){return n&~t&~e|~n&~t&e|n&t&e},U[e++]=function(e,t,n){return~t&~e|~n&~t|n&t&e},U[e++]=function(e,t,n){return~n&t&~e|~n&~t&e|n&t&e},U[e++]=function(e,t,n){return~n&~e|~n&~t|n&t&e},U[e++]=function(e,t,n){return n&~t&~e|~n&t&~e|~n&~t&e|n&t&e},U[e++]=function(e,t,n){return~t&~e|~n&~e|~n&~t|n&t&e},U[e++]=function(e,t,n){return n&t|~n&~t&e},U[e++]=function(e,t,n){return~n&~t|n&t},U[e++]=function(e,t,n){return n&~e|~n&~t&e|n&t},U[e++]=function(e,t,n){return~t&~e|n&~e|~n&~t|n&t},U[e++]=function(e,t,n){return t&~e|~n&~t&e|n&t},U[e++]=function(e,t,n){return~n&~e|t&~e|~n&~t|n&t},U[e++]=function(e,t,n){return n&~e|t&~e|~n&~t&e|n&t},U[e++]=function(e,t,n){return~e|~n&~t|n&t},U[e++]=function(e,t,n){return n&e},U[e++]=function(e,t,n){return~n&~t&~e|n&e},U[e++]=function(e,t,n){return n&~t|n&e},U[e++]=function(e,t,n){return~t&~e|n&e},U[e++]=function(e,t,n){return~n&t&~e|n&e},U[e++]=function(e,t,n){return~n&~e|n&e},U[e++]=function(e,t,n){return n&~t|~n&t&~e|n&e},U[e++]=function(e,t,n){return~t&~e|~n&~e|n&e},U[e++]=function(e,t,n){return n&t|n&e},U[e++]=function(e,t,n){return~n&~t&~e|n&t|n&e},U[e++]=function(e,t,n){return n},U[e++]=function(e,t,n){return~t&~e|n},U[e++]=function(e,t,n){return t&~e|n&e},U[e++]=function(e,t,n){return~n&~e|t&~e|n&e},U[e++]=function(e,t,n){return n|t&~e},U[e++]=function(e,t,n){return~e|n},U[e++]=function(e,t,n){return~t&e|n&e},U[e++]=function(e,t,n){return~n&~t|~t&e|n&e},U[e++]=function(e,t,n){return n&~t|~t&e|n&e},U[e++]=function(e,t,n){return~t|n&e},U[e++]=function(e,t,n){return~n&t&~e|~t&e|n&e},U[e++]=function(e,t,n){return~n&~e|~t&e|n&e},U[e++]=function(e,t,n){return n&~t|~n&t&~e|~t&e|n&e},U[e++]=function(e,t,n){return~t|~n&~e|n&e},U[e++]=function(e,t,n){return n&t|~t&e},U[e++]=function(e,t,n){return~n&~t|n&t|~t&e},U[e++]=function(e,t,n){return n|~t&e},U[e++]=function(e,t,n){return~t|n},U[e++]=function(e,t,n){return t&~e|~t&e|n&e},U[e++]=function(e,t,n){return~n&~e|t&~e|~t&e|n&e},U[e++]=function(e,t,n){return n|t&~e|~t&e},U[e++]=function(e,t,n){return~e|~t|n},U[e++]=function(e,t,n){return t&e},U[e++]=function(e,t,n){return~n&~t&~e|t&e},U[e++]=function(e,t,n){return n&~t&~e|t&e},U[e++]=function(e,t,n){return~t&~e|t&e},U[e++]=function(e,t,n){return~n&t|t&e},U[e++]=function(e,t,n){return~n&~e|t&e},U[e++]=function(e,t,n){return n&~t&~e|~n&t|t&e},U[e++]=function(e,t,n){return~t&~e|~n&~e|t&e},U[e++]=function(e,t,n){return n&t|t&e},U[e++]=function(e,t,n){return~n&~t&~e|n&t|t&e},U[e++]=function(e,t,n){return n&~e|t&e},U[e++]=function(e,t,n){return~t&~e|n&~e|t&e},U[e++]=function(e,t,n){return t},U[e++]=function(e,t,n){return~n&~e|t},U[e++]=function(e,t,n){return n&~e|t},U[e++]=function(e,t,n){return~e|t},U[e++]=function(e,t,n){return~n&e|t&e},U[e++]=function(e,t,n){return~n&~t|t&e},U[e++]=function(e,t,n){return n&~t&~e|~n&e|t&e},U[e++]=function(e,t,n){return~t&~e|~n&e|t&e},U[e++]=function(e,t,n){return~n&t|~n&e|t&e},U[e++]=function(e,t,n){return~n|t&e},U[e++]=function(e,t,n){return n&~t&~e|~n&t|~n&e|t&e},U[e++]=function(e,t,n){return~t&~e|~n|t&e},U[e++]=function(e,t,n){return n&t|~n&e},U[e++]=function(e,t,n){return~n&~t|n&t|t&e},U[e++]=function(e,t,n){return n&~e|~n&e|t&e},U[e++]=function(e,t,n){return~t&~e|n&~e|~n&e|t&e},U[e++]=function(e,t,n){return t|~n&e},U[e++]=function(e,t,n){return~n|t},U[e++]=function(e,t,n){return n&~e|t|~n&e},U[e++]=function(e,t,n){return~e|~n|t},U[e++]=function(e,t,n){return n&e|t&e},U[e++]=function(e,t,n){return~n&~t&~e|n&e|t&e},U[e++]=function(e,t,n){return n&~t|t&e},U[e++]=function(e,t,n){return~t&~e|n&e|t&e},U[e++]=function(e,t,n){return~n&t|n&e},U[e++]=function(e,t,n){return~n&~e|n&e|t&e},U[e++]=function(e,t,n){return n&~t|~n&t|t&e},U[e++]=function(e,t,n){return~t&~e|~n&~e|n&e|t&e},U[e++]=function(e,t,n){return n&t|n&e|t&e},U[e++]=function(e,t,n){return~n&~t&~e|n&t|n&e|t&e},U[e++]=function(e,t,n){return n|t&e},U[e++]=function(e,t,n){return~t&~e|n|t&e},U[e++]=function(e,t,n){return t|n&e},U[e++]=function(e,t,n){return~n&~e|t|n&e},U[e++]=function(e,t,n){return n|t},U[e++]=function(e,t,n){return~e|n|t},U[e++]=function(e,t,n){return e},U[e++]=function(e,t,n){return~n&~t|e},U[e++]=function(e,t,n){return n&~t|e},U[e++]=function(e,t,n){return~t|e},U[e++]=function(e,t,n){return~n&t|e},U[e++]=function(e,t,n){return~n|e},U[e++]=function(e,t,n){return n&~t|~n&t|e},U[e++]=function(e,t,n){return~t|~n|e},U[e++]=function(e,t,n){return n&t|e},U[e++]=function(e,t,n){return~n&~t|n&t|e},U[e++]=function(e,t,n){return n|e},U[e++]=function(e,t,n){return~t|n|e},U[e++]=function(e,t,n){return t|e},U[e++]=function(e,t,n){return~n|t|e},U[e++]=function(e,t,n){return n|t|e},U[255]=function(e,t,n){return 65535}),SAEE_None},this.reset=function(){r=-1;for(var e=ue=le=ne=0;e<Re.length;e++)Re[e]=0;De=xe=we=10,Ae=Se=Ee=0,me=he=0,ye=ve=be=Ce=ke=ge=0},this.handler=function(e){if(SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)||(SAER.events.event2_newevent(SAEC_Events_EV2_BLITTER,10,0),!(++ge<2e4)&&i)){if((ge=0)<Z&&!i)return SAER.events.event2_newevent(SAEC_Events_EV2_BLITTER,Z,0),void(Z=-1);Ge()}},this.decide_blitter=function(e){var t=e<0;if(i)return SAEV_Blitter_bltstate==SAEC_Blitter_bltstate_DONE?void 0:void(SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&Ge());if(0<j&&function(e){for(var t=de;t<e;){var n=Te(t);if(t++,0<n&&0==--j)return ie=ie&&-1,SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_DONE,We(t,ae=0),X=H=j=0,ie=ie&&1}}(e),0<oe&&t&&(--oe||SAER.custom.send_interrupt(SAEC_Custom_INTF_BLIT,2*SAEC_Events_CYCLE_UNIT)),SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&u){if(e<0&&(e=SAER.playfield.get_maxhpos()),k)return A.got_cycle=1,void function(e,t){var n={val:0};for(ae&&A.vblitsize&&(ae=0);de<t;){for(var r=Fe(H);;){var i=Te(de);if(X){X=0;break}if(ae){if(2<=++H)return ze(de);break}if(i<=0){0;break}if(H++,Ie(de,r),3==r)Oe(),n.val=y,y=n.val,0;else if(5==r)_e&&(v=y),_e=1,Ne(),Be(),Ue();else if(4==r&&(I&&(Le(),n.val=v,v=n.val,I=0,0),0==A.vblitsize)){v=y,ae=1,Pe(X=H=0,0);break}break}de++}e&&(de=0),Ve()}(t,e);for(;de<e;){for(var n=Fe(H);;){var r=Te(de);if(X){X=0;break}if(0==n&&0==r||r<0){if(H<0||!ae){0;break}if(w&&s[B][0]){0;break}}if(re){0;break}if(0==n){if(A.got_cycle=1,0==++H&&(ae=0),0==B&&q<=H)return void ze(de);break}if(r<=0){0;break}if(A.got_cycle=1,4==n?function(){var e,t={val:0};if(0==$)e=He();else if(fe)e=ce,fe=0;else{if(!_e)return;e=se,_e=0}SAER_Memory_chipData[v]=e>>8,SAER_Memory_chipData[v+1]=255&e,t.val=v,v=t.val,v+=P,++Se==A.hblitsize&&(v+=N,(Se=0)==$&&me++,me<++he&&(me=he)),1==B&&(Ae=Se)}():me<A.vblitsize&&function(e){var t={val:0};switch(e){case 1:A.bltadat=SAER_Memory_chipData[h]<<8|SAER_Memory_chipData[h+1],SAEV_Custom_last_value=A.bltadat,h+=P,t.val=h,h=t.val;break;case 2:A.bltbdat=SAER_Memory_chipData[g]<<8|SAER_Memory_chipData[g+1],SAEV_Custom_last_value=A.bltbdat,g+=P,A.bltbhold=M?(A.bltbdat<<16|ue)>>>0>>>A.blitdownbshift:(ue<<16|A.bltbdat)>>>0>>>A.blitbshift,ue=A.bltbdat,t.val=g,g=t.val;break;case 3:A.bltcdat=SAER_Memory_chipData[y]<<8|SAER_Memory_chipData[y+1],SAEV_Custom_last_value=A.bltcdat,y+=P,t.val=y,y=t.val}$<=++Ee&&(ce=se,fe=_e,_e=Ee=0,se=He(),256&S&&(_e=1),++Ae==A.hblitsize&&(Ae=0,2048&S&&(h+=z),1024&S&&(g+=O),512&S&&(y+=L),me++,R=!!(4&m)))}(n),H++,me>=A.vblitsize&&he>=A.vblitsize&&!_e&&!fe)return void ze(de);Ie(de,n);break}SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&!ae&&(me==A.vblitsize||me==A.vblitsize-1&&Ae==A.hblitsize-1&&0==$)&&function(e){if(e<0)return 0;var t=Me();return e<t[0]?e:(e-=t[0],e%=t[0])}(H-1)==te[0]-1&&(Pe(0,0),H=0,ae=1),de++}Ve(),t&&(de=0)}},this.blitter_check_start=function(){SAEV_Blitter_bltstate==SAEC_Blitter_bltstate_INIT&&(Ye(),SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_WORK,i&&Ge())},this.check_is_blit_dangerous=function(e,t,n){if(SAEV_Blitter_dangerous=!1,SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&u)for(var r=0;r<t;r++){var i=e[r],a=(v&SAEV_Memory_chipMask)>>>0;if(i-2*n<=a&&a<i+2*n)return void(SAEV_Blitter_dangerous=!0)}},this.blitnasty=function(){if(SAEV_Blitter_bltstate==SAEC_Blitter_bltstate_DONE)return 0;if(!SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN))return 0;if(u)return function(){if(SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE){var e=SAEV_Custom_dmacon;if(SAEV_Custom_dmacon|=SAEC_Custom_DMAF_DMAEN|SAEC_Custom_DMAF_BLTEN,SAEF_log("blitter.blitter_force_finish() forcing finish"),u&&!i){for(var t=1e4;SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&0<t;)SAER.blitter.decide_blitter(-1),t--;0==t&&SAEF_warn("blitter.blitter_force_finish() froze!?"),j=0}else Ke();ze(SAER.events.current_hpos()),SAEV_Custom_dmacon=e}}(),-1;if(J>=te[0]&&Q==te[0])return 0;for(var e=(SAEV_Events_currcycle-W)*SAEC_Events_CYCLE_UNIT_INV>>>0,t=0;J<e;)Fe(J++)||t++;return t},this.blitter_slowdown=function(e,t,n,r){var i;!n||e<0||t<0||(e==ye&&t==ve&&n==be&&Ce==r||(i=((t-e+n-1)/n*n>>>0)*Q/te[0]>>>0,ke=(r=((ve=t)-(ye=e)+(be=n)-1)/n*(Ce=r)>>>0)<i?i-r:0),Z<0||k||(Z+=ke,0))},this.BLTADAT=function(e,t){Je(e,0),A.bltadat=t},this.BLTBDAT=function(e,t){Je(e,0),A.bltbhold=2&m?t<<(m>>12)&65535:t>>(m>>12)&65535,A.bltbdat=t},this.BLTCDAT=function(e,t){Je(e,0),A.bltcdat=t,Ze(0)},this.BLTAMOD=function(e,t){Je(e,1),A.bltamod=65534&t,32768&A.bltamod&&(A.bltamod-=65536),Ze(0)},this.BLTBMOD=function(e,t){Je(e,1),A.bltbmod=65534&t,32768&A.bltbmod&&(A.bltbmod-=65536),Ze(0)},this.BLTCMOD=function(e,t){Je(e,1),A.bltcmod=65534&t,32768&A.bltcmod&&(A.bltcmod-=65536),Ze(0)},this.BLTDMOD=function(e,t){Je(e,1),A.bltdmod=65534&t,32768&A.bltdmod&&(A.bltdmod-=65536),Ze(0)},this.BLTCON0=function(e,t){Je(e,2),S=t,Ze(1)},this.BLTCON0L=function(e,t){Je(e,2),S=65280&S|255&t,Ze(1)},this.BLTCON1=function(e,t){Je(e,2),m=t,Ze(2)},this.BLTAFWM=function(e,t){Je(e,2),A.bltafwm=t,Ze(0)},this.BLTALWM=function(e,t){Je(e,2),A.bltalwm=t,Ze(0)},this.BLTAPTH=function(e,t){t&=SAEV_config.chipset.mask==SAEC_Config_Chipset_Mask_OCS?7:31,Je(e,0),SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_config.chipset.blitter.cycle_exact?(n=(65535&h|t<<16)>>>0,r=e,a=1):h=(65535&h|t<<16)>>>0},this.BLTAPTL=function(e,t){Je(e,0),SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_config.chipset.blitter.cycle_exact?(n=(4294901760&h|65534&t)>>>0,r=e,a=1):h=(4294901760&h|65534&t)>>>0},this.BLTBPTH=function(e,t){t&=SAEV_config.chipset.mask==SAEC_Config_Chipset_Mask_OCS?7:31,Je(e,0),SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_config.chipset.blitter.cycle_exact?(n=(65535&g|t<<16)>>>0,r=e,a=2):g=(65535&g|t<<16)>>>0},this.BLTBPTL=function(e,t){Je(e,0),SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_config.chipset.blitter.cycle_exact?(n=(4294901760&g|65534&t)>>>0,r=e,a=2):g=(4294901760&g|65534&t)>>>0},this.BLTCPTH=function(e,t){t&=SAEV_config.chipset.mask==SAEC_Config_Chipset_Mask_OCS?7:31,Je(e,0),SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_config.chipset.blitter.cycle_exact?(n=(65535&y|t<<16)>>>0,r=e,a=3):y=(65535&y|t<<16)>>>0},this.BLTCPTL=function(e,t){Je(e,0),SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_config.chipset.blitter.cycle_exact?(n=(4294901760&y|65534&t)>>>0,r=e,a=3):y=(4294901760&y|65534&t)>>>0},this.BLTDPTH=function(e,t){t&=SAEV_config.chipset.mask==SAEC_Config_Chipset_Mask_OCS?7:31,Je(e,0),SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_config.chipset.blitter.cycle_exact?(n=(65535&v|t<<16)>>>0,r=e,a=4):v=(65535&v|t<<16)>>>0},this.BLTDPTL=function(e,t){Je(e,0),SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEV_config.chipset.blitter.cycle_exact?(n=(4294901760&v|65534&t)>>>0,r=e,a=4):v=(4294901760&v|65534&t)>>>0},this.BLTSIZE=function(e,t){Je(e,0),A.vblitsize=t>>6,A.hblitsize=63&t,A.vblitsize||(A.vblitsize=1024),A.hblitsize||(A.hblitsize=64),We(e,SAEV_Copper_access),SAER.playfield.dcheck_is_blit_dangerous()},this.BLTSIZV=function(e,t){Je(e,0),A.vblitsize=32767&t},this.BLTSIZH=function(e,t){Je(e,0),A.hblitsize=2047&t,A.vblitsize||(A.vblitsize=32768),A.hblitsize||(A.hblitsize=2048),We(e,SAEV_Copper_access)};const Qe=[function(e,t,n,r,i){var a,o,s=0,c=0,_=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++)_&&(SAER_Memory_chipData[_]=c>>8,SAER_Memory_chipData[_+1]=255&c),s|=c=0,r&&(_=r,r+=2);r&&(r+=i.bltdmod)}_&&(SAER_Memory_chipData[_]=c>>8,SAER_Memory_chipData[_+1]=255&c);0!=s&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c,_=0,f=0,l=i.bltcdat,u=0,d=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++)n&&(l=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n+=2),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e+=2):s=A.bltadat,s&=G[a],c=(f<<16|s)>>>0>>>i.blitashift,f=s,d&&(SAER_Memory_chipData[d]=u>>8,SAER_Memory_chipData[d+1]=255&u),_|=u=~c&l&65535,r&&(d=r,r+=2);e&&(e+=i.bltamod),n&&(n+=i.bltcmod),r&&(r+=i.bltdmod)}i.bltcdat=l,d&&(SAER_Memory_chipData[d]=u>>8,SAER_Memory_chipData[d+1]=255&u);0!=_&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n+=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t+=2,l=(f<<16|E)>>>0>>>i.blitbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e+=2):s=A.bltadat,s&=G[a],E=(_<<16|s)>>>0>>>i.blitashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=u&~(E&l)&65535,r&&(p=r,r+=2)}e&&(e+=i.bltamod),t&&(t+=i.bltbmod),n&&(n+=i.bltcmod),r&&(r+=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=0,d=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var p;t&&(p=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t+=2,l=(f<<16|p)>>>0>>>i.blitbshift,f=p),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e+=2):s=A.bltadat,s&=G[a],p=(_<<16|s)>>>0>>>i.blitashift,_=s,d&&(SAER_Memory_chipData[d]=u>>8,SAER_Memory_chipData[d+1]=255&u),c|=u=p&~l&65535,r&&(d=r,r+=2)}e&&(e+=i.bltamod),t&&(t+=i.bltbmod),r&&(r+=i.bltdmod)}i.bltbhold=l,d&&(SAER_Memory_chipData[d]=u>>8,SAER_Memory_chipData[d+1]=255&u);0!=c&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n+=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t+=2,l=(f<<16|E)>>>0>>>i.blitbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e+=2):s=A.bltadat,s&=G[a],E=(_<<16|s)>>>0>>>i.blitashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=65535&(l^(E|l^u)),r&&(p=r,r+=2)}e&&(e+=i.bltamod),t&&(t+=i.bltbmod),n&&(n+=i.bltcmod),r&&(r+=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=0,d=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var p;t&&(p=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t+=2,l=(f<<16|p)>>>0>>>i.blitbshift,f=p),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e+=2):s=A.bltadat,s&=G[a],p=(_<<16|s)>>>0>>>i.blitashift,_=s,d&&(SAER_Memory_chipData[d]=u>>8,SAER_Memory_chipData[d+1]=255&u),c|=u=65535&(p^l),r&&(d=r,r+=2)}e&&(e+=i.bltamod),t&&(t+=i.bltbmod),r&&(r+=i.bltdmod)}i.bltbhold=l,d&&(SAER_Memory_chipData[d]=u>>8,SAER_Memory_chipData[d+1]=255&u);0!=c&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n+=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t+=2,l=(f<<16|E)>>>0>>>i.blitbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e+=2):s=A.bltadat,s&=G[a],E=(_<<16|s)>>>0>>>i.blitashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=65535&(u^E&(l|u)),r&&(p=r,r+=2)}e&&(e+=i.bltamod),t&&(t+=i.bltbmod),n&&(n+=i.bltcmod),r&&(r+=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n+=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t+=2,l=(f<<16|E)>>>0>>>i.blitbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e+=2):s=A.bltadat,s&=G[a],E=(_<<16|s)>>>0>>>i.blitashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=65535&(u^E&l),r&&(p=r,r+=2)}e&&(e+=i.bltamod),t&&(t+=i.bltbmod),n&&(n+=i.bltcmod),r&&(r+=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n+=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t+=2,l=(f<<16|E)>>>0>>>i.blitbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e+=2):s=A.bltadat,s&=G[a],E=(_<<16|s)>>>0>>>i.blitashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=u&(~E|l)&65535,r&&(p=r,r+=2)}e&&(e+=i.bltamod),t&&(t+=i.bltbmod),n&&(n+=i.bltcmod),r&&(r+=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n+=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t+=2,l=(f<<16|E)>>>0>>>i.blitbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e+=2):s=A.bltadat,s&=G[a],E=(_<<16|s)>>>0>>>i.blitashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=l&(~E|u)&65535,r&&(p=r,r+=2)}e&&(e+=i.bltamod),t&&(t+=i.bltbmod),n&&(n+=i.bltcmod),r&&(r+=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n+=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t+=2,l=(f<<16|E)>>>0>>>i.blitbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e+=2):s=A.bltadat,s&=G[a],E=(_<<16|s)>>>0>>>i.blitashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=65535&(u^E&~l),r&&(p=r,r+=2)}e&&(e+=i.bltamod),t&&(t+=i.bltbmod),n&&(n+=i.bltcmod),r&&(r+=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n+=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t+=2,l=(f<<16|E)>>>0>>>i.blitbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e+=2):s=A.bltadat,s&=G[a],E=(_<<16|s)>>>0>>>i.blitashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=u&(E|l)&65535,r&&(p=r,r+=2)}e&&(e+=i.bltamod),t&&(t+=i.bltbmod),n&&(n+=i.bltcmod),r&&(r+=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,function(e,t,n,r,i){var a,o,s=0,c=i.bltcdat,_=0,f=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++)n&&(c=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n+=2),f&&(SAER_Memory_chipData[f]=_>>8,SAER_Memory_chipData[f+1]=255&_),s|=_=65535&c,r&&(f=r,r+=2);n&&(n+=i.bltcmod),r&&(r+=i.bltdmod)}i.bltcdat=c,f&&(SAER_Memory_chipData[f]=_>>8,SAER_Memory_chipData[f+1]=255&_);0!=s&&(i.blitzero=0)},0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n+=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t+=2,l=(f<<16|E)>>>0>>>i.blitbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e+=2):s=A.bltadat,s&=G[a],E=(_<<16|s)>>>0>>>i.blitashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=65535&~(E^(u|E^l)),r&&(p=r,r+=2)}e&&(e+=i.bltamod),t&&(t+=i.bltbmod),n&&(n+=i.bltcmod),r&&(r+=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n+=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t+=2,l=(f<<16|E)>>>0>>>i.blitbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e+=2):s=A.bltadat,s&=G[a],E=(_<<16|s)>>>0>>>i.blitashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=65535&(u^E&(l^u)),r&&(p=r,r+=2)}e&&(e+=i.bltamod),t&&(t+=i.bltbmod),n&&(n+=i.bltcmod),r&&(r+=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,function(e,t,n,r,i){var a,o,s=0,c=0,_=i.bltbhold,f=0,l=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var u;t&&(u=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t+=2,_=(c<<16|u)>>>0>>>i.blitbshift,c=u),l&&(SAER_Memory_chipData[l]=f>>8,SAER_Memory_chipData[l+1]=255&f),s|=f=65535&_,r&&(l=r,r+=2)}t&&(t+=i.bltbmod),r&&(r+=i.bltdmod)}i.bltbhold=_,l&&(SAER_Memory_chipData[l]=f>>8,SAER_Memory_chipData[l+1]=255&f);0!=s&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n+=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t+=2,l=(f<<16|E)>>>0>>>i.blitbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e+=2):s=A.bltadat,s&=G[a],E=(_<<16|s)>>>0>>>i.blitashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=65535&(E^u&(E^l)),r&&(p=r,r+=2)}e&&(e+=i.bltamod),t&&(t+=i.bltbmod),n&&(n+=i.bltcmod),r&&(r+=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n+=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t+=2,l=(f<<16|E)>>>0>>>i.blitbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e+=2):s=A.bltadat,s&=G[a],E=(_<<16|s)>>>0>>>i.blitashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=65535&(u^l&(E^u)),r&&(p=r,r+=2)}e&&(e+=i.bltamod),t&&(t+=i.bltbmod),n&&(n+=i.bltcmod),r&&(r+=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n+=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t+=2,l=(f<<16|E)>>>0>>>i.blitbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e+=2):s=A.bltadat,s&=G[a],E=(_<<16|s)>>>0>>>i.blitashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=65535&(u|E&l),r&&(p=r,r+=2)}e&&(e+=i.bltamod),t&&(t+=i.bltbmod),n&&(n+=i.bltcmod),r&&(r+=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c,_=0,f=0,l=0,u=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++)e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e+=2):s=A.bltadat,s&=G[a],c=(f<<16|s)>>>0>>>i.blitashift,f=s,u&&(SAER_Memory_chipData[u]=l>>8,SAER_Memory_chipData[u+1]=255&l),_|=l=65535&c,r&&(u=r,r+=2);e&&(e+=i.bltamod),r&&(r+=i.bltdmod)}u&&(SAER_Memory_chipData[u]=l>>8,SAER_Memory_chipData[u+1]=255&l);0!=_&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c,_=0,f=0,l=i.bltcdat,u=0,d=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++)n&&(l=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n+=2),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e+=2):s=A.bltadat,s&=G[a],c=(f<<16|s)>>>0>>>i.blitashift,f=s,d&&(SAER_Memory_chipData[d]=u>>8,SAER_Memory_chipData[d+1]=255&u),_|=u=65535&(c|l),r&&(d=r,r+=2);e&&(e+=i.bltamod),n&&(n+=i.bltcmod),r&&(r+=i.bltdmod)}i.bltcdat=l,d&&(SAER_Memory_chipData[d]=u>>8,SAER_Memory_chipData[d+1]=255&u);0!=_&&(i.blitzero=0)},0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=0,d=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var p;t&&(p=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t+=2,l=(f<<16|p)>>>0>>>i.blitbshift,f=p),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e+=2):s=A.bltadat,s&=G[a],p=(_<<16|s)>>>0>>>i.blitashift,_=s,d&&(SAER_Memory_chipData[d]=u>>8,SAER_Memory_chipData[d+1]=255&u),c|=u=65535&(p|l),r&&(d=r,r+=2)}e&&(e+=i.bltamod),t&&(t+=i.bltbmod),r&&(r+=i.bltdmod)}i.bltbhold=l,d&&(SAER_Memory_chipData[d]=u>>8,SAER_Memory_chipData[d+1]=255&u);0!=c&&(i.blitzero=0)},0,0,0],$e=[function(e,t,n,r,i){var a,o,s=0,c=0,_=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++)_&&(SAER_Memory_chipData[_]=c>>8,SAER_Memory_chipData[_+1]=255&c),s|=c=0,r&&(_=r,r-=2);r&&(r-=i.bltdmod)}_&&(SAER_Memory_chipData[_]=c>>8,SAER_Memory_chipData[_+1]=255&c);0!=s&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c,_=0,f=0,l=i.bltcdat,u=0,d=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++)n&&(l=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n-=2),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e-=2):s=A.bltadat,s&=G[a],c=(s<<16|f)>>>0>>>i.blitdownashift,f=s,d&&(SAER_Memory_chipData[d]=u>>8,SAER_Memory_chipData[d+1]=255&u),_|=u=~c&l&65535,r&&(d=r,r-=2);e&&(e-=i.bltamod),n&&(n-=i.bltcmod),r&&(r-=i.bltdmod)}i.bltcdat=l,d&&(SAER_Memory_chipData[d]=u>>8,SAER_Memory_chipData[d+1]=255&u);0!=_&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n-=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t-=2,l=(E<<16|f)>>>0>>>i.blitdownbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e-=2):s=A.bltadat,s&=G[a],E=(s<<16|_)>>>0>>>i.blitdownashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=u&~(E&l)&65535,r&&(p=r,r-=2)}e&&(e-=i.bltamod),t&&(t-=i.bltbmod),n&&(n-=i.bltcmod),r&&(r-=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=0,d=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var p;t&&(p=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t-=2,l=(p<<16|f)>>>0>>>i.blitdownbshift,f=p),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e-=2):s=A.bltadat,s&=G[a],p=(s<<16|_)>>>0>>>i.blitdownashift,_=s,d&&(SAER_Memory_chipData[d]=u>>8,SAER_Memory_chipData[d+1]=255&u),c|=u=p&~l&65535,r&&(d=r,r-=2)}e&&(e-=i.bltamod),t&&(t-=i.bltbmod),r&&(r-=i.bltdmod)}i.bltbhold=l,d&&(SAER_Memory_chipData[d]=u>>8,SAER_Memory_chipData[d+1]=255&u);0!=c&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n-=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t-=2,l=(E<<16|f)>>>0>>>i.blitdownbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e-=2):s=A.bltadat,s&=G[a],E=(s<<16|_)>>>0>>>i.blitdownashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=65535&(l^(E|l^u)),r&&(p=r,r-=2)}e&&(e-=i.bltamod),t&&(t-=i.bltbmod),n&&(n-=i.bltcmod),r&&(r-=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=0,d=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var p;t&&(p=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t-=2,l=(p<<16|f)>>>0>>>i.blitdownbshift,f=p),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e-=2):s=A.bltadat,s&=G[a],p=(s<<16|_)>>>0>>>i.blitdownashift,_=s,d&&(SAER_Memory_chipData[d]=u>>8,SAER_Memory_chipData[d+1]=255&u),c|=u=65535&(p^l),r&&(d=r,r-=2)}e&&(e-=i.bltamod),t&&(t-=i.bltbmod),r&&(r-=i.bltdmod)}i.bltbhold=l,d&&(SAER_Memory_chipData[d]=u>>8,SAER_Memory_chipData[d+1]=255&u);0!=c&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n-=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t-=2,l=(E<<16|f)>>>0>>>i.blitdownbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e-=2):s=A.bltadat,s&=G[a],E=(s<<16|_)>>>0>>>i.blitdownashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=65535&(u^E&(l|u)),r&&(p=r,r-=2)}e&&(e-=i.bltamod),t&&(t-=i.bltbmod),n&&(n-=i.bltcmod),r&&(r-=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n-=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t-=2,l=(E<<16|f)>>>0>>>i.blitdownbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e-=2):s=A.bltadat,s&=G[a],E=(s<<16|_)>>>0>>>i.blitdownashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=65535&(u^E&l),r&&(p=r,r-=2)}e&&(e-=i.bltamod),t&&(t-=i.bltbmod),n&&(n-=i.bltcmod),r&&(r-=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n-=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t-=2,l=(E<<16|f)>>>0>>>i.blitdownbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e-=2):s=A.bltadat,s&=G[a],E=(s<<16|_)>>>0>>>i.blitdownashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=u&(~E|l)&65535,r&&(p=r,r-=2)}e&&(e-=i.bltamod),t&&(t-=i.bltbmod),n&&(n-=i.bltcmod),r&&(r-=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n-=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t-=2,l=(E<<16|f)>>>0>>>i.blitdownbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e-=2):s=A.bltadat,s&=G[a],E=(s<<16|_)>>>0>>>i.blitdownashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=l&(~E|u)&65535,r&&(p=r,r-=2)}e&&(e-=i.bltamod),t&&(t-=i.bltbmod),n&&(n-=i.bltcmod),r&&(r-=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n-=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t-=2,l=(E<<16|f)>>>0>>>i.blitdownbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e-=2):s=A.bltadat,s&=G[a],E=(s<<16|_)>>>0>>>i.blitdownashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=65535&(u^E&~l),r&&(p=r,r-=2)}e&&(e-=i.bltamod),t&&(t-=i.bltbmod),n&&(n-=i.bltcmod),r&&(r-=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n-=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t-=2,l=(E<<16|f)>>>0>>>i.blitdownbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e-=2):s=A.bltadat,s&=G[a],E=(s<<16|_)>>>0>>>i.blitdownashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=u&(E|l)&65535,r&&(p=r,r-=2)}e&&(e-=i.bltamod),t&&(t-=i.bltbmod),n&&(n-=i.bltcmod),r&&(r-=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,function(e,t,n,r,i){var a,o,s=0,c=i.bltcdat,_=0,f=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++)n&&(c=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n-=2),f&&(SAER_Memory_chipData[f]=_>>8,SAER_Memory_chipData[f+1]=255&_),s|=_=65535&c,r&&(f=r,r-=2);n&&(n-=i.bltcmod),r&&(r-=i.bltdmod)}i.bltcdat=c,f&&(SAER_Memory_chipData[f]=_>>8,SAER_Memory_chipData[f+1]=255&_);0!=s&&(i.blitzero=0)},0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n-=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t-=2,l=(E<<16|f)>>>0>>>i.blitdownbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e-=2):s=A.bltadat,s&=G[a],E=(s<<16|_)>>>0>>>i.blitdownashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=65535&~(E^(u|E^l)),r&&(p=r,r-=2)}e&&(e-=i.bltamod),t&&(t-=i.bltbmod),n&&(n-=i.bltcmod),r&&(r-=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n-=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t-=2,l=(E<<16|f)>>>0>>>i.blitdownbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e-=2):s=A.bltadat,s&=G[a],E=(s<<16|_)>>>0>>>i.blitdownashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=65535&(u^E&(l^u)),r&&(p=r,r-=2)}e&&(e-=i.bltamod),t&&(t-=i.bltbmod),n&&(n-=i.bltcmod),r&&(r-=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,function(e,t,n,r,i){var a,o,s=0,c=0,_=i.bltbhold,f=0,l=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var u;t&&(u=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t-=2,_=(u<<16|c)>>>0>>>i.blitdownbshift,c=u),l&&(SAER_Memory_chipData[l]=f>>8,SAER_Memory_chipData[l+1]=255&f),s|=f=65535&_,r&&(l=r,r-=2)}t&&(t-=i.bltbmod),r&&(r-=i.bltdmod)}i.bltbhold=_,l&&(SAER_Memory_chipData[l]=f>>8,SAER_Memory_chipData[l+1]=255&f);0!=s&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n-=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t-=2,l=(E<<16|f)>>>0>>>i.blitdownbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e-=2):s=A.bltadat,s&=G[a],E=(s<<16|_)>>>0>>>i.blitdownashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=65535&(E^u&(E^l)),r&&(p=r,r-=2)}e&&(e-=i.bltamod),t&&(t-=i.bltbmod),n&&(n-=i.bltcmod),r&&(r-=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n-=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t-=2,l=(E<<16|f)>>>0>>>i.blitdownbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e-=2):s=A.bltadat,s&=G[a],E=(s<<16|_)>>>0>>>i.blitdownashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=65535&(u^l&(E^u)),r&&(p=r,r-=2)}e&&(e-=i.bltamod),t&&(t-=i.bltbmod),n&&(n-=i.bltcmod),r&&(r-=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=i.bltcdat,d=0,p=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var E;n&&(u=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n-=2),t&&(E=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t-=2,l=(E<<16|f)>>>0>>>i.blitdownbshift,f=E),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e-=2):s=A.bltadat,s&=G[a],E=(s<<16|_)>>>0>>>i.blitdownashift,_=s,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d),c|=d=65535&(u|E&l),r&&(p=r,r-=2)}e&&(e-=i.bltamod),t&&(t-=i.bltbmod),n&&(n-=i.bltcmod),r&&(r-=i.bltdmod)}i.bltbhold=l,i.bltcdat=u,p&&(SAER_Memory_chipData[p]=d>>8,SAER_Memory_chipData[p+1]=255&d);0!=c&&(i.blitzero=0)},0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c,_=0,f=0,l=0,u=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++)e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e-=2):s=A.bltadat,s&=G[a],c=(s<<16|f)>>>0>>>i.blitdownashift,f=s,u&&(SAER_Memory_chipData[u]=l>>8,SAER_Memory_chipData[u+1]=255&l),_|=l=65535&c,r&&(u=r,r-=2);e&&(e-=i.bltamod),r&&(r-=i.bltdmod)}u&&(SAER_Memory_chipData[u]=l>>8,SAER_Memory_chipData[u+1]=255&l);0!=_&&(i.blitzero=0)},0,0,0,0,0,0,0,0,0,function(e,t,n,r,i){var a,o,s,c,_=0,f=0,l=i.bltcdat,u=0,d=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++)n&&(l=SAER_Memory_chipData[n]<<8|SAER_Memory_chipData[n+1],n-=2),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e-=2):s=A.bltadat,s&=G[a],c=(s<<16|f)>>>0>>>i.blitdownashift,f=s,d&&(SAER_Memory_chipData[d]=u>>8,SAER_Memory_chipData[d+1]=255&u),_|=u=65535&(c|l),r&&(d=r,r-=2);e&&(e-=i.bltamod),n&&(n-=i.bltcmod),r&&(r-=i.bltdmod)}i.bltcdat=l,d&&(SAER_Memory_chipData[d]=u>>8,SAER_Memory_chipData[d+1]=255&u);0!=_&&(i.blitzero=0)},0,function(e,t,n,r,i){var a,o,s,c=0,_=0,f=0,l=i.bltbhold,u=0,d=0;for(o=0;o<i.vblitsize;o++){for(a=0;a<i.hblitsize;a++){var p;t&&(p=A.bltbdat=SAER_Memory_chipData[t]<<8|SAER_Memory_chipData[t+1],t-=2,l=(p<<16|f)>>>0>>>i.blitdownbshift,f=p),e?(s=A.bltadat=SAER_Memory_chipData[e]<<8|SAER_Memory_chipData[e+1],e-=2):s=A.bltadat,s&=G[a],p=(s<<16|_)>>>0>>>i.blitdownashift,_=s,d&&(SAER_Memory_chipData[d]=u>>8,SAER_Memory_chipData[d+1]=255&u),c|=u=65535&(p|l),r&&(d=r,r-=2)}e&&(e-=i.bltamod),t&&(t-=i.bltbmod),r&&(r-=i.bltdmod)}i.bltbhold=l,d&&(SAER_Memory_chipData[d]=u>>8,SAER_Memory_chipData[d+1]=255&u);0!=c&&(i.blitzero=0)},0,0,0]}var SAER_Copper_cop_state=null,SAEV_Copper_access=!1,SAEV_Copper_last_hpos=0,SAEV_Copper_enabled_thisline=0;function SAEO_Copper(){const _=[1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],f=0,l=1,u=2,d=3,p=4,E=5,A=6,S=7,m=8,h=9,g=10,y=11,v=12,b=13,C=14,k=15;var R=new function(){this.i1=0,this.saved_i1=0,this.i2=0,this.saved_i2=0,this.state=f,this.state_prev=f,this.ip=0,this.saved_ip=0,this.hpos=0,this.vpos=0,this.ignore_next=!1,this.vcmp=0,this.hcmp=0,this.strobe=0,this.moveaddr=0,this.movedata=0,this.movedelay=0};SAER_Copper_cop_state=R;var w=0,x=0,D=0;function M(e,t,n,r){SAEV_Copper_access=!0;r=SAER_Custom_put16_real(e,t,n,r);return SAEV_Copper_access=!1,r}function n(e){var t=SAER.playfield.get_vpos()&(R.saved_i2>>8&127|128),n=R.hpos;if(R.state==m&&t<R.vcmp)return SAEV_Copper_enabled_thisline=0,R.state=f,void SAEF_clrSpcFlags(SAEC_spcflag_COPPER);if(!(e<=SAEV_Copper_last_hpos)){for((-2&(i=SAER.playfield.get_maxhpos()))<e&&(e=-2&i);;){var r,i,a=n;if(e<=n)break;switch(SAER.playfield.decide_line(n),SAER.playfield.decide_fetch(n),0<R.movedelay&&(R.movedelay--,0==R.movedelay&&M(n,R.moveaddr,R.movedata,0)),n+=n==(i=SAER.playfield.get_maxhpos())-3&&1&i?1:2,R.state){case E:if(SAER.playfield.copper_cant_read(a,0))continue;R.state=S;break;case A:if(SAER.playfield.copper_cant_read(a,0))continue;R.state=h;break;case C:R.state=g;break;case g:if(SAER.playfield.copper_cant_read(a,1))continue;a==(i=SAER.playfield.get_maxhpos())-2?(R.state=u,1==R.strobe?R.ip=w:R.ip=x,R.strobe=0):(R.state=y,R.ip+=2);break;case y:R.state=u,1==R.strobe?R.ip=w:R.ip=x,R.strobe=0;break;case v:R.state=b;break;case b:if(SAER.playfield.copper_cant_read(a,1))continue;R.state=u,1==R.strobe?R.ip=w:R.ip=x,R.strobe=0;break;case k:if(SAER.playfield.copper_cant_read(a,1))continue;R.state=u,R.i1=SAEV_Custom_last_value=SAER_Memory_chipData[R.ip]<<8|SAER_Memory_chipData[R.ip+1],R.ip=w;break;case u:if(SAER.playfield.copper_cant_read(a,1))continue;R.i1=SAEV_Custom_last_value=SAER_Memory_chipData[R.ip]<<8|SAER_Memory_chipData[R.ip+1],R.ip+=2,R.state=d;break;case d:if(SAER.playfield.copper_cant_read(a,1))continue;if(R.i2=SAEV_Custom_last_value=SAER_Memory_chipData[R.ip]<<8|SAER_Memory_chipData[R.ip+1],R.ip+=2,R.saved_i1=R.i1,R.saved_i2=R.i2,R.saved_ip=R.ip,1&R.i1)R.ignore_next=!1,1&R.i2?R.state=A:R.state=E;else{var o=510&R.i1,s=R.i2;if(R.state=u,function(e){if((510&e)<(2&D?SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS?0:64:128))return R.state=f,SAEV_Copper_enabled_thisline=0,SAEF_clrSpcFlags(SAEC_spcflag_COPPER)}(o),!SAEV_Copper_enabled_thisline)return R.hpos=n,void(SAEV_Copper_last_hpos=e);136==(o=R.ignore_next?510:o)?(R.strobe=1,R.state=g):138==o?(R.strobe=2,R.state=g):_[o>>1]?(R.moveaddr=o,R.movedata=s,R.movedelay=_[o>>1]):M(a,o,s,0),R.ignore_next=!1}SAEV_Copper_enabled_thisline<0&&!SAEF_Custom_dmaen(SAEC_Custom_DMAF_COPEN)&&(SAEV_Copper_enabled_thisline=0,SAEF_clrSpcFlags(SAEC_spcflag_COPPER));break;case S:if(R.state=m,R.vcmp=(R.saved_i1&(32768|R.saved_i2))>>8,R.hcmp=R.saved_i1&R.saved_i2&254,t=SAER.playfield.get_vpos()&(R.saved_i2>>8&127|128),65535==R.saved_i1&&65534==R.saved_i2)return R.state=l,SAEV_Copper_enabled_thisline=0,SAEF_clrSpcFlags(SAEC_spcflag_COPPER),R.hpos=n,void(SAEV_Copper_last_hpos=e);if(t<R.vcmp)return SAEV_Copper_enabled_thisline=0,SAEF_clrSpcFlags(SAEC_spcflag_COPPER),R.hpos=n,void(SAEV_Copper_last_hpos=e);case m:var c=n;if(1&c&&(c=0),0==(32768&R.saved_i2)&&(SAER.blitter.decide_blitter(a),SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE))return R.state=p,SAEV_Copper_enabled_thisline=0,SAEF_clrSpcFlags(SAEC_spcflag_COPPER),R.hpos=n,void(SAEV_Copper_last_hpos=e);if(SAER.playfield.copper_cant_read(a,0))continue;if(r=254&c&R.saved_i2,t==R.vcmp&&r<R.hcmp)break;R.state=u;break;case h:if((-2&(i=SAER.playfield.get_maxhpos()))<=n||1&n)break;if(SAER.playfield.copper_cant_read(a,0))continue;o=(R.saved_i1&(32768|R.saved_i2))>>8,s=R.saved_i1&R.saved_i2&254,c=SAER.playfield.get_vpos()&(R.saved_i2>>8&127|128),r=254&n&R.saved_i2,!(o<c||c==o&&s<=r)||0==(32768&R.saved_i2)&&SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE||(R.ignore_next=!0),R.state=u}}R.hpos=n,SAEV_Copper_last_hpos=e}}this.reset=function(){D=0,R.state=f,R.movedelay=0,R.strobe=0,R.ignore_next=!1},this.clr_copcon=function(){D=0},this.copper_stop=function(){0<=(SAEV_Copper_enabled_thisline=SAEV_Copper_enabled_thisline&&R.state===d?-1:SAEV_Copper_enabled_thisline)&&(SAEV_Copper_enabled_thisline=0,SAEF_clrSpcFlags(SAEC_spcflag_COPPER))},this.compute_spcflag_copper=function(e){var t,n=SAEV_Copper_enabled_thisline;if(SAEV_Copper_enabled_thisline=0,SAEF_clrSpcFlags(SAEC_spcflag_COPPER),SAEF_Custom_dmaen(SAEC_Custom_DMAF_COPEN)&&R.state!=f&&R.state!=l&&R.state!=p){if(R.state==m)if((SAER.playfield.get_vpos()&(R.saved_i2>>8&127|128))<R.vcmp)return;!n&&R.hpos<e&&e<SAER.playfield.get_maxhpos()&&(t=SAER.playfield.get_maxhpos_short(),R.hpos=e=(-2&t)<(e=e+2&-2)?-2&t:e),n||R.state!=C||(R.state=g),SAEV_Copper_enabled_thisline=1,SAEF_setSpcFlags(SAEC_spcflag_COPPER)}},this.blitter_done_notify=function(e){var t,n,r;R.state==p&&(t=(r=SAER.playfield.get_vpos())&(R.saved_i2>>8&127|128),n=r,e++,(r=SAER.playfield.get_maxhpos())<=(e&=-2)&&(e-=r,n++),R.hpos=e,R.vpos=n,R.state=m,R.saved_i2|=32768,SAEF_Custom_dmaen(SAEC_Custom_DMAF_COPEN)&&t>=R.vcmp?(SAEV_Copper_enabled_thisline=1,SAEF_setSpcFlags(SAEC_spcflag_COPPER)):SAEF_clrSpcFlags(SAEC_spcflag_COPPER))},this.cycle=function(){n(SAER.events.current_hpos())},this.sync_copper_with_cpu=function(e,t){SAEV_Copper_enabled_thisline&&n(e)},this.COP1LCH=function(e){e&=SAEV_config.chipset.mask==SAEC_Config_Chipset_Mask_OCS?7:31,w=(65535&w|e<<16)>>>0},this.COP1LCL=function(e){w=(4294901760&w|65534&e)>>>0},this.COP2LCH=function(e){e&=SAEV_config.chipset.mask==SAEC_Config_Chipset_Mask_OCS?7:31,x=(65535&x|e<<16)>>>0},this.COP2LCL=function(e){x=(4294901760&x|65534&e)>>>0},this.COPJMP=function(e,t){var n=R.strobe,r=R.state==f&&!t;SAEF_clrSpcFlags(SAEC_spcflag_COPPER),R.ignore_next=!1,n||(R.state_prev=R.state),R.state!=m&&R.state!=l||t||!SAEF_Custom_dmaen(SAEC_Custom_DMAF_COPEN)?R.state=t?k:SAEV_Copper_access?g:C:R.state=v,R.vpos=SAER.playfield.get_vpos(),R.hpos=-2&SAER.events.current_hpos(),SAEV_Copper_enabled_thisline=0,R.strobe=e,SAEF_Custom_dmaen(SAEC_Custom_DMAF_COPEN)?this.compute_spcflag_copper(SAER.events.current_hpos()):(r||0<n&&n!=e&&R.state_prev==m)&&(R.state=f)},this.COPCON=function(e){D=e}}var SAEC_Playfield_CLOCK_PAL=3546895,SAEC_Playfield_CLOCK_NTSC=3579545,SAEV_Playfield_fake_vblank_hz=0,SAEV_Playfield_frame_rendered=!1,SAEV_Playfield_frame_shown=!1,SAEV_Playfield_picasso_requested_on=!1,SAEV_Playfield_picasso_on=!1,SAER_Playfield_gfxvidinfo=null,SAER_Playfield_isvsync_chipset=null,SAER_Playfield_isvsync=null,SAER_Playfield_init_row_map=null,SAER_Playfield_current_maxvpos=null;function SAEF_Playfield_getvsyncrate(e,t){var n;e<0?(t.mult=0,t.hz=0):85<e?(t.mult=-1,t.hz=e/2):e<35&&0<e?(n=SAEV_config.video.apmode[SAEV_Playfield_picasso_on?1:0],t.mult=n.gfx_interlaced?0:1,t.hz=2*e):(t.mult=0,t.hz=e)}function SAEO_Playfield(){const o=!0,c=!0,m=8,r=8;const s=256,_=592,f=2,l=2,a=1,h=1,u=9,d=56,p=0,E=1;function i(e){return 2*e-d+h-1<<Q}const A=0;function S(){return i(234)}function g(e){return(e-=d)<<Q}function t(e){return(e>>=Q)+d}function y(e){return e-d+h-1<<Q}function v(e){return(e=t(e))-h}const b=0,C=1,k=2,R=4;function w(e){return 0!=(e&1<<b)}function x(e){return 0!=(e&1<<k)}function D(e){return 0!=(e&1<<C)}function e(){this.color_regs_ecs=new Uint16Array(32),this.acolors=new Uint32Array(256),this.color_regs_aga=new Uint32Array(256),this.extra=0}function M(e){return SAEC_LITTLE_ENDIAN?(Le[255&e]|Oe[e>>>8&255]|ze[e>>>16&255])>>>0:(Le[e>>>24&255]|Oe[e>>>16&255]|ze[e>>>8&255])>>>0}function F(e){return ne?M(e):Pe[e]}function T(e,t){return(te?e.color_regs_aga:e.color_regs_ecs)[t]}function V(e,t){if(te)for(var n=0;n<256;n++)e.acolors[n]=t.acolors[n],e.color_regs_aga[n]=t.color_regs_aga[n];else for(n=0;n<32;n++)e.color_regs_ecs[n]=t.color_regs_ecs[n],e.acolors[n]=t.acolors[n];e.extra=t.extra}const I=2147483648,P=1073741824;function n(){this.linepos=0,this.regno=0,this.value=0}const z=1760,O=(2*(_+1)+1)*z;function L(){this.pos=0,this.max=0,this.first_pixel=0,this.has_attached=!1}const N=2*(_+1)*s;function B(){this.plfleft=0,this.plfright=0,this.plflinelen=0,this.diwfirstword=0,this.diwlastword=0,this.ctable=0,this.bplcon0=0,this.bplcon2=0,this.bplcon3=0,this.bplcon4=0,this.nr_planes=0,this.bplres=0,this.ehb_seen=!1,this.ham_seen=!1,this.ham_at_start=!1,this.bordersprite_seen=!1,this.clr=function(){this.plfleft=0,this.plfright=0,this.plflinelen=0,this.diwfirstword=0,this.diwlastword=0,this.ctable=0,this.bplcon0=0,this.bplcon2=0,this.bplcon3=0,this.bplcon4=0,this.nr_planes=0,this.bplres=0,this.ehb_seen=!1,this.ham_seen=!1,this.ham_at_start=!1,this.bordersprite_seen=!1}}function U(){this.first_sprite_entry=0,this.last_sprite_entry=0,this.first_color_change=0,this.last_color_change=0,this.nr_color_changes=0,this.nr_sprites=0,this.clr=function(){this.first_sprite_entry=0,this.last_sprite_entry=0,this.first_color_change=0,this.last_color_change=0,this.nr_color_changes=0,this.nr_sprites=0}}const K=0,G=1,H=2,X=3,q=4,Z=5,j=6,Y=7,W=8;const J=1;var Q=0;function $(e){(Q=e)!=e&&sr()}function ee(){SAEV_config.video.hresolution,$(SAEV_config.video.hresolution),0<Ca&&(Q<2&&Q++,$(Q)),_o=SAEV_config.video.hresolution,0<Ca&&_o<SAEC_Config_Video_HResolution_SuperHiRes&&_o++}var te=!1,ne=!1,re=0,ie=0,ae=0,oe=0;const se=10;var ce=0,_e=0,fe=new Int32Array(f+1),le=!1,ue=!1,de=!1;const pe=[0,2,4,8,16,32,64,128];var Ee=null,Ae=null,Se=null,me=null,he=null,ge=null,ye=null,ve=null,be=null,Ce=null,ke=null;function Re(){this.flush_line=function(e,t,n){},this.flush_block=function(e,t,n,r){},this.flush_screen=function(e,t,n,r){},this.flush_clear_screen=function(e,t){},this.lockscr=function(e,t){return 1},this.unlockscr=function(e,t){},this.linemem=null,this.emergmem=null,this.bufmem=null,this.bufmem_pos=0,this.bufmemend=0,this.bufmemend_pos=0,this.realbufmem=null,this.bufmem_allocated=null,this.bufmem_lockable=!1,this.rowbytes=0,this.pixbytes=0,this.width_allocated=0,this.height_allocated=0,this.outwidth=0,this.outheight=0,this.inwidth=0,this.inheight=0,this.inwidth2=0,this.inheight2=0,this.nativepositioning=!1,this.tempbufferinuse=!1,this.extrawidth=0,this.xoffset=0,this.yoffset=0,this.inxoffset=0,this.inyoffset=0,this.clr=function(){this.linemem=null,this.emergmem=null,this.bufmem=null,this.bufmem_pos=0,this.bufmemend=0,this.bufmemend_pos=0,this.realbufmem=null,this.bufmem_allocated=null,this.bufmem_lockable=!1,this.rowbytes=0,this.pixbytes=0,this.width_allocated=0,this.height_allocated=0,this.outwidth=0,this.outheight=0,this.inwidth=0,this.inheight=0,this.inwidth2=0,this.inheight2=0,this.nativepositioning=!1,this.tempbufferinuse=!1,this.extrawidth=0,this.xoffset=0,this.yoffset=0,this.inxoffset=0,this.inyoffset=0}}var we=new function(){this.maxblocklines=0,this.drawbuffer=new Re,this.tempbuffer=new Re,this.inbuffer=null,this.outbuffer=null,this.gfx_resolution_reserved=0,this.gfx_vresolution_reserved=0,this.xchange=0,this.ychange=0};function xe(){this.attach=0,this.stdata=0,this.data=0,this.clr=function(){this.attach=0,this.stdata=0,this.data=0}}SAER_Playfield_gfxvidinfo=we;for(var De=new Array(z),Me=0;Me<z;Me++)De[Me]=new xe;var Fe=null,Te=0,Ve=0,Ie=0,Pe=new Uint32Array(4096),ze=new Uint32Array(256),Oe=new Uint32Array(256),Le=new Uint32Array(256),Ne=0,Be=0,Ue=0,Ke=0,Ge=0,He=0,Xe=new e,qe=new e,Ze=null,je=null;var Ye=new function(){this.apixelsBuffer=new ArrayBuffer(2*z),this.apixels=new Uint8Array(this.apixelsBuffer),this.apixels_l=new Uint32Array(this.apixelsBuffer)},We=null,Je=null,Qe=null,$e=0,et=new Uint16Array(2*O),tt=new function(){this.bytes=new Uint8Array(2*O)},nt=new Uint32Array(2*z);new Array(8);SAEF_memset(new Uint8Array(z),0,255,z);new Uint8Array(z);var rt=null,it=0,at=null,ot=null,st=0,ct=null,_t=null,ft=new ArrayBuffer(32*z/8);const lt=1,ut=2,dt=3,pt=4,Et=5,At=6,St=7,mt=8,ht=9,gt=2*(_+2)+1;var yt=new Uint8Array(gt);const vt=50;for(var bt=new Array(2*(_+2)),Me=0;Me<bt.length;Me++)bt[Me]=new Uint32Array(r*vt);var Ct=0,kt=0,Rt=0,wt=0,xt=0,Dt=0,Mt=0,Ft=0,Tt=0,Vt=0,It=0,Pt=0,zt=0,Ot=0,Lt=0,Nt=0,Bt=0,Ut=0;const Kt=3e4;for(var Gt=!1,Ht=!1,Xt=!1,qt=!1,Zt=0,jt=0,Yt=!1,Wt=!1,Jt=!1,Qt=0,$t=0,en=0,tn=0,nn=0,rn=0,an=0,on=[16,16],sn=0,cn=0,_n=0,fn=0,ln=0,un=0,dn=new Array(768),Me=0;Me<768;Me++)dn[Me]=new Uint32Array(3);var pn=0;function En(e,t,n){if(0==t)return 0;e<<=24;return e>>>=32-t,(e<<=n)>>>0}function An(e,t,n){return 8<=t?e<<n>>>0:e>>8-t<<n>>>0}function Sn(e,t,n){return(e&(1<<t)-1)<<n>>>0}function mn(){var e=.128*SAEV_config.video.luminance,t=(SAEV_config.video.contrast+1e3)/1e3,n=(1e3-SAEV_config.video.gamma)/1e3,r=new Array(3);r[0]=n+(1e3-SAEV_config.video.gammaCh[0])/1e3,r[1]=n+(1e3-SAEV_config.video.gammaCh[1])/1e3,r[2]=n+(1e3-SAEV_config.video.gammaCh[2])/1e3,pn=Math.floor(64*SAEV_config.video.gf[SAEV_Playfield_picasso_on?1:0].gfx_filter_blur/1e3),0;for(var i,a=0;a<768;a++)for(var o=0;o<3;o++){var s=(i=a-256,s=r[o],i+=e,(i*=t)<=0?0:s=(s=Math.pow(255,1-s)*Math.pow(i,s))<0?0:s)>>>0;255<(s=0==SAEV_config.video.luminance&&0==SAEV_config.video.contrast&&0==SAEV_config.video.gamma?255&a:s)&&(s=255),dn[a][o]=s}}function hn(e){if(null!==e.bufmem_allocated)for(var t=0;t<e.bufmem_allocated.length;t++)e.bufmem_allocated[t]=0}function gn(){for(var e=0;e<gt;e++)yt[e]=lt}function yn(e,t){return t<0?e>>-t:e<<t}function vn(e){return 0<=re?e>>re:e<<-re}function bn(){ln=2}this.alloc_colors_rgb=function(e,t,n,r,i,a,o,s,c,_,f,l,u){for(var d=e+t+n+o,p=0;p<256;p++){var E=0,E=SAEV_config.video.blackerThanBlack?Math.floor(15*p/16)+15:p;E+=256,f[p]=An(dn[E][0],e,r)|Sn(c,o,s),l[p]=An(dn[E][1],t,i)|Sn(c,o,s),u[p]=An(dn[E][2],n,a)|Sn(c,o,s),_&&(d<=16?(f[p]=SAEF_bswap16(f[p]),l[p]=SAEF_bswap16(l[p]),u[p]=SAEF_bswap16(u[p])):(f[p]=SAEF_bswap32(f[p]),l[p]=SAEF_bswap32(l[p]),u[p]=SAEF_bswap32(u[p]))),d<=16&&(f[p]=65537*f[p]>>>0,l[p]=65537*l[p]>>>0,u[p]=65537*u[p]>>>0)}},this.alloc_colors64k=function(e,t,n,r,i,a,o,s,c,_){var f=e+t+n+o;mn();for(var l=0;l<4096;l++){var u=dn[256+(u=l>>8<<4|l>>8)][0],d=dn[256+(d=(l>>4&15)<<4|l>>4&15)][1],p=dn[256+(p=(15&l)<<4|15&l)][2];Pe[l]=En(u,e,r)|En(d,t,i)|En(p,n,a)|Sn(c,o,s),_&&(Pe[l]=(f<=16?SAEF_bswap16:SAEF_bswap32)(Pe[l])),f<=16&&(Pe[l]=(65537*Pe[l]|Pe[l])>>>0)}this.alloc_colors_rgb(e,t,n,r,i,a,o,s,c,_,ze,Oe,Le),Be=(1<<e)-1<<(Ne=r)>>>0,Ke=(1<<t)-1<<(Ue=i)>>>0,He=(1<<n)-1<<(Ge=a)>>>0};function Cn(){Tt=xt,Vt=Dt,ka&&(Tt<g(2*ca)&&(Tt=g(2*ca)),Vt>g(2*_a)&&(Vt=g(2*_a)))}this.isnativevidbuf=function(){return null!==we.outbuffer&&(we.outbuffer===we.drawbuffer||we.outbuffer.nativepositioning)},this.check_custom_limits=function(){var e=SAEV_config.video.gf[0],t=e.gfx_filter_left_border>>f-SAEV_config.video.hresolution,n=e.gfx_filter_right_border>>f-SAEV_config.video.hresolution,r=e.gfx_filter_top_border,e=e.gfx_filter_bottom_border;xt<t&&(xt=t),t<n&&n<Dt&&(Dt=n),Mt<r&&(Mt=r),r<e&&e<Ft&&(Ft=e),Cn()},this.set_custom_limits=function(e,t,n,r){var i=xt,a=Dt,o=Mt,s=Ft;Dt=e<=0||n<0?(xt=0,Kt):(xt=Rt+n)+e,Ft=t<=0||r<0?(Mt=0,Kt):(Mt=Lt+r)+t,i==xt&&a==Dt&&o==Mt&&s==Ft||bn(),this.check_custom_limits()},this.store_custom_limits=function(e,t,n,r){0};var kn=null,Rn=null;function wn(){return Qt==SAEC_Config_Video_HResolution_SuperHiRes?0:rn>>f-SAEV_config.video.hresolution}var xn=0,Dn=0,Mn=0,Fn=0,Tn=0,Vn=!1,In=0,Pn=0,zn=0,On=0,Ln=0,Nn=0,Bn=0;function Un(e){return e||sn||w(Xe.extra)?0:Xe.acolors[0]}function Kn(e){var t=re;(re=e)!=t&&sr()}function Gn(e){var t=2*kn.plfleft+h,n=2*kn.plfright+h;if(e&&(t=d),zn=g(t),(On=g(n))<(zn=(n=zn)<0?0:zn)&&(On=zn),In=kn.diwfirstword,(Pn=kn.diwlastword)<In&&(Pn=In),Kn(Q-Qt),Tn=Mn=xn=wt<(xn=(xn=(xn=In)<zn?zn:xn)<Rt?Rt:xn)?wt:xn,Fn=Dn=wt<(Dn=(Dn=On<(Dn=Pn)?On:Dn)<Rt?Rt:Dn)?wt:Dn,Rn.nr_sprites&&(w(Xe.extra)?(Tn=0,Dn<Pn&&Dn<Vt&&(Dn=Pn)):(Dn<Pn&&Dn<Vt&&(Dn=Pn),(o=(o=g(2*kn.plfleft))<Rt?Rt:o)<xn&&In<=o&&(xn=o))),Vn=!1,kn.bordersprite_seen&&!w(Xe.extra)&&Rn.nr_sprites){var r=wt,i=Rt;for(c=0;c<Rn.nr_sprites;c++){var a=Ks[Rn.first_sprite_entry+c].pos;a<r&&(r=a),i<(a=Ks[Rn.first_sprite_entry+c].max+3)&&(i=a)}r=g(r>>_o)+(h<<Q),i=g(i>>_o)+(h<<Q),(xn=r<xn?r:xn)<Rt&&(xn=Rt),wt<(Dn=Dn<i?i:Dn)&&(Dn=wt),Vn=!(Tn=0)}Bn=vn(Bn=Rt<xn?0:Rt-xn);var o=Ve,s=Ie;if(o<s&&(kn.bordersprite_seen&&!w(Xe.extra)&&(Rt<o&&(o=Rt),s<wt&&(s=wt)),(o=o<0?0:o)<(s=s>z-2?z-2:s)))for(var c=o;c<=s;c++)Fe[c].clr();if(Ie=0,Ve=z-1,t-=d,Ln=z-(t<<Qt),t<<=Qt,n=xn-n,xn<Tt&&(n+=Tt-xn),Nn=z+vn(n),0!=Rn.nr_sprites){if(!te||(_=wn())&&(0<Tn?Tn-=_:xn-=_),In<zn){for(var _=vn(zn-In),f=(l=z-_)+_,c=l;c<f;c++)Ye.apixels[c]=0;In=zn}if(On<Pn){for(var l,f=(l=z+vn(On-zn))+vn(Pn-On),c=l;c<f;c++)Ye.apixels[c]=0;In=zn}}}function Hn(e,t,n){for(var r=Un(n),i=e+it,a=t+it;i<a;i++)rt[i]=r}function Xn(e,t){for(var n=Un(!1),r=e+it,i=e+it+t;r<i;r++)rt[r]=n}function qn(e){var t,n=Rt,r=Rt+we.drawbuffer.inwidth;if(e<Mt||Ft<=e){e=sn;return sn=3,Xn(n,we.drawbuffer.inwidth),void(sn=e)}if(sn)return sn=3,void Xn(n,we.drawbuffer.inwidth);Tt<=n&&r<=Vt?Xn(n,we.drawbuffer.inwidth):(n<Tt&&(Hn(n,t=Tt<r?Tt:r,!0),n=t),n<Vt&&(Hn(n,t=Vt<r?Vt:r,!1),n=t),n<r&&Hn(n,r,!0))}var Zn=0;function jn(e,t,n,r){var i=Fe[e],a=i.data;if(e+=Zn,n=(t?qt?Ae:Ee:Se)[n],a&=~(an>>>n>>>n),(0<jt||Tn<=e)&&0!=a){var o,e=255&a,e=0==e?4+Ce[a>>8]:Ce[e];return a>>>=2*e,a&=15,i.attach&&i.stdata&3<<e?(o=a,o+=r?on[1]:16):(i=a>>2,o=3&a||i,o+=r?0<i?on[1]:on[0]:16,o+=2*e),o}return 0}function Yn(e,t){return(e>>Ne&Be)+(t>>Ne&Be)>>1<<Ne|(e>>Ge&He)+(t>>Ge&He)>>1<<Ge|(e>>Ue&Ke)+(t>>Ue&Ke)>>1<<Ue}function Wn(e,t){return((e>>16&255)+(t>>16&255)>>1<<16|(e>>8&255)+(t>>8&255)>>1<<8|(e>>0&255)+(t>>0&255)>>1<<0)>>>0}var Jn=function(e,t,n){},Qn=function(e,t,n){},$n=function(e,t,n){};function er(e,t,n){Nn=Jn(Nn,e,t)}function tr(e,t,n){Nn=Qn(Nn,e,t)}function nr(e,t,n){return e}var rr=function(e,t,n){},ir=function(e,t,n){};function ar(e,t,n){var r=wn();r&&ir(e,t,t+r),it+=r;n=rr(e,t,n);return it-=r,n}function or(e,t,n){var r=e;if(t<Mn&&Mn<n){r=$n(r,t,t+(Mn-t));t=Mn}else if(n<=Mn)return r=$n(r,t,n);e=wn();return e&&ir(r,t,t+e),Te+=Zn=e,it+=e,r=ir(r,t,n),it-=e,Te-=e,Zn=0,r}function sr(){if(Ze=Xe.acolors,je=Pe,nn=255,Wt&&(Ze=qe.acolors),Fe=De,Te=0,$n=nr,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA){if(0==re)switch(we.drawbuffer.pixbytes){case 2:Jn=ue?linetoscr_16_aga_genlock:yl,Qn=ue?linetoscr_16_aga_spr_genlock:xl,$n=pl;break;case 4:Jn=ue?linetoscr_32_aga_genlock:Ql,Qn=ue?linetoscr_32_aga_spr_genlock:au,$n=Xl}else if(2==re)switch(we.drawbuffer.pixbytes){case 2:Jn=ue?linetoscr_16_stretch2_aga_genlock:bl,Qn=ue?linetoscr_16_stretch2_aga_spr_genlock:Ml,$n=Al;break;case 4:Jn=ue?linetoscr_32_stretch2_aga_genlock:eu,Qn=ue?linetoscr_32_stretch2_aga_spr_genlock:su,$n=Zl}else if(1==re)switch(we.drawbuffer.pixbytes){case 2:Jn=ue?linetoscr_16_stretch1_aga_genlock:vl,Qn=ue?linetoscr_16_stretch1_aga_spr_genlock:Dl,$n=El;break;case 4:Jn=ue?linetoscr_32_stretch1_aga_genlock:$l,Qn=ue?linetoscr_32_stretch1_aga_spr_genlock:ou,$n=ql}else if(-1==re)if(SAEV_config.video.lores_mode)switch(we.drawbuffer.pixbytes){case 2:Jn=ue?linetoscr_16_shrink1f_aga_genlock:kl,Qn=ue?linetoscr_16_shrink1f_aga_spr_genlock:Tl,$n=ml;break;case 4:Jn=ue?linetoscr_32_shrink1f_aga_genlock:nu,Qn=ue?linetoscr_32_shrink1f_aga_spr_genlock:_u,$n=Yl}else switch(we.drawbuffer.pixbytes){case 2:Jn=ue?linetoscr_16_shrink1_aga_genlock:Cl,Qn=ue?linetoscr_16_shrink1_aga_spr_genlock:Fl,$n=Sl;break;case 4:Jn=ue?linetoscr_32_shrink1_aga_genlock:tu,Qn=ue?linetoscr_32_shrink1_aga_spr_genlock:cu,$n=jl}else if(-2==re)if(SAEV_config.video.lores_mode)switch(we.drawbuffer.pixbytes){case 2:Jn=ue?linetoscr_16_shrink2f_aga_genlock:wl,Qn=ue?linetoscr_16_shrink2f_aga_spr_genlock:Il,$n=gl;break;case 4:Jn=ue?linetoscr_32_shrink2f_aga_genlock:iu,Qn=ue?linetoscr_32_shrink2f_aga_spr_genlock:lu,$n=Jl}else switch(we.drawbuffer.pixbytes){case 2:Jn=ue?linetoscr_16_shrink2_aga_genlock:Rl,Qn=ue?linetoscr_16_shrink2_aga_spr_genlock:Vl,$n=hl;break;case 4:Jn=ue?linetoscr_32_shrink2_aga_genlock:ru,Qn=ue?linetoscr_32_shrink2_aga_spr_genlock:fu,$n=Wl}wn()&&(rr=Jn,ir=Qn,Jn=ar,Qn=or)}if(!(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)&&Yt)if(0==re)switch(we.drawbuffer.pixbytes){case 2:Jn=Mf,Qn=Df;break;case 4:Jn=Vf,Qn=Tf}else if(-1==re)if(SAEV_config.video.lores_mode)switch(we.drawbuffer.pixbytes){case 2:Jn=Xf,Qn=Hf;break;case 4:Jn=Nf,Qn=Lf}else switch(we.drawbuffer.pixbytes){case 2:Jn=Kf,Qn=Uf;break;case 4:Jn=zf,Qn=Pf}else if(-2==re)if(SAEV_config.video.lores_mode)switch(we.drawbuffer.pixbytes){case 2:Jn=rl,Qn=nl;break;case 4:Jn=Jf,Qn=Wf}else switch(we.drawbuffer.pixbytes){case 2:Jn=el,Qn=$f;break;case 4:Jn=jf,Qn=Zf}if(!(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA||Yt))if(0==re)switch(we.drawbuffer.pixbytes){case 2:Jn=ue?linetoscr_16_genlock:il,Qn=ue?linetoscr_16_spr_genlock:_l;break;case 4:Jn=ue?linetoscr_32_genlock:Pl,Qn=ue?linetoscr_32_spr_genlock:Bl}else if(2==re)switch(we.drawbuffer.pixbytes){case 2:Jn=ue?linetoscr_16_stretch2_genlock:ol,Qn=ue?linetoscr_16_stretch2_spr_genlock:ll;break;case 4:Jn=ue?linetoscr_32_stretch2_genlock:Ol,Qn=ue?linetoscr_32_stretch2_spr_genlock:Kl}else if(1==re)switch(we.drawbuffer.pixbytes){case 2:Jn=ue?linetoscr_16_stretch1_genlock:al,Qn=ue?linetoscr_16_stretch1_spr_genlock:fl;break;case 4:Jn=ue?linetoscr_32_stretch1_genlock:zl,Qn=ue?linetoscr_32_stretch1_spr_genlock:Ul}else if(-1==re)if(SAEV_config.video.lores_mode)switch(we.drawbuffer.pixbytes){case 2:Jn=ue?linetoscr_16_shrink1f_genlock:cl,Qn=ue?linetoscr_16_shrink1f_spr_genlock:dl;break;case 4:Jn=ue?linetoscr_32_shrink1f_genlock:Nl,Qn=ue?linetoscr_32_shrink1f_spr_genlock:Hl}else switch(we.drawbuffer.pixbytes){case 2:Jn=ue?linetoscr_16_shrink1_genlock:sl,Qn=ue?linetoscr_16_shrink1_spr_genlock:ul;break;case 4:Jn=ue?linetoscr_32_shrink1_genlock:Ll,Qn=ue?linetoscr_32_shrink1_spr_genlock:Gl}}function cr(e,t,n){n?Hn(e,t,n):$n(Nn,e,t)}function _r(e,t,n){}var fr=0,lr=0;function ur(e,t,n){var r=vn(t-e);if(Ht)if(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)if(7<=jt)for(;0<r--;){switch(3&(i=Ye.apixels[fr]^tn)){case 0:lr=16777215&Xe.color_regs_aga[i>>2];break;case 1:lr&=16776963,lr|=252&i;break;case 2:lr&=262143,lr|=(252&i)<<16;break;case 3:lr&=16712703,lr|=(252&i)<<8}nt[fr++]=lr}else for(;0<r--;){switch(48&(i=Ye.apixels[fr]^tn)){case 0:lr=16777215&Xe.color_regs_aga[i];break;case 16:lr&=16776960,lr|=(15&i)<<4;break;case 32:lr&=65535,lr|=(15&i)<<20;break;case 48:lr&=16711935,lr|=(15&i)<<12}nt[fr++]=lr}else for(;0<r--;){switch(48&(i=Ye.apixels[fr])){case 0:lr=4095&Xe.color_regs_ecs[i];break;case 16:lr&=4080,lr|=15&i;break;case 32:lr&=255,lr|=(15&i)<<8;break;case 48:lr&=3855,lr|=(15&i)<<4}nt[fr++]=lr}else for(;0<r--;){var i=Ye.apixels[fr];lr=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?16777215&Xe.color_regs_aga[i^tn]:4095&Xe.color_regs_ecs[i],nt[fr++]=lr}}function dr(e,t,n){var r=e.pos+(h-d<<_o);r<Ve&&(Ve=r);for(var i=e.pos;i<e.max;i++,r++)0<=r&&r<z&&(Fe[r].data=et[e.first_pixel-e.pos+i],Fe[r].stdata=tt.bytes[e.first_pixel-e.pos+i],Fe[r].attach=n);Ie<r&&(Ie=r)}const pr=+vt,Er=2*vt,Ar=3*vt,Sr=4*vt,mr=5*vt,hr=6*vt,gr=7*vt;var yr=null,vr=0,br=0,Cr=!1;function kr(){var e=we.drawbuffer,t=2==e.pixbytes;if(e.height_allocated>SAEC_Video_MAX_UAE_HEIGHT&&SAEF_fatal(SAEE_Internal,"playfield.init_row_map() resolution too high, aborting..."),null===ct&&(ct=new Array(SAEC_Video_MAX_UAE_HEIGHT+1)),null===yr||yr!==e.bufmem||vr!=e.height_allocated||br!=e.rowbytes||Cr!=de){for(_t=null,i=0==vr?SAEC_Video_MAX_UAE_HEIGHT:vr,r=e.height_allocated;r<SAEC_Video_MAX_UAE_HEIGHT+1&&r<i+1;r++)ct[r]=new(t?Uint16Array:Uint32Array)(ft);if(null!==e.bufmem)for(var n=e.bufmem.byteLength,r=0,i=e.bufmem_pos;r<e.height_allocated;r++,i+=e.rowbytes)i+e.rowbytes<=n?ct[r]=t?new Uint16Array(e.bufmem,i,e.rowbytes>>1):new Uint32Array(e.bufmem,i,e.rowbytes>>2):ct[r]=new(t?Uint16Array:Uint32Array)(ft);yr=e.bufmem,vr=e.height_allocated,br=e.rowbytes,Cr=de}}function Rr(e){e===we.outbuffer&&SAER.video.unlockscr(e)}function wr(){var e=!1;Qt=kn.bplres,jt=kn.nr_planes,Ht=kn.ham_seen,Gt=kn.ehb_seen,0!=(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE)&&0!=(512&kn.bplcon2)&&(Gt=!1),Rn.nr_sprites,(Jt=0!=(512&kn.bplcon0))||0,e=Yt!=(Yt=Qt==SAEC_Config_Video_HResolution_SuperHiRes&&0!=(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE)&&0==(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)),$t=7&kn.bplcon2,en=kn.bplcon2>>3&7,an=4294901760<<4*en,an|=65535<<4*$t&65535,an>>>=0,Xt=1024==(1024&kn.bplcon0),qt=64==(64&kn.bplcon2),Wt!=(0!=(32&kn.bplcon0))&&(nn=255,Wt=0!=(32&kn.bplcon0),e=!0),Wt&&(Ht&&6==jt&&(nn=15),Ht&&8==jt&&(nn=252),Gt&&(nn=31),Gt=Ht=!1),Zt=kn.bplcon3>>10&7,on[0]=(kn.bplcon4>>4&15)<<4,on[1]=(kn.bplcon4>>0&15)<<4,tn=kn.bplcon4>>8;var t=Xe.extra>>R&3;t!=rn&&(rn=t,e=!0),(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE&&(3072&kn.bplcon2||D(Xe.extra))?1:0)&&(2048&kn.bplcon3&&kn.bplcon2,1024&kn.bplcon3&&0),e&&sr()}function xr(e,t){if(65535!=e){switch(e-=4096){case 256:kn.bplcon0=t,kn.bplres=Ei(t),kn.nr_planes=mi(t),kn.ham_seen=function(e){var t=mi(e);if(!(2048&e))return 0;if(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA){if(6==t||8==t)return 1}else{if(0<Ei(e))return 0;if(5<=t)return 1}return 0}(t);break;case 260:kn.bplcon2=t;break;case 262:kn.bplcon3=t;break;case 268:kn.bplcon4=t}wr(),Kn(Q-Qt)}else sn=1}SAER_Playfield_init_row_map=kr;var Dr=0;const Mr=0,Fr=1;var Tr=0;function Vr(e,t){if(Dr!=e||t<0){if(t)V(Xe,js[e]),Tr=Fr;else{for(var n=0;n<Xe.acolors.length;n++)Xe.acolors[n]=js[e].acolors[n];Xe.extra=js[e].extra,Tr=Mr}Dr=e}else t&&Tr!=Fr&&(V(Xe,js[e]),Tr=Fr)}function Ir(e,t,n){for(var r,i,a,o,s=Rt,c=Rt+we.drawbuffer.inwidth,_=Rn.first_color_change;_<=Rn.last_color_change;_++){var f,l=Hs[_].regno,u=Hs[_].value,d=_==Rn.last_color_change?c:g(Hs[_].linepos),p=d;if(s<(p=c<d?c:p)&&s<Tt&&(e(s,f=p<=Tt?p:Tt,!0),s=f),s<p&&s<xn&&(e(s,f=p<=xn?p:xn,!1),s=f),s<p&&xn<=s&&s<Dn&&(f=p<=Dn?p:Dn,5<en&&!(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)&&function(e,t){if(e>>=Q,t>>=Q,5!=jt||Xt){if(Xt&&qt)for(n=Ln+e;n<Ln+t;n++)42&Ye.apixels[n]&&(Ye.apixels[n]|=64);else if(Xt&&!qt)for(n=Ln+e;n<Ln+t;n++)Ye.apixels[n]&=-43}else for(var n=Ln+e;n<Ln+t;n++)16&Ye.apixels[n]&&(Ye.apixels[n]=16)}(s,f),tn&&Vn&&t!==cr?(r=t,a=f,d=o=void 0,(i=s)<Mn&&(d=(o=a<Mn?a:Mn)-i,cr(i,o,!1),0<=re?d>>=re:d<<=re,Nn+=d,i=o),r(i,a<Fn?a:Fn,!1),Fn<a&&cr(Fn,a,!1)):t(s,f,!1),s=f),s<p&&Dn<=s&&(e(s,f=p<=Vt?p:Vt,!1),s=f),Vt<p&&(e(Vt,p,!0),s=p),4096<=l?xr(l,u):0<=l&&(0==l&&u&I?(Xe.extra&=~(1<<b),Xe.extra&=~(1<<C),Xe.extra&=~(1<<k),Xe.extra|=0!=(1&u)?1<<b:0,Xe.extra|=2==(3&u)?1<<k:0,Xe.extra|=4==(5&u)?1<<C:0):0==l&&u&P?(Xe.extra&=~(1<<R),Xe.extra&=~(1<<R+1),Xe.extra|=(3&u)<<R,wr()):(i=Xe,a=l,p=u,te?i.color_regs_aga[a]=p:i.color_regs_ecs[a]=p,Xe.acolors[l]=F(u))),c<=s)break}(n<Mt||Ft<=n)&&e(Rt,Rt+we.drawbuffer.inwidth,!0)}const Pr=0,zr=1,Or=2;function Lr(e,t,n,r){var i,a=0,o=0,s=0,c=yt[t];switch(kn=Ls[t],Rn=qs[t],0<=kn.plfleft&&fe[kn.bplres]++,c){case ht:return void(un||(SAEF_warn("playfield.pfield_draw_line() Shouldn't get here... this is a bug."),un++));case Et:yt[t]=At,a=-1;break;case At:return;case pt:kn=Ls[t-1],Rn=qs[t-1],yt[t]=mt,kn.plfleft<0&&(a=1);break;case mt:case St:return;case dt:0<=r&&(yt[t+(o=1)]=mt);default:kn.plfleft<0&&(a=1),yt[t]=St}if(c=Hs[(i=Rn).first_color_change].regno,c=1<(i=i.nr_color_changes)||1==i&&65535!=c&&-1!=c,it=0,(rt=null)!==we.drawbuffer.linemem&&(s=zr,rt=new(2==we.drawbuffer.pixbytes?Uint16Array:Uint32Array)(we.drawbuffer.linemem)),null===rt&&null!==we.drawbuffer.emergmem&&o&&(0==a||c)&&(s=Or,rt=new(2==we.drawbuffer.pixbytes?Uint16Array:Uint32Array)(we.drawbuffer.emergmem)),null===rt&&(s=Pr,rt=ct[n]),it-=It,null!==_t&&(_t[n]=Jt),0==a){if(wr(),Gn(!1),function(e){var t=kn.plflinelen,n=z>>2;if(0!=jt){for(var r=bt[e],i=0,a=pr,o=Er,s=Ar,c=Sr,_=mr,f=hr,l=gr;0<t--;){var u=0,d=0,p=0,E=0,A=0,S=0,m=0,h=0;switch(jt){case 8:u=r[l++];case 7:d=r[f++];case 6:p=r[_++];case 5:E=r[c++];case 4:A=r[s++];case 3:S=r[o++];case 2:m=r[a++];case 1:h=r[i++]}var g=1431655765&(u^d>>>1);u^=g,d^=g<<1,p^=g=1431655765&(p^E>>>1),E^=g<<1,A^=g=1431655765&(A^S>>>1),S^=g<<1,m^=g=1431655765&(m^h>>>1),h^=g<<1,u^=g=858993459&(u^p>>>2),p^=g<<2,d^=g=858993459&(d^E>>>2),E^=g<<2,A^=g=858993459&(A^m>>>2),m^=g<<2,S^=g=858993459&(S^h>>>2),h^=g<<2,u^=g=252645135&(u^A>>>4),A^=g<<4,d^=g=252645135&(d^S>>>4),S^=g<<4,p^=g=252645135&(p^m>>>4),m^=g<<4,E^=g=252645135&(E^h>>>4),h^=g<<4,u^=g=16711935&(u^d>>>8),d^=g<<8,p^=g=16711935&(p^E>>>8),E^=g<<8,A^=g=16711935&(A^S>>>8),S^=g<<8,m^=g=16711935&(m^h>>>8),h^=g<<8,u^=g=65535&(u^p>>>16),p^=g<<16,d^=g=65535&(d^E>>>16),E^=g<<16,A^=g=65535&(A^m>>>16),m^=g<<16,S^=g=65535&(S^h>>>16),h^=g<<16,SAEC_LITTLE_ENDIAN?(Ye.apixels_l[n]=(255&u)<<24|(65280&u)<<8|(16711680&u)>>>8|(4278190080&u)>>>24,Ye.apixels_l[n+1]=(255&A)<<24|(65280&A)<<8|(16711680&A)>>>8|(4278190080&A)>>>24,Ye.apixels_l[n+2]=(255&d)<<24|(65280&d)<<8|(16711680&d)>>>8|(4278190080&d)>>>24,Ye.apixels_l[n+3]=(255&S)<<24|(65280&S)<<8|(16711680&S)>>>8|(4278190080&S)>>>24,Ye.apixels_l[n+4]=(255&p)<<24|(65280&p)<<8|(16711680&p)>>>8|(4278190080&p)>>>24,Ye.apixels_l[n+5]=(255&m)<<24|(65280&m)<<8|(16711680&m)>>>8|(4278190080&m)>>>24,Ye.apixels_l[n+6]=(255&E)<<24|(65280&E)<<8|(16711680&E)>>>8|(4278190080&E)>>>24,Ye.apixels_l[n+7]=(255&h)<<24|(65280&h)<<8|(16711680&h)>>>8|(4278190080&h)>>>24):(Ye.apixels_l[n]=u,Ye.apixels_l[n+1]=A,Ye.apixels_l[n+2]=d,Ye.apixels_l[n+3]=S,Ye.apixels_l[n+4]=p,Ye.apixels_l[n+5]=m,Ye.apixels_l[n+6]=E,Ye.apixels_l[n+7]=h),n+=8}if(null!==We&&e<$e){var t=kn.plflinelen,y=new Uint32Array(We,e*z*2);t*=8;for(var v=!0,b=0;b<t;b++)if(y[b]!=r[b]){v=!1;break}if(v)255!=Je[e]&&(Je[e]++,Je[e]>Qe[e]&&(Qe[e]=Je[e]));else{for(b=0;b<t;b++)y[b]=r[b];Je[e]!=Qe[e]&&(Qe[e]=0),Je[e]=0}}}else for(var b=n,C=n+8*t;b<C;b++)Ye.apixels_l[b]=0}(t),Vr(kn.ctable,kn.ham_seen||Gt||Yt),kn.ham_seen&&(_=sn,function(){var e,t=Bn;if(fr=Nn,lr=T(Xe,0),Ht)if(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)if(7<=jt)for(;0<t--;)switch(3&(e=Ye.apixels[fr++]^tn)){case 0:lr=16777215&Xe.color_regs_aga[e>>2];break;case 1:lr&=16776963,lr|=252&e;break;case 2:lr&=262143,lr|=(252&e)<<16;break;case 3:lr&=16712703,lr|=(252&e)<<8}else for(;0<t--;)switch(48&(e=Ye.apixels[fr++]^tn)){case 0:lr=16777215&Xe.color_regs_aga[e];break;case 16:lr&=16776960,lr|=(15&e)<<4;break;case 32:lr&=65535,lr|=(15&e)<<20;break;case 48:lr&=16711935,lr|=(15&e)<<12}else for(;0<t--;)switch(48&(e=Ye.apixels[fr++])){case 0:lr=4095&Xe.color_regs_ecs[e];break;case 16:lr&=4080,lr|=15&e;break;case 32:lr&=255,lr|=(15&e)<<8;break;case 48:lr&=3855,lr|=(15&e)<<4}else 0<t&&(e=Ye.apixels[fr+t-1],lr=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?16777215&Xe.color_regs_aga[e^tn]:4095&Xe.color_regs_ecs[e])}(),Ir(_r,ur,t),c&&(Vr(kn.ctable,-1),wr()),sn=_,fr=Nn,Ht=kn.ham_at_start),Rn.nr_sprites)for(x(Xe.extra)&&kn.bordersprite_seen&&!w(Xe.extra)&&function(){var e,t,n,r=re;if(r<0){for(n=(t=Ln+(xn<<(r=-r)))+(Mn-xn<<r),e=t;e<n;e++)Ye.apixels[e]=0;for(n=(t=Ln+(Fn<<r))+(Dn-Fn<<r),e=t;e<n;e++)Ye.apixels[e]=0}else{for(n=(t=Ln+(xn>>r))+(Mn-xn>>r),e=t;e<n;e++)Ye.apixels[e]=0;for(n=(t=Ln+(Fn>>r))+(Dn-Fn>>r),e=t;e<n;e++)Ye.apixels[e]=0}}(),l=0;l<Rn.nr_sprites;l++)dr(f=Ks[Rn.first_sprite_entry+l],0,f.has_attached);Rn.nr_sprites&&x(Xe.extra)&&!w(Xe.extra)&&kn.bordersprite_seen?Ir(cr,tr,t):Ir(Hn,Rn.nr_sprites?tr:er,t),s==Or&&ct[n].set(rt.subarray(0,we.drawbuffer.inwidth)),o&&(s==Or?ct[r].set(rt.subarray(0,we.drawbuffer.inwidth)):s==Pr&&ct[r].set(ct[n].subarray(0,we.drawbuffer.inwidth))),Rn.nr_sprites&&function(){if(Ve<zn)for(var e=vn(zn-Ve),t=(r=z-e)+e,n=r;n<t;n++)Ye.apixels[n]=0;if(On<Ie)for(var r,t=(r=z+vn(On-zn))+vn(Ie-On),n=r;n<t;n++)Ye.apixels[n]=0}()}else if(0<a){var _=!1;if(Vr(kn.ctable,0),kn.bordersprite_seen&&!w(Xe.extra)&&Rn.nr_sprites&&(_=!0,wr(),Gn(!0),function(){if(!(wt<=Rt)){var e=0,t=0;Rt<zn&&(e=-(t=vn(zn-Rt))),zn<wt&&(t+=vn(wt-zn));for(var e=z-e,n=e+t,r=e;r<n;r++)Ye.apixels[r]=0}}()),!_&&!c)return kn.plfleft<-1?(u=sn,sn=1,qn(t),sn=u):qn(t),void(o&&s==Pr&&(rt=ct[r],it=0-It,qn(t)));if(_){for(var f,l=0;l<Rn.nr_sprites;l++)dr(f=Ks[Rn.first_sprite_entry+l],0,f.has_attached);Ir(cr,cr,t)}else Dn=xn=wt,Ir(Hn,Hn,t);s==Or&&ct[n].set(rt.subarray(0,we.drawbuffer.inwidth)),o&&(s==Or?ct[r].set(rt.subarray(0,we.drawbuffer.inwidth)):s==Pr&&ct[r].set(ct[n].subarray(0,we.drawbuffer.inwidth)))}else{var u=sn;sn=1,qn(t),sn=u}}function Nr(){for(var e,t,n,r,i=0;i<=f;i++)fe[i]=0;if(ce=-1,_e=0,se,ee(),function(){if(Gs)for(var e=Gs[0].first_pixel,t=Gs[Bs].first_pixel-e,n=0;n<t;n++)et[e+n]=0,tt.bytes[e+n]=0;Bs=Ns,Js=Ns=Ws=0,Qs=-1,Gs=Vs[Ts],Ks=Vs[1^Ts],Xs=Is[Ts],Hs=Is[1^Ts],Ys=Os[Ts],js=Os[1^Ts],Zs=Ps[Ts],qs=Ps[1^Ts],Ts^=1,$s=ec=-1,Ks[0].first_pixel=Ts*O,Us=1}(),Bt<(Nt=Nt<0?la:Nt)&&(Bt=Nt),e=2+(sa+1<<ie),o)for(i=0;i<e;i++)switch(yt[i]){case mt:yt[i]=ht;break;case At:break;default:yt[i]=lt}else for(i=0;i<e;i++)yt[i]=lt;ln?(gn(),fn=1,ln--):fn=0,t=Rt,n=Pt,r=we.drawbuffer.inwidth,SAEV_config.video.xcenter&&0<kt&&!SAEV_config.video.gf[0].gfx_filter_autoscale?(Rt=kt-Ct<r&&2==SAEV_config.video.xcenter?Math.truncate((kt-Ct-r)/2)+Ct:kt-r-Math.truncate((kt-Ct-r)/2),Rt&=~(yn(1,Q)-1),le||Rs||2==SAEV_config.video.xcenter&&Rt<t&&t<Ct&&Ct-Rt<=32&&(Rt=t)):we.drawbuffer.extrawidth?(Rt=S()-r,0<we.drawbuffer.extrawidth&&(Rt+=we.drawbuffer.extrawidth<<SAEV_config.video.hresolution)):Rt=we.drawbuffer.inxoffset<0?0:we.drawbuffer.inxoffset-d,(Rt=Rt>S()-32?S()-32:Rt)<0&&(Rt=0),Rt&=~(yn(1,Q)-1),It=Rt,we.drawbuffer.pixbytes,(wt=Rt+r)>S()&&(wt=S()),(r=st)>we.drawbuffer.inheight&&(r=we.drawbuffer.inheight),r>>=ie,Pt=la,SAEV_config.video.ycenter&&0<=Nt&&!SAEV_config.video.gf[0].gfx_filter_autoscale&&(Pt=Bt-Nt<r&&2==SAEV_config.video.ycenter?Math.truncate((Bt-Nt-r)/2)+Nt:Nt,le||ws||2==SAEV_config.video.ycenter&&Pt!=n&&n<=Nt&&Bt<n+r&&(Pt=n)),zt=(Pt=(Pt=aa+(aa>>1)<Pt+r?aa+(aa>>1)-r:Pt)<0?0:Pt)<<ie,Ot=sa-la+1<<ie,t==Rt&&n==Pt||ln<(n=0<oe&&ie?2:1)&&(ln=n),kt=0,Ct=Kt,we.drawbuffer.xoffset=(d<<f)+(Rt<<f-SAEV_config.video.hresolution),we.drawbuffer.yoffset=Pt<<a,Rs=ws=le=!1,Dr=Bt=Nt=-1}function Br(e,t,n,r){if(!(n<=0))switch(t){case 1:e[n]=255&r;break;case 2:e[n]=65535&r;break;case 3:break;case 4:e[n]=r}}const Ur=[1911,240,15,4080,3855];function Kr(){wi=0,xi=ns=-1,Di=K,_s=p,p,ps!=Es&&(Rs=ws=!0),Es=ps,us==As&&ds==Ss||(Rs=!0),As=us,Ss=ds,ms==vs&&hs==bs&&gs==Cs&&ys==ks||(ws=!0),vs=ms,bs=hs,Cs=gs,ks=ys,ds=us=0,ms=S(),hs=0,gs=S(),Yo=X0();for(var e=Jo=ps=Wo=ys=0;e<m;e++)Ya[e].ptxhpos=s,Ya[e].ptxvpos2=-1;bc=vc}function Gr(){var e=we.drawbuffer;we.outbuffer=e,SAER.video.lockscr(e,!1)?o?(function(e){for(var t=0;t<Ot;t++){var n=t+Lt,r=t+zt,i=at[n],n=at[n+1];if(i>=e.inheight)break;i<0||Lr(sn=0,r,i,n)}}(e),null!==We&&function(e){for(var t=0;t<Ot;t++){var n=t+Lt,r=t+zt,i=at[n],n=at[n+1];if(i>=e.inheight)break;if(!(i<0)){if($e<=r)break;rt=ct[i];var i=Qe[r],a=0,o=0;(i=0<=n?Qe[-2&r]:i)<=4?a=o=Ur[i]:i<=8&&(o=Ur[i-5]);for(var s=0;s<8;s++)Br(rt,we.drawbuffer.pixbytes,s,Pe[a]);for(s=8;s<16;s++)Br(rt,we.drawbuffer.pixbytes,s,Pe[o])}}}(e),Rr(e)):oe?SAER.video.unlockscr():Rr(e):bn()}function Hr(e){var t,n;o||0<=(t=e-zt)&&t<Ot&&((n=at[t+Lt])<we.drawbuffer.outheight&&0<=n&&Lr(we.drawbuffer,e,n,at[t+Lt+1]))}function Xr(e,t){if(Ut++,t||oe<=0||SAEV_config.video.iscanlines&&0<oe||2<=Ut||e||Ca<0){if((Ut=0)==_n&&Gr(),SAEV_command<0)return SAEV_command=-SAEV_command,e=J,cn|=1<<e,void SAEF_setSpcFlags(SAEC_spcflag_BRK|SAEC_spcflag_MODE_CHANGE);++_n>=SAEV_config.video.framerate&&(_n=0),0==(_n=cn?1:_n)&&Nr()}SAER.gui.flicker_led(-1,0,0)}function qr(e,t,n){if(0==_n)switch(n|=0!=ln||null!==We?1:0,t){case K:yt[e]=n?ut:St;break;case G:yt[e]=n?dt:St,n|=yt[e+1]!=ht?1:0,yt[e+1]=n?pt:mt;break;case q:yt[e]=n?ut:St,yt[e+1]!=At&&(yt[e+1]=Et);break;case X:0<e&&yt[e-1]==lt&&(yt[e-1]=ut),yt[e]=n?ut:St;break;case H:yt[e]=n?ut:St,yt[e+1]!=lt&&yt[e+1]!=ht&&yt[e+1]!=pt||(yt[e+1]=ut);break;case W:yt[e+1]=Et,yt[e]=ut;break;case j:n|=yt[e]!=St?1:0,yt[e+1]=St,yt[e]=n?ut:St;break;case Y:yt[e]=ut,0<e&&(yt[e-1]=Et),oe||e!=2*(aa+vi)-2||(yt[e+1]=Et);break;case Z:n|=yt[e]!=St?1:0,yt[e]=n?ut:St,0<e&&(yt[e-1]=St),oe||e!=2*(aa+vi)-2||(yt[e+1]=St)}}function Zr(e){var t=!1;return oe=e?(0==oe&&(t=!0),SAEV_config.video.vresolution?1:-1):(oe&&(t=!0),0),t}function jr(){kt=0,ee(),gn(),function(){var e,t,n=we.drawbuffer.height_allocated;if(0!=n){for(ae=ie=SAEV_config.video.vresolution,0<Ca&&oe<=0&&(ie=0,ae=1),at=new Array(2*(_+1)+1),ot=new Array(n),t=_+1<<ae,Lt=la<<ie,st=-1,e=0;e<t;e++){var r=e-Lt;n<=r&&st<0&&(st=r),(e<Lt||n<=r)&&(r=-1),at[e]=r}for(st<0&&(st=t-Lt),e=0;e<n;e++)ot[e]=-1;for(e=t-1;Lt<=e;e--)if(-1!=at[e])for(var i=at[e];i<n&&-1==ot[i];i++)ot[i]=e>>ie;we.xchange=1<<f-SAEV_config.video.hresolution,we.ychange=ie?1:2,xt=0,Dt=Kt,Mt=0,Ft=Kt,Cn()}}(),yr=null,br=vr=0,Cr=!1,kr(),SAEF_memset(et,Ut=0,0,2*O),SAEF_memset(tt.bytes,0,0,2*O),Nr(),sr(),bn(),0,0,le=!0,hn(we.drawbuffer),hn(we.tempbuffer),le=!0,un=0}function Yr(){Qe=Je=We=null,SAEV_config.video.refreshIndicator&&($e=600,We=new ArrayBuffer(2*z*$e),Je=new Uint8Array($e),Qe=new Uint8Array($e)),function(){if(null===Ee){Ee=new Array(256),Ae=new Array(256),Se=new Array(256),me=new Array(256),he=new Array(256),ge=new Array(256),ye=new Array(256),ve=new Array(256),be=new Array(256),Ce=new Array(256),ke=new Uint32Array(256);for(var e=0;e<256;e++){var t=e>>0&1|e>>1&2|e>>2&4|e>>3&8,n=e>>1&1|e>>2&2|e>>3&4|e>>4&8;ge[e]=0==t&&0!=n,ye[e]=0!=n,ve[e]=0==t?n:t,be[e]=0==n?t:n,Ee[e]=0==t?0==n?16:8:0,Ae[e]=0==n?0==t?16:0:8,Se[e]=0==e?16:8,0<n&&(n+=8),me[e]=128<=e?127&e:0==t?n:t,he[e]=128<=e?127&e:0==n?t:n,64&e&&(he[e]=0,me[e]=0),Ce[e]=15&e?0:2,ke[e]=(3&e&&12&e)<<9|(3&e&&48&e)<<10|(3&e&&192&e)<<11|(12&e&&48&e)<<12|(12&e&&192&e)<<13|(48&e&&192&e)<<14}}}(),function(){for(var e=0;e<256;e++)qe.acolors[e]=M((e<<16|e<<8|e)>>>0)}(),SAEV_Playfield_picasso_requested_on=SAEV_Playfield_picasso_on=!1,rt=null!==we.drawbuffer.bufmem?new(2==we.drawbuffer.pixbytes?Uint16Array:Uint32Array)(we.drawbuffer.bufmem):null,cn=0,we.drawbuffer.flush_line=function(e,t,n){},we.drawbuffer.flush_block=function(e,t,n,r){},we.drawbuffer.flush_screen=function(e,t,n,r){},we.drawbuffer.flush_clear_screen=function(e,t){},we.drawbuffer.lockscr=function(e,t){return 1},we.drawbuffer.unlockscr=function(e,t){},jr()}function Wr(){var e=SAEV_config.video.apmode[0];return SAEV_Playfield_picasso_on||!e.gfx_vsync?0:0==e.gfx_vsyncmode?1:0<=SAEV_config.cpu.speed?-1:-2}SAER_Playfield_isvsync_chipset=Wr;const Jr=!0,Qr=2048,$r=512,ei=3,ti=227,ni=227,ri=312,ii=262,ai=26,oi=21,si=25,ci=20,_i=50,fi=60,li=5,ui=6,di=8,pi=10;function Ei(e){return SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE||(e&=-65),64&e?SAEC_Config_Video_HResolution_SuperHiRes:32768&e?SAEC_Config_Video_HResolution_HiRes:SAEC_Config_Video_HResolution_LoRes}function Ai(e){return SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS||(e&=-65),64&e?SAEC_Config_Video_HResolution_SuperHiRes:32768&e?SAEC_Config_Video_HResolution_HiRes:SAEC_Config_Video_HResolution_LoRes}function Si(e){return 3==(e=e>>2&3)?64:0==e?16:32}function mi(e){return 16&e&&28672&e?0:16&e?8:e>>12&7}var hi=0,gi=0,yi=0,vi=0,bi=0,Ci=!(SAER_Playfield_isvsync=function(){return SAEV_Playfield_picasso_on?(e=SAEV_config.video.apmode[1],SAEV_Playfield_picasso_on&&e.gfx_vsync?0==e.gfx_vsyncmode?1:0<=SAEV_config.cpu.speed?-1:-2:0):Wr();var e}),ki=!1,Ri=0,wi=0,xi=0,Di=0,Mi=0,Fi=0,Ti=0,Vi=0,Ii=0,Pi=!1,zi=0,Oi=!1,Li=!1,Ni=!1;const Bi=3;var Ui=0,Ki=0,Gi=0,Hi=0,Xi=0,qi=0,Zi=0,ji=0,Yi=0,Wi=0,Ji=null,Qi=null,$i=null,ea=null,ta=null,na=new Uint8Array(256),ra=(new Uint16Array(256),ti),ia=ti,aa=ri,oa=ri,sa=ri,ca=0,_a=0,fa=511,la=ai,ua=0,da=di,pa=!0,Ea=_i,Aa=0,Sa=0,ma=0,ha=0,ga=0,ya=0,va=0,ba=null,Ca=0,ka=!1,Ra=0,wa=0,xa=0,Da=0,Ma=!1,Fa=ri,Ta=ti,Va=0,Ia=0,Pa=0,za=0,Oa=0,La=0,Na=0,Ba=0,Ua=0,Ka=0,Ga=0,Ha=0,Xa=0,qa=0;function Za(){this.pt=0,this.xpos=0,this.vstart=0,this.vstop=0,this.dblscan=0,this.armed=0,this.dmastate=0,this.dmacycle=0,this.ptxhpos=0,this.ptxhpos2=0,this.ptxvpos2=0,this.ignoreverticaluntilnextline=!1,this.clr=function(){this.pt=0,this.xpos=0,this.vstart=0,this.vstop=0,this.dblscan=0,this.armed=0,this.dmastate=0,this.dmacycle=0,this.ptxhpos=0,this.ptxhpos2=0,this.ptxvpos2=0,this.ignoreverticaluntilnextline=!1}}const ja=21;for(var Ya=new Array(m),Me=0;Me<m;Me++)Ya[Me]=new Za;for(var Wa=0,Ja=!1,Qa=new Uint32Array(4),$a=si,eo=new Uint16Array(m),to=new Uint16Array(m),no=new Array(m),Me=0;Me<m;Me++)no[Me]=new Uint16Array(4);for(var ro=new Array(m),Me=0;Me<m;Me++)ro[Me]=new Uint16Array(4);for(var io=0,ao=0,oo=0,so=0,co=0,_o=0,fo=!1,lo=!1,uo=!1,po=0,Eo=0,Ao=0,So=0,mo=0,ho=0,go=new Array(2),Me=0;Me<go.length;Me++){go[Me]=new Array(_);for(var yo=0;yo<go[Me].length;yo++){go[Me][yo]=new Array(8);for(var vo=0;vo<go[Me][yo].length;vo++)go[Me][yo][vo]=0}}for(var bo=new Array(8),Co=new Array(8),Me=0;Me<8;Me++)bo[Me]=0,Co[Me]=0;for(var ko,Ro=0,wo=new e,xo=0,Do=0,Mo=0,Fo=0,To=0,Vo=0,Io=0,Po=0,zo=0,Oo=0,Lo=0,No=0,Bo=0,Uo=0,Ko=0,Go=0,Ho=0,Xo=0,qo=-1,Zo=0,jo=0,Yo=0,Wo=0,Jo=0,Qo=0,$o=0,es=0,ts=0,ns=0,rs=0,is=0,as=0,os=0,ss=0,cs=0,_s=0,fs=0,ls=0,us=0,ds=0,ps=0,Es=0,As=0,Ss=0,ms=0,hs=0,gs=0,ys=0,vs=0,bs=0,Cs=0,ks=0,Rs=0,ws=0,xs=0,Ds=0,Ms=0,Fs=0,Ts=0,Vs=new Array(2),Me=0;Me<Vs.length;Me++){Vs[Me]=new Array(O>>4);for(yo=0;yo<Vs[Me].length;yo++)Vs[Me][yo]=new L}for(var Is=new Array(2),Me=0;Me<Is.length;Me++){Is[Me]=new Array(N);for(yo=0;yo<Is[Me].length;yo++)Is[Me][yo]=new n}for(var Ps=new Array(2),Me=0;Me<Ps.length;Me++){Ps[Me]=new Array(2*(_+2)+1);for(yo=0;yo<Ps[Me].length;yo++)Ps[Me][yo]=new U}const zs=2*(_+2);for(var Os=new Array(2),Me=0;Me<Os.length;Me++){Os[Me]=new Array(zs);for(yo=0;yo<Os[Me].length;yo++)Os[Me][yo]=new e}for(var Ls=new Array(2*(_+2)+1),Me=0;Me<2*(_+2)+1;Me++)Ls[Me]=new B;var Ns=0,Bs=0,Us=1,Ks=null,Gs=null,Hs=null,Xs=null,qs=null,Zs=null,js=null,Ys=null,Ws=0,Js=0,Qs=0,$s=0,ec=0,tc=0,nc=0,rc=new B,ic=0,ac=0,oc=!1,sc=0,cc=0,_c=0,fc=0,lc=!1,uc=0,dc=0,pc=!1,Ec=!0;const Ac=0,Sc=3,mc=4,hc=5,gc=6,yc=7,vc=8;var bc=Ac;const Cc=0,kc=1,Rc=2,wc=3;var xc=Cc;const Dc=0,Mc=1,Fc=2,Tc=3;var Vc=Dc,Ic=20;function Pc(){return 0!=_n}function zc(){return SAEV_config.video.vresolution&&Ca<0&&hi<_}function Oc(){wa=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?Ra:0,oo=Si(wa)}function Lc(){te=0!=(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA),ne=te,co=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?25:SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE?17:1,Oc()}function Nc(e){if(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)for(var t=0;t<256;t++)(n=T(e,t))<0||16777215<n||(e.acolors[t]=F(n));else for(var n,t=0;t<32;t++)(n=T(e,t))<0||4095<n||(e.acolors[t]=F(n))}function Bc(){Lc(),Nc(wo),Nc(Xe);for(var e=0;e<2*(_+1);e++)Nc(Os[0][e]),Nc(Os[1][e])}function Uc(){var e,t;Js>=zs||(Qs<0&&(V(js[Js],wo),Qs=Js++),rc.ctable=Qs,$s<0||ec!=Qs||Ls[wi].ctable!=$s?((e=Ls[wi].ctable)<(t=0)?$s=ec=-(t=1):((tc=0!=function(e,t){if(te){for(var n=0;n<256;n++)if(e.color_regs_aga[n]!=t.color_regs_aga[n])return 1}else for(n=0;n<32;n++)if(e.color_regs_ecs[n]!=t.color_regs_ecs[n])return 1;return e.extra==t.extra?0:1}(Ys[e],wo))&&(t=1),$s=e,ec=Qs),nc|=t):tc&&(nc=1))}function Kc(){return da+(pa&&bi?1:0)}this.get_maxhpos=function(){return ra},this.get_maxhpos_short=function(){return ia},this.get_maxvpos=function(){return aa},this.get_maxvpos_nom=function(){return oa},this.get_maxvpos_display=function(){return sa},this.get_vpos=function(){return hi},this.get_vblank_hz=function(){return Ea},this.get_beamcon0=function(){return xa},this.set_line_cyclebased=function(){Go=2},this.get_slowdowndata=function(){return[rc.plfleft,rc.plfright-(16<<jc),d_[jc][Ai(xo)][$c(xo)],u_[jc][Ai(xo)][$c(xo)]]},this.set_bitplane_maybe_start_hpos=function(e){Go=2,dc=e},this.copper_cant_read=function(e,t){return ra<=e+1?1:e==ra-3&&1&ra&&0<=t?-1:this.is_bitplane_dma(e)},this.notice_new_xcolors_ext=function(){Bc()};const Gc=4;function Hc(){return 128&xa||16384&xa||64&xo}function Xc(){return Hc()?ra:212}const qc=20;function Zc(e){var t=ra<=e?2*ra+1:2*e+2;for(!(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE)&&hi<=Kc()&&(t=Ha),t&=511;;){var n=t;if(Ka<=(n=n<cs?512:n)&&cs<Ka&&fs==p&&(rc.diwfirstword<0&&(rc.diwfirstword=os<0?i(0):os),fs=E),(ra<=e&&Hc()||Ga<=n&&cs<Ga)&&fs==E&&(rc.diwlastword<0&&(rc.diwlastword=ss<0?0:ss),fs=p),512!=n)break;cs=-1}cs=t}var jc=0,Yc=0,Wc=0,Jc=0,Qc=[];function $c(e){var t=Ai(e),e=mi(e);return Qc[jc][t][e]}function e_(){0<mo&&(po=Ao,mo=0),0<ho&&(Eo=So,ho=0)}this.isvga=function(){return!!(128&xa)&&2e4<=Sa},this.ispal=function(){return 128&xa?0==SAEV_config.chipset.ntsc:sa>=ii+(ri-ii>>1)};var t_=0,n_=0,r_=0,i_=0,a_=0,o_=0,s_=0;const c_=[8,8,8,0,16,8,8,0,32,16,8,0],__=[3,2,1,0,4,3,2,0,5,4,3,0],f_=[3,2,1,0,3,3,2,0,3,3,3,0];var l_=null,u_=null,d_=null,p_=null;const E_=[[2,1,2,1,2,1,2,1],[4,2,3,1,4,2,3,1],[8,4,6,2,7,3,5,1]];var A_=0,S_=0;function m_(e){var t,n=c_[4*jc+Po],r=8<=n?8:n;A_=bc<hc?(t=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS?$o+Gc<e||$o>Xc()?Xc():$o:$o+Gc<=e||$o>Xc()?Xc():$o,e+((t=ic+(t-e+Gc)+n-1&~(n-1))-ic)+r):(t=ic+n-1&~(n-1),bc==yc&&(t-=n),e+(t-ic)+r)}var h_,g_,y_,v_=new Uint32Array(r),b_=0,C_=0,k_=new Uint16Array(r),R_=new Uint16Array(r),w_=new Uint16Array(r),x_=new Array(2),D_=new Uint32Array(r),M_=new Uint32Array(r),F_=new Uint32Array(r),T_=new Uint32Array(r),V_=new Uint32Array(r),I_=new Uint32Array(r),P_=0,z_=0,O_=0,L_=0,N_=0,B_=0,U_=new Int32Array(2),K_=new Int32Array(2),G_=new Int32Array(2),H_=0,X_=new Int32Array(2),q_=!1,Z_=0;function j_(e,t,n){e*=2;4364==t&&e++,Hs[Ws].linepos=e,Hs[Ws].regno=t,Hs[Ws].value=n,Hs[++Ws].regno=-1}function Y_(e){return SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?24576==(28688&e):SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE?24576==(64512&e)||28672==(64512&e):(24576==(64512&e)||28672==(64512&e))&&!SAEV_config.chipset.deniseNoEHB}function W_(){return 0==(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)&&0==Po&&7==zo}function J_(){return!(2048&xa||32&xa)&&SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS||!(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS||!SAEV_config.chipset.ntsc)}function Q_(e){var t=15&e|(3072&e)>>6,n=e>>4&15|(e>>4&3072)>>6,r=e>>8&3,i=e>>12&3,a=Wc>>P_;U_[0]=(t&a)<<P_,U_[0]|=r>>f-P_,U_[1]=(n&a)<<P_,U_[1]|=i>>f-P_,c&&(n+=e=Yc-((ls-(qc+Gc)&a_)<<1),K_[0]=((t+=e)&a)<<P_,K_[0]|=r>>f-P_,K_[1]=(n&a)<<P_,K_[1]|=i>>f-P_)}function $_(){Hc()?(X_[0]=512<<Po,X_[1]=512<<Po):(X_[0]=2*(ra+1)+0<<Po,X_[1]=X_[0],J_()&&X_[1]++)}function e0(e){switch(3&wa){case 0:jc=0;break;case 1:case 2:jc=1;break;case 3:jc=2}Ho=Ai(xo)!=Ei(xo),Po=Ai(xo),zo=mi(xo),Oo=$c(xo),t_=c_[4*jc+Po],n_=t_-1,i_=__[4*jc+Po],a_=(r_=1<<i_)-1,s_=f_[4*jc+Po],o_=1<<s_,ac=t_-r_,Jc=2<<jc,Wc=(Yc=16<<jc)-1,$_(),Q_(Do),rc.plfleft<0&&(rc.bplres=Po,rc.bplcon0=xo,rc.nr_planes=zo),p_=l_[jc][Po][Oo],m_(e),h_=-1,y_=0,N_=zo,W_()&&(N_=6),Go=2}function t0(e){switch(y_){case 0:ff(e,xo,!1),y_++,h_+=g_;break;case 1:e0(e)}}function n0(e){0<h_&&h_<=e&&t0(e)}function r0(e){if(Go=2,e+3+(SAEV_Copper_access?1:0)+(8==zo?1:0)<20)return ff(e,xo,!1),void e0(e);h_<0&&(h_=e+(SAEV_Copper_access?1:0),g_=3+(8==zo?1:0),y_=0,SAEV_Copper_access||t0(e))}function i0(e){if(N_>rc.nr_planes){if(C_)for(var t=rc.nr_planes;t<N_;t++)!function(e,t,n){if(!nc)for(var r=t,i=t+n;r<i;r++)if(e[r]){nc=1;break}for(i=(r=t)+n;r<i;r++)e[r]=0}(bt[wi],vt*t,C_),0<=rc.plfleft&&(k_[t]=0,e&&(D_[t]=M_[t]=0));rc.nr_planes=N_}}function a0(e){rc.plfleft<0&&(rc.plfleft=e)}function o0(e,t,n){if(e<Oo){var r,i=Jc;switch(n>ra-ei&&!(128&xa)&&((a=n)==ra-1?SAEF_warn("playfield.fetch_warn() BPL fetch conflicts with strobe refresh slot!"):SAEF_warn("playfield.fetch_warn() BPL fetch at hpos %d/%d",a,ra),Ro=a,i=qa),r=bo[e],bo[e]+=i,Co[e]+=i,0==e&&(fo=!0),t){case 0:w_[e]=SAER_Memory_chipGet16_indirect(r),SAEV_Custom_last_value=w_[e];break;case 1:V_[e]=0,I_[e]=SAER_Memory_chipGet32_indirect(r),SAEV_Custom_last_value=I_[e],w_[e]=65535&I_[e];break;case 2:V_[e]=SAER_Memory_chipGet32_indirect(r),I_[e]=SAER_Memory_chipGet32_indirect(r+4),SAEV_Custom_last_value=I_[e],w_[e]=65535&I_[e]}bc==yc&&(ic&~n_)+ac<=ic&&(t=e,mo!=(n=n)&&mo&&(po=Ao,mo=0),ho!=n&&ho&&(Eo=So,ho=0),n=16384&wa?1&(Lo>>8^hi)?Eo:po:1&t?Eo:po,bo[t]+=n,Co[t]+=n,e_())}var a}function s0(e,t,n){for(var r=16-n,i=e;i<rc.nr_planes;i+=t)v_[i]<<=n;for(i=e;i<L_;i+=t)v_[i]|=R_[i]>>>r,R_[i]<<=n}function c0(e,t,n){for(var r=Yc-n,i=65535>>16-n,a=e;a<rc.nr_planes;a+=t)v_[a]<<=n;for(a=e;a<L_;a+=t)v_[a]|=r<32?(F_[a]<<32-r|T_[a]>>>r)&i:F_[a]>>>r-32&i,F_[a]=F_[a]<<n|T_[a]>>>32-n,T_[a]<<=n}function _0(e,t,n,r){2==t?(0==r?s0:c0)(e,2,n):(0==r?s0:c0)(0,1,n)}function f0(e,t){0==t?function(e){for(var t=H_&Wc,n=0;n<2;n++){var r=U_[n];r<t&&(r+=Yc);var i=r-t,r=e;if(i<r&&(_0(n,2,i,0),r-=i,x_[n])){for(var a=n;a<B_;a+=2)R_[a]=k_[a];x_[n]=!1}r&&_0(n,2,r,0)}}(e):function(e,t){for(var n=H_&Wc,r=0;r<2;r++){var i=U_[r];i<n&&(i+=Yc);var a=i-n,i=e;if(a<i&&(_0(r,2,a,t),i-=a,x_[r])){for(var o=r;o<B_;o+=2)F_[o]=D_[o],T_[o]=M_[o];x_[r]=!1}i&&_0(r,2,i,t)}}(e,t)}function l0(e,t){var n,r,i;if(H_+e>=X_[Ri]?(n=e,r=t,(i=X_[Ri]-H_)<=(n=n)&&(f0(i,r),n-=i,(H_=0)<=qo&&(Q_(qo),qo=-1),U_[0]-=2,U_[0]&=Wc,U_[1]-=2,U_[1]&=Wc),n&&(f0(n,r),H_+=n)):(U_[0]==U_[1]?0==t?function(e){var t=H_&Wc,n=U_[0];if(n<t&&(n+=Yc),(t=n-t)<e&&(_0(0,1,t,0),e-=t,x_[0])){for(var r=0;r<B_;r++)R_[r]=k_[r];x_[0]=!1,x_[1]=!1}e&&_0(0,1,e,0)}(e):function(e,t){var n=H_&Wc,r=U_[0];if(r<n&&(r+=Yc),(n=r-n)<e&&(_0(0,1,n,t),e-=n,x_[0])){for(var i=0;i<B_;i++)F_[i]=D_[i],T_[i]=M_[i];x_[0]=!1,x_[1]=!1}e&&_0(0,1,e,t)}(e,t):f0(e,t),H_+=e),32==(b_+=e)){for(var a=bt[wi],o=C_,s=0;s<rc.nr_planes;s++)a[o]!=v_[s]&&(a[o]=v_[s],nc=1),v_[s]=0,o+=vt;C_++,b_=0}}function u0(e,t){switch(t){case 0:d0(e,0);break;case 1:d0(e,1);break;case 2:d0(e,2)}}function d0(e,t){16<e&&(u0(16,t),e-=16);var n=32-b_;n<e&&(l0(n,t),e-=n),l0(e,t)}function p0(e){0<Z_&&0<=rc.plfleft&&u0(Z_,e),Z_=0}function E0(e){var t,n,r,i;(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA||G_[0]||G_[1])&&(t=G_[0],n=G_[1],r=Do>>8&3,i=Do>>12&3,G_[0]=(3&r)>>P_,G_[1]=(3&i)>>P_,(0<=e&&G_[0]!=t||G_[1]!=n)&&(F0(e,0,P|G_[0]),wo.extra&=~(1<<R),wo.extra&=~(1<<R+1),wo.extra|=G_[0]<<R,Qs=-1))}function A0(e){Ei(Vo)!=P_&&p0(jc),P_=Ei(Vo),z_=2<<P_,H_=2*e<<P_,Io!=Vo&&(j_(e,4352,Vo),Io=Vo),O_=mi(Vo),W_()?L_<6&&(L_=6):L_=O_,B_=L_,E0(e)}function S0(e,t){return SAER_Memory_chipCheck_indirect(e,t)?SAER_Memory_chipXLate_indirect(e):null}function m0(e,t){var n;if(0==t)for(n=0;n<r;n++)k_[n]=w_[n];else for(n=0;n<r;n++)D_[n]=V_[n],M_[n]=I_[n];x_[0]=x_[1]=!0,a0(e),A0(e),N_>rc.nr_planes&&i0(t)}function h0(e,t,n,r){var i=S0(bo[e],2*t),a=K_[1&e],o=b_,s=v_[e],c=w_[e],_=bt[wi],f=vt*e+C_;if(r&&(bo[e]+=2*t,Co[e]+=2*t),null!==i){for(var l=R_[e]<<a;0<t;){var u=32-o,d=(l=(l|c)>>>0)>>>a&65535;n&&u<16?(nc|=(_[f]^(s=((s=s<<u&4294967295)|d>>>16-u)>>>0))>>>0,_[f++]=s,s=d,o=16-u):(s=(s<<16&4294967295|d)>>>0,32==(o+=16)&&(nc|=(_[f]^s)>>>0,_[f++]=s,o=0)),l=l<<16&4294967295,t--,r&&(c=SAER_Memory_chipData[i]<<8|SAER_Memory_chipData[i+1],i+=2)}w_[e]=c,R_[e]=l>>>a,v_[e]=s}}function g0(e,t,n,r){var i,a=S0(bo[e],2*t),o=K_[1&e],s=b_,c=v_[e],_=I_[e],f=bt[wi],l=vt*e+C_,u=16+o;if(r&&(bo[e]+=2*t,Co[e]+=2*t),null!==a){for(i=F_[e],d=T_[e],o&&(i=(i<<o&4294967295|d>>>32-o)>>>0,d=d<<o&4294967295);0<t;){for(var d=(d|_)>>>0,p=0;p<2;p++){var E=32-s,A=u<32?65535&(i<<32-u|d>>>u):i>>>u-32&65535;n&&E<16?(nc|=(f[l]^(c=((c=c<<E&4294967295)|A>>>16-E)>>>0))>>>0,f[l++]=c,c=A,s=16-E):(c=(c<<16&4294967295|A)>>>0,32==(s+=16)&&(nc|=(f[l]^c)>>>0,f[l++]=c,s=0)),i=(i<<16&4294967295|d>>>16)>>>0,d=d<<16&4294967295}t-=2,r&&(_=(SAER_Memory_chipData[a]<<24|SAER_Memory_chipData[a+1]<<16|SAER_Memory_chipData[a+2]<<8|SAER_Memory_chipData[a+3])>>>0,a+=4)}I_[e]=_,o?(T_[e]=i<<32-o&4294967295|d>>>o,F_[e]=i>>>o):(F_[e]=i,T_[e]=d),v_[e]=c}}function y0(e,t){t&&(e[3]=e[3]<<(t&=31)|e[2]>>>32-t,e[2]=e[2]<<t|e[1]>>>32-t,e[1]=e[1]<<t|e[0]>>>32-t,e[0]<<=t)}function v0(e,t,n,r){var i,a=S0(bo[e],2*t),o=K_[1&e],s=b_,c=new Uint32Array(4),_=v_[e],f=V_[e],l=I_[e],u=bt[wi],d=vt*e+C_,p=48+o;if(r&&(bo[e]+=2*t,Co[e]+=2*t),null!==a){for(c[3]=0,c[2]=0,c[1]=F_[e],c[0]=T_[e],y0(c,o);0<t;){c[1]|=f,c[0]|=l;for(var E=0;E<4;E++){var A=32-s,S=p<32?65535&(c[1]<<32-p|c[0]>>>+p):p<64?65535&(c[2]<<64-p|c[1]>>>p-32):p<96?65535&(c[3]<<96-p|c[2]>>>p-64):c[3]>>>p-96&65535;n&&A<16?(nc|=(u[d]^(_=((_=_<<A&4294967295)|S>>>16-A)>>>0))>>>0,u[d++]=_,_=S,s=16-A):(_=(_<<16&4294967295|S)>>>0,32==(s+=16)&&(nc|=(u[d]^_)>>>0,u[d++]=_,s=0)),y0(c,16)}t-=4,r&&(f=(SAER_Memory_chipData[a]<<24|SAER_Memory_chipData[a+1]<<16|SAER_Memory_chipData[a+2]<<8|SAER_Memory_chipData[a+3])>>>0,l=(SAER_Memory_chipData[a+4]<<24|SAER_Memory_chipData[a+5]<<16|SAER_Memory_chipData[a+6]<<8|SAER_Memory_chipData[a+7])>>>0,a+=8)}V_[e]=f,I_[e]=l,i=c,(o=o)&&(i[0]=i[1]<<32-(o&=31)|i[0]>>>o,i[1]=i[2]<<32-o|i[1]>>>o,i[2]=i[3]<<32-o|i[2]>>>o,i[3]>>>=o),F_[e]=c[1],T_[e]=c[0],v_[e]=_}}function b0(e,t,n){rc.plfleft<0||xc>=Rc||(xc=Rc,p0(t),rc.plfright=e,n||SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS&&(p,Vc=Dc))}function C0(e,t){var n=!1;if(bc!=yc||Vc!=Fc&&Vc!=Mc||oc||!SAEF_Custom_dmaen(SAEC_Custom_DMAF_BPLEN))b0(e,t,!0);else{do{var r=ic&a_;switch(o_){case 8:switch(r){case 0:o0(7,t,e);break;case 1:o0(3,t,e);break;case 2:o0(5,t,e);break;case 3:o0(1,t,e);break;case 4:o0(6,t,e);break;case 5:o0(2,t,e);break;case 6:o0(4,t,e);break;case 7:o0(0,t,e);break;default:return void b0(e,t,!0)}break;case 4:switch(r){case 0:o0(3,t,e);break;case 1:o0(1,t,e);break;case 2:o0(2,t,e);break;case 3:o0(0,t,e);break;default:return void b0(e,t,!0)}break;case 2:switch(r){case 0:o0(1,t,e);break;case 1:o0(0,t,e);break;default:return void b0(e,t,!0)}}}while(ic++,16==(Z_=16<(Z_+=z_)?0:Z_)&&p0(t),n=!0,Ro=e,0!=(ic&n_));n&&0<Ic&&(Ic--,SAEF_warn("playfield.maybe_finish_last_fetch() bitplane DMA crossing scanlines!")),b0(e,t,!0)}}function k0(){var e,t;rc.plfleft<0||(xc<Rc&&b0(ra,jc,!0),xc=wc,oc&&bc>=hc&&(bc=vc),rc.plfright+=(e=jc,t=0,b_<=16&&(t+=16,l0(16,e)),0!=b_&&(t+=32-b_,l0(32-b_,e)),t+=32,l0(16,e),l0(16,e),2==e&&(t+=32,l0(16,e),l0(16,e),t+=32,l0(16,e),l0(16,e)),t>>1+P_),rc.plflinelen=C_,la<=hi&&(Nt<0||hi<Nt)&&(Nt=hi),Bt=hi,o&&Ls[wi].plflinelen==rc.plflinelen&&Ls[wi].plfleft==rc.plfleft&&Ls[wi].bplcon0==rc.bplcon0&&Ls[wi].bplcon2==rc.bplcon2&&Ls[wi].bplcon3==rc.bplcon3&&Ls[wi].bplcon4==rc.bplcon4||(nc=1))}function R0(e,t,n){var r=!0,i=_s==E;if(bc==mc&&t&&i?(r=!1,(fc=(uc=0)<=fc?t?-5:-4:fc)<0&&0==++fc&&(bc=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS?hc:Sc)):t&&i||(r=!1,bc!=Sc&&bc!=hc&&bc!=gc||(uc=1,fc<=0&&(fc=t?5:4)),0<fc&&(r=!0,0==--fc&&(r=!1,bc=mc))),(t&&i||SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS)&&bc!=mc&&(e==$o&&_c!=e?(bc<hc&&(bc=hc),cc=e+Gc):e==cc&&(pc=!0,bc<gc&&(bc=gc))),0==(ic&n_)){if(bc==yc)return b0(e,n,!1),1;bc==gc&&(bc=yc)}if(e==Xc()&&bc<mc&&(bc=gc),n0(e),r){var a=ic&a_;switch(o_){case 8:switch(a){case 0:o0(7,n,e);break;case 1:o0(3,n,e);break;case 2:o0(5,n,e);break;case 3:o0(1,n,e);break;case 4:o0(6,n,e);break;case 5:o0(2,n,e);break;case 6:o0(4,n,e);break;case 7:o0(0,n,e);break;default:bc==gc&&(oc=!0)}break;case 4:switch(a){case 0:o0(3,n,e);break;case 1:o0(1,n,e);break;case 2:o0(2,n,e);break;case 3:o0(0,n,e);break;default:bc==gc&&(oc=!0)}break;case 2:switch(a){case 0:o0(1,n,e);break;case 1:o0(0,n,e);break;default:bc==gc&&(oc=!0)}}}fo&&(Vc=Tc,fo=!1),ic++,Z_+=z_,q_&&(p0(n),Q_(Do),q_=!1),16<Z_&&(SAEF_error("one_fetch_cycle() toscr_nbits > 16 (%d)",Z_),Z_=0),16==Z_&&p0(n)}function w0(e,t){if(!Pc()){var n=is;for(i0(t);n<e;n++)16<(Z_+=z_)&&(SAEF_error("update_fetch_x() toscr_nbits > 16 (%d)",Z_),Z_=0),16==Z_&&p0(t);ra<=e?C0(n,t):p0(t)}}function x0(e,t){var n=SAEF_Custom_dmaen(SAEC_Custom_DMAF_BPLEN);if(!(Pc()||bc>=vc)){var r,i,a,o,s=is;for(S_=is-ic;;s++){if(s==e)return ra<=e&&void C0(s,t);if(Vc==Tc)break;if(Vc=Fc,R0(s,n,t))return}for(c&&bc==Sc&&!Go&&n&&(ic&a_)==(o_&a_)&&!Ho&&O_==N_&&(o=Xc(),o=(i=((r=(o=$o>=is-Gc&&$o<o?$o:o)+Gc)-(a=s-ic&n_)+t_-1&~n_)+a)+t_,r_<=(a=(e<i?e:e<o?i:o)-s)&&(o=s+(a&=~a_),rc.plfleft<0&&Q_(Do),function(e,t,n,r){var i;switch(p0(r),m0(e,r),r){case 0:if(15&b_)for(i=0;i<O_;i++)h0(i,t,1,n);else for(i=0;i<O_;i++)h0(i,t,0,n);break;case 1:if(15&b_)for(i=0;i<O_;i++)g0(i,t,1,n);else for(i=0;i<O_;i++)g0(i,t,0,n);break;case 2:if(15&b_)for(i=0;i<O_;i++)v0(i,t,1,n);else for(i=0;i<O_;i++)v0(i,t,0,n)}C_+=(b_+=16*t)>>5,b_&=31,H_+=16*t,n&&0<O_&&(Vc=Tc)}(s,a>>3-P_,n,t),a0(s),s<=$o&&$o<o&&(bc=hc,cc=$o+Gc),s<=$o+Gc&&o>$o+Gc&&(bc=gc,cc=256+Gc,pc=!0),s<=Xc()&&o>Xc()&&bc<mc&&(bc=gc),s<=r&&i<o&&(bc=yc),s<=i&&i+o_<=o&&function(){var e,t;switch(e_(),16384&wa?e=t=1&(Lo>>8^hi)?Eo:po:(e=po,t=Eo),Oo){case 8:bo[7]+=t,Co[7]+=t;case 7:bo[6]+=e,Co[6]+=e;case 6:bo[5]+=t,Co[5]+=t;case 5:bo[4]+=e,Co[4]+=e;case 4:bo[3]+=t,Co[3]+=t;case 3:bo[2]+=e,Co[2]+=e;case 2:bo[1]+=t,Co[1]+=t;case 1:bo[0]+=e,Co[0]+=e}}(),s+=a,ic+=a));s<e;s++)if(Vc==Tc&&(p0(t),m0(s,t)),Vc=Fc,R0(s,n,t))return;ra<=e?C0(s,t):p0(t)}}function D0(){Z_=C_=b_=0,rc.bplres=Po}function M0(){return!SAEV_config.chipset.agnusDIP&&aa+vi<=hi+1}function F0(e,t,n){var r,i,a,o;t<4096&&Pc()||hi<la||(Zc(e),SAER.playfield.decide_line(e),rc.ctable<0&&Uc(),(t<4096||4364==t)&&e<u&&!(128&xa)&&0<=xi&&(i=(r=qs[xi]).last_color_change,a=4364==t?1:0,o=!1,65535==Hs[i-1].regno&&(i--,o=!0),r.last_color_change++,r.nr_color_changes++,Hs[i].linepos=2*(e+ra)+a,Hs[i].regno=t,Hs[i].value=n,o?(Hs[i+1].linepos=2*_a,Hs[i+1].regno=65535,Hs[i+2].regno=-1):Hs[i+1].regno=-1),j_(e,t,n))}function T0(e,t,n){var r=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE&&1&t&&32&n,n=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE&&1&t&&16&n;return 0<=e&&(w(wo.extra)!=r||D(wo.extra)!=n)&&(F0(e,0,I|(r?1:0)|(x(wo.extra)?2:0)|(n?4:0)),wo.extra&=~(1<<b),wo.extra&=~(1<<C),wo.extra|=r?1<<b:0,wo.extra|=n?1<<C:0,Qs=-1),r}function V0(e,t,n){n=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA&&1&t&&2&n;return 0<=e&&x(wo.extra)!=n&&(F0(e,0,I|(w(wo.extra)?1:0)|(D(wo.extra)?4:0)|(n?2:0)),wo.extra&=~(1<<k),wo.extra|=n?1<<k:0,Qs=-1,n&&!w(wo.extra)&&(rc.bordersprite_seen=!0)),n&&!w(wo.extra)}function I0(e,t,n){256==t?(2048&n&&(rc.ham_seen=1),rc.ehb_seen=Y_(n),T0(e,n,Fo),V0(e,n,Fo)):260==t?rc.ehb_seen=Y_(xo):262==t&&(T0(e,xo,n),V0(e,xo,n)),F0(e,t+4096,n)}function P0(e,t){var n;switch(t>>6&3){case 0:n=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE&&Ei(e)==SAEC_Config_Video_HResolution_SuperHiRes?SAEC_Config_Video_HResolution_HiRes:SAEC_Config_Video_HResolution_LoRes;break;case 1:n=SAEC_Config_Video_HResolution_LoRes;break;case 2:n=SAEC_Config_Video_HResolution_HiRes;break;case 3:n=SAEC_Config_Video_HResolution_SuperHiRes;break;default:n=SAEC_Config_Video_HResolution_LoRes}return n}function z0(e,t,n,r,i,a,o,s){for(var c=0;n;){var _,f=0,l=0;(es<=e&&e<ts||2&Fo)&&(f=(3&n)<<2*r),0==(c&a)&&(_=et[t]|f,et[t++]=_,o&&(l|=_),e++),0<i&&(_=et[t]|f,et[t++]=_,o&&(l|=_),e++),1<i&&(_=et[t]|f,et[t++]=_,o&&(l|=_),_=et[t]|f,et[t++]=_,o&&(l|=_),e++,e++),c++,n>>>=2,o&&(l&=s)&&(l=$i[255&l]|$i[l>>8]<<2,xs|=ea[l])}}function O0(e,t,n,r,i){var a,o,s,c,_=Ks[Ns],f=Ns,l=0,u=0,d=0,p=_o-so;for(p<0&&(d=-p,p=0,l=1<<d),s=oo<<_o>>so,c=128&eo[1|t],!Us&&Ks[f-1].max+oo>=n?_=Ks[--f]:(Ns++,_.pos=n,_.has_attached=0),n<_.pos&&SAEF_error("record_sprite() sprxp < e.pos (%d < %d)",n,_.pos),_.max=n+s,Ks[f+1].first_pixel=_.first_pixel+(_.max-_.pos+3&-4),Us=0,o=ta[Ds>>12],a=_.first_pixel+n-_.pos,h=0;h<oo;h+=16){var E=r[u],A=i[u],E=(Ji[255&E]<<16|Ji[E>>8]|Qi[255&A]<<16|Qi[A>>8])>>>0,A=h<<p>>d;SAEV_config.chipset.colLevel>SAEC_Config_Chipset_ColLevel_None&&o?z0(n+A,a+A,E,t,p,l,1,o):z0(n+A,a+A,E,t,p,l,0,o),u++}if(c&&(!(Po==SAEC_Config_Video_HResolution_SuperHiRes&&SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE)||SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)){for(var S=16843009<<(254&t)>>>0&255,m=a,h=0;h<s;h+=8)tt.bytes[m+0]|=S,tt.bytes[m+1]|=S,tt.bytes[m+2]|=S,tt.bytes[m+3]|=S,tt.bytes[m+4]|=S,tt.bytes[m+5]|=S,tt.bytes[m+6]|=S,tt.bytes[m+7]|=S,m+=8;_.has_attached=1}}function L0(e,t,n,r,i){for(var a,o=0;o<e&&!(r[o]>n)&&!(r[o]==n&&i[o]<t);o++);for(a=e;o<a;a--)r[a]=r[a-1],i[a]=i[a-1];r[a]=n,i[a]=t}function N0(e){return t(e-(h<<Q))<<_o}function B0(e){return 2*e-h<<_o}function U0(e,t){void 0===t&&(t=!1);var n=new Int32Array(2*m),r=new Int32Array(2*m),i=256<<_o,a=!1;if(!(rc.plfleft<0)||2&Fo){var o,s=2*e;if(ra<=e&&(s+=14*_o),!(Pc()||e<20||0==ao||s==io)){Zc(e),SAER.playfield.decide_line(e),ts=32767,(es=0)<=rc.diwlastword&&(ts=N0(rc.diwlastword)),0<=rc.diwfirstword&&(es=N0(rc.diwfirstword)),0<=rc.plfleft&&(o=B0(rc.plfleft),e=B0(rc.plfright),es<o&&o<e&&(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE||40<=rc.plfleft||uo)&&(es=o));for(var c=0,_=0;_<m;_++){var f=Ya[_].xpos,l=32768&wa?f&~i:f,u=l>>_o,d=t&&eo[_]&co?0:1;f<0||Ya[_].armed&&(io<u&&u<=s+d&&L0(c++,_,l,r,n),32768&wa&&!(l&i)?io<(u=(l|=i)>>_o)&&u<=s+d&&L0(c++,m+_,l,r,n):!(128&wa)&&2<<_o<=f&&f<=9<<_o&&io<(u=(l+=2*ra<<_o)>>_o)&&u<=s+d&&L0(c++,m+_,l,r,n))}for(_=0;_<c;_++){var p=n[_]&m-1;if(O0(0,p,r[_],no[p],ro[p],eo[p]),Jr&&SAEF_Custom_dmaen(SAEC_Custom_DMAF_SPREN)&&1&xo&&2&Fo&&!(32&Fo)&&0<p){for(var E=0,A=0;E<oo;E+=16,A++){var S=g(r[_]+E>>_o)+(h<<Q);(no[p][A]||ro[p][A])&&(S<ms&&S>=48<<SAEV_config.video.hresolution&&(ms=S),hs<S+16&&S<=448<<SAEV_config.video.hresolution&&(hs=S+16))}a=!0}}io=s,Jr&&a&&(hi<us&&(us=hi),hi<Yo&&(Yo=hi),ds<hi&&(ds=hi),Wo<hi&&(Wo=hi))}}}function K0(){var e,t,n,r,i,a=ra;Pc()||(Zc(a),SAER.playfield.decide_line(a),SAER.playfield.decide_fetch_safe(a),k0(),j_(_a,65535,0),0<=rc.plfleft&&rc.plflinelen<0&&(Vc!=Dc&&SAEF_warn("playfield.finish_decisions() fetch_state != fetch_not_started"),rc.plfright=rc.plfleft,rc.plflinelen=0,rc.bplres=SAEC_Config_Video_HResolution_LoRes),fs==E&&(rc.diwlastword=S(),rc.diwfirstword<0&&(rc.diwfirstword=A)),rc.diwfirstword!=Ls[wi].diwfirstword&&o&&(nc=1),rc.diwlastword!=Ls[wi].diwlastword&&o&&(nc=1),e=qs[wi],i=Zs[wi],t=Ls[wi],r=nc|fn,0<=rc.plfleft&&0<rc.nr_planes&&(rc.plfleft,kt<(n=ss)&&(kt=n),(n=os)<Ct&&(Ct=n)),U0(a+1),e.last_sprite_entry=Ns,e.last_color_change=Ws,rc.ctable<0&&(rc.plfleft,Uc()),e.nr_color_changes=Ws-e.first_color_change,e.nr_sprites=Ns-e.first_sprite_entry,(r=!(r=!(r=rc.plfleft!=Ls[wi].plfleft?1:r)&&function(e,t){if(e.nr_color_changes!=t.nr_color_changes)return 1;if(0!=e.nr_color_changes)for(var n,r,i=0;i<e.nr_color_changes;i++)if(0!=(n=Hs[e.first_color_change],r=Xs[t.first_color_change],n.linepos==r.linepos&&n.regno==r.regno&&n.value==r.value?0:1))return 1}(e,i)?1:r)&&(0<=rc.plfleft||1&rc.bplcon0&&2&rc.bplcon3&&!(32&rc.bplcon3))&&function(e,t){var n=Ks[e.first_sprite_entry],r=Ks[e.last_sprite_entry],i=Gs[t.first_sprite_entry];if(e.nr_sprites!=t.nr_sprites)return 1;if(0!=e.nr_sprites){for(c=0;c<e.nr_sprites;c++){var a=Ks[e.first_sprite_entry+c],o=Gs[t.first_sprite_entry+c];if(a.pos!=o.pos||a.max!=o.max||a.has_attached!=o.has_attached)return 1}for(var s=r.first_pixel+(r.max-r.pos)-n.first_pixel,c=0;c<s;c++){if(et[n.first_pixel+c]!=et[i.first_pixel+c])return 1;if(tt.bytes[n.first_pixel+c]!=tt.bytes[i.first_pixel+c])return 1}}}(e,i)?1:r)?(nc=1,i=rc,(r=t).plfleft=i.plfleft,r.plfright=i.plfright,r.plflinelen=i.plflinelen,r.diwfirstword=i.diwfirstword,r.diwlastword=i.diwlastword,r.ctable=i.ctable,r.bplcon0=i.bplcon0,r.bplcon2=i.bplcon2,r.bplcon3=i.bplcon3,r.bplcon4=i.bplcon4,r.nr_planes=i.nr_planes,r.bplres=i.bplres,r.ehb_seen=i.ehb_seen,r.ham_seen=i.ham_seen,r.ham_at_start=i.ham_at_start,r.bordersprite_seen=i.bordersprite_seen):t.ctable=rc.ctable,Ws+=(u+1)/2,Ha+=2*ra,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE||hi!=Kc()-1||Ha++,(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE||hi>Kc()||SAEV_config.chipset.agnusDIP&&0==hi)&&(Ha=2*ra,cs=1),Ws>=N-30&&(SAEF_warn("playfield.finish_decisions() color_change buffer overflow!"),Ws=0,e.nr_color_changes=0,e.first_color_change=0,e.last_color_change=0))}function G0(){if(!Pc()){O_=L_=0,rc.bplres=Po,rc.nr_planes=0,lo=fo=!1,rc.plfleft=-1,rc.plflinelen=-1,rc.ham_seen=!!(2048&xo),rc.ehb_seen=!!Y_(xo),rc.ham_at_start=!!(2048&xo),rc.bordersprite_seen=V0(-1,xo,Fo),rc.diwfirstword=-1,rc.diwlastword=-1,fs==E&&(rc.diwfirstword=A,rc.diwfirstword!=Ls[wi].diwfirstword&&o&&(nc=1)),rc.ctable=-1,nc=0,qs[wi].first_color_change=Ws,qs[wi].first_sprite_entry=Ns,Us=1,io=0,Vc=Dc,0<=h_&&(ff(0,xo,!0),e0(0)),uo=!(h_=-1),e_(),H_=y_=0,Q_(Do),(bc>=yc||bc==mc)&&(bc=Ac),SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS&&(pc||(bc=Sc)),ls=256,xc=Cc,sc=256+Gc,cc=256+Gc,fc=dc=_c=-1,Go&&(--Go||(uc=0)),x_[0]=x_[1]=!1;for(var e=0;e<r;e++)v_[e]=0,k_[e]=0,R_[e]=0;if(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)for(e=0;e<r;e++)D_[e]=M_[e]=0,F_[e]=T_[e]=0;if(oc=!1,Ro?(0<(Ro-=ra-ei)&&(lo=fo=!0,D0(),m0(Ro,jc)),Ro=0):D0(),rs=-(Gc+1),is=as=-1,Ja){Ja=!1;for(e=0;e<m;e++)Ya[e].ignoreverticaluntilnextline=!1}rc.bplcon0=xo,rc.bplcon2=Mo,rc.bplcon3=Fo,rc.bplcon4=To,0}}function H0(){var e,t=oa,n=ia,r=1;ya=SAEV_Playfield_fake_vblank_hz=0,va=1,.1<Math.abs(SAEV_config.chipset.refreshRate)&&(r=SAEV_config.chipset.refreshRate/Aa,Ea=SAEV_config.chipset.refreshRate,Wr()&&(SAEF_Playfield_getvsyncrate(Ea,e={}),e.hz!=Ea&&(SAEF_Playfield_getvsyncrate(Ea,e),Ea=e.hz,0<(ya=e.mult)&&(va=0)))),SAEV_Playfield_fake_vblank_hz=SAEV_Playfield_fake_vblank_hz||Ea,SAEV_Audio_vsynctimebase_orig=SAER.events.calc_vsynctimebase(SAEV_Playfield_fake_vblank_hz),J_()&&(n+=.5),oe?t+=.5:bi&&(t+=1),SAEV_config.audio.mode!=SAEC_Config_Audio_Mode_Off&&(SAEF_log("playfield.compute_vsynctime() %.1f*%.1f*%.6f=%.6f, syncadjust %f",t,n,SAEV_Playfield_fake_vblank_hz,n=t*n*SAEV_Playfield_fake_vblank_hz,r),SAER.devices.update_sound(n,r))}function X0(){return aa+(vi?1:0)}function q0(){var e=oe?1:0,t=32&xa?0:1;SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS||(t=SAEV_config.chipset.ntsc?1:0);for(var n=0;n<SAEV_config.chipset.refresh.length;n++){var r=SAEV_config.chipset.refresh[n];if((r.horiz<0||r.horiz==ra)&&(r.vert<0||r.vert==sa)&&(r.ntsc<0||0<r.ntsc&&t||0==r.ntsc&&!t)&&(r.lace<0||0<r.lace&&e||0==r.lace&&!e)&&(r.framelength<0||0<r.framelength&&vi||0==r.framelength&&!vi||0<=r.framelength&&e)&&(r.rtg&&SAEV_Playfield_picasso_on||!r.rtg&&!SAEV_Playfield_picasso_on)&&(r.vsync<0||0<r.vsync&&Wr()||0==r.vsync&&!Wr()))return r}return null}function Z0(){var e,t=oe?1:0,n=32&xa?0:1,r=!1;Ea=t?ga:bi?ma:ha;for(var i,a,o,s,c=q0();null!==c;){var _=-1;if(SAEV_Playfield_picasso_on||SAEV_Playfield_picasso_requested_on)_=0==c.locked?Ea:c.rate,SAEV_config.chipset.refreshRate=_;else{if(0==c.locked){SAEV_config.chipset.refreshRate=Ea;break}0<(_=(_=c.rate)<0?c.rate:_)&&(SAEV_config.chipset.refreshRate=_)}r=!0;break}for(r||(SAEV_config.chipset.refreshRate=Ea),ba=c,Fi=Ki=Ui=Ti=0,we.drawbuffer.inxoffset=-1,we.drawbuffer.inyoffset=-1,128&xa?(Ai(xo),a=SAEV_config.video.hresolution,0<Ca&&a++,a>f&&(a=f),i=SAEV_config.video.vresolution,0<Ca&&!t&&i--,(i=i<0?0:i)>l&&(i=l),o=_a,s=ca,we.drawbuffer.inwidth=2*(ra-(ra-o+d/2)+1)<<a,we.drawbuffer.inxoffset=2*s,we.drawbuffer.extrawidth=0,we.drawbuffer.inwidth2=we.drawbuffer.inwidth,we.drawbuffer.inheight=(ua<aa?ua:aa)-la+1<<i):(we.drawbuffer.inwidth=SAEC_Video_MAX_AMIGA_WIDTH<<SAEV_config.video.hresolution,we.drawbuffer.extrawidth=-1,we.drawbuffer.inwidth2=we.drawbuffer.inwidth,we.drawbuffer.inheight=sa-la+1<<SAEV_config.video.vresolution),we.drawbuffer.inheight2=we.drawbuffer.inheight,we.drawbuffer.inwidth>we.drawbuffer.width_allocated&&(we.drawbuffer.inwidth=we.drawbuffer.width_allocated),we.drawbuffer.inwidth2>we.drawbuffer.width_allocated&&(we.drawbuffer.inwidth2=we.drawbuffer.width_allocated),we.drawbuffer.inheight>we.drawbuffer.height_allocated&&(we.drawbuffer.inheight=we.drawbuffer.height_allocated),we.drawbuffer.inheight2>we.drawbuffer.height_allocated&&(we.drawbuffer.inheight2=we.drawbuffer.height_allocated),we.drawbuffer.outwidth=we.drawbuffer.inwidth,we.drawbuffer.outheight=we.drawbuffer.inheight,we.drawbuffer.outwidth>we.drawbuffer.width_allocated&&(we.drawbuffer.outwidth=we.drawbuffer.width_allocated),we.drawbuffer.outheight>we.drawbuffer.height_allocated&&(we.drawbuffer.outheight=we.drawbuffer.height_allocated),e=0;e<Ls.length;e++)Ls[e].clr(),Ls[e].plfleft=-2;for(e=0;e<Ps[0].length;e++)Ps[0][e].clr(),Ps[1][e].clr();H0(),Sa=(SAEV_config.chipset.ntsc?SAEC_Playfield_CLOCK_NTSC:SAEC_Playfield_CLOCK_PAL)/(ra+(J_()?.5:0)),SAEF_log("playfield.compute_framesync() %s mode%s%s V=%.4fHz H=%0.4fHz (%dx%d+%d) IDX=%d (%s) DSP=%d RTG=%d/%d",n?"NTSC":"PAL",t?" lace":Pi?" loflace":"",0<Ca?" dblscan":"",Ea,Sa,ra,aa,vi?1:0,null!==c?c.index:-1,null!==c&&c.label.length?c.label:"<?>",SAEV_config.video.apmode[SAEV_Playfield_picasso_on?1:0].gfx_display,SAEV_Playfield_picasso_on?1:0,SAEV_Playfield_picasso_requested_on?1:0),SAER.video.target_graphics_buffer_update()&&jr()}function j0(e){var t,n,r=Ca,i=aa,a=Ea,o=0;yi=gi=!e?0:gi,Ca=0,ka=!1,(160&xa)!=(160&Da)&&(o=1),xa!=Da&&(SAEF_log("playfield.init_hz() BEAMCON0 0x%04x -> 0x%04x",xa,Da),yi=gi=0),t=32&(xa=Da)?0:1,n=oe?1:0,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS||(t=SAEV_config.chipset.ntsc?1:0);e=SAEV_config.chipset.ntsc?SAEC_Playfield_CLOCK_NTSC:SAEC_Playfield_CLOCK_PAL;ga=t?(aa=ii,ra=ni,la=oi,Aa=Ea=fi,$a=ci,da=pi,pa=!1,ha=e/((aa+0)*(ra+.5)),ma=e/((aa+1)*(ra+.5)),e/((aa+.5)*(ra+.5))):(aa=ri,ra=ti,la=ai,Aa=Ea=_i,$a=si,da=di,pa=!0,ha=e/((aa+0)*ra),ma=e/((aa+1)*ra),e/((aa+.5)*ra)),sa=oa=aa,0<gi?(Aa=ha=ma=ga=Ea=(t?15734:15625)/(gi=gi<10?10:gi),sa=256<=(oa=gi-(bi?1:0))&&oa<=313||128&xa?oa:oa<256?255:313,jr()):0==gi&&(yi=gi=aa),ua=aa+1,128&xa&&(Fa>=_&&(Fa=_-1),ua=(aa=Fa+1)+1,Ta>=s&&(Ta=s-1),Aa=Ea=3541200/(aa*(ra=Ta+1)),ha=Ea,ma=3552550/(aa*ra),ga=3546875/(aa*ra),4096&xa&&512&xa?(aa>>1<(la=La<za?za:La)&&(la=La<za?La:za),ua=Oa):512&xa?aa>>1<(la=za)&&(la=0):4096&xa&&(aa>>1<(la=La)&&(la=0),ua=Oa),ua<(la=aa<=(la=la<2?2:la)?aa-1:la)&&(ua=aa+1),$a=la-2,sa=oa=aa,da=-1,(Ca=Ta<=164&&350<=Fa?1:0)&&140<=Ta&&64&xo&&(Ca=0),Ma=ka=!0,yi=gi=oa,o=1),oa>=_&&(oa=_),sa>=_&&(sa=_),(Ca=SAEV_config.video.scandoubler&&0==Ca?-1:Ca)==r&&aa==i||(o=1),300<(Ea=Ea<10?10:Ea)&&(Ea=300),ia=ra,$_(),128&xa&&256&xa?(_a=Na,ca=Va,1&xo&&1&Fo&&(ra>>1<Ia?_a<Ia&&(_a=Ia):Ia<_a&&(_a=Ia),ra>>1<Pa?Pa<ca&&(ca=Pa):ca<Pa&&(ca=Pa)),_a<ca&&(_a=ra+_a),--ca<2&&(ca=2)):(_a=ia+13,ca=24),SAER_Events_eventtab[SAEC_Events_EV_HSYNC].oldcycles=SAEV_Events_currcycle,SAER_Events_eventtab[SAEC_Events_EV_HSYNC].evtime=SAEV_Events_currcycle+ra*SAEC_Events_CYCLE_UNIT,SAER.events.schedule(),o&&(oe=n,jr()),(fa=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS?Qr-1:$r-1)>_&&(fa=_),Z0(),Ea!=a&&SAER.video.updatedisplayarea(),Ma=Ma&&!1}function Y0(){j0(!1)}function W0(){SAER.disk.vsync(),4&xo&&(vi=vi?0:1),2&xo&&SAEV_config.chipset.genlock&&(Ni=vi?1:0),ki!=Ci?(Ui<Bi&&Ui++,Ui>=Bi&&(Ki=0)):(!(4&xo)&&0<Ui&&Ui<Bi&&!oe&&(Mi=1),Ki=Bi,Ui=0),ki=Ci,bi=vi,Ui>=Bi?(Ti=Zr(!0))&&bn():Ki>=Bi&&(Ti=Zr(!1))&&bn(),Fi?((!vi&&Fi<0||vi&&0<Fi)&&(Mi=1,++Vi>=Bi&&(Vi=Bi,0==Pi?Pi=!0:Mi=0),4&xo&&(Mi=0)),Fi=0):(Vi=0,Pi=!1),SAER.devices.vsync_post(),Ma||(944&xa)!=(944&Da)?Y0():0<gi&&1<Math.abs(gi-yi)&&Ii<4?j0(!0):(Ti||ba!=q0()||Mi)&&Z0(),Ii=Mi=0,SAER.copper.COPJMP(1,1),Kr()}function J0(){ra=ia+Ri,SAER_Events_eventtab[SAEC_Events_EV_HSYNC].evtime=SAEV_Events_currcycle+ra*SAEC_Events_CYCLE_UNIT,SAER_Events_eventtab[SAEC_Events_EV_HSYNC].oldcycles=SAEV_Events_currcycle}function Q0(e){SAER.events.current_hpos();SAER.copper.sync_copper_with_cpu(ra,0);var t,n;SAEV_Copper_enabled_thisline&&3==SAER_Copper_cop_state.state&&258==(510&SAER_Copper_cop_state.i1)&&(qo=SAER_Memory_chipGet16_indirect(SAER_Copper_cop_state.ip)),K0(),0<=rc.plfleft&&(SAEV_config.chipset.colLevel>SAEC_Config_Chipset_ColLevel_Sprite_Sprite&&function(){var e=qs[wi].nr_sprites,t=qs[wi].first_sprite_entry,n=ta[Ds>>12],r=Po,i=2*rc.plfleft<<r,a=v(rc.diwlastword),o=v(rc.diwfirstword);if(0!=Ms)for(var s=0;s<e;s++){var c=Ks[t+s],_=c.pos,f=c.max,l=_>>_o,u=f>>_o;a<u&&(f=a<<_o),u>2*rc.plfright&&(f=2*rc.plfright<<_o),l<o&&(_=o<<_o);for(var d=_=l<2*rc.plfleft?2*rc.plfleft<<_o:_;d<f;d++){var p=!0;if(0!=(A=et[c.first_pixel+d-c.pos]&n)){var E=(d<<r>>_o)-i,A=$i[255&A]|$i[A>>8]<<2;A<<=1;for(var S=bt[wi],m=1;0<=m;m--){var h=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?8:6;1024&xo&&(p=!0);for(var g=m;p&&g<h;g+=2){var y=0;g<rc.nr_planes&&(y=S[vt*g+(E>>5)]>>>31-(31&E)&1),Ms&1<<g&&y!=(Fs>>g&1)&&(p=!1)}p&&(xs|=A<<4*m)}}}}else xs|=510}(),SAEV_config.chipset.colLevel>SAEC_Config_Chipset_ColLevel_Sprite_Playfield&&function(){var e,t,n,r=Po,i=2*rc.plfleft<<r,a=v(rc.diwlastword),o=v(rc.diwfirstword),s=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?8:6;if(0!=Ms){if(!(1&xs)){e=!1,t=2*rc.plfleft,a<(n=2*rc.plfright)&&(n=a);for(var c=bt[wi],_=t=t<o?o:t;_<n&&!e;_+=32){for(var f=(_<<r)-i>>5,l=4294967295,u=0;u<s;u++){var d=Fs>>u&1,p=4294967295;l&=p=Ms>>u&1?u<rc.nr_planes?((p=c[vt*u+f])^(1&d)-1>>>0)>>>0:(1&d)-1>>>0:p}l&&(e=!0)}e&&(xs|=1)}}else xs|=1}()),qr(wi,Di,nc),hi==$a&&(Zi=0),Wi&&0<ji&&8&xo&&!Zi&&Yi==hi&&(Xi=hi,qi=ji,Zi=1),Hr(wi),zc()&&0<oe&&function(){if(!(vi&&oa-1<=hi)){wi++,zi=1;for(var e,t=new Array(8),n=new Array(8),r=0;r<8;r++)t[r]=bo[r],n[r]=Co[r],go[vi][hi][r]&&go[1-vi][hi][r]&&(e=go[vi][hi][r]-go[1-vi][hi][r],vi?4&xo&&(bo[r]=go[vi][hi][r]-e):bo[r]=4&xo?go[vi][hi][r]:bo[r]-e);G0(),bc=Ac,xc=Cc;for(var i=qs[wi-1],a=i.first_color_change;a<i.last_color_change;a++){var o,s,c=Hs[a],_=c.regno,f=c.linepos;_<4096&&f<u&&!(128&xa)&&0<=xi?(s=(o=qs[wi-1]).last_color_change,o.last_color_change++,o.nr_color_changes++,Hs[s].linepos=f+ra+1,Hs[s].regno=_,Hs[s].value=c.value,Hs[s+1].regno=-1):(s=Hs[Ws],c=c,(s=s).linepos=c.linepos,s.regno=c.regno,s.value=c.value,Ws++)}for(Hs[Ws].regno=-1,K0(),qr(wi,K,nc),Hr(wi),r=zi=0;r<8;r++)bo[r]=t[r],Co[r]=n[r]}}(),t=Ai(xo),n=0!=oe,ce<t&&(ce=t),0<t&&0,!_e&&n&&(_e=n),SAER.devices.hsync(e),SAEV_Events_hsync_counter++,65535<(Xa+=2048)&&(Xa-=65536),4294967295<(qa+=2048)&&(qa-=4294967296),J_()?Ri^=1:Ri=0,gi++,fa<=++hi&&(hi=0),e&&(hi=0,SAEV_Events_vsync_counter++),J0()}function $0(){return hi+1==aa+vi}this.is_bitplane_dma=function(e){return e<ls||Vc==Dc||bc==mc||bc>=vc&&e>=rc.plfright||A_<=e?0:p_[e-S_&a_]},this.decide_fetch=function(e){is<e&&(Vc!=Dc?x0(e,jc):lo&&(w0(e,jc),fo=!1),n0(e),is=e)},this.decide_fetch_safe=function(e){if(SAEV_Blitter_dangerous)for(;is<e;)this.decide_fetch(is+1),SAER.blitter.decide_blitter(is+1);else this.decide_fetch(e),SAER.blitter.decide_blitter(e)},this.decide_line=function(e){var t=0!=(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS);if(hi==Zo&&(0<hi||0==hi&&!SAEV_config.chipset.agnusDIP)&&(_s=E,Go=2),(hi==jo||M0()||0==hi&&SAEV_config.chipset.agnusDIP)&&(_s=p,Go=2),!(e<=rs)){var n=0!=SAEF_Custom_dmaen(SAEC_Custom_DMAF_BPLEN),r=_s==E;if(t?rs<Qo&&Qo<=e&&(pc=!1):rs<Qo&&Qo<=e&&(pc=!1,Qo>-Gc&&(lc=!1)),Vc==Dc){var i,a=!1,o=vc,s=rs;if((s=s<dc?dc:s)<qc+Gc&&(s=qc+Gc),1&(s=dc+Gc>s?dc+Gc:s)&&s++,t?(rs<Qo&&Qo<=e&&bc!=Sc&&(bc=2,a=!0,sc=Qo+Gc),(a&&sc<=e||rs<sc&&sc<=e)&&2==bc&&(bc=Sc,s=sc)):(i=qc,rs<i&&i<=e&&(lc||(bc=1),lc=!0),n&&r&&rs<Qo&&Qo<=e&&(1==bc&&(bc=2,a=!0,sc=Qo+Gc),lc=!1),n&&r&&(a&&sc<=e||rs<sc&&sc<=e)&&2==bc&&(bc=Sc,s=sc)),r&&n){a=!1;if(t?(a=bc==Sc&&(e>=qc+Gc||Hc()),uc&&$o<s&&(a=!1)):!(a=bc==Sc)&&rs<$o&&$o<s&&s==(dc+Gc+1&-2)&&(s=$o+Gc,a=!0,o=hc),a)return function(e){if(ns<0&&(ns=hi),zc()&&0<oe&&!zi)for(var t=0;t<8;t++)go[bi][hi][t]=Co[t],!bi&&4&xo&&(bo[t]=go[1-bi][hi][t]),4&xo&&!(oe<0)||(go[1-bi][hi][t]=go[bi][hi][t]=0);if(Vc=Fc,xc=kc,E,ls=e,uo){p0(jc);for(var n=e-rc.plfright<<1+P_;16<=n;)l0(16,jc),n-=16;n&&l0(n,jc),S_=e,A0(is),w0(e,jc)}else is<0&&(is=0),Wa=e,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS||Wa--,ic=0,A0(is),lo&&is<e?(w0(e,jc),lo=!1):D0(),S_=e,uo=!0;m_(is=e)}(s),t&&(rs<s&&$o<=s&&s-$o<=Gc&&(cc=$o+Gc,o=hc),rs<Xc()&&s>Xc()&&(cc=Xc()+Gc,o=hc),uc&&(o=gc,uc=0)),o!=vc&&(bc=o,m_(s)),void bf(rs=e)}t?(Qo!=$o&&rs<$o&&$o<=e&&$o<=ra-Gc&&(pc=!0,bc!=mc&&bc<hc&&(bc=hc,cc=$o+Gc)),rs<Xc()&&e>=Xc()&&(bc=gc)):n&&r&&rs<$o&&$o<=e&&$o<=ra-Gc&&bc!=mc&&(pc=!0)}as<e&&as<ja+4*m&&bf(e),rs=e}},this.compute_vsynctime_ext=function(){H0()},SAER_Playfield_current_maxvpos=X0;var ef=0;function tf(){var e=255&Lo,t=255&No,n=Lo>>8,r=No>>8;Uo&&SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS?(n|=(7&Bo)<<8,r|=(Bo>>8&7)<<8):0==(128&r)&&(r|=256),Uo&&SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE?(e|=(Bo>>5&1)<<8,t|=(Bo>>13&1)<<8):t+=256,Ga=t,os=y(Ka=e),(ss=y(t))<=os&&(os=A,ss=S()),os<A&&(os=A),n==hi&&r!=hi&&_s==p&&(Go=2,dc=SAER.events.current_hpos()),Zo=n,jo=r,Qo=ko-Gc,$o=Ko-Gc,Xo=2}function nf(){return!(8192&xa)&&0<Zi}function rf(){return 0!=(2&xo)&&!SAEV_config.chipset.genlock}function af(){return nf()?Xi:rf()?Gi:hi}function of(){return nf()?qi:rf()?Hi:SAER.events.current_hpos()}function sf(){return SAEV_config.chipset.genlock&&(!(0<=SAEV_config.cpu.speed)&&258==xo)}this.hsync_handler=function(){var e,e=(e=fa<=(e=hi+1)?0:e)==aa+vi||e==aa+vi+1||gi+1>=_;Q0(e),e&&(function(){if(0<SAEV_Events_bogusframe&&SAEV_Events_bogusframe--,0<SAEV_command)return _n=0,G0();0<kf&&kf--,SAER.devices.vsync_pre(),Oi||(e=SAEF_now(),Xr(vi,Mi),Oi=!0,SAEV_Events_frameskiptime+=SAEF_now()-e);var e=SAER.events.framewait();SAEV_Playfield_picasso_on||(SAEV_Playfield_frame_rendered=!SAEV_Playfield_frame_rendered&&va?SAER.video.render_screen(!1):SAEV_Playfield_frame_rendered)&&!SAEV_Playfield_frame_shown&&(SAEV_Playfield_frame_shown=SAER.video.show_screen_maybe(0<=Wr())),SAER.events.fpscounter(e),SAEV_Playfield_frame_rendered=SAEV_Playfield_frame_shown=Oi=!1,0<ya?va^=1:va=1}(),SAEF_setSpcFlags(SAEC_spcflag_BRK)),function(e){SAEV_Copper_last_hpos=0,Li=!Li;var t,n=!(2&xo)||2&xo&&SAEV_config.chipset.genlock&&(!SAEV_config.chipset.ntsc||Li),r=!(2&xo)||2&xo&&SAEV_config.chipset.genlock&&Ni;SAER.cia.hsync_post(n),n&&(384&xa?Va<(-2&ra)&&Na<ra&&SAER.cia.b_tod_handler(Va):SAER.cia.b_tod_handler(18)),SAEV_config.chipset.cia.tod!=SAEC_Config_Chipset_CIA_TOD_VSync?ef<ra?(SAER.cia.a_tod_inc(ef),n=Ea*(2*aa+(oe?1:0))*(2*ra+(J_()?1:0))/(4*(SAEV_config.chipset.cia.tod==SAEC_Config_Chipset_CIA_TOD_60Hz?60:50))>>>0,ef+=n):ef-=ra:SAEV_config.chipset.cia.tod==SAEC_Config_Chipset_CIA_TOD_VSync&&r&&(640&xa?hi==za&&Ba<=aa&&SAER.cia.a_tod_inc(vi?Va:Va+Ua):hi==(SAEV_config.chipset.ntsc?ui:li)&&SAER.cia.a_tod_inc(vi?132:18)),SAER.input.hsync(),!SAEV_config.chipset.blitter.cycle_exact&&SAEV_Blitter_bltstate!=SAEC_Blitter_bltstate_DONE&&SAEF_Custom_dmaen(SAEC_Custom_DMAF_BPLEN)&&_s==E&&SAER.blitter.blitter_slowdown(rc.plfleft,rc.plfright-(16<<jc),d_[jc][Ai(xo)][$c(xo)],u_[jc][Ai(xo)][$c(xo)]),e&&(8&xo&&!Zi&&(Xi=hi-1,qi=ra,Zi=1),hi=0,W0(),gi=0),SAEV_config.chipset.agnusDIP?1==hi&&SAER.custom.send_interrupt(SAEC_Custom_INTF_VERTB,+SAEC_Events_CYCLE_UNIT):0==hi&&SAER.custom.send_interrupt(SAEC_Custom_INTF_VERTB,+SAEC_Events_CYCLE_UNIT),hi+1!=aa+vi&&hi+1!=aa+vi+1||(Ci=0!=vi),SAER.events.events_dmal_hsync(),SAEV_config.cpu.speed<0?SAER.events.framewait2_maximum($0()):hi+1<aa+vi&&(hi==+sa/3>>>0||hi==2*sa/3>>>0)&&SAER.events.framewait2_normal(),(e=hi)>=_&&(e%=_),Di=K,zc()&&0<oe?e*=2:!oe&&Ca<=0&&SAEV_config.video.vresolution&&1<SAEV_config.video.pscanlines?(e*=2,Di=1&SAEV_Events_timeframes?(e++,3==SAEV_config.video.pscanlines?W:j):3==SAEV_config.video.pscanlines?Y:Z):(Ca<=0||0<oe)&&SAEV_config.video.vresolution&&SAEV_config.video.iscanlines?(e*=2,Di=oe?bi?2==SAEV_config.video.iscanlines?Y:Z:(e++,2==SAEV_config.video.iscanlines?W:j):SAEV_config.video.vresolution>SAEC_Config_Video_VResolution_NonDouble&&1==SAEV_config.video.pscanlines?q:G):SAEV_config.video.vresolution&&(Ca<=0||0<oe)&&(e*=2,Di=oe?bi?H:(e++,X):SAEV_config.video.vresolution>SAEC_Config_Video_VResolution_NonDouble&&1==SAEV_config.video.pscanlines?q:G),xi=wi,wi=e,G0(),Wa=255,SAER_Copper_cop_state.hpos=0,SAER.copper.compute_spcflag_copper(ra),0<mi(xo)&&SAEF_Custom_dmaen(SAEC_Custom_DMAF_BPLEN)&&(0==ps&&(ps=xo),ds<hi&&(ds=hi),la<=hi&&0==us?us=la<hi?hi-1:hi:hi>=X0()-1&&(ds=X0())),0==Xo&&(us<=hi&&hi<=ds&&(hs<ss&&(hs=ss)>y(2*_a)&&(hs=y(2*_a)),os<ms&&((ms=os)<y(2*ca)&&(ms=y(2*ca)),0)),_s==E&&(Qo+(t=8<<jc)<gs+t&&(gs=Qo+t),ys+2*t<$o+2*t&&(ys=$o+2*t)),(Zo<Yo||Yo==la&&la<hi)&&Zo<hi>>1&&(Yo=Zo<la?la:Zo),Wo<jo&&Yo<jo&&aa>>1<jo&&(Wo=jo)),0<Xo&&Xo--,$0()&&Wr()<=-2&&!Oi&&0==SAEV_config.video.apmode[0].gfx_vflip&&(t=SAEF_now(),Xr(vi,Mi),Oi=!0,va&&(SAEV_Playfield_frame_rendered=SAER.video.render_screen(!0)),SAEV_Events_frameskiptime+=SAEF_now()-t)}(e)},this.DENISEID=function(){return 0<=SAEV_config.chipset.deniseRev?SAEV_config.chipset.deniseRev:SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?SAEV_config.chipset.ide==SAEC_Config_Chipset_IDE_A4000?64760:248:65532},this.VPOSR=function(){var e=0,t=af(),n=of(),r=vi;return t+1!=aa+vi||n!=ra-1&&n!=ra-2||4&xo&&Ec&&(r=vi?0:1),t=(t=n+(Ec?ei:0)>=ra+(Ec?1:0)&&aa+vi<=++t?0:t)>>8&7,0<=SAEV_config.chipset.agnusRev?e|=SAEV_config.chipset.agnusRev<<8:(e|=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?8960:0,e|=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS?8192:0,SAEV_config.chipset.ntsc&&(e|=4096)),SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS||(t&=1),t|=(r?32768:0)|e,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS&&(t|=Ri?128:0),sf(),t},this.VPOSW=function(e){var t=hi;vi!=(32768&e?1:0)&&(Fi=(vi=32768&e?1:0)?1:-1),SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS&&(Ri=128&e?1:0,J_()||(Ri=0)),Fi||(hi&=255,e&=7,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS||(e&=1),(hi|=e<<8)!=t&&Ii++,hi<t&&(hi=t))},this.VHPOSW=function(e){var t=hi;hi&=65280,(hi|=e>>=8)!=t&&Ii++,(hi<t||hi<la&&t<la)&&(hi=t)};var cf=0;function _f(){128&xa&&(Ma=!0)}function ff(e,t,n){SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE?SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA||(t&=-177):t&=-242,Vo==(t&=-929)&&!n||(Io=-1,Y_(Vo)&&(t|=128),I0(e,256,n?t:-3201&Vo|3201&t),Vo=-129&t,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE&&(U0(e),so=P0(t,Fo)),(rc.plfleft<0?A0:function(e){var t=mi(Vo);if(t<B_&&e>rc.plfright&&rc.plfright&&(x_[0]||x_[1])){for(var n=e-rc.plfright<<1+P_;16<=n;)l0(16,jc),n-=16;n&&l0(n,jc),rc.plfright+=e-rc.plfright}SAEV_config.cpu.model<SAEC_Config_CPU_Model_68020&&(B_=t,W_()&&B_<6&&(B_=6))})(e))}function lf(e){return 32768&e?e-65536:e}function uf(e,t){0===t?(ao-=Ya[e].armed,Ya[e].armed=0):(ao+=1-Ya[e].armed,Ya[e].armed=1)}function df(e){hi<$a||M0()||e.ignoreverticaluntilnextline||(hi==e.vstart&&(e.dmastate=1),hi==e.vstop&&(e.dmastate=0))}function pf(e){var t,n=Ya[e];df(n),t=2*(255&to[e])+(1&eo[e]),t<<=_o,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?(t|=(eo[e]>>3&3)>>f-_o,n.dblscan=128&to[e]):SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE&&(t|=(eo[e]>>3&2)>>f-_o),n.xpos=t,n.vstart=to[e]>>8,n.vstart|=4&eo[e]?256:0,n.vstop=eo[e]>>8,n.vstop|=2&eo[e]?256:0,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS&&(n.vstart|=64&eo[e]?512:0,n.vstop|=32&eo[e]?512:0),df(n)}function Ef(e,t,n){ra-2<=n&&eo[t]!=e&&hi<aa-1&&(n=Ya[t],hi++,df(n),hi--,n.ignoreverticaluntilnextline=!0,Ja=!0),eo[t]=e,uf(t,0),pf(t)}function Af(e,t,n){ra-2<=n&&to[t]!=e&&hi<aa-1&&(n=Ya[t],hi++,df(n),hi--,n.ignoreverticaluntilnextline=!0,Ja=!0),to[t]=e,pf(t)}function Sf(e,t){no[t][0]=e,no[t][1]=e,no[t][2]=e,no[t][3]=e,uf(t,1)}function mf(e,t){ro[t][0]=e,ro[t][1]=e,ro[t][2]=e,ro[t][3]=e}function hf(){var e;SAEV_Copper_access&&(hi<20||T0(-1,xo,Fo)||(la<=hi?(e=Jo?la:hi,0==us&&(us=e-2),Yo==X0()&&(Yo=e-2),(ds<e||Wo<e)&&(Wo=ds=e+3),Jo=0):Jo++))}function gf(e,t){var n=65535&SAEV_Custom_last_value;return t&&(n=SAEV_Custom_last_value=SAER_Memory_chipGet16_indirect(e.pt)),e.pt+=2,n}function yf(e){var t=SAER_Memory_chipGet16_indirect(e.pt);return e.pt+=2,t}function vf(e,t,n){var r,i,a=Ya[e],o=0,s=SAEF_Custom_dmaen(SAEC_Custom_DMAF_SPREN)||1&e&&Ya[-2&e].dmacycle;if(!M0())if(s&&a.dblscan&&32768&wa&&(1&hi)!=(1&a.vstart)&&a.dmastate)uf(e,1);else{if(hi==a.vstart){if(a.dmastate=1,a.ptxvpos2==hi&&n<a.ptxhpos2)return;0==e&&0==t&&SAEF_Custom_dmaen(SAEC_Custom_DMAF_SPREN)&&0!=us&&(Ya[0].pt,Ya[0].vstop,Ya[0].vstart,Qa[0]=0,0==so&&0,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?(i=(To>>4&15)<<4,Qa[1]=wo.color_regs_aga[1+i],Qa[2]=wo.color_regs_aga[2+i],Qa[3]=wo.color_regs_aga[3+i]):(Qa[1]=Pe[wo.color_regs_ecs[17]],Qa[2]=Pe[wo.color_regs_ecs[18]],Qa[3]=Pe[wo.color_regs_ecs[19]]),0)}if(hi!=a.vstop&&hi!=$a||(a.dmastate=0),s){if(r=n<Wa||_s!=E,hi==a.vstop||hi==$a){if(a.dmastate=0,o=1,r){switch(c=gf(a,r),oo){case 64:yf(a),yf(a);case 32:yf(a)}0==t?(Af(c,e,n),a.dmacycle=1):(Ef(c,e,n),a.dmastate=0,df(a))}hi==$a&&(a.dmastate=0)}if(a.dmastate&&!o&&r){var c=gf(a,r);switch(0==t?(Sf(c,e),a.dmacycle=1):(mf(c,e),uf(e,1)),oo){case 64:var _=yf(a),f=yf(a),l=yf(a);r&&(0==t?(no[e][3]=l,no[e][2]=f,no[e][1]=_):(ro[e][3]=l,ro[e][2]=f,ro[e][1]=_));break;case 32:_=yf(a);r&&(0==t?no[e][1]=_:ro[e][1]=_)}}}}}function bf(e){if(!(hi<$a||zc()&&oe&&1&wi)){var t=e,n=as+1;if(!(t<=n||as==e)&&(t>=ja+4*m&&(t=ja+4*m-1),(n=n<ja?ja:n)!=t)){for(var r=n;r<=t;r++){var i=-1,a=r-ja>>2;switch(r-ja&3){case 0:Ya[a].dmacycle=i=0;break;case 2:i=1}0<=i&&(Ya[a].ptxhpos=s,vf(a,i,r))}as=e}}}function Cf(e){return 0}this.VHPOSR=function(){var e=af(),t=of();return Ec&&(t+=ei),ra<=t&&(Ec?1:0)<=(t-=ra)&&aa+vi<=++e&&(e=0),Ec&&ra<=(t+=1)&&(t-=ra),e=e<<8&65535,sf()&&(t=cf%ra,65535<++cf&&(cf=0)),e|=t},this.REFPTR=function(e){qa=65024&(Xa=e)|(510&e)>>1,1&e&&(qa=(65536|qa)>>>0),2&e&&(qa=(131073|qa)>>>0),4&e&&(qa=(258|qa)>>>0)},this.BEAMCON0=function(e){e!=Da&&-33&(Da=e)&&SAEF_warn("playfield.BEAMCON0() write 0x%04x",e),tf()},this.HTOTAL=function(e){Ta!=e&&(Ta=255&e,_f())},this.HSSTOP=function(e){Va!=e&&(Va=255&e,_f())},this.HBSTRT=function(e){Ia!=e&&(Ia=255&e,_f())},this.HBSTOP=function(e){Pa!=e&&(Pa=255&e,_f())},this.VTOTAL=function(e){Fa!=e&&(Fa=e&Qr-1,_f())},this.VSSTOP=function(e){za!=e&&(za=e&Qr-1,_f())},this.VBSTRT=function(e){(Oa<e||Oa>1+(e&Qr-1))&&(Oa=e&Qr-1,_f())},this.VBSTOP=function(e){(La<e||La>1+(e&Qr-1))&&(La=e&Qr-1,_f())},this.HSSTRT=function(e){Na!=e&&(Na=255&e,_f())},this.VSSTRT=function(e){Ba!=e&&(Ba=e&Qr-1,_f())},this.HCENTER=function(e){Ua!=e&&(Ua=255&e,_f())},this.dcheck_is_blit_dangerous=function(){SAER.blitter.check_is_blit_dangerous(bo,zo,50<<Po)},this.BPLxPTH=function(e,t,n){this.decide_line(e),this.decide_fetch_safe(e),SAEV_Copper_access&&this.is_bitplane_dma(e+1)==n+1?Go=2:(bo[n]=(65535&bo[n]|t<<16)>>>0,Co[n]=(65535&Co[n]|t<<16)>>>0,this.dcheck_is_blit_dangerous())},this.BPLxPTL=function(e,t,n){this.decide_line(e),this.decide_fetch_safe(e),SAEV_Copper_access&&this.is_bitplane_dma(e+1)==n+1?Go=2:(bo[n]=(4294901760&bo[n]|65534&t)>>>0,Co[n]=(4294901760&Co[n]|65534&t)>>>0,this.dcheck_is_blit_dangerous())},this.BPLCON0=function(e,t){SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE?SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA||(t&=-177):t&=-242,xo!=(t&=-129)&&(Go=2,Zc(e),this.decide_line(e),this.decide_fetch_safe(e),rf()||(Gi=hi,Hi=e),4&xo&&0,xo=t,r0(e),rc.plfleft<0&&ff(e,t,!0))},this.BPLCON1=function(e,t){SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA||(t&=255),Do!=t&&(Go=2,this.decide_line(e),this.decide_fetch_safe(e),q_=!0,Do=t,E0(e))},this.BPLCON2=function(e,t){SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA||(t&=127),(16383&Mo)!=(16383&t)&&(this.decide_line(e),I0(e,260,Mo=t))},this.BPLCON3=function(e,t){SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA||(t&=63,t|=3072),Fo!=t&&(this.decide_line(e),U0(e),so=P0(xo,Fo=t),I0(e,262,t))},this.BPLCON4=function(e,t){To!=t&&(this.decide_line(e),I0(e,268,To=t))},this.BPL1MOD=function(e,t){po!=lf(t&=-2)&&(this.decide_line(e),this.decide_fetch_safe(e)),mo=1&this.is_bitplane_dma(e+1)?(Ao=lf(t),e+1):(po=lf(t),0)},this.BPL2MOD=function(e,t){Eo!=lf(t&=-2)&&(this.decide_line(e),this.decide_fetch_safe(e)),ho=2&this.is_bitplane_dma(e+1)?(So=lf(t),e+1):(Eo=lf(t),0)},this.BPLxDAT=function(e,t,n){0==t&&8<=e&&(this.decide_line(e),this.decide_fetch_safe(e)),p0(jc),w_[t]=n,V_[t]=0,I_[t]=n,0==t&&8<=e&&(lo=fo=!0,rc.plfleft<0&&D0(),m0(e,jc))},this.DIWSTRT=function(e,t){Lo==t&&!Uo||(Zc(e),this.decide_line(e),Uo=0,Lo=t,tf())},this.DIWSTOP=function(e,t){No==t&&!Uo||(Zc(e),this.decide_line(e),Uo=0,No=t,tf())},this.DIWHIGH=function(e,t){SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA||(t&=-6169),t&=-49345,Uo&&Bo==t||(this.decide_line(e),Uo=1,Bo=t,tf())},this.DDFSTRT=function(e,t){t&=254,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS||(t&=252),this.decide_line(e),Go=2,e==ko-Gc&&2==bc&&sc==e+Gc&&(bc=1,sc=ra),ko=t,tf(),Vc!=Dc&&m_(e),212<Ko&&4==(4&ko)&&SAEF_warn("playfield.DDFSTRT() very strange DDF values (%x %x)",ko,Ko)},this.DDFSTOP=function(e,t){t&=254,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_AGNUS||(t&=252),this.decide_line(e),this.decide_fetch_safe(e),Go=2,e==t-Gc?bc==hc&&cc==e+Gc&&(bc=Sc,cc=256+Gc,_c=e):e==Ko-Gc&&bc==Sc&&(bc=hc,cc=e+Gc),Ko=t,tf(),Vc!=Dc&&m_(e),212<Ko&&4==(4&ko)&&SAEF_warn("playfield.DDFSTOP() very strange DDF values (%x %x)",ko,Ko)},this.FMODE=function(e,t){wa!=(t&=49167)&&(Go=2,Ra=t,Oc(),r0(e))},this.FNULL=function(e){},this.SPRxDATA=function(e,t,n){U0(e,!0),Sf(t,n)},this.SPRxDATB=function(e,t,n){U0(e,!0),mf(t,n)},this.SPRxCTL=function(e,t,n){U0(e),Ef(t,n,e)},this.SPRxPOS=function(e,t,n){var r,i=Ya[n];U0(e),r=i.vstart,Af(t,n,e),e>=ja+4*n-4&&e<=ja+4*n-1&&r!=hi&&(i.ptxvpos2=hi,i.ptxhpos2=e+4)},this.SPRxPTH=function(e,t,n){U0(e),e-1!=Ya[n].ptxhpos&&(Ya[n].pt=(t<<16|65535&Ya[n].pt)>>>0)},this.SPRxPTL=function(e,t,n){U0(e),e-1!=Ya[n].ptxhpos&&(Ya[n].pt=(4294901760&Ya[n].pt|65534&t)>>>0)},this.CLXCON=function(e){Ms=(Ds=e)>>6&63,Fs=63&e},this.CLXCON2=function(e){Ms|=192&e,Fs|=(3&e)<<6,Fs&=4294967295},this.CLXDAT=function(){var e=32768|xs;return xs=0,e},this.COLOR_READ=function(e){if(!(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA&&256&Mo))return 65535;var t,n=32*(Fo>>13&7)+e,r=wo.color_regs_aga[n]>>16&255,i=wo.color_regs_aga[n]>>8&255,n=255&wo.color_regs_aga[n];return 512&Fo?t=(15&r)<<8|(15&i)<<4|(15&n)<<0:(t=r>>4<<8|i>>4<<4|n>>4<<0,na[e]&&(t|=32768)),t},this.COLOR_WRITE=function(e,t,n){var r,i,a,o,s,c,_;SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA?256&Mo||(r=32*(Fo>>13&7)+n,i=(3840&t)>>8,a=(240&t)>>4,o=(15&t)>>0,s=wo.color_regs_aga[r]>>16&255,c=wo.color_regs_aga[r]>>8&255,_=255&wo.color_regs_aga[r],512&Fo?(s&=240,s|=i,c&=240,c|=a,_&=240,_|=o):(s=i+(i<<4),c=a+(a<<4),_=o+(o<<4),na[r]=t>>15),_=(s<<16|c<<8|_|(na[r]?2147483648:0))>>>0,_!=wo.color_regs_aga[r]&&(0==r&&hf(),F0(e,r,_),Qs=-1,wo.color_regs_aga[r]=_,wo.acolors[r]=F(_))):(t&=36863,SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE||(t&=4095),na[n]=t>>15,wo.color_regs_ecs[n]!=t&&(0==n&&hf(),F0(e,n,t),Qs=-1,wo.color_regs_ecs[n]=t,wo.acolors[n]=F(t)))};var kf=0;function Rf(e){if(0==SAER_CPU_regs.d[0])return kf;kf=10;var t={};return SAEF_gettimeofday(t,null),SAER_Memory_put32(SAER_CPU_regs.a[0],t.tv_sec-252460800),SAER_Memory_put32(SAER_CPU_regs.a[0]+4,t.tv_usec),0}function wf(e,t,n,r){if(!r)return n;t=jn(e,0,t,0);if(!t)return n;t=3276&Xe.color_regs_ecs[t];return Pe[t|=t>>2]}function xf(e,t,n,r){for(var i=rt;t<n;){var a=Ye.apixels[e++],o=Ye.apixels[e++],s=4*(3&o)+(3&a)+(16&(a|o)),c=(3276&Xe.color_regs_ecs[s])<<0;c|=c>>2,i[t+it]=wf(t,a,Pe[c],r),t++,c=(819&Xe.color_regs_ecs[s])<<2,c|=c>>2,i[t+it]=wf(t,o,Pe[c],r),t++}return e}function Df(e,t,n){return xf(e,t,n,!0)}function Mf(e,t,n){return xf(e,t,n,!1)}function Ff(e,t,n,r){for(var i=rt;t<n;){var a=Ye.apixels[e++],o=Ye.apixels[e++],s=4*(3&o)+(3&a)+(16&(a|o)),c=(3276&Xe.color_regs_ecs[s])<<0;c|=c>>2,i[t+it]=wf(t,a,Pe[c],r),t++,c=(819&Xe.color_regs_ecs[s])<<2,c|=c>>2,i[t+it]=wf(t,o,Pe[c],r),t++}return e}function Tf(e,t,n){return Ff(e,t,n,!0)}function Vf(e,t,n){return Ff(e,t,n,!1)}function If(e,t,n,r){for(var i=rt;t<n;){var a=Ye.apixels[e++],o=Ye.apixels[e++],o=(3276&Xe.color_regs_ecs[4*(3&o)+(3&a)+(16&(a|o))])<<0;o|=o>>2,i[t+it]=wf(t,a,Pe[o],r),t++}return e}function Pf(e,t,n){return If(e,t,n,!0)}function zf(e,t,n){return If(e,t,n,!1)}function Of(e,t,n,r){for(var i=rt;t<n;){var a=Ye.apixels[e++],o=Ye.apixels[e++],s=4*(3&o)+(3&a)+(16&(a|o)),c=(3276&Xe.color_regs_ecs[s])<<0,o=Pe[c|=c>>2];c=(819&Xe.color_regs_ecs[s])<<2,c=Pe[c|=c>>2],i[t+it]=wf(t,a,Wn(o,c),r),t++}return e}function Lf(e,t,n){return Of(e,t,n,!0)}function Nf(e,t,n){return Of(e,t,n,!1)}function Bf(e,t,n,r){for(var i=rt;t<n;){var a=Ye.apixels[e++],o=Ye.apixels[e++],o=(3276&Xe.color_regs_ecs[4*(3&o)+(3&a)+(16&(a|o))])<<0;o|=o>>2,i[t+it]=wf(t,a,Pe[o],r),t++}return e}function Uf(e,t,n){return Bf(e,t,n,!0)}function Kf(e,t,n){return Bf(e,t,n,!1)}function Gf(e,t,n,r){for(var i=rt;t<n;){var a=Ye.apixels[e++],o=Ye.apixels[e++],s=4*(3&o)+(3&a)+(16&(a|o)),c=(3276&Xe.color_regs_ecs[s])<<0,o=Pe[c|=c>>2];c=(819&Xe.color_regs_ecs[s])<<2,c=Pe[c|=c>>2],i[t+it]=wf(t,a,Yn(o,c),r),t++}return e}function Hf(e,t,n){return Gf(e,t,n,!0)}function Xf(e,t,n){return Gf(e,t,n,!1)}function qf(e,t,n,r){for(var i=rt;t<n;){var a=Ye.apixels[e++],o=Ye.apixels[e++],o=(3276&Xe.color_regs_ecs[4*(3&o)+(3&a)+(16&(a|o))])<<0;o|=o>>2,i[t+it]=wf(t,a,Pe[o],r),e+=2,t++}return e}function Zf(e,t,n){return qf(e,t,n,!0)}function jf(e,t,n){return qf(e,t,n,!1)}function Yf(e,t,n,r){for(var i=rt;t<n;){var a,o=Ye.apixels[e++],s=Ye.apixels[e++],c=4*(3&s)+(3&o)+(16&(o|s)),_=(3276&Xe.color_regs_ecs[c])<<0,f=Pe[_|=_>>2];_=(819&Xe.color_regs_ecs[c])<<2,a=Wn(f,Pe[_|=_>>2]),o=Ye.apixels[e++],s=Ye.apixels[e++],_=(3276&Xe.color_regs_ecs[c=4*(3&s)+(3&o)+(16&(o|s))])<<0,f=Pe[_|=_>>2],_=(819&Xe.color_regs_ecs[c])<<2,_=Wn(f,Pe[_|=_>>2]),i[t+it]=wf(t,o,Wn(a,_),r),t++}return e}function Wf(e,t,n){return Yf(e,t,n,!0)}function Jf(e,t,n){return Yf(e,t,n,!1)}function Qf(e,t,n,r){for(var i=rt;t<n;){var a=Ye.apixels[e++],o=Ye.apixels[e++],o=(3276&Xe.color_regs_ecs[4*(3&o)+(3&a)+(16&(a|o))])<<0;o|=o>>2,i[t+it]=wf(t,a,Pe[o],r),e+=2,t++}return e}function $f(e,t,n){return Qf(e,t,n,!0)}function el(e,t,n){return Qf(e,t,n,!1)}function tl(e,t,n,r){for(var i=rt;t<n;){var a,o=Ye.apixels[e++],s=Ye.apixels[e++],c=4*(3&s)+(3&o)+(16&(o|s)),_=(3276&Xe.color_regs_ecs[c])<<0,f=Pe[_|=_>>2];_=(819&Xe.color_regs_ecs[c])<<2,a=Wn(f,Pe[_|=_>>2]),o=Ye.apixels[e++],s=Ye.apixels[e++],_=(3276&Xe.color_regs_ecs[c=4*(3&s)+(3&o)+(16&(o|s))])<<0,f=Pe[_|=_>>2],_=(819&Xe.color_regs_ecs[c])<<2,_=Wn(f,Pe[_|=_>>2]),i[t+it]=wf(t,o,Yn(a,_),r),t++}return e}function nl(e,t,n){return tl(e,t,n,!0)}function rl(e,t,n){return tl(e,t,n,!1)}function il(e,t,n){var r=rt;if(Ht){if(t+it&2&&(a=i=0,i=nt[e],a=je[i],e++,r[t+it]=a,t++),n<=t)return e;for((s=n+it&2)&&n--;t<n;){var i=0,a=0,o=0;i=nt[e],o=a=je[i],i=nt[++e],a=je[i],e++,r[t+it]=(o=(o<<16|65535&a)>>>0)>>>16,r[t+it+1]=65535&o,t+=2}s&&(a=i=0,i=nt[e],a=je[i],e++,r[t+it]=a,t++)}else if(Xt){var s,c=qt?he:me;if(t+it&2&&(a=i=0,i=Ye.apixels[e],a=Ze[c[i]],e++,r[t+it]=a,t++),n<=t)return e;for((s=n+it&2)&&n--;t<n;){var i=0,a=0,o=0;i=Ye.apixels[e],e++,o=a=Ze[c[i]],i=Ye.apixels[e],a=Ze[c[i]],e++,r[t+it]=(o=(o<<16|65535&a)>>>0)>>>16,r[t+it+1]=65535&o,t+=2}s&&(a=i=0,i=Ye.apixels[e],a=Ze[c[i]],e++,r[t+it]=a,t++)}else if(Gt){if(t+it&2&&(a=i=0,a=(i=Ye.apixels[e])<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],e++,r[t+it]=a,t++),n<=t)return e;for((s=n+it&2)&&n--;t<n;){var i=0,a=0,o=0;i=Ye.apixels[e],e++,o=a=i<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],a=(i=Ye.apixels[e])<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],e++,r[t+it]=(o=(o<<16|65535&a)>>>0)>>>16,r[t+it+1]=65535&o,t+=2}s&&(a=i=0,a=(i=Ye.apixels[e])<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],e++,r[t+it]=a,t++)}else{if(t+it&2&&(a=i=0,i=Ye.apixels[e],a=Ze[i],e++,r[t+it]=a,t++),n<=t)return e;for((s=n+it&2)&&n--;t<n;){i=0,a=0,o=0;i=Ye.apixels[e],e++,o=a=Ze[i],i=Ye.apixels[e],a=Ze[i],e++,r[t+it]=(o=(o<<16|65535&a)>>>0)>>>16,r[t+it+1]=65535&o,t+=2}s&&(a=i=0,i=Ye.apixels[e],a=Ze[i],e++,r[t+it]=a,t++)}return e}function al(e,t,n){var r=rt;if(Ht)for(;t<n;){var i=0,a=0;i=nt[e],e++,a=je[i],r[t+it]=a>>>16,r[t+it+1]=65535&a,t+=2}else if(Xt)for(var o=qt?he:me;t<n;){i=0,a=0;i=Ye.apixels[e],e++,a=Ze[o[i]],r[t+it]=a>>>16,r[t+it+1]=65535&a,t+=2}else if(Gt)for(;t<n;){i=0,a=0;i=Ye.apixels[e],e++,a=i<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],r[t+it]=a>>>16,r[t+it+1]=65535&a,t+=2}else for(;t<n;){i=0,a=0;i=Ye.apixels[e],e++,a=Ze[i],r[t+it]=a>>>16,r[t+it+1]=65535&a,t+=2}return e}function ol(e,t,n){var r=rt;if(Ht)for(;t<n;){var i=0,a=0;i=nt[e],e++,a=je[i],r[t+it]=a>>>16,r[t+it+1]=65535&a,r[(t+=2)+it]=a>>>16,r[t+it+1]=65535&a,t+=2}else if(Xt)for(var o=qt?he:me;t<n;){i=0,a=0;i=Ye.apixels[e],e++,a=Ze[o[i]],r[t+it]=a>>>16,r[t+it+1]=65535&a,r[(t+=2)+it]=a>>>16,r[t+it+1]=65535&a,t+=2}else if(Gt)for(;t<n;){i=0,a=0;i=Ye.apixels[e],e++,a=i<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],r[t+it]=a>>>16,r[t+it+1]=65535&a,r[(t+=2)+it]=a>>>16,r[t+it+1]=65535&a,t+=2}else for(;t<n;){i=0,a=0;i=Ye.apixels[e],e++,a=Ze[i],r[t+it]=a>>>16,r[t+it+1]=65535&a,r[(t+=2)+it]=a>>>16,r[t+it+1]=65535&a,t+=2}return e}function sl(e,t,n){var r=rt;if(Ht){if(t+it&2&&(a=i=0,i=nt[e],a=je[i],e+=2,r[t+it]=a,t++),n<=t)return e;for((s=n+it&2)&&n--;t<n;){var i=0,a=0,o=0;i=nt[e],o=a=je[i],i=nt[e+=2],a=je[i],e+=2,r[t+it]=(o=(o<<16|65535&a)>>>0)>>>16,r[t+it+1]=65535&o,t+=2}s&&(a=i=0,i=nt[e],a=je[i],e+=2,r[t+it]=a,t++)}else if(Xt){var s,c=qt?he:me;if(t+it&2&&(a=i=0,i=Ye.apixels[e],a=Ze[c[i]],e+=2,r[t+it]=a,t++),n<=t)return e;for((s=n+it&2)&&n--;t<n;){var i=0,a=0,o=0;i=Ye.apixels[e],e+=2,o=a=Ze[c[i]],i=Ye.apixels[e],a=Ze[c[i]],e+=2,r[t+it]=(o=(o<<16|65535&a)>>>0)>>>16,r[t+it+1]=65535&o,t+=2}s&&(a=i=0,i=Ye.apixels[e],a=Ze[c[i]],e+=2,r[t+it]=a,t++)}else if(Gt){if(t+it&2&&(a=i=0,a=(i=Ye.apixels[e])<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],e+=2,r[t+it]=a,t++),n<=t)return e;for((s=n+it&2)&&n--;t<n;){var i=0,a=0,o=0;i=Ye.apixels[e],e+=2,o=a=i<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],a=(i=Ye.apixels[e])<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],e+=2,r[t+it]=(o=(o<<16|65535&a)>>>0)>>>16,r[t+it+1]=65535&o,t+=2}s&&(a=i=0,a=(i=Ye.apixels[e])<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],e+=2,r[t+it]=a,t++)}else{if(t+it&2&&(a=i=0,i=Ye.apixels[e],a=Ze[i],e+=2,r[t+it]=a,t++),n<=t)return e;for((s=n+it&2)&&n--;t<n;){i=0,a=0,o=0;i=Ye.apixels[e],e+=2,o=a=Ze[i],i=Ye.apixels[e],a=Ze[i],e+=2,r[t+it]=(o=(o<<16|65535&a)>>>0)>>>16,r[t+it+1]=65535&o,t+=2}s&&(a=i=0,i=Ye.apixels[e],a=Ze[i],e+=2,r[t+it]=a,t++)}return e}function cl(e,t,n){var r=rt;if(Ht){if(t+it&2&&(a=i=0,i=nt[e],_=a=je[i],i=nt[++e],a=Yn(a=je[i],_),e++,r[t+it]=a,t++),n<=t)return e;for((s=n+it&2)&&n--;t<n;){var i=0,a=0,o=0;i=nt[e],_=a=je[i],i=nt[++e],o=a=Yn(a=je[i],_),i=nt[++e],_=a=je[i],i=nt[++e],a=Yn(a=je[i],_),e++,r[t+it]=(o=(o<<16|65535&a)>>>0)>>>16,r[t+it+1]=65535&o,t+=2}s&&(a=i=0,i=nt[e],_=a=je[i],i=nt[++e],a=Yn(a=je[i],_),e++,r[t+it]=a,t++)}else if(Xt){var s,c=qt?he:me;if(t+it&2&&(a=i=0,i=Ye.apixels[e],_=a=Ze[c[i]],i=Ye.apixels[++e],a=Yn(a=Ze[c[i]],_),e++,r[t+it]=a,t++),n<=t)return e;for((s=n+it&2)&&n--;t<n;){var i=0,a=0,o=0;i=Ye.apixels[e],e++,_=a=Ze[c[i]],i=Ye.apixels[e],e++,o=a=Yn(a=Ze[c[i]],_),i=Ye.apixels[e],e++,_=a=Ze[c[i]],i=Ye.apixels[e],a=Yn(a=Ze[c[i]],_),e++,r[t+it]=(o=(o<<16|65535&a)>>>0)>>>16,r[t+it+1]=65535&o,t+=2}s&&(a=i=0,i=Ye.apixels[e],_=a=Ze[c[i]],i=Ye.apixels[++e],a=Yn(a=Ze[c[i]],_),e++,r[t+it]=a,t++)}else if(Gt){if(t+it&2&&(a=i=0,_=a=(i=Ye.apixels[e])<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],a=Yn(a=(i=Ye.apixels[++e])<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],_),e++,r[t+it]=a,t++),n<=t)return e;for((s=n+it&2)&&n--;t<n;){var i=0,a=0,o=0;i=Ye.apixels[e],e++,_=a=i<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],a=Yn(a=(i=Ye.apixels[e])<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],_),e++,o=a,i=Ye.apixels[e],e++,_=a=i<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],a=Yn(a=(i=Ye.apixels[e])<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],_),e++,r[t+it]=(o=(o<<16|65535&a)>>>0)>>>16,r[t+it+1]=65535&o,t+=2}s&&(a=i=0,_=a=(i=Ye.apixels[e])<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],a=Yn(a=(i=Ye.apixels[++e])<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],_),e++,r[t+it]=a,t++)}else{if(t+it&2&&(a=i=0,i=Ye.apixels[e],_=a=Ze[i],i=Ye.apixels[++e],a=Yn(a=Ze[i],_),e++,r[t+it]=a,t++),n<=t)return e;for((s=n+it&2)&&n--;t<n;){var _,i=0,a=0,o=0;i=Ye.apixels[e],e++,_=a=Ze[i],i=Ye.apixels[e],e++,o=a=Yn(a=Ze[i],_),i=Ye.apixels[e],e++,_=a=Ze[i],i=Ye.apixels[e],a=Yn(a=Ze[i],_),e++,r[t+it]=(o=(o<<16|65535&a)>>>0)>>>16,r[t+it+1]=65535&o,t+=2}s&&(a=i=0,i=Ye.apixels[e],_=a=Ze[i],i=Ye.apixels[++e],a=Yn(a=Ze[i],_),e++,r[t+it]=a,t++)}return e}function _l(e,t,n){var r=rt,i=0;if(Ht)for(;t<n;){var a=0,o=0,s=0,c=0;o=nt[e],s=je[o],a=Ye.apixels[e],e++,c=s,Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,t++}else if(Xt)for(var _=qt?he:me;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,c=s=Ze[_[a=o]],Fe[t+Te].data&&(i=jn(t,1,a,0))&&(c=Ze[i]),r[t+it]=c,t++}else if(Gt)for(;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,c=s=(a=o)<=31?Ze[o]:je[Xe.color_regs_ecs[o-32]>>>1&1911],Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,t++}else for(;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,c=s=Ze[a=o],Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,t++}return e}function fl(e,t,n){var r=rt,i=0;if(Ht)for(;t<n;){var a=0,o=0,s=0,c=0;o=nt[e],s=je[o],a=Ye.apixels[e],e++,c=s,Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,r[++t+it]=c,t++}else if(Xt)for(var _=qt?he:me;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,c=s=Ze[_[a=o]],Fe[t+Te].data&&(i=jn(t,1,a,0))&&(c=Ze[i]),r[t+it]=c,r[++t+it]=c,t++}else if(Gt)for(;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,c=s=(a=o)<=31?Ze[o]:je[Xe.color_regs_ecs[o-32]>>>1&1911],Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,r[++t+it]=c,t++}else for(;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,c=s=Ze[a=o],Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,r[++t+it]=c,t++}return e}function ll(e,t,n){var r=rt,i=0;if(Ht)for(;t<n;){var a=0,o=0,s=0,c=0;o=nt[e],s=je[o],a=Ye.apixels[e],e++,c=s,Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,r[++t+it]=c,r[++t+it]=c,r[++t+it]=c,t++}else if(Xt)for(var _=qt?he:me;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,c=s=Ze[_[a=o]],Fe[t+Te].data&&(i=jn(t,1,a,0))&&(c=Ze[i]),r[t+it]=c,r[++t+it]=c,r[++t+it]=c,r[++t+it]=c,t++}else if(Gt)for(;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,c=s=(a=o)<=31?Ze[o]:je[Xe.color_regs_ecs[o-32]>>>1&1911],Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,r[++t+it]=c,r[++t+it]=c,r[++t+it]=c,t++}else for(;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,c=s=Ze[a=o],Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,r[++t+it]=c,r[++t+it]=c,r[++t+it]=c,t++}return e}function ul(e,t,n){var r=rt,i=0;if(Ht)for(;t<n;){var a=0,o=0,s=0,c=0;o=nt[e],s=je[o],a=Ye.apixels[e],e+=2,c=s,Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,t++}else if(Xt)for(var _=qt?he:me;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e+=2,c=s=Ze[_[a=o]],Fe[t+Te].data&&(i=jn(t,1,a,0))&&(c=Ze[i]),r[t+it]=c,t++}else if(Gt)for(;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e+=2,c=s=(a=o)<=31?Ze[o]:je[Xe.color_regs_ecs[o-32]>>>1&1911],Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,t++}else for(;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e+=2,c=s=Ze[a=o],Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,t++}return e}function dl(e,t,n){var r=rt,i=0;if(Ht)for(;t<n;){var a=0,o=0,s=0,c=0;o=nt[e],s=je[o],a=Ye.apixels[e],f=s,o=nt[++e],s=je[o],a=Ye.apixels[e],e++,c=s=Yn(s,f),Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,t++}else if(Xt)for(var _=qt?he:me;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,f=s=Ze[_[a=o]],o=Ye.apixels[e],e++,c=s=Yn(s=Ze[_[a=o]],f),Fe[t+Te].data&&(i=jn(t,1,a,0))&&(c=Ze[i]),r[t+it]=c,t++}else if(Gt)for(;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,f=s=(a=o)<=31?Ze[o]:je[Xe.color_regs_ecs[o-32]>>>1&1911],s=Yn(s=(a=o=Ye.apixels[e])<=31?Ze[o]:je[Xe.color_regs_ecs[o-32]>>>1&1911],f),e++,c=s,Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,t++}else for(;t<n;){var f,a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,f=s=Ze[a=o],o=Ye.apixels[e],e++,c=s=Yn(s=Ze[a=o],f),Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,t++}return e}function pl(e,t,n){var r,i=rt;for(1;t<n;){var a=0;e++,a=Ze[0],Fe[t+Te].data&&(r=jn(t+0,0,0,1))&&(a=Ze[r]),i[t+it]=a,t++}return e}function El(e,t,n){var r=rt,i=0;for(1;t<n;){var a=0;e++;var o=a=Ze[0],a=a;Fe[t+Te].data&&(i=jn(t,0,0,1))&&(o=Ze[i]),Fe[t+Te+1].data&&(i=jn(t+1,0,0,1))&&(a=Ze[i]),r[t+it]=o,r[++t+it]=a,t++}return e}function Al(e,t,n){var r=rt,i=0;for(1;t<n;){var a=0;e++;var o=a=Ze[0],s=a,c=a,a=a;Fe[t+Te].data&&(i=jn(t,0,0,1))&&(o=Ze[i]),Fe[t+Te+1].data&&(i=jn(t+1,0,0,1))&&(s=Ze[i]),Fe[t+Te+2].data&&(i=jn(t+2,0,0,1))&&(c=Ze[i]),Fe[t+Te+3].data&&(i=jn(t+3,0,0,1))&&(a=Ze[i]),r[t+it]=o,r[++t+it]=s,r[++t+it]=c,r[++t+it]=a,t++}return e}function Sl(e,t,n){var r,i=rt;for(1;t<n;){var a=0;e++,a=Ze[0],Fe[t+Te].data&&(r=jn(t+0,0,0,1))&&(a=Ze[r]),i[t+it]=a,t++}return e}function ml(e,t,n){var r,i=rt;for(1;t<n;){var a=0;e++,a=Ze[0],Fe[t+Te].data&&(r=jn(t+0,0,0,1))&&(a=Ze[r]),i[t+it]=a,t++}return e}function hl(e,t,n){var r,i=rt;for(1;t<n;){var a=0;e++,a=Ze[0],Fe[t+Te].data&&(r=jn(t+0,0,0,1))&&(a=Ze[r]),i[t+it]=a,t++}return e}function gl(e,t,n){var r,i=rt;for(1;t<n;){var a=0;e++,a=Ze[0],Fe[t+Te].data&&(r=jn(t+0,0,0,1))&&(a=Ze[r]),i[t+it]=a,t++}return e}function yl(e,t,n){var r=rt,i=tn,a=nn;if(Ht){if(t+it&2&&(s=o=0,o=(Ye.apixels[e]^i)&a,s=M(o=nt[e]),e++,r[t+it]=s,t++),n<=t)return e;for((_=n+it&2)&&n--;t<n;){var o=0,s=0,c=0;o=(Ye.apixels[e]^i)&a,o=nt[e],e++,c=s=M(o),o=(Ye.apixels[e]^i)&a,s=M(o=nt[e]),e++,r[t+it]=(c=(c<<16|65535&s)>>>0)>>>16,r[t+it+1]=65535&c,t+=2}_&&(s=o=0,o=(Ye.apixels[e]^i)&a,s=M(o=nt[e]),e++,r[t+it]=s,t++)}else if(Xt){var _,f=qt?be:ve,l=qt?ye:ge;if(t+it&2&&(s=o=0,u=f[o=Ye.apixels[e]],l[o]&&(u+=pe[Zt]),s=Ze[u^=i],e++,r[t+it]=s,t++),n<=t)return e;for((_=n+it&2)&&n--;t<n;){var o=0,s=0,c=0,u=f[o=Ye.apixels[e]];l[o]&&(u+=pe[Zt]),e++,c=s=Ze[u^=i];var u=f[o=Ye.apixels[e]];l[o]&&(u+=pe[Zt]),s=Ze[u^=i],e++,r[t+it]=(c=(c<<16|65535&s)>>>0)>>>16,r[t+it+1]=65535&c,t+=2}_&&(s=o=0,u=f[o=Ye.apixels[e]],l[o]&&(u+=pe[Zt]),s=Ze[u^=i],e++,r[t+it]=s,t++)}else if(Gt){if(t+it&2&&(s=o=0,s=32<=(o=(Ye.apixels[e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],e++,r[t+it]=s,t++),n<=t)return e;for((_=n+it&2)&&n--;t<n;){var o=0,s=0,c=0;o=(Ye.apixels[e]^i)&a,e++,c=s=32<=o&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],s=32<=(o=(Ye.apixels[e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],e++,r[t+it]=(c=(c<<16|65535&s)>>>0)>>>16,r[t+it+1]=65535&c,t+=2}_&&(s=o=0,s=32<=(o=(Ye.apixels[e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],e++,r[t+it]=s,t++)}else{if(t+it&2&&(s=o=0,o=(Ye.apixels[e]^i)&a,s=Ze[o],e++,r[t+it]=s,t++),n<=t)return e;for((_=n+it&2)&&n--;t<n;){o=0,s=0,c=0;o=(Ye.apixels[e]^i)&a,e++,c=s=Ze[o],o=(Ye.apixels[e]^i)&a,s=Ze[o],e++,r[t+it]=(c=(c<<16|65535&s)>>>0)>>>16,r[t+it+1]=65535&c,t+=2}_&&(s=o=0,o=(Ye.apixels[e]^i)&a,s=Ze[o],e++,r[t+it]=s,t++)}return e}function vl(e,t,n){var r=rt,i=tn,a=nn;if(Ht)for(;t<n;){var o=0,s=0;o=(Ye.apixels[e]^i)&a,o=nt[e],e++,s=M(o),r[t+it]=s>>>16,r[t+it+1]=65535&s,t+=2}else if(Xt)for(var c=qt?be:ve,_=qt?ye:ge;t<n;){var o=0,s=0,f=c[o=Ye.apixels[e]];_[o]&&(f+=pe[Zt]),e++,s=Ze[f^=i],r[t+it]=s>>>16,r[t+it+1]=65535&s,t+=2}else if(Gt)for(;t<n;){o=0,s=0;o=(Ye.apixels[e]^i)&a,e++,s=32<=o&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],r[t+it]=s>>>16,r[t+it+1]=65535&s,t+=2}else for(;t<n;){o=0,s=0;o=(Ye.apixels[e]^i)&a,e++,s=Ze[o],r[t+it]=s>>>16,r[t+it+1]=65535&s,t+=2}return e}function bl(e,t,n){var r=rt,i=tn,a=nn;if(Ht)for(;t<n;){var o=0,s=0;o=(Ye.apixels[e]^i)&a,o=nt[e],e++,s=M(o),r[t+it]=s>>>16,r[t+it+1]=65535&s,r[(t+=2)+it]=s>>>16,r[t+it+1]=65535&s,t+=2}else if(Xt)for(var c=qt?be:ve,_=qt?ye:ge;t<n;){var o=0,s=0,f=c[o=Ye.apixels[e]];_[o]&&(f+=pe[Zt]),e++,s=Ze[f^=i],r[t+it]=s>>>16,r[t+it+1]=65535&s,r[(t+=2)+it]=s>>>16,r[t+it+1]=65535&s,t+=2}else if(Gt)for(;t<n;){o=0,s=0;o=(Ye.apixels[e]^i)&a,e++,s=32<=o&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],r[t+it]=s>>>16,r[t+it+1]=65535&s,r[(t+=2)+it]=s>>>16,r[t+it+1]=65535&s,t+=2}else for(;t<n;){o=0,s=0;o=(Ye.apixels[e]^i)&a,e++,s=Ze[o],r[t+it]=s>>>16,r[t+it+1]=65535&s,r[(t+=2)+it]=s>>>16,r[t+it+1]=65535&s,t+=2}return e}function Cl(e,t,n){var r=rt,i=tn,a=nn;if(Ht){if(t+it&2&&(s=o=0,o=(Ye.apixels[e]^i)&a,s=M(o=nt[e]),e+=2,r[t+it]=s,t++),n<=t)return e;for((_=n+it&2)&&n--;t<n;){var o=0,s=0,c=0;o=(Ye.apixels[e]^i)&a,o=nt[e],e+=2,c=s=M(o),o=(Ye.apixels[e]^i)&a,s=M(o=nt[e]),e+=2,r[t+it]=(c=(c<<16|65535&s)>>>0)>>>16,r[t+it+1]=65535&c,t+=2}_&&(s=o=0,o=(Ye.apixels[e]^i)&a,s=M(o=nt[e]),e+=2,r[t+it]=s,t++)}else if(Xt){var _,f=qt?be:ve,l=qt?ye:ge;if(t+it&2&&(s=o=0,u=f[o=Ye.apixels[e]],l[o]&&(u+=pe[Zt]),s=Ze[u^=i],e+=2,r[t+it]=s,t++),n<=t)return e;for((_=n+it&2)&&n--;t<n;){var o=0,s=0,c=0,u=f[o=Ye.apixels[e]];l[o]&&(u+=pe[Zt]),e+=2,c=s=Ze[u^=i];var u=f[o=Ye.apixels[e]];l[o]&&(u+=pe[Zt]),s=Ze[u^=i],e+=2,r[t+it]=(c=(c<<16|65535&s)>>>0)>>>16,r[t+it+1]=65535&c,t+=2}_&&(s=o=0,u=f[o=Ye.apixels[e]],l[o]&&(u+=pe[Zt]),s=Ze[u^=i],e+=2,r[t+it]=s,t++)}else if(Gt){if(t+it&2&&(s=o=0,s=32<=(o=(Ye.apixels[e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],e+=2,r[t+it]=s,t++),n<=t)return e;for((_=n+it&2)&&n--;t<n;){var o=0,s=0,c=0;o=(Ye.apixels[e]^i)&a,e+=2,c=s=32<=o&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],s=32<=(o=(Ye.apixels[e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],e+=2,r[t+it]=(c=(c<<16|65535&s)>>>0)>>>16,r[t+it+1]=65535&c,t+=2}_&&(s=o=0,s=32<=(o=(Ye.apixels[e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],e+=2,r[t+it]=s,t++)}else{if(t+it&2&&(s=o=0,o=(Ye.apixels[e]^i)&a,s=Ze[o],e+=2,r[t+it]=s,t++),n<=t)return e;for((_=n+it&2)&&n--;t<n;){o=0,s=0,c=0;o=(Ye.apixels[e]^i)&a,e+=2,c=s=Ze[o],o=(Ye.apixels[e]^i)&a,s=Ze[o],e+=2,r[t+it]=(c=(c<<16|65535&s)>>>0)>>>16,r[t+it+1]=65535&c,t+=2}_&&(s=o=0,o=(Ye.apixels[e]^i)&a,s=Ze[o],e+=2,r[t+it]=s,t++)}return e}function kl(e,t,n){var r=rt,i=tn,a=nn;if(Ht){if(t+it&2&&(s=o=0,o=(Ye.apixels[e]^i)&a,d=s=M(o=nt[e]),o=(Ye.apixels[++e]^i)&a,s=Yn(s=M(o=nt[e]),d),e++,r[t+it]=s,t++),n<=t)return e;for((_=n+it&2)&&n--;t<n;){var o=0,s=0,c=0;o=(Ye.apixels[e]^i)&a,o=nt[e],e++,d=s=M(o),o=(Ye.apixels[e]^i)&a,s=Yn(s=M(o=nt[e]),d),e++,c=s,o=(Ye.apixels[e]^i)&a,o=nt[e],e++,d=s=M(o),o=(Ye.apixels[e]^i)&a,s=Yn(s=M(o=nt[e]),d),e++,r[t+it]=(c=(c<<16|65535&s)>>>0)>>>16,r[t+it+1]=65535&c,t+=2}_&&(s=o=0,o=(Ye.apixels[e]^i)&a,d=s=M(o=nt[e]),o=(Ye.apixels[++e]^i)&a,s=Yn(s=M(o=nt[e]),d),e++,r[t+it]=s,t++)}else if(Xt){var _,f=qt?be:ve,l=qt?ye:ge;if(t+it&2&&(s=o=0,u=f[o=Ye.apixels[e]],l[o]&&(u+=pe[Zt]),d=s=Ze[u^=i],u=f[o=Ye.apixels[++e]],l[o]&&(u+=pe[Zt]),s=Yn(s=Ze[u^=i],d),e++,r[t+it]=s,t++),n<=t)return e;for((_=n+it&2)&&n--;t<n;){var o=0,s=0,c=0,u=f[o=Ye.apixels[e]];l[o]&&(u+=pe[Zt]),e++,d=s=Ze[u^=i];var u=f[o=Ye.apixels[e]];l[o]&&(u+=pe[Zt]),e++,c=s=Yn(s=Ze[u^=i],d);var u=f[o=Ye.apixels[e]];l[o]&&(u+=pe[Zt]),e++,d=s=Ze[u^=i];u=f[o=Ye.apixels[e]];l[o]&&(u+=pe[Zt]),s=Yn(s=Ze[u^=i],d),e++,r[t+it]=(c=(c<<16|65535&s)>>>0)>>>16,r[t+it+1]=65535&c,t+=2}_&&(s=o=0,u=f[o=Ye.apixels[e]],l[o]&&(u+=pe[Zt]),d=s=Ze[u^=i],u=f[o=Ye.apixels[++e]],l[o]&&(u+=pe[Zt]),s=Yn(s=Ze[u^=i],d),e++,r[t+it]=s,t++)}else if(Gt){if(t+it&2&&(s=o=0,d=s=32<=(o=(Ye.apixels[e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],s=Yn(s=32<=(o=(Ye.apixels[++e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],d),e++,r[t+it]=s,t++),n<=t)return e;for((_=n+it&2)&&n--;t<n;){var o=0,s=0,c=0;o=(Ye.apixels[e]^i)&a,e++,d=s=32<=o&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],s=Yn(s=32<=(o=(Ye.apixels[e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],d),e++,c=s,o=(Ye.apixels[e]^i)&a,e++,d=s=32<=o&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],s=Yn(s=32<=(o=(Ye.apixels[e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],d),e++,r[t+it]=(c=(c<<16|65535&s)>>>0)>>>16,r[t+it+1]=65535&c,t+=2}_&&(s=o=0,d=s=32<=(o=(Ye.apixels[e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],s=Yn(s=32<=(o=(Ye.apixels[++e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],d),e++,r[t+it]=s,t++)}else{if(t+it&2&&(s=o=0,o=(Ye.apixels[e]^i)&a,d=s=Ze[o],o=(Ye.apixels[++e]^i)&a,s=Yn(s=Ze[o],d),e++,r[t+it]=s,t++),n<=t)return e;for((_=n+it&2)&&n--;t<n;){var d,o=0,s=0,c=0;o=(Ye.apixels[e]^i)&a,e++,d=s=Ze[o],o=(Ye.apixels[e]^i)&a,e++,c=s=Yn(s=Ze[o],d),o=(Ye.apixels[e]^i)&a,e++,d=s=Ze[o],o=(Ye.apixels[e]^i)&a,s=Yn(s=Ze[o],d),e++,r[t+it]=(c=(c<<16|65535&s)>>>0)>>>16,r[t+it+1]=65535&c,t+=2}_&&(s=o=0,o=(Ye.apixels[e]^i)&a,d=s=Ze[o],o=(Ye.apixels[++e]^i)&a,s=Yn(s=Ze[o],d),e++,r[t+it]=s,t++)}return e}function Rl(e,t,n){var r=rt,i=tn,a=nn;if(Ht){if(t+it&2&&(s=o=0,o=(Ye.apixels[e]^i)&a,s=M(o=nt[e]),e+=4,r[t+it]=s,t++),n<=t)return e;for((_=n+it&2)&&n--;t<n;){var o=0,s=0,c=0;o=(Ye.apixels[e]^i)&a,o=nt[e],e+=4,c=s=M(o),o=(Ye.apixels[e]^i)&a,s=M(o=nt[e]),e+=4,r[t+it]=(c=(c<<16|65535&s)>>>0)>>>16,r[t+it+1]=65535&c,t+=2}_&&(s=o=0,o=(Ye.apixels[e]^i)&a,s=M(o=nt[e]),e+=4,r[t+it]=s,t++)}else if(Xt){var _,f=qt?be:ve,l=qt?ye:ge;if(t+it&2&&(s=o=0,u=f[o=Ye.apixels[e]],l[o]&&(u+=pe[Zt]),s=Ze[u^=i],e+=4,r[t+it]=s,t++),n<=t)return e;for((_=n+it&2)&&n--;t<n;){var o=0,s=0,c=0,u=f[o=Ye.apixels[e]];l[o]&&(u+=pe[Zt]),e+=4,c=s=Ze[u^=i];var u=f[o=Ye.apixels[e]];l[o]&&(u+=pe[Zt]),s=Ze[u^=i],e+=4,r[t+it]=(c=(c<<16|65535&s)>>>0)>>>16,r[t+it+1]=65535&c,t+=2}_&&(s=o=0,u=f[o=Ye.apixels[e]],l[o]&&(u+=pe[Zt]),s=Ze[u^=i],e+=4,r[t+it]=s,t++)}else if(Gt){if(t+it&2&&(s=o=0,s=32<=(o=(Ye.apixels[e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],e+=4,r[t+it]=s,t++),n<=t)return e;for((_=n+it&2)&&n--;t<n;){var o=0,s=0,c=0;o=(Ye.apixels[e]^i)&a,e+=4,c=s=32<=o&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],s=32<=(o=(Ye.apixels[e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],e+=4,r[t+it]=(c=(c<<16|65535&s)>>>0)>>>16,r[t+it+1]=65535&c,t+=2}_&&(s=o=0,s=32<=(o=(Ye.apixels[e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],e+=4,r[t+it]=s,t++)}else{if(t+it&2&&(s=o=0,o=(Ye.apixels[e]^i)&a,s=Ze[o],e+=4,r[t+it]=s,t++),n<=t)return e;for((_=n+it&2)&&n--;t<n;){o=0,s=0,c=0;o=(Ye.apixels[e]^i)&a,e+=4,c=s=Ze[o],o=(Ye.apixels[e]^i)&a,s=Ze[o],e+=4,r[t+it]=(c=(c<<16|65535&s)>>>0)>>>16,r[t+it+1]=65535&c,t+=2}_&&(s=o=0,o=(Ye.apixels[e]^i)&a,s=Ze[o],e+=4,r[t+it]=s,t++)}return e}function wl(e,t,n){var r=rt,i=tn,a=nn;if(Ht){if(t+it&2&&(s=o=0,o=(Ye.apixels[e]^i)&a,d=s=M(o=nt[e]),o=(Ye.apixels[++e]^i)&a,p=s=M(o=nt[e]),o=(Ye.apixels[++e]^i)&a,E=s=M(o=nt[e]),o=(Ye.apixels[++e]^i)&a,s=M(o=nt[e]),d=Yn(d,p),p=Yn(E,s),s=Yn(d,p),e++,r[t+it]=s,t++),n<=t)return e;for((_=n+it&2)&&n--;t<n;){var o=0,s=0,c=0;o=(Ye.apixels[e]^i)&a,o=nt[e],e++,d=s=M(o),o=(Ye.apixels[e]^i)&a,o=nt[e],e++,p=s=M(o),o=(Ye.apixels[e]^i)&a,o=nt[e],e++,E=s=M(o),o=(Ye.apixels[e]^i)&a,s=M(o=nt[e]),d=Yn(d,p),p=Yn(E,s),e++,c=s=Yn(d,p),o=(Ye.apixels[e]^i)&a,o=nt[e],e++,d=s=M(o),o=(Ye.apixels[e]^i)&a,o=nt[e],e++,p=s=M(o),o=(Ye.apixels[e]^i)&a,o=nt[e],e++,E=s=M(o),o=(Ye.apixels[e]^i)&a,s=M(o=nt[e]),d=Yn(d,p),p=Yn(E,s),s=Yn(d,p),e++,r[t+it]=(c=(c<<16|65535&s)>>>0)>>>16,r[t+it+1]=65535&c,t+=2}_&&(s=o=0,o=(Ye.apixels[e]^i)&a,d=s=M(o=nt[e]),o=(Ye.apixels[++e]^i)&a,p=s=M(o=nt[e]),o=(Ye.apixels[++e]^i)&a,E=s=M(o=nt[e]),o=(Ye.apixels[++e]^i)&a,s=M(o=nt[e]),d=Yn(d,p),p=Yn(E,s),s=Yn(d,p),e++,r[t+it]=s,t++)}else if(Xt){var _,f=qt?be:ve,l=qt?ye:ge;if(t+it&2&&(s=o=0,u=f[o=Ye.apixels[e]],l[o]&&(u+=pe[Zt]),d=s=Ze[u^=i],u=f[o=Ye.apixels[++e]],l[o]&&(u+=pe[Zt]),p=s=Ze[u^=i],u=f[o=Ye.apixels[++e]],l[o]&&(u+=pe[Zt]),E=s=Ze[u^=i],u=f[o=Ye.apixels[++e]],l[o]&&(u+=pe[Zt]),s=Ze[u^=i],d=Yn(d,p),p=Yn(E,s),s=Yn(d,p),e++,r[t+it]=s,t++),n<=t)return e;for((_=n+it&2)&&n--;t<n;){var o=0,s=0,c=0,u=f[o=Ye.apixels[e]];l[o]&&(u+=pe[Zt]),e++,d=s=Ze[u^=i];var u=f[o=Ye.apixels[e]];l[o]&&(u+=pe[Zt]),e++,p=s=Ze[u^=i];var u=f[o=Ye.apixels[e]];l[o]&&(u+=pe[Zt]),e++,E=s=Ze[u^=i];var u=f[o=Ye.apixels[e]];l[o]&&(u+=pe[Zt]),s=Ze[u^=i],d=Yn(d,p),p=Yn(E,s),e++,c=s=Yn(d,p);var u=f[o=Ye.apixels[e]];l[o]&&(u+=pe[Zt]),e++,d=s=Ze[u^=i];u=f[o=Ye.apixels[e]];l[o]&&(u+=pe[Zt]),e++,p=s=Ze[u^=i];u=f[o=Ye.apixels[e]];l[o]&&(u+=pe[Zt]),e++,E=s=Ze[u^=i];u=f[o=Ye.apixels[e]];l[o]&&(u+=pe[Zt]),s=Ze[u^=i],d=Yn(d,p),p=Yn(E,s),s=Yn(d,p),e++,r[t+it]=(c=(c<<16|65535&s)>>>0)>>>16,r[t+it+1]=65535&c,t+=2}_&&(s=o=0,u=f[o=Ye.apixels[e]],l[o]&&(u+=pe[Zt]),d=s=Ze[u^=i],u=f[o=Ye.apixels[++e]],l[o]&&(u+=pe[Zt]),p=s=Ze[u^=i],u=f[o=Ye.apixels[++e]],l[o]&&(u+=pe[Zt]),E=s=Ze[u^=i],u=f[o=Ye.apixels[++e]],l[o]&&(u+=pe[Zt]),s=Ze[u^=i],d=Yn(d,p),p=Yn(E,s),s=Yn(d,p),e++,r[t+it]=s,t++)}else if(Gt){if(t+it&2&&(s=o=0,d=s=32<=(o=(Ye.apixels[e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],p=s=32<=(o=(Ye.apixels[++e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],E=s=32<=(o=(Ye.apixels[++e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],s=32<=(o=(Ye.apixels[++e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],d=Yn(d,p),p=Yn(E,s),s=Yn(d,p),e++,r[t+it]=s,t++),n<=t)return e;for((_=n+it&2)&&n--;t<n;){var o=0,s=0,c=0;o=(Ye.apixels[e]^i)&a,e++,d=s=32<=o&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],o=(Ye.apixels[e]^i)&a,e++,p=s=32<=o&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],o=(Ye.apixels[e]^i)&a,e++,E=s=32<=o&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],s=32<=(o=(Ye.apixels[e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],d=Yn(d,p),p=Yn(E,s),e++,c=s=Yn(d,p),o=(Ye.apixels[e]^i)&a,e++,d=s=32<=o&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],o=(Ye.apixels[e]^i)&a,e++,p=s=32<=o&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],o=(Ye.apixels[e]^i)&a,e++,E=s=32<=o&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],s=32<=(o=(Ye.apixels[e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],d=Yn(d,p),p=Yn(E,s),s=Yn(d,p),e++,r[t+it]=(c=(c<<16|65535&s)>>>0)>>>16,r[t+it+1]=65535&c,t+=2}_&&(s=o=0,d=s=32<=(o=(Ye.apixels[e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],p=s=32<=(o=(Ye.apixels[++e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],E=s=32<=(o=(Ye.apixels[++e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],s=32<=(o=(Ye.apixels[++e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],d=Yn(d,p),p=Yn(E,s),s=Yn(d,p),e++,r[t+it]=s,t++)}else{if(t+it&2&&(s=o=0,o=(Ye.apixels[e]^i)&a,d=s=Ze[o],o=(Ye.apixels[++e]^i)&a,p=s=Ze[o],o=(Ye.apixels[++e]^i)&a,E=s=Ze[o],o=(Ye.apixels[++e]^i)&a,s=Ze[o],d=Yn(d,p),p=Yn(E,s),s=Yn(d,p),e++,r[t+it]=s,t++),n<=t)return e;for((_=n+it&2)&&n--;t<n;){var d,p,E,o=0,s=0,c=0;o=(Ye.apixels[e]^i)&a,e++,d=s=Ze[o],o=(Ye.apixels[e]^i)&a,e++,p=s=Ze[o],o=(Ye.apixels[e]^i)&a,e++,E=s=Ze[o],o=(Ye.apixels[e]^i)&a,s=Ze[o],d=Yn(d,p),p=Yn(E,s),e++,c=s=Yn(d,p),o=(Ye.apixels[e]^i)&a,e++,d=s=Ze[o],o=(Ye.apixels[e]^i)&a,e++,p=s=Ze[o],o=(Ye.apixels[e]^i)&a,e++,E=s=Ze[o],o=(Ye.apixels[e]^i)&a,s=Ze[o],d=Yn(d,p),p=Yn(E,s),s=Yn(d,p),e++,r[t+it]=(c=(c<<16|65535&s)>>>0)>>>16,r[t+it+1]=65535&c,t+=2}_&&(s=o=0,o=(Ye.apixels[e]^i)&a,d=s=Ze[o],o=(Ye.apixels[++e]^i)&a,p=s=Ze[o],o=(Ye.apixels[++e]^i)&a,E=s=Ze[o],o=(Ye.apixels[++e]^i)&a,s=Ze[o],d=Yn(d,p),p=Yn(E,s),s=Yn(d,p),e++,r[t+it]=s,t++)}return e}function xl(e,t,n){var r=rt,i=0,a=tn,o=nn;if(Ht)for(;t<n;){var s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,c=nt[e],e++,_=M(c),Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(_=Ze[i]),r[t+it]=_,t++}else if(Xt)for(var f=qt?be:ve,l=qt?ye:ge;t<n;){var s=0,c=0,_=0,u=f[s=c=Ye.apixels[e]];l[c]&&(u+=pe[Zt]),e++,_=Ze[u^=a],Fe[t+Te].data&&(i=jn(t+0,1,s,1))&&(_=Ze[i]),r[t+it]=_,t++}else if(Gt)for(;t<n;){s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++,_=32<=c&&c<64?M(Xe.color_regs_aga[c-32]>>>1&8355711):Ze[c],Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(_=Ze[i]),r[t+it]=_,t++}else for(;t<n;){s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++,_=Ze[c],Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(_=Ze[i]),r[t+it]=_,t++}return e}function Dl(e,t,n){var r=rt,i=0,a=tn,o=nn;if(Ht)for(;t<n;){var s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,c=nt[e],e++;var f=_=M(c),l=_;Fe[t+Te].data&&(i=jn(t,0,s,1))&&(f=Ze[i]),Fe[t+Te+1].data&&(i=jn(t+1,0,s,1))&&(l=Ze[i]),r[t+it]=f,r[++t+it]=l,t++}else if(Xt)for(var u=qt?be:ve,d=qt?ye:ge;t<n;){var s=0,c=0,_=0,p=u[s=c=Ye.apixels[e]];d[c]&&(p+=pe[Zt]),e++;f=_=Ze[p^=a],l=_;Fe[t+Te].data&&(i=jn(t,1,s,1))&&(f=Ze[i]),Fe[t+Te+1].data&&(i=jn(t+1,1,s,1))&&(l=Ze[i]),r[t+it]=f,r[++t+it]=l,t++}else if(Gt)for(;t<n;){s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++;f=_=32<=c&&c<64?M(Xe.color_regs_aga[c-32]>>>1&8355711):Ze[c],l=_;Fe[t+Te].data&&(i=jn(t,0,s,1))&&(f=Ze[i]),Fe[t+Te+1].data&&(i=jn(t+1,0,s,1))&&(l=Ze[i]),r[t+it]=f,r[++t+it]=l,t++}else for(;t<n;){s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++;f=_=Ze[c],l=_;Fe[t+Te].data&&(i=jn(t,0,s,1))&&(f=Ze[i]),Fe[t+Te+1].data&&(i=jn(t+1,0,s,1))&&(l=Ze[i]),r[t+it]=f,r[++t+it]=l,t++}return e}function Ml(e,t,n){var r=rt,i=0,a=tn,o=nn;if(Ht)for(;t<n;){var s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,c=nt[e],e++;var f=_=M(c),l=_,u=_,d=_;Fe[t+Te].data&&(i=jn(t,0,s,1))&&(f=Ze[i]),Fe[t+Te+1].data&&(i=jn(t+1,0,s,1))&&(l=Ze[i]),Fe[t+Te+2].data&&(i=jn(t+2,0,s,1))&&(u=Ze[i]),Fe[t+Te+3].data&&(i=jn(t+3,0,s,1))&&(d=Ze[i]),r[t+it]=f,r[++t+it]=l,r[++t+it]=u,r[++t+it]=d,t++}else if(Xt)for(var p=qt?be:ve,E=qt?ye:ge;t<n;){var s=0,c=0,_=0,A=p[s=c=Ye.apixels[e]];E[c]&&(A+=pe[Zt]),e++;f=_=Ze[A^=a],l=_,u=_,d=_;Fe[t+Te].data&&(i=jn(t,1,s,1))&&(f=Ze[i]),Fe[t+Te+1].data&&(i=jn(t+1,1,s,1))&&(l=Ze[i]),Fe[t+Te+2].data&&(i=jn(t+2,1,s,1))&&(u=Ze[i]),Fe[t+Te+3].data&&(i=jn(t+3,1,s,1))&&(d=Ze[i]),r[t+it]=f,r[++t+it]=l,r[++t+it]=u,r[++t+it]=d,t++}else if(Gt)for(;t<n;){s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++;f=_=32<=c&&c<64?M(Xe.color_regs_aga[c-32]>>>1&8355711):Ze[c],l=_,u=_,d=_;Fe[t+Te].data&&(i=jn(t,0,s,1))&&(f=Ze[i]),Fe[t+Te+1].data&&(i=jn(t+1,0,s,1))&&(l=Ze[i]),Fe[t+Te+2].data&&(i=jn(t+2,0,s,1))&&(u=Ze[i]),Fe[t+Te+3].data&&(i=jn(t+3,0,s,1))&&(d=Ze[i]),r[t+it]=f,r[++t+it]=l,r[++t+it]=u,r[++t+it]=d,t++}else for(;t<n;){s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++;f=_=Ze[c],l=_,u=_,d=_;Fe[t+Te].data&&(i=jn(t,0,s,1))&&(f=Ze[i]),Fe[t+Te+1].data&&(i=jn(t+1,0,s,1))&&(l=Ze[i]),Fe[t+Te+2].data&&(i=jn(t+2,0,s,1))&&(u=Ze[i]),Fe[t+Te+3].data&&(i=jn(t+3,0,s,1))&&(d=Ze[i]),r[t+it]=f,r[++t+it]=l,r[++t+it]=u,r[++t+it]=d,t++}return e}function Fl(e,t,n){var r=rt,i=0,a=tn,o=nn;if(Ht)for(;t<n;){var s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,c=nt[e],e+=2,_=M(c),Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(_=Ze[i]),r[t+it]=_,t++}else if(Xt)for(var f=qt?be:ve,l=qt?ye:ge;t<n;){var s=0,c=0,_=0,u=f[s=c=Ye.apixels[e]];l[c]&&(u+=pe[Zt]),e+=2,_=Ze[u^=a],Fe[t+Te].data&&(i=jn(t+0,1,s,1))&&(_=Ze[i]),r[t+it]=_,t++}else if(Gt)for(;t<n;){s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e+=2,_=32<=c&&c<64?M(Xe.color_regs_aga[c-32]>>>1&8355711):Ze[c],Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(_=Ze[i]),r[t+it]=_,t++}else for(;t<n;){s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e+=2,_=Ze[c],Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(_=Ze[i]),r[t+it]=_,t++}return e}function Tl(e,t,n){var r=rt,i=0,a=tn,o=nn;if(Ht)for(;t<n;){var s=0,c=0,_=0,f=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,c=nt[e],e++,p=_=M(c),s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,_=Yn(_=M(c=nt[e]),p),e++,f=_,Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(f=Ze[i]),r[t+it]=f,t++}else if(Xt)for(var l=qt?be:ve,u=qt?ye:ge;t<n;){var s=0,c=0,_=0,f=0,d=l[s=c=Ye.apixels[e]];u[c]&&(d+=pe[Zt]),e++,p=_=Ze[d^=a];d=l[s=c=Ye.apixels[e]];u[c]&&(d+=pe[Zt]),e++,f=_=Yn(_=Ze[d^=a],p),Fe[t+Te].data&&(i=jn(t+0,1,s,1))&&(f=Ze[i]),r[t+it]=f,t++}else if(Gt)for(;t<n;){s=0,c=0,_=0,f=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++,p=_=32<=c&&c<64?M(Xe.color_regs_aga[c-32]>>>1&8355711):Ze[c],s=Ye.apixels[e],_=Yn(_=32<=(c=(Ye.apixels[e]^a)&o)&&c<64?M(Xe.color_regs_aga[c-32]>>>1&8355711):Ze[c],p),e++,f=_,Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(f=Ze[i]),r[t+it]=f,t++}else for(;t<n;){var p,s=0,c=0,_=0,f=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++,p=_=Ze[c],s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++,f=_=Yn(_=Ze[c],p),Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(f=Ze[i]),r[t+it]=f,t++}return e}function Vl(e,t,n){var r=rt,i=0,a=tn,o=nn;if(Ht)for(;t<n;){var s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,c=nt[e],e+=4,_=M(c),Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(_=Ze[i]),r[t+it]=_,t++}else if(Xt)for(var f=qt?be:ve,l=qt?ye:ge;t<n;){var s=0,c=0,_=0,u=f[s=c=Ye.apixels[e]];l[c]&&(u+=pe[Zt]),e+=4,_=Ze[u^=a],Fe[t+Te].data&&(i=jn(t+0,1,s,1))&&(_=Ze[i]),r[t+it]=_,t++}else if(Gt)for(;t<n;){s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e+=4,_=32<=c&&c<64?M(Xe.color_regs_aga[c-32]>>>1&8355711):Ze[c],Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(_=Ze[i]),r[t+it]=_,t++}else for(;t<n;){s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e+=4,_=Ze[c],Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(_=Ze[i]),r[t+it]=_,t++}return e}function Il(e,t,n){var r=rt,i=0,a=tn,o=nn;if(Ht)for(;t<n;){var s=0,c=0,_=0,f=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,c=nt[e],e++,p=_=M(c),s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,c=nt[e],e++,E=_=M(c),s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,c=nt[e],e++,A=_=M(c),s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,_=M(c=nt[e]),p=Yn(p,E),E=Yn(A,_),e++,f=_=Yn(p,E),Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(f=Ze[i]),r[t+it]=f,t++}else if(Xt)for(var l=qt?be:ve,u=qt?ye:ge;t<n;){var s=0,c=0,_=0,f=0,d=l[s=c=Ye.apixels[e]];u[c]&&(d+=pe[Zt]),e++,p=_=Ze[d^=a];d=l[s=c=Ye.apixels[e]];u[c]&&(d+=pe[Zt]),e++,E=_=Ze[d^=a];d=l[s=c=Ye.apixels[e]];u[c]&&(d+=pe[Zt]),e++,A=_=Ze[d^=a];d=l[s=c=Ye.apixels[e]];u[c]&&(d+=pe[Zt]),_=Ze[d^=a],p=Yn(p,E),E=Yn(A,_),e++,f=_=Yn(p,E),Fe[t+Te].data&&(i=jn(t+0,1,s,1))&&(f=Ze[i]),r[t+it]=f,t++}else if(Gt)for(;t<n;){s=0,c=0,_=0,f=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++,p=_=32<=c&&c<64?M(Xe.color_regs_aga[c-32]>>>1&8355711):Ze[c],s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++,E=_=32<=c&&c<64?M(Xe.color_regs_aga[c-32]>>>1&8355711):Ze[c],s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++,A=_=32<=c&&c<64?M(Xe.color_regs_aga[c-32]>>>1&8355711):Ze[c],s=Ye.apixels[e],_=32<=(c=(Ye.apixels[e]^a)&o)&&c<64?M(Xe.color_regs_aga[c-32]>>>1&8355711):Ze[c],p=Yn(p,E),E=Yn(A,_),e++,f=_=Yn(p,E),Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(f=Ze[i]),r[t+it]=f,t++}else for(;t<n;){var p,E,A,s=0,c=0,_=0,f=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++,p=_=Ze[c],s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++,E=_=Ze[c],s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++,A=_=Ze[c],s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,_=Ze[c],p=Yn(p,E),E=Yn(A,_),e++,f=_=Yn(p,E),Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(f=Ze[i]),r[t+it]=f,t++}return e}function Pl(e,t,n){var r=rt;if(Ht)for(;t<n;){var i=0,a=0;i=nt[e],e++,a=je[i],r[t+it]=a,t++}else if(Xt)for(var o=qt?he:me;t<n;){i=0,a=0;i=Ye.apixels[e],e++,a=Ze[o[i]],r[t+it]=a,t++}else if(Gt)for(;t<n;){i=0,a=0;i=Ye.apixels[e],e++,a=i<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],r[t+it]=a,t++}else for(;t<n;){i=0,a=0;i=Ye.apixels[e],e++,a=Ze[i],r[t+it]=a,t++}return e}function zl(e,t,n){var r=rt;if(Ht)for(;t<n;){var i=0,a=0;i=nt[e],e++,a=je[i],r[t+it]=a,r[++t+it]=a,t++}else if(Xt)for(var o=qt?he:me;t<n;){i=0,a=0;i=Ye.apixels[e],e++,a=Ze[o[i]],r[t+it]=a,r[++t+it]=a,t++}else if(Gt)for(;t<n;){i=0,a=0;i=Ye.apixels[e],e++,a=i<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],r[t+it]=a,r[++t+it]=a,t++}else for(;t<n;){i=0,a=0;i=Ye.apixels[e],e++,a=Ze[i],r[t+it]=a,r[++t+it]=a,t++}return e}function Ol(e,t,n){var r=rt;if(Ht)for(;t<n;){var i=0,a=0;i=nt[e],e++,a=je[i],r[t+it]=a,r[++t+it]=a,r[++t+it]=a,r[++t+it]=a,t++}else if(Xt)for(var o=qt?he:me;t<n;){i=0,a=0;i=Ye.apixels[e],e++,a=Ze[o[i]],r[t+it]=a,r[++t+it]=a,r[++t+it]=a,r[++t+it]=a,t++}else if(Gt)for(;t<n;){i=0,a=0;i=Ye.apixels[e],e++,a=i<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],r[t+it]=a,r[++t+it]=a,r[++t+it]=a,r[++t+it]=a,t++}else for(;t<n;){i=0,a=0;i=Ye.apixels[e],e++,a=Ze[i],r[t+it]=a,r[++t+it]=a,r[++t+it]=a,r[++t+it]=a,t++}return e}function Ll(e,t,n){var r=rt;if(Ht)for(;t<n;){var i=0,a=0;i=nt[e],e+=2,a=je[i],r[t+it]=a,t++}else if(Xt)for(var o=qt?he:me;t<n;){i=0,a=0;i=Ye.apixels[e],e+=2,a=Ze[o[i]],r[t+it]=a,t++}else if(Gt)for(;t<n;){i=0,a=0;i=Ye.apixels[e],e+=2,a=i<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],r[t+it]=a,t++}else for(;t<n;){i=0,a=0;i=Ye.apixels[e],e+=2,a=Ze[i],r[t+it]=a,t++}return e}function Nl(e,t,n){var r=rt;if(Ht)for(;t<n;){var i=0,a=0,o=0;i=nt[e],c=a=je[i],i=nt[++e],e++,o=a=Wn(a=je[i],c),r[t+it]=o,t++}else if(Xt)for(var s=qt?he:me;t<n;){i=0,a=0,o=0;i=Ye.apixels[e],e++,c=a=Ze[s[i]],i=Ye.apixels[e],e++,o=a=Wn(a=Ze[s[i]],c),r[t+it]=o,t++}else if(Gt)for(;t<n;){i=0,a=0,o=0;i=Ye.apixels[e],e++,c=a=i<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],a=Wn(a=(i=Ye.apixels[e])<=31?Ze[i]:je[Xe.color_regs_ecs[i-32]>>>1&1911],c),e++,o=a,r[t+it]=o,t++}else for(;t<n;){var c,i=0,a=0,o=0;i=Ye.apixels[e],e++,c=a=Ze[i],i=Ye.apixels[e],e++,o=a=Wn(a=Ze[i],c),r[t+it]=o,t++}return e}function Bl(e,t,n){var r=rt,i=0;if(Ht)for(;t<n;){var a=0,o=0,s=0,c=0;o=nt[e],s=je[o],a=Ye.apixels[e],e++,c=s,Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,t++}else if(Xt)for(var _=qt?he:me;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,c=s=Ze[_[a=o]],Fe[t+Te].data&&(i=jn(t,1,a,0))&&(c=Ze[i]),r[t+it]=c,t++}else if(Gt)for(;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,c=s=(a=o)<=31?Ze[o]:je[Xe.color_regs_ecs[o-32]>>>1&1911],Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,t++}else for(;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,c=s=Ze[a=o],Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,t++}return e}function Ul(e,t,n){var r=rt,i=0;if(Ht)for(;t<n;){var a=0,o=0,s=0,c=0;o=nt[e],s=je[o],a=Ye.apixels[e],e++,c=s,Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,r[++t+it]=c,t++}else if(Xt)for(var _=qt?he:me;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,c=s=Ze[_[a=o]],Fe[t+Te].data&&(i=jn(t,1,a,0))&&(c=Ze[i]),r[t+it]=c,r[++t+it]=c,t++}else if(Gt)for(;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,c=s=(a=o)<=31?Ze[o]:je[Xe.color_regs_ecs[o-32]>>>1&1911],Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,r[++t+it]=c,t++}else for(;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,c=s=Ze[a=o],Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,r[++t+it]=c,t++}return e}function Kl(e,t,n){var r=rt,i=0;if(Ht)for(;t<n;){var a=0,o=0,s=0,c=0;o=nt[e],s=je[o],a=Ye.apixels[e],e++,c=s,Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,r[++t+it]=c,r[++t+it]=c,r[++t+it]=c,t++}else if(Xt)for(var _=qt?he:me;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,c=s=Ze[_[a=o]],Fe[t+Te].data&&(i=jn(t,1,a,0))&&(c=Ze[i]),r[t+it]=c,r[++t+it]=c,r[++t+it]=c,r[++t+it]=c,t++}else if(Gt)for(;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,c=s=(a=o)<=31?Ze[o]:je[Xe.color_regs_ecs[o-32]>>>1&1911],Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,r[++t+it]=c,r[++t+it]=c,r[++t+it]=c,t++}else for(;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,c=s=Ze[a=o],Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,r[++t+it]=c,r[++t+it]=c,r[++t+it]=c,t++}return e}function Gl(e,t,n){var r=rt,i=0;if(Ht)for(;t<n;){var a=0,o=0,s=0,c=0;o=nt[e],s=je[o],a=Ye.apixels[e],e+=2,c=s,Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,t++}else if(Xt)for(var _=qt?he:me;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e+=2,c=s=Ze[_[a=o]],Fe[t+Te].data&&(i=jn(t,1,a,0))&&(c=Ze[i]),r[t+it]=c,t++}else if(Gt)for(;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e+=2,c=s=(a=o)<=31?Ze[o]:je[Xe.color_regs_ecs[o-32]>>>1&1911],Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,t++}else for(;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e+=2,c=s=Ze[a=o],Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,t++}return e}function Hl(e,t,n){var r=rt,i=0;if(Ht)for(;t<n;){var a=0,o=0,s=0,c=0;o=nt[e],s=je[o],a=Ye.apixels[e],f=s,o=nt[++e],s=je[o],a=Ye.apixels[e],e++,c=s=Wn(s,f),Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,t++}else if(Xt)for(var _=qt?he:me;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,f=s=Ze[_[a=o]],o=Ye.apixels[e],e++,c=s=Wn(s=Ze[_[a=o]],f),Fe[t+Te].data&&(i=jn(t,1,a,0))&&(c=Ze[i]),r[t+it]=c,t++}else if(Gt)for(;t<n;){a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,f=s=(a=o)<=31?Ze[o]:je[Xe.color_regs_ecs[o-32]>>>1&1911],s=Wn(s=(a=o=Ye.apixels[e])<=31?Ze[o]:je[Xe.color_regs_ecs[o-32]>>>1&1911],f),e++,c=s,Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,t++}else for(;t<n;){var f,a=0,o=0,s=0,c=0;o=Ye.apixels[e],e++,f=s=Ze[a=o],o=Ye.apixels[e],e++,c=s=Wn(s=Ze[a=o],f),Fe[t+Te].data&&(i=jn(t,0,a,0))&&(c=Ze[i]),r[t+it]=c,t++}return e}function Xl(e,t,n){var r,i=rt;for(1;t<n;){var a=0;e++,a=Ze[0],Fe[t+Te].data&&(r=jn(t+0,0,0,1))&&(a=Ze[r]),i[t+it]=a,t++}return e}function ql(e,t,n){var r=rt,i=0;for(1;t<n;){var a=0;e++;var o=a=Ze[0],a=a;Fe[t+Te].data&&(i=jn(t,0,0,1))&&(o=Ze[i]),Fe[t+Te+1].data&&(i=jn(t+1,0,0,1))&&(a=Ze[i]),r[t+it]=o,r[++t+it]=a,t++}return e}function Zl(e,t,n){var r=rt,i=0;for(1;t<n;){var a=0;e++;var o=a=Ze[0],s=a,c=a,a=a;Fe[t+Te].data&&(i=jn(t,0,0,1))&&(o=Ze[i]),Fe[t+Te+1].data&&(i=jn(t+1,0,0,1))&&(s=Ze[i]),Fe[t+Te+2].data&&(i=jn(t+2,0,0,1))&&(c=Ze[i]),Fe[t+Te+3].data&&(i=jn(t+3,0,0,1))&&(a=Ze[i]),r[t+it]=o,r[++t+it]=s,r[++t+it]=c,r[++t+it]=a,t++}return e}function jl(e,t,n){var r,i=rt;for(1;t<n;){var a=0;e++,a=Ze[0],Fe[t+Te].data&&(r=jn(t+0,0,0,1))&&(a=Ze[r]),i[t+it]=a,t++}return e}function Yl(e,t,n){var r,i=rt;for(1;t<n;){var a=0;e++,a=Ze[0],Fe[t+Te].data&&(r=jn(t+0,0,0,1))&&(a=Ze[r]),i[t+it]=a,t++}return e}function Wl(e,t,n){var r,i=rt;for(1;t<n;){var a=0;e++,a=Ze[0],Fe[t+Te].data&&(r=jn(t+0,0,0,1))&&(a=Ze[r]),i[t+it]=a,t++}return e}function Jl(e,t,n){var r,i=rt;for(1;t<n;){var a=0;e++,a=Ze[0],Fe[t+Te].data&&(r=jn(t+0,0,0,1))&&(a=Ze[r]),i[t+it]=a,t++}return e}function Ql(e,t,n){var r=rt,i=tn,a=nn;if(Ht)for(;t<n;){var o=0,s=0;o=(Ye.apixels[e]^i)&a,o=nt[e],e++,s=M(o),r[t+it]=s,t++}else if(Xt)for(var c=qt?be:ve,_=qt?ye:ge;t<n;){var o=0,s=0,f=c[o=Ye.apixels[e]];_[o]&&(f+=pe[Zt]),e++,s=Ze[f^=i],r[t+it]=s,t++}else if(Gt)for(;t<n;){o=0,s=0;o=(Ye.apixels[e]^i)&a,e++,s=32<=o&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],r[t+it]=s,t++}else for(;t<n;){o=0,s=0;o=(Ye.apixels[e]^i)&a,e++,s=Ze[o],r[t+it]=s,t++}return e}function $l(e,t,n){var r=rt,i=tn,a=nn;if(Ht)for(;t<n;){var o=0,s=0;o=(Ye.apixels[e]^i)&a,o=nt[e],e++,s=M(o),r[t+it]=s,r[++t+it]=s,t++}else if(Xt)for(var c=qt?be:ve,_=qt?ye:ge;t<n;){var o=0,s=0,f=c[o=Ye.apixels[e]];_[o]&&(f+=pe[Zt]),e++,s=Ze[f^=i],r[t+it]=s,r[++t+it]=s,t++}else if(Gt)for(;t<n;){o=0,s=0;o=(Ye.apixels[e]^i)&a,e++,s=32<=o&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],r[t+it]=s,r[++t+it]=s,t++}else for(;t<n;){o=0,s=0;o=(Ye.apixels[e]^i)&a,e++,s=Ze[o],r[t+it]=s,r[++t+it]=s,t++}return e}function eu(e,t,n){var r=rt,i=tn,a=nn;if(Ht)for(;t<n;){var o=0,s=0;o=(Ye.apixels[e]^i)&a,o=nt[e],e++,s=M(o),r[t+it]=s,r[++t+it]=s,r[++t+it]=s,r[++t+it]=s,t++}else if(Xt)for(var c=qt?be:ve,_=qt?ye:ge;t<n;){var o=0,s=0,f=c[o=Ye.apixels[e]];_[o]&&(f+=pe[Zt]),e++,s=Ze[f^=i],r[t+it]=s,r[++t+it]=s,r[++t+it]=s,r[++t+it]=s,t++}else if(Gt)for(;t<n;){o=0,s=0;o=(Ye.apixels[e]^i)&a,e++,s=32<=o&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],r[t+it]=s,r[++t+it]=s,r[++t+it]=s,r[++t+it]=s,t++}else for(;t<n;){o=0,s=0;o=(Ye.apixels[e]^i)&a,e++,s=Ze[o],r[t+it]=s,r[++t+it]=s,r[++t+it]=s,r[++t+it]=s,t++}return e}function tu(e,t,n){var r=rt,i=tn,a=nn;if(Ht)for(;t<n;){var o=0,s=0;o=(Ye.apixels[e]^i)&a,o=nt[e],e+=2,s=M(o),r[t+it]=s,t++}else if(Xt)for(var c=qt?be:ve,_=qt?ye:ge;t<n;){var o=0,s=0,f=c[o=Ye.apixels[e]];_[o]&&(f+=pe[Zt]),e+=2,s=Ze[f^=i],r[t+it]=s,t++}else if(Gt)for(;t<n;){o=0,s=0;o=(Ye.apixels[e]^i)&a,e+=2,s=32<=o&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],r[t+it]=s,t++}else for(;t<n;){o=0,s=0;o=(Ye.apixels[e]^i)&a,e+=2,s=Ze[o],r[t+it]=s,t++}return e}function nu(e,t,n){var r=rt,i=tn,a=nn;if(Ht)for(;t<n;){var o=0,s=0,c=0;o=(Ye.apixels[e]^i)&a,o=nt[e],e++,u=s=M(o),o=(Ye.apixels[e]^i)&a,s=Wn(s=M(o=nt[e]),u),e++,c=s,r[t+it]=c,t++}else if(Xt)for(var _=qt?be:ve,f=qt?ye:ge;t<n;){var o=0,s=0,c=0,l=_[o=Ye.apixels[e]];f[o]&&(l+=pe[Zt]),e++,u=s=Ze[l^=i];l=_[o=Ye.apixels[e]];f[o]&&(l+=pe[Zt]),e++,c=s=Wn(s=Ze[l^=i],u),r[t+it]=c,t++}else if(Gt)for(;t<n;){o=0,s=0,c=0;o=(Ye.apixels[e]^i)&a,e++,u=s=32<=o&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],s=Wn(s=32<=(o=(Ye.apixels[e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],u),e++,c=s,r[t+it]=c,t++}else for(;t<n;){var u,o=0,s=0,c=0;o=(Ye.apixels[e]^i)&a,e++,u=s=Ze[o],o=(Ye.apixels[e]^i)&a,e++,c=s=Wn(s=Ze[o],u),r[t+it]=c,t++}return e}function ru(e,t,n){var r=rt,i=tn,a=nn;if(Ht)for(;t<n;){var o=0,s=0;o=(Ye.apixels[e]^i)&a,o=nt[e],e+=4,s=M(o),r[t+it]=s,t++}else if(Xt)for(var c=qt?be:ve,_=qt?ye:ge;t<n;){var o=0,s=0,f=c[o=Ye.apixels[e]];_[o]&&(f+=pe[Zt]),e+=4,s=Ze[f^=i],r[t+it]=s,t++}else if(Gt)for(;t<n;){o=0,s=0;o=(Ye.apixels[e]^i)&a,e+=4,s=32<=o&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],r[t+it]=s,t++}else for(;t<n;){o=0,s=0;o=(Ye.apixels[e]^i)&a,e+=4,s=Ze[o],r[t+it]=s,t++}return e}function iu(e,t,n){var r=rt,i=tn,a=nn;if(Ht)for(;t<n;){var o=0,s=0,c=0;o=(Ye.apixels[e]^i)&a,o=nt[e],e++,u=s=M(o),o=(Ye.apixels[e]^i)&a,o=nt[e],e++,d=s=M(o),o=(Ye.apixels[e]^i)&a,o=nt[e],e++,p=s=M(o),o=(Ye.apixels[e]^i)&a,s=M(o=nt[e]),u=Wn(u,d),d=Wn(p,s),e++,c=s=Wn(u,d),r[t+it]=c,t++}else if(Xt)for(var _=qt?be:ve,f=qt?ye:ge;t<n;){var o=0,s=0,c=0,l=_[o=Ye.apixels[e]];f[o]&&(l+=pe[Zt]),e++,u=s=Ze[l^=i];l=_[o=Ye.apixels[e]];f[o]&&(l+=pe[Zt]),e++,d=s=Ze[l^=i];l=_[o=Ye.apixels[e]];f[o]&&(l+=pe[Zt]),e++,p=s=Ze[l^=i];l=_[o=Ye.apixels[e]];f[o]&&(l+=pe[Zt]),s=Ze[l^=i],u=Wn(u,d),d=Wn(p,s),e++,c=s=Wn(u,d),r[t+it]=c,t++}else if(Gt)for(;t<n;){o=0,s=0,c=0;o=(Ye.apixels[e]^i)&a,e++,u=s=32<=o&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],o=(Ye.apixels[e]^i)&a,e++,d=s=32<=o&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],o=(Ye.apixels[e]^i)&a,e++,p=s=32<=o&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],s=32<=(o=(Ye.apixels[e]^i)&a)&&o<64?M(Xe.color_regs_aga[o-32]>>>1&8355711):Ze[o],u=Wn(u,d),d=Wn(p,s),e++,c=s=Wn(u,d),r[t+it]=c,t++}else for(;t<n;){var u,d,p,o=0,s=0,c=0;o=(Ye.apixels[e]^i)&a,e++,u=s=Ze[o],o=(Ye.apixels[e]^i)&a,e++,d=s=Ze[o],o=(Ye.apixels[e]^i)&a,e++,p=s=Ze[o],o=(Ye.apixels[e]^i)&a,s=Ze[o],u=Wn(u,d),d=Wn(p,s),e++,c=s=Wn(u,d),r[t+it]=c,t++}return e}function au(e,t,n){var r=rt,i=0,a=tn,o=nn;if(Ht)for(;t<n;){var s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,c=nt[e],e++,_=M(c),Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(_=Ze[i]),r[t+it]=_,t++}else if(Xt)for(var f=qt?be:ve,l=qt?ye:ge;t<n;){var s=0,c=0,_=0,u=f[s=c=Ye.apixels[e]];l[c]&&(u+=pe[Zt]),e++,_=Ze[u^=a],Fe[t+Te].data&&(i=jn(t+0,1,s,1))&&(_=Ze[i]),r[t+it]=_,t++}else if(Gt)for(;t<n;){s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++,_=32<=c&&c<64?M(Xe.color_regs_aga[c-32]>>>1&8355711):Ze[c],Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(_=Ze[i]),r[t+it]=_,t++}else for(;t<n;){s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++,_=Ze[c],Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(_=Ze[i]),r[t+it]=_,t++}return e}function ou(e,t,n){var r=rt,i=0,a=tn,o=nn;if(Ht)for(;t<n;){var s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,c=nt[e],e++;var f=_=M(c),l=_;Fe[t+Te].data&&(i=jn(t,0,s,1))&&(f=Ze[i]),Fe[t+Te+1].data&&(i=jn(t+1,0,s,1))&&(l=Ze[i]),r[t+it]=f,r[++t+it]=l,t++}else if(Xt)for(var u=qt?be:ve,d=qt?ye:ge;t<n;){var s=0,c=0,_=0,p=u[s=c=Ye.apixels[e]];d[c]&&(p+=pe[Zt]),e++;f=_=Ze[p^=a],l=_;Fe[t+Te].data&&(i=jn(t,1,s,1))&&(f=Ze[i]),Fe[t+Te+1].data&&(i=jn(t+1,1,s,1))&&(l=Ze[i]),r[t+it]=f,r[++t+it]=l,t++}else if(Gt)for(;t<n;){s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++;f=_=32<=c&&c<64?M(Xe.color_regs_aga[c-32]>>>1&8355711):Ze[c],l=_;Fe[t+Te].data&&(i=jn(t,0,s,1))&&(f=Ze[i]),Fe[t+Te+1].data&&(i=jn(t+1,0,s,1))&&(l=Ze[i]),r[t+it]=f,r[++t+it]=l,t++}else for(;t<n;){s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++;f=_=Ze[c],l=_;Fe[t+Te].data&&(i=jn(t,0,s,1))&&(f=Ze[i]),Fe[t+Te+1].data&&(i=jn(t+1,0,s,1))&&(l=Ze[i]),r[t+it]=f,r[++t+it]=l,t++}return e}function su(e,t,n){var r=rt,i=0,a=tn,o=nn;if(Ht)for(;t<n;){var s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,c=nt[e],e++;var f=_=M(c),l=_,u=_,d=_;Fe[t+Te].data&&(i=jn(t,0,s,1))&&(f=Ze[i]),Fe[t+Te+1].data&&(i=jn(t+1,0,s,1))&&(l=Ze[i]),Fe[t+Te+2].data&&(i=jn(t+2,0,s,1))&&(u=Ze[i]),Fe[t+Te+3].data&&(i=jn(t+3,0,s,1))&&(d=Ze[i]),r[t+it]=f,r[++t+it]=l,r[++t+it]=u,r[++t+it]=d,t++}else if(Xt)for(var p=qt?be:ve,E=qt?ye:ge;t<n;){var s=0,c=0,_=0,A=p[s=c=Ye.apixels[e]];E[c]&&(A+=pe[Zt]),e++;f=_=Ze[A^=a],l=_,u=_,d=_;Fe[t+Te].data&&(i=jn(t,1,s,1))&&(f=Ze[i]),Fe[t+Te+1].data&&(i=jn(t+1,1,s,1))&&(l=Ze[i]),Fe[t+Te+2].data&&(i=jn(t+2,1,s,1))&&(u=Ze[i]),Fe[t+Te+3].data&&(i=jn(t+3,1,s,1))&&(d=Ze[i]),r[t+it]=f,r[++t+it]=l,r[++t+it]=u,r[++t+it]=d,t++}else if(Gt)for(;t<n;){s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++;f=_=32<=c&&c<64?M(Xe.color_regs_aga[c-32]>>>1&8355711):Ze[c],l=_,u=_,d=_;Fe[t+Te].data&&(i=jn(t,0,s,1))&&(f=Ze[i]),Fe[t+Te+1].data&&(i=jn(t+1,0,s,1))&&(l=Ze[i]),Fe[t+Te+2].data&&(i=jn(t+2,0,s,1))&&(u=Ze[i]),Fe[t+Te+3].data&&(i=jn(t+3,0,s,1))&&(d=Ze[i]),r[t+it]=f,r[++t+it]=l,r[++t+it]=u,r[++t+it]=d,t++}else for(;t<n;){s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++;f=_=Ze[c],l=_,u=_,d=_;Fe[t+Te].data&&(i=jn(t,0,s,1))&&(f=Ze[i]),Fe[t+Te+1].data&&(i=jn(t+1,0,s,1))&&(l=Ze[i]),Fe[t+Te+2].data&&(i=jn(t+2,0,s,1))&&(u=Ze[i]),Fe[t+Te+3].data&&(i=jn(t+3,0,s,1))&&(d=Ze[i]),r[t+it]=f,r[++t+it]=l,r[++t+it]=u,r[++t+it]=d,t++}return e}function cu(e,t,n){var r=rt,i=0,a=tn,o=nn;if(Ht)for(;t<n;){var s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,c=nt[e],e+=2,_=M(c),Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(_=Ze[i]),r[t+it]=_,t++}else if(Xt)for(var f=qt?be:ve,l=qt?ye:ge;t<n;){var s=0,c=0,_=0,u=f[s=c=Ye.apixels[e]];l[c]&&(u+=pe[Zt]),e+=2,_=Ze[u^=a],Fe[t+Te].data&&(i=jn(t+0,1,s,1))&&(_=Ze[i]),r[t+it]=_,t++}else if(Gt)for(;t<n;){s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e+=2,_=32<=c&&c<64?M(Xe.color_regs_aga[c-32]>>>1&8355711):Ze[c],Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(_=Ze[i]),r[t+it]=_,t++}else for(;t<n;){s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e+=2,_=Ze[c],Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(_=Ze[i]),r[t+it]=_,t++}return e}function _u(e,t,n){var r=rt,i=0,a=tn,o=nn;if(Ht)for(;t<n;){var s=0,c=0,_=0,f=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,c=nt[e],e++,p=_=M(c),s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,_=Wn(_=M(c=nt[e]),p),e++,f=_,Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(f=Ze[i]),r[t+it]=f,t++}else if(Xt)for(var l=qt?be:ve,u=qt?ye:ge;t<n;){var s=0,c=0,_=0,f=0,d=l[s=c=Ye.apixels[e]];u[c]&&(d+=pe[Zt]),e++,p=_=Ze[d^=a];d=l[s=c=Ye.apixels[e]];u[c]&&(d+=pe[Zt]),e++,f=_=Wn(_=Ze[d^=a],p),Fe[t+Te].data&&(i=jn(t+0,1,s,1))&&(f=Ze[i]),r[t+it]=f,t++}else if(Gt)for(;t<n;){s=0,c=0,_=0,f=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++,p=_=32<=c&&c<64?M(Xe.color_regs_aga[c-32]>>>1&8355711):Ze[c],s=Ye.apixels[e],_=Wn(_=32<=(c=(Ye.apixels[e]^a)&o)&&c<64?M(Xe.color_regs_aga[c-32]>>>1&8355711):Ze[c],p),e++,f=_,Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(f=Ze[i]),r[t+it]=f,t++}else for(;t<n;){var p,s=0,c=0,_=0,f=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++,p=_=Ze[c],s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++,f=_=Wn(_=Ze[c],p),Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(f=Ze[i]),r[t+it]=f,t++}return e}function fu(e,t,n){var r=rt,i=0,a=tn,o=nn;if(Ht)for(;t<n;){var s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,c=nt[e],e+=4,_=M(c),Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(_=Ze[i]),r[t+it]=_,t++}else if(Xt)for(var f=qt?be:ve,l=qt?ye:ge;t<n;){var s=0,c=0,_=0,u=f[s=c=Ye.apixels[e]];l[c]&&(u+=pe[Zt]),e+=4,_=Ze[u^=a],Fe[t+Te].data&&(i=jn(t+0,1,s,1))&&(_=Ze[i]),r[t+it]=_,t++}else if(Gt)for(;t<n;){s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e+=4,_=32<=c&&c<64?M(Xe.color_regs_aga[c-32]>>>1&8355711):Ze[c],Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(_=Ze[i]),r[t+it]=_,t++}else for(;t<n;){s=0,c=0,_=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e+=4,_=Ze[c],Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(_=Ze[i]),r[t+it]=_,t++}return e}function lu(e,t,n){var r=rt,i=0,a=tn,o=nn;if(Ht)for(;t<n;){var s=0,c=0,_=0,f=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,c=nt[e],e++,p=_=M(c),s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,c=nt[e],e++,E=_=M(c),s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,c=nt[e],e++,A=_=M(c),s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,_=M(c=nt[e]),p=Wn(p,E),E=Wn(A,_),e++,f=_=Wn(p,E),Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(f=Ze[i]),r[t+it]=f,t++}else if(Xt)for(var l=qt?be:ve,u=qt?ye:ge;t<n;){var s=0,c=0,_=0,f=0,d=l[s=c=Ye.apixels[e]];u[c]&&(d+=pe[Zt]),e++,p=_=Ze[d^=a];d=l[s=c=Ye.apixels[e]];u[c]&&(d+=pe[Zt]),e++,E=_=Ze[d^=a];d=l[s=c=Ye.apixels[e]];u[c]&&(d+=pe[Zt]),e++,A=_=Ze[d^=a];d=l[s=c=Ye.apixels[e]];u[c]&&(d+=pe[Zt]),_=Ze[d^=a],p=Wn(p,E),E=Wn(A,_),e++,f=_=Wn(p,E),Fe[t+Te].data&&(i=jn(t+0,1,s,1))&&(f=Ze[i]),r[t+it]=f,t++}else if(Gt)for(;t<n;){s=0,c=0,_=0,f=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++,p=_=32<=c&&c<64?M(Xe.color_regs_aga[c-32]>>>1&8355711):Ze[c],s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++,E=_=32<=c&&c<64?M(Xe.color_regs_aga[c-32]>>>1&8355711):Ze[c],s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++,A=_=32<=c&&c<64?M(Xe.color_regs_aga[c-32]>>>1&8355711):Ze[c],s=Ye.apixels[e],_=32<=(c=(Ye.apixels[e]^a)&o)&&c<64?M(Xe.color_regs_aga[c-32]>>>1&8355711):Ze[c],p=Wn(p,E),E=Wn(A,_),e++,f=_=Wn(p,E),Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(f=Ze[i]),r[t+it]=f,t++}else for(;t<n;){var p,E,A,s=0,c=0,_=0,f=0;s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++,p=_=Ze[c],s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++,E=_=Ze[c],s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,e++,A=_=Ze[c],s=Ye.apixels[e],c=(Ye.apixels[e]^a)&o,_=Ze[c],p=Wn(p,E),E=Wn(A,_),e++,f=_=Wn(p,E),Fe[t+Te].data&&(i=jn(t+0,0,s,1))&&(f=Ze[i]),r[t+it]=f,t++}return e}this.setup=function(){var e;return SAEV_AutoConf_boot_rom_type&&(e=SAER.autoconf.here(),SAER.autoconf.org(SAEV_AutoConf_base+65392),SAER.autoconf.calltrap(SAER.autoconf.define_trap(Cf,0,"mousehack_helper_old")),SAER.autoconf.dw(SAEC_AutoConf_RTS),SAER.autoconf.org(SAEV_AutoConf_base+65440),SAER.autoconf.calltrap(SAER.autoconf.define_trap(Rf,0,"timehack_helper")),SAER.autoconf.dw(SAEC_AutoConf_RTS),SAER.autoconf.org(e)),function(){var e;if(null===Ji){for(Ji=new Uint32Array(256),Qi=new Uint32Array(256),$i=new Uint32Array(256),e=0;e<256;e++)Ji[e]=(e>>7&1)<<0|(e>>6&1)<<2|(e>>5&1)<<4|(e>>4&1)<<6|(e>>3&1)<<8|(e>>2&1)<<10|(e>>1&1)<<12|(e>>0&1)<<14,Qi[e]=2*Ji[e],$i[e]=(15&e?1:0)|(240&e?2:0);for(ea=new Uint32Array(16),ta=new Uint32Array(16),e=0;e<16;e++)ta[e]=(1&e?15:3)|(2&e?240:48)|(4&e?3840:768)|(8&e?61440:12288),ea[e]=((3==(3&e)?1:0)|(5==(5&e)?2:0)|(9==(9&e)?4:0)|(6==(6&e)?8:0)|(10==(10&e)?16:0)|(12==(12&e)?32:0))<<9}}(),Yr(),function(){var e,t,n,r,i,a,o,s,c,_;if(null===l_)for(l_=new Array(3),u_=new Array(3),d_=new Array(3),Qc=new Array(3),e=0;e<=2;e++)for(l_[e]=new Array(3),u_[e]=new Array(3),d_[e]=new Array(3),Qc[e]=new Array(3),t=0;t<=2;t++)for(l_[e][t]=new Array(9),u_[e][t]=new Array(9),d_[e][t]=new Array(9),Qc[e][t]=new Array(9),s=f_[4*e+t],o=1<<__[4*e+t],_=E_[s-1],s=1<<s,r=0;r<=8;r++){for(l_[e][t][r]=new Array(32),n=c=0;n<32;n++)l_[e][t][r][n]=-1;if(r<=s)for(n=0;n<o;n++)n<s&&r>=_[7&n]?a=_[7&n]:(a=0,c++),l_[e][t][r][n]=a;u_[e][t][r]=c,d_[e][t][r]=o,i=r,7!=(i=s<r?0:r)||0!=e||0!=t||SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA||(i=4),Qc[e][t][r]=i}}(),Bc(),SAEE_None},this.custom_reset=function(e,t){var n;if(n=e,SAER.events.reset(),SAER.filesys.reset(),SAER.memory.reset(n),SAER.dongle.reset(),SAER.memory.map_dump(),ji=Yi=-1,SAEV_Events_vsync_counter=SAEV_Events_hsync_counter=ao=Zi=0,Lc(),SAER.blitter.reset(),e)if(te){r=0;for(i=0;i<256;i++)wo.color_regs_aga[i]=r,wo.acolors[i]=F(r)}else for(var r=SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_ECS_DENISE&&!(SAEV_config.chipset.mask&SAEC_Config_Chipset_Mask_AGA)||SAEV_config.chipset.deniseNoEHB?4095:0,i=0;i<32;i++)wo.color_regs_ecs[i]=r,wo.acolors[i]=F(r);for(i=xs=0;i<Ya.length;i++)Ya[i].clr();SAER.custom.reset(),SAER.copper.clr_copcon(),SAER.disk.DSKLEN(0,0),To=17,Fo=3072,Uo=Bo=xo=0,fs=p,Xa=65535,this.FMODE(0,0),this.CLXCON(0),this.CLXCON2(0),e0(0),oo=Si(wa),xa=Da=SAEV_config.chipset.ntsc?0:32,SAEV_Blitter_bltstate=SAEC_Blitter_bltstate_DONE,vi=bi=0,Pi=!(SAEV_Blitter_interrupt=!0),SAEF_memset(to,0,0,m),SAEF_memset(eo,0,0,m),SAER.devices.reset(e),SAEF_clrSpcFlags(~(SAEC_spcflag_BRK|SAEC_spcflag_MODE_CHANGE)),gi=yi=hi=0,SAER.input.reset(),Vs[Gs=Ks=kf=0][0].first_pixel=0,Vs[1][0].first_pixel=O,Vs[0][1].first_pixel=0,Vs[1][1].first_pixel=O,SAEF_memset(et,0,0,2*O),SAEF_memset(tt.bytes,0,0,2*O),G_[0]=0,G_[1]=0,SAER_Copper_cop_state.state=0,SAER_Copper_cop_state.movedelay=0,SAER_Copper_cop_state.strobe=0,SAER_Copper_cop_state.ignore_next=!1,_s=p,SAER.events.clr_dmal(),Y0(),Xi=-1,Ki=Ui=Fi=0,SAER.audio.reset(),SAEV_Custom_adkcon=0,SAER.audio.update_adkmasks(),Kr(),Yr(),G0(),SAEV_Events_bogusframe=1,so=P0(xo,Fo),oo=Si(wa),e0(0),e&&SAER.rtc.hardreset(),qo=-1,cf=ef=0,Ec=SAEV_config.cpu.model<SAEC_Config_CPU_Model_68020,Ic=20},this.custom_prepare=function(){J0()}}const SAEC_Video_DEF_AMIGA_WIDTH=360,SAEC_Video_DEF_AMIGA_HEIGHT=284,SAEC_Video_MAX_AMIGA_WIDTH=376,SAEC_Video_MAX_AMIGA_HEIGHT=288,SAEC_Video_MIN_UAE_WIDTH=160,SAEC_Video_MAX_UAE_WIDTH=3072,SAEC_Video_MIN_UAE_HEIGHT=128,SAEC_Video_MAX_UAE_HEIGHT=2048;function SAEO_Video(){const i="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}",a="precision mediump float;uniform sampler2D u_image;varying vec2 v_texCoord;void main() {gl_FragColor = texture2D(u_image, v_texCoord);}";var f={alpha:!1,depth:!1,stencil:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!0,failIfMajorPerformanceCaveat:!1};function n(e,t,n){this.width=e,this.width_allocated=e+7&-8,this.height=t,this.height_allocated=t,this.pixbytes=n,this.rowbytes=this.width_allocated*this.pixbytes,this.data=new ArrayBuffer(this.width_allocated*this.height_allocated*this.pixbytes)}function o(e,t,n){this.width=e,this.width_allocated=e+7&-8,this.height=t,this.height_allocated=t,this.pixbytes=n,this.rowbytes=this.width_allocated*this.pixbytes,this.data=new ArrayBuffer(this.width_allocated*this.height_allocated*this.pixbytes),this.imageData=null}function _(){this.canvas=null,this.ctx=null,this.texture=null,this.surface=null,this.div=null,this.shown=!1,this.fullscreen=!1}function l(){this.left=0,this.top=0,this.right=0,this.bottom=0}var u=null,d=null,r=new l;function p(e,t){var n,r;return"vertex"==t?(n=e.createShader(e.VERTEX_SHADER),r=i):"fragment"==t&&(n=e.createShader(e.FRAGMENT_SHADER),r=a),e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:SAEE_Video_ComphileShader}function E(){(document.webkitPointerLockElement||document.mozPointerLockElement||document.msPointerLockElement||document.pointerLockElement)===u.canvas?SAER.input.mouse.attach(u.canvas,!0):SAER.input.mouse.dettach(u.canvas,!0)}function A(){var e=document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.fullscreenElement;u.fullscreen=e===u.canvas,"function"==typeof SAEV_config.hook.event.screened&&SAEV_config.hook.event.screened(u.fullscreen)}const s=0,S=1;function m(e,t){t!=S||e.shown?t==s&&e.shown&&(null!==e.div&&e.div.removeChild(e.canvas),e.shown=!1):("DIV"==(t=document.getElementById(SAEV_config.video.id)).nodeName?(e.div=t,e.div.style.width=String(C.native_width)+"px",e.div.style.height=String(C.native_height)+"px",e.div.appendChild(e.canvas)):(e.div=null,e.canvas.style.width=String(C.native_width)+"px",e.canvas.style.height=String(C.native_height)+"px"),e.shown=!0)}const h=1,g=2,y=512,v=1024,b=2048;function e(){this.primary=!1,this.ddguid=0,this.adaptername="",this.adapterid="",this.adapterkey="",this.monitorname="",this.monitorid="",this.fullname="",this.rect=new l}for(var c=new Array(1),t=0;t<1;t++)c[t]=new e;var C=new function(){this.flags=0,this.native_width=0,this.native_height=0,this.native_depth,this.pitch=0,this.current_width=0,this.current_height=0,this.current_depth=0,this.amiga_width=0,this.amiga_height=0,this.initdone=0,this.fullfill=0,this.vsync=0,this.freq=0},k=null,R=!1,w=0,x=0;function D(e){var t=R?1:0;return e.video.apmode[t].gfx_fullscreen==SAEC_Config_Video_AP_Fullscreen_FULLSCREEN?1:e.video.apmode[t].gfx_fullscreen==SAEC_Config_Video_AP_Fullscreen_FULLWINDOW?-1:0}function M(){return D(SAEV_config)}var F=null;function T(e){return t=e,n=-1,e=c.length,t=n<0?t.video.apmode[R?1:0].gfx_display-1:n,0<=n&&e<=t?null:c[t=(t=e<=t?0:t)<0?0:t];var t,n}function V(e){var t=M();!e&&0<t||((e=r).left=(screen.width>>1)-(C.native_width>>1),e.left<0&&(e.left=0),e.top=(screen.height>>1)-(C.native_height>>1),e.top<0&&(e.top=0),e.right=e.left+C.native_width,e.bottom=e.top+C.native_height,SAEF_log("video.updatewinrect() GetWindowRect %dx%d %dx%d %d",r.left,r.top,r.right,r.bottom,t),0==t&&(SAEV_config.video.size_win.x=r.left,SAEV_config.video.size_win.y=r.top))}function I(){k=null}function P(){var e=C.flags&h,t=C.flags&g,n=!0,r=T(SAEV_config),i=0;if(d=null,0,(n=t&&!n?!0:n)&&(i=0),e){var a=C.native_width,o=C.native_height;0<=(s=r.rect).left?s.left:(s.left,s.right,s.left),0<=s.top?s.top:(s.top,s.bottom,s.top)}else{var s=new l,c=2;for(n&&(SAEV_config.video.size_win.x,SAEV_config.video.size_win.y);c;){c--,s.left=0,s.top=0,s.right=s.left+0+C.current_width+0,s.bottom=s.top+0+C.current_height+0+i;break}t&&(s=SAEF_CloneObject(r.rect),C.native_width=s.right-s.left,C.native_height=s.bottom-s.top),n&&(s.left,s.top),a=C.native_width,o=C.native_height}try{u=function(e,t){var n=new _,r=document.getElementById(SAEV_config.video.id);if("CANVAS"==r.nodeName?n.canvas=r:n.canvas=document.createElement("canvas"),n.canvas.width=e,n.canvas.height=t,n.canvas.style.backgroundColor=sprintf("#%06X",SAEV_config.video.backgroundColor),SAEV_config.video.api==SAEC_Config_Video_API_WebGL)try{f.antialias=SAEV_config.video.antialias,f.alpha=5<=SAEV_config.video.colorMode,n.ctx=n.canvas.getContext("webgl",f)||n.canvas.getContext("experimental-webgl",f)}catch(e){throw SAEE_Video_RequiresWegGl}else if(SAEV_config.video.api==SAEC_Config_Video_API_Canvas)try{n.ctx=n.canvas.getContext("2d")}catch(e){throw SAEE_Video_RequiresCanvas}return SAEF_info("sae.video() %s mode, %dx%d pixels, %d bpp",SAEV_config.video.api==SAEC_Config_Video_API_WebGL?"WebGL":"Canvas",e,t,2==SAEV_config.video.colorMode?16:32),n.canvas.oncontextmenu=function(){return!1},SAEV_config.ports[0].type==SAEC_Config_Ports_Type_Mouse&&(SAEC_info.video.pointerLock&&SAEV_config.video.cursor==SAEC_Config_Video_Cursor_Lock?n.canvas.myRequestPointerLock=n.canvas.webkitRequestPointerLock||n.canvas.mozRequestPointerLock||n.canvas.msRequestPointerLock||n.canvas.requestPointerLock:n.canvas.myRequestPointerLock=null,null!==n.canvas.myRequestPointerLock?(void 0!==document.onwebkitpointerlockchange?document.addEventListener("webkitpointerlockchange",E,!1):void 0!==document.onmozpointerlockchange?document.addEventListener("mozpointerlockchange",E,!1):void 0!==document.onpointerlockchange&&document.addEventListener("pointerlockchange",E,!1),n.canvas.onclick=function(e){null===(document.webkitPointerLockElement||document.mozPointerLockElement||document.msPointerLockElement||document.pointerLockElement)&&n.canvas.myRequestPointerLock()}):SAER.input.mouse.attach(n.canvas,!1)),SAEV_config.ports[0].type==SAEC_Config_Ports_Type_Joy&&SAEV_config.ports[0].device!=SAEC_Config_Ports_Device_None&&SAER.input.joystick[0].enable(),SAEV_config.ports[1].type==SAEC_Config_Ports_Type_Joy&&SAEV_config.ports[1].device!=SAEC_Config_Ports_Device_None&&SAER.input.joystick[1].enable(),SAEC_info.video.requestFullScreen&&(n.canvas.myRequestFullscreen=n.canvas.webkitRequestFullscreen||n.canvas.mozRequestFullScreen||n.canvas.msRequestFullscreen||n.canvas.requestFullScreen,document.myFullscreenEnabled=document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.fullscreenEnabled,document.myExitFullscreen=document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen||document.exitFullscreen,void 0!==document.onwebkitfullscreenchange?document.addEventListener("webkitfullscreenchange",A,!1):void 0!==document.onmozfullscreenchange?document.addEventListener("mozfullscreenchange",A,!1):void 0!==document.onMSFullscreenChange?document.addEventListener("MSFullscreenChange",A,!1):void 0!==document.onfullscreenchange&&document.addEventListener("fullscreenchange",A,!1)),n}(a,o)}catch(e){return j(),e}return null===d&&(d=u),m(u,S),V(!0),SAEE_None}function z(){for(var e,t,n,r,i,a=3;;){i=r=n=t=e=void 0,e=C.current_depth+7&-8,t=C.native_width,n=C.native_height,SAEV_config.video.apmode[SAEV_Playfield_picasso_on?1:0].gfx_refreshrate,r=0!=(C.flags&h),i=0!=(C.flags&y),u.surface=null,(i||r)&&(i&&(u.surface=new o(t,n,4),u.surface.imageData=u.ctx.createImageData(t,n),C.pitch=u.surface.rowbytes),SAEF_log("video.set_ddraw_2() %dx%d@%d-bytes",t,n,e));if(a--<=0)return;0;break}return 1}function O(e){e.clr()}var L=0,N=0,B=0,U=0,K=0,G=0,H=0,X=0,q=0;function Z(){var e,t,n,r,i,a,o,s,c,_=0;for(remembered_vblank=-1,0==w&&(w=SAEV_config.video.apmode[0].gfx_fullscreen==SAEC_Config_Video_AP_Fullscreen_FULLWINDOW?1:-1),0==x&&(x=SAEV_config.video.apmode[1].gfx_fullscreen==SAEC_Config_Video_AP_Fullscreen_FULLWINDOW?1:-1),I(),O(SAER_Playfield_gfxvidinfo.drawbuffer),O(SAER_Playfield_gfxvidinfo.tempbuffer);;){if(W(),C.native_depth=0,C.flags&g&&(e=T(SAEV_config).rect,C.native_width=e.right-e.left,C.native_height=e.bottom-e.top),e=void 0,(_=(e=P())!=SAEE_None?e:(z(),SAEE_None))!=SAEE_None)return j(),_;if(R)break;C.native_depth=C.current_depth,SAEV_config.video.hresolution>SAER_Playfield_gfxvidinfo.gfx_resolution_reserved&&(SAER_Playfield_gfxvidinfo.gfx_resolution_reserved=SAEV_config.video.hresolution),SAEV_config.video.vresolution>SAER_Playfield_gfxvidinfo.gfx_vresolution_reserved&&(SAER_Playfield_gfxvidinfo.gfx_vresolution_reserved=SAEV_config.video.vresolution),C.amiga_width=C.current_width,C.amiga_height=C.current_height,SAER_Playfield_gfxvidinfo.drawbuffer.pixbytes=C.current_depth>>3,SAER_Playfield_gfxvidinfo.drawbuffer.bufmem=null,SAER_Playfield_gfxvidinfo.drawbuffer.linemem=null,SAER_Playfield_gfxvidinfo.drawbuffer.rowbytes=C.pitch,SAER_Playfield_gfxvidinfo.maxblocklines=0;break}if(null===F&&(F=new ArrayBuffer(4*SAEC_Video_MAX_UAE_WIDTH)),SAER_Playfield_gfxvidinfo.drawbuffer.emergmem=F,SAER_Playfield_gfxvidinfo.drawbuffer.realbufmem=null,SAER_Playfield_gfxvidinfo.drawbuffer.bufmem=null,SAER_Playfield_gfxvidinfo.drawbuffer.bufmem_allocated=null,SAER_Playfield_gfxvidinfo.drawbuffer.bufmem_lockable=!1,SAER_Playfield_gfxvidinfo.outbuffer=SAER_Playfield_gfxvidinfo.drawbuffer,SAER_Playfield_gfxvidinfo.inbuffer=SAER_Playfield_gfxvidinfo.drawbuffer,R||(t="draw",n=SAER_Playfield_gfxvidinfo.drawbuffer,r=C.flags,i=C.native_width,a=C.native_height,c=C.current_depth,n.pixbytes=c+7>>3,n.width_allocated=i+7&-8,n.height_allocated=a,r&b?r&b&&(r=2*(o=n.width_allocated)*(2*(s=n.height_allocated))*n.pixbytes,n.rowbytes=2*o*n.pixbytes,n.realbufmem=new ArrayBuffer(r),n.bufmem=n.realbufmem,n.bufmem_pos=s/2*n.rowbytes+o/2*n.pixbytes,n.bufmemend=n.realbufmem,n.bufmemend_pos=r-n.rowbytes,n.bufmem_allocated=n.bufmem,n.bufmem_lockable=!0,SAEF_log("video.allocsoftbuffer() Allocated %s temp buffer (%d*%d*%d)",t,i,a,c)):n===SAER_Playfield_gfxvidinfo.drawbuffer&&(n.bufmem=null,n.bufmemend=null,n.realbufmem=null,n.bufmem_allocated=null,n.bufmem_lockable=!0,SAEF_log("video.allocsoftbuffer() Reserved %s temp buffer (%d*%d*%d)",t,i,a,c)),SAER_Playfield_init_row_map()),c=SAEC_LITTLE_ENDIAN,C.flags&v?16==C.current_depth?(N=6,K=11,q=X=H=U=0,c=!(G=B=L=5)):(K=24,G=16,H=U=B=N=L=8,X=0,q=SAEV_config.video.alpha):C.flags&y&&(K=24,G=16,H=U=B=N=L=8,X=0,q=SAEV_config.video.alpha),SAER.playfield.alloc_colors64k(L,N,B,K,G,H,U,X,q,c),SAER.playfield.notice_new_xcolors_ext(),Q=$=-1,C.flags&v){if((_=function(e,t,n){SAEF_log("video.setupWebGL() %dx%d",t,n);var r=p(e,"vertex");if(r===SAEE_Video_ComphileShader)return SAEE_Video_ComphileShader;var i=p(e,"fragment");if(i===SAEE_Video_ComphileShader)return SAEE_Video_ComphileShader;var a=e.createProgram();return e.attachShader(a,r),e.attachShader(a,i),e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS)?(e.useProgram(a),e.program=a,i=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW),i=e.getAttribLocation(a,"a_texCoord"),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),i=e.createTexture(),e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),i=e.getUniformLocation(a,"u_resolution"),e.uniform2f(i,t,n),i=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,i),a=e.getAttribLocation(a,"a_position"),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0),e.viewport(0,0,t,n),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),f.alpha||e.colorMask(!0,!0,!0,!1),SAEE_None):SAEE_Video_LinkShader}(u.ctx,C.native_width,C.native_height))!=SAEE_None)return j(),_;V(!0)}return _}function j(){null!==u&&(m(u,s),function(e){SAEC_info.video.requestFullScreen&&(void 0!==document.onwebkitfullscreenchange?document.removeEventListener("webkitfullscreenchange",A,!1):void 0!==document.onmozfullscreenchange?document.removeEventListener("mozfullscreenchange",A,!1):void 0!==document.onMSFullscreenChange?document.removeEventListener("MSFullscreenChange",A,!1):void 0!==document.onfullscreenchange&&document.removeEventListener("fullscreenchange",A,!1)),SAEV_config.ports[0].type==SAEC_Config_Ports_Type_Joy&&SAEV_config.ports[0].device!=SAEC_Config_Ports_Device_None&&SAER.input.joystick[0].disable(),SAEV_config.ports[1].type==SAEC_Config_Ports_Type_Joy&&SAEV_config.ports[1].device!=SAEC_Config_Ports_Device_None&&SAER.input.joystick[1].disable();var t=!1;SAEV_config.ports[0].type==SAEC_Config_Ports_Type_Mouse&&(SAEC_info.video.pointerLock&&SAEV_config.video.cursor==SAEC_Config_Video_Cursor_Lock&&null!==e.canvas.myRequestPointerLock&&(void 0!==document.onwebkitpointerlockchange?document.removeEventListener("webkitpointerlockchange",E,!1):void 0!==document.onmozpointerlockchange?document.removeEventListener("mozpointerlockchange",E,!1):void 0!==document.onpointerlockchange&&document.removeEventListener("pointerlockchange",E,!1),t=!(e.canvas.myRequestPointerLock=null)),t||SAER.input.mouse.dettach(e.canvas,!1)),SAEV_config.video.api==SAEC_Config_Video_API_WebGL?e.texture=null:SAEV_config.video.api==SAEC_Config_Video_API_Canvas&&(e.surface=null),e.canvas=null}(u),u==d&&(d=null),u=null)}function Y(e){SAER.config.fixup_prefs_dimensions_ext(e),0!=D(e)?e.video.size=SAEF_CloneObject(e.video.size_fs):e.video.size=SAEF_CloneObject(e.video.size_win)}function W(){C.fullfill=0;var e=y;0<M()?e|=h:M()<0&&(e|=g),null!==k&&(e|=b,C.current_depth<15&&(C.current_depth=16)),SAEV_config.video.api==SAEC_Config_Video_API_WebGL&&(e|=v,e&=~y),(C.flags=e)&b&&(C.fullfill=1),e&g&&(e=T(SAEV_config).rect,C.current_width=e.right-e.left,C.current_height=e.bottom-e.top),C.native_width=C.current_width,C.native_height=C.current_height}function J(){Y(SAEV_config),W(),Y(SAEV_config),C.current_width=SAEV_config.video.size.width,C.current_height=SAEV_config.video.size.height,SAEV_config.video.apmode[0].gfx_vsync&&(C.vsync=1+SAEV_config.video.apmode[0].gfx_vsyncmode),C.current_depth=SAEV_config.video.colorMode<5?16:32,C.amiga_width=C.current_width,C.amiga_height=C.current_height;var e=Z();if(e!=SAEE_None)return e;for(var t=0;t<SAEC_GUI_LED_MAX;t++)SAER.gui.flicker_led(t,-1,-1);for(SAER.gui.led(SAEC_GUI_LED_POWER,SAER.gui.data.powerled,SAER.gui.data.powerled_brightness),SAER.gui.fps(0,0,0),t=0;t<4;t++)SAEV_config.floppy.drive[t].type!=SAEC_Config_Floppy_Type_None&&SAER.gui.led(SAEC_GUI_LED_DF0+t,0,-1);return e}this.updatedisplayarea=function(){},this.obtain=function(){if(!SAEV_config.video.enabled)return SAEE_None;var e=document.getElementById(SAEV_config.video.id);return null===e||"DIV"!=e.nodeName&&"CANVAS"!=e.nodeName?SAEE_Video_ElementNotFound:(SAEV_config.video.api!=SAEC_Config_Video_API_WebGL||SAEC_info.video.webGL||(SAEF_warn("video.obtain() 'WebGL' is not available. Falling back to 'Canvas'..."),SAEV_config.video.api=SAEC_Config_Video_API_Canvas,SAEV_config.video.colorMode=5),SAEV_config.video.api!=SAEC_Config_Video_API_Canvas||SAEC_info.video.canvas?(SAEV_config.video.api==SAEC_Config_Video_API_Canvas&&5!=SAEV_config.video.colorMode&&(SAEV_config.video.colorMode=5),(e=c[0]).monitorname="Default",e.rect.right=screen.availWidth,e.rect.bottom=screen.availHeight,SAEE_None):SAEE_Video_RequiresCanvas)},this.setup=function(e){return SAEV_config.video.enabled?(ee=0,te=!($=Q=-1),I(),J()):SAEE_None},this.cleanup=function(){O(SAER_Playfield_gfxvidinfo.drawbuffer),O(SAER_Playfield_gfxvidinfo.tempbuffer),j()};var Q=-1,$=-1,ee=0;this.target_graphics_buffer_update=function(){var e,t;return t=R?(e=picasso96_state.Width>picasso_vidinfo.width?picasso96_state.Width:picasso_vidinfo.width,picasso96_state.Height>picasso_vidinfo.height?picasso96_state.Height:picasso_vidinfo.height):(t=SAER_Playfield_gfxvidinfo.drawbuffer.tempbufferinuse?SAER_Playfield_gfxvidinfo.tempbuffer:SAER_Playfield_gfxvidinfo.drawbuffer,e=(SAER_Playfield_gfxvidinfo.outbuffer=t).outwidth,t.outheight),(Q!=e||$!=t||ee!=R)&&(e&&t?(C.flags&v?u.texture=new n(e,t,SAER_Playfield_gfxvidinfo.drawbuffer.pixbytes):C.flags&y&&(u.surface=new o(e,t,4),u.surface.imageData=u.ctx.createImageData(e,t)),SAEF_log("video.target_graphics_buffer_update() Buffer size (%d*%d) %s",Q=e,$=t,(ee=R)?"RTG":"Native"),!0):(Q=e,$=t,ee=R,!1))},this.hideCursor=function(e){null!==u&&u.shown&&(u.canvas.style.cursor=e?"none":"auto")},this.screen=function(e){SAEC_info.video.requestFullScreen&&null!==u&&(e&&!u.fullscreen?document.myFullscreenEnabled&&u.canvas.myRequestFullscreen():!e&&u.fullscreen&&document.myExitFullscreen())},this.flush_line=function(e,t){},this.flush_block=function(e,t,n){};var te=!(this.flush_screen=function(e,t,n){});this.render_screen=function(e){return SAEV_config.video.enabled?(te=!1,C.flags&v?(i=u.ctx,n=(t=u.texture).width,0,r=t.height,2==SAER_Playfield_gfxvidinfo.drawbuffer.pixbytes?i.texImage2D(i.TEXTURE_2D,0,i.RGB,t.width,t.height,0,i.RGB,i.UNSIGNED_SHORT_5_6_5,new Uint16Array(t.data)):i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t.width,t.height,0,i.RGBA,i.UNSIGNED_BYTE,new Uint8Array(t.data)),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,n,0,0,r,0,r,n,0,n,r]),i.STATIC_DRAW),i.drawArrays(i.TRIANGLES,0,6),te=!0):C.flags&y&&((i=u.surface).imageData.data.set(new Uint8ClampedArray(i.data)),u.ctx.putImageData(i.imageData,0,0),te=!0),te):te=!0;var t,n,r,i},this.show_screen=function(e){te=(SAEV_config.video.enabled,!1)},this.show_screen_maybe=function(e){var t=SAEV_config.video.apmode[SAEV_Playfield_picasso_on?1:0];return(!t.gfx_vflip||0==t.gfx_vsyncmode||!t.gfx_vsync)&&(!!e&&(this.show_screen(0),!0))},this.lockscr=function(e,t){var n=!1;return SAEV_config.video.enabled&&null!==d&&(C.flags&v?(e.bufmem=u.texture.data,e.bufmem_pos=0,e.rowbytes=u.texture.rowbytes,SAER_Playfield_init_row_map(),n=null!==e.bufmem):C.flags&y&&((e=SAER_Playfield_gfxvidinfo.outbuffer).bufmem=u.surface.data,e.bufmem_pos=0,e.rowbytes=u.surface.rowbytes,SAER_Playfield_init_row_map(),n=null!==e.bufmem)),n},this.unlockscr=function(e){SAEV_config.video.enabled&&(C.flags&v||C.flags&y)&&(e.bufmem=null)}}const SAEC_GUI_LED_POWER=0,SAEC_GUI_LED_DF0=1,SAEC_GUI_LED_DF1=2,SAEC_GUI_LED_DF2=3,SAEC_GUI_LED_DF3=4,SAEC_GUI_LED_HD=5,SAEC_GUI_LED_FPS=7,SAEC_GUI_LED_CPU=8,SAEC_GUI_LED_MAX=11;function SAEO_GUI(){function e(){this.drive_side=0,this.drive_motor=[!1,!1,!1,!1],this.drive_track=[0,0,0,0],this.drive_writing=[!1,!1,!1,!1],this.drive_disabled=[!1,!1,!1,!1],this.df=["","","",""],this.crc32=[0,0,0,0],this.powerled=!1,this.powerled_brightness=0,this.hd=0,this.cd=0,this.md=0,this.cpu_halted=0,this.fps=0,this.fps_color=0,this.idle=0,this.sndbuf=0,this.sndbuf_status=0}var i=this.data=null;this.setup=function(){return this.data=new e,this.data.cd=-1,this.data.hd=-1,this.data.md=-1,SAEF_memset(i=new Array(SAEC_GUI_LED_MAX),0,0,SAEC_GUI_LED_MAX),SAEE_None},this.flicker_led2=function(e,t,n){if(e==SAEC_GUI_LED_HD){var r=this.data.hd;if(!(n<0))return 0==n&&r<0?(e==SAEC_GUI_LED_HD&&(this.data.hd=0),i[e]=0,void this.led(e,0,-1)):void(0==n&&(i[e]--,0<i[e])||(e==SAEC_GUI_LED_HD&&(this.data.hd=n),i[e]=6,r!=n&&this.led(e,n,-1)));r<0?this.led(e,-1,-1):this.led(e,0,-1)}},this.flicker_led=function(e,t,n){e<0?this.flicker_led2(SAEC_GUI_LED_HD,0,0):this.flicker_led2(e,t,n)},this.fps=function(e,t,n){this.data.fps=e,this.data.idle=t,this.data.fps_color=n,this.led(SAEC_GUI_LED_FPS,0,-1),this.led(SAEC_GUI_LED_CPU,0,-1)},this.led=function(e,t,n){var r=0;e>=SAEC_GUI_LED_DF0&&e<=SAEC_GUI_LED_DF3?(this.data.drive_writing[e-1]&&(r=1),SAEV_config.hook.led.df(e-1,this.data.drive_disabled[e-1],this.data.drive_track[e-1],this.data.drive_side,t?r?2:1:0)):e==SAEC_GUI_LED_POWER?SAEV_config.hook.led.power(t):e==SAEC_GUI_LED_HD?(1<t&&(r=1),SAEV_config.hook.led.hd(t?r?2:1:0)):e==SAEC_GUI_LED_FPS?(t=1,t=SAER.paused?0:1,SAEV_config.hook.led.fps(this.data.fps,SAER.paused)):e==SAEC_GUI_LED_CPU&&(t=SAER.paused?0:1,SAEV_config.hook.led.cpu(this.data.idle,SAER.paused))},this.led_string=function(e,t,n){var r=-1,i=0;e>=SAEC_GUI_LED_DF0&&e<=SAEC_GUI_LED_DF3?(r=e-SAEC_GUI_LED_DF0+6,this.data.drive_disabled[e-1]?drive_text[r]="":drive_text[r]=sprintf("%02d",this.data.drive_track[e-1]),this.data.drive_writing[e-1]&&(i=1),SAEV_config.hook.led.df(e-1,this.data.drive_disabled[e-1],this.data.drive_track[e-1],this.data.drive_side,t?i?2:1:0)):e==SAEC_GUI_LED_POWER?(r=3,drive_text[r]="Power",SAEV_config.hook.led.power(t)):e==SAEC_GUI_LED_HD?(r=4,drive_text[r]="HD",1<t&&(i=1),SAEV_config.hook.led.hd(t?i?2:1:0)):e==SAEC_GUI_LED_FPS?(i=this.data.fps,r=2,drive_text[r]=sprintf("FPS: %.1f",i),0<this.data.cpu_halted&&(drive_text[r]=sprintf("HALT%d",this.data.cpu_halted)),SAER.paused&&(drive_text[r]="PAUSED"),t=1,SAEV_config.hook.led.fps(this.data.fps,SAER.paused)):e==SAEC_GUI_LED_CPU&&(r=1,drive_text[r]="",this.data.cpu_halted<0?drive_text[r]="STOP":drive_text[r]=sprintf("%s: %.0f%%","CPU",this.data.idle),t=SAER.paused?0:1,SAEV_config.hook.led.cpu(this.data.idle,SAER.paused))}}var SAEV_Audio_vsynctimebase_orig=0,SAER_Audio_deactivate=null;function SAEO_Audio(){var n={context:null,processor:null,connected:!1};const r=16;var o={frames:0,buffer:null,readoffset:0,writeoffset:0,wait:!1};const i=4;var a={frames:0,buffer:null};var t,l=!1,s=!1,c=!1,_=0;function f(e,t){var n=e-t;return n>o.frames>>1?n=o.frames-e+t:n<-o.frames>>1&&(n=o.frames-t+e),n}this.update_sound=function(e){c&&(t=e*SAEC_Events_CYCLE_UNIT*1/_,x=t)};const u=1/32768;function d(e){var t;t=s||o.wait||0==F.currrent?F.frames:F.average.set(F.currrent),F.currrent=0,function(e,t){var n=f(o.writeoffset,o.readoffset+t);if(n<0){for(var r=0;r<SAEV_config.audio.channels;r++)for(var i=0;i<t;i++)e[r][i]=0;t-=-n}if(0<t){if(o.readoffset+t>o.frames){var a=o.frames-o.readoffset;if(a)for(r=0;r<SAEV_config.audio.channels;r++)e[r].set(o.buffer[r].subarray(o.readoffset,o.readoffset+a));if(t-a)for(r=0;r<SAEV_config.audio.channels;r++)e[r].set(o.buffer[r].subarray(0,t-a),a);o.readoffset=t-a}else{for(r=0;r<SAEV_config.audio.channels;r++)e[r].set(o.buffer[r].subarray(o.readoffset,o.readoffset+t));o.readoffset+=t}return}t<0&&SAEF_warn("audio.cacheread() empty %d",t)}(a.buffer,t),function(e,t,n){var r=SAEV_config.audio.channels,i=e.outputBuffer.length;if(l)for(var a=0;a<r;a++)for(var o=e.outputBuffer.getChannelData(a),s=0;s<i;s++)o[s]=0;else for(var c=n/i,a=0;a<r;a++)for(var o=e.outputBuffer.getChannelData(a),_=t[a],s=0,f=0;s<i;s++,f+=c)o[s]=_[f>>>0]*u}(e,a.buffer,t)}function e(e,t){!s&&c&&(function(e,t){var n=f(o.writeoffset,o.readoffset);if(!(n>o.frames>>2)){if(o.writeoffset+t>o.frames){var r=o.frames-o.writeoffset;if(r)for(var i=0;i<SAEV_config.audio.channels;i++)o.buffer[i].set(e[i].subarray(0,r),o.writeoffset);if(t-r)for(i=0;i<SAEV_config.audio.channels;i++)o.buffer[i].set(e[i].subarray(r,t-r+r));o.writeoffset=t-r}else{for(i=0;i<SAEV_config.audio.channels;i++)o.buffer[i].set(e[i].subarray(0,t),o.writeoffset);o.writeoffset+=t}return}SAEF_warn("audio.cachewrite() full %d",n+t)}(e,t),o.wait=!1)}function p(){n.context=null;try{var e=window.webkitAudioContext||window.AudioContext;n.context=new e,n.processor=n.context.createScriptProcessor(F.frames,SAEV_config.audio.channels,SAEV_config.audio.channels)}catch(e){return n.context&&n.context.close().then(function(){}),!1}if(_=SAEV_config.audio.freq==SAEC_Config_Audio_Freq_Auto?n.context.sampleRate:SAEV_config.audio.freq,null===o.buffer){o.frames=F.frames*r,o.buffer=new Array(2);for(var t=0;t<o.buffer.length;t++)o.buffer[t]=new Int16Array(o.frames)}if(null===a.buffer){a.frames=F.frames*i,a.buffer=new Array(2);for(t=0;t<a.buffer.length;t++)a.buffer[t]=new Int16Array(a.frames)}return n.connected||(n.processor.onaudioprocess=d,n.processor.connect(n.context.destination),n.connected=!0),c=!0,SAEF_info("sae.audio() %d channels, frequency %d/%d Hz, %d frames",SAEV_config.audio.channels,_,n.context.sampleRate,F.frames),!0}function E(){c&&(SAEF_log("audio.close_sound() initialised..."),n.connected&&(n.processor.disconnect(n.context.destination),n.processor.onaudioprocess=function(e){},n.connected=!1),n.context.close&&n.context.close().then(function(){n.context=null,SAEF_log("audio.close_sound() ...done")}),c=s=!1)}const A=SAEC_Events_CYCLE_MAX,S=4,m=SAEC_Events_CYCLE_MAX,h=4,g=32;function y(){this.enabled=!1,this.evtime=0,this.dmaenstore=!1,this.intreq2=!1,this.dr=!1,this.dsr=!1,this.pbufldl=!1,this.drhpos=0,this.dat_written=!1,this.lc=0,this.pt=0,this.current_sample=0,this.last_sample=0,this.state=0,this.per=0,this.vol=0,this.len=0,this.wlen=0,this.dat=0,this.dat2=0,this.sample_accum=0,this.sample_accum_time=0,this.ptx=0,this.ptx_written=!1,this.ptx_tofetch=!1,this.dmaofftime_active=!1,this.clr=function(){this.enabled=!1,this.evtime=0,this.dmaenstore=!1,this.intreq2=!1,this.dr=!1,this.dsr=!1,this.pbufldl=!1,this.drhpos=0,this.dat_written=!1,this.lc=this.pt=0,this.current_sample=0,this.last_sample=0,this.state=0,this.per=0,this.vol=0,this.len=0,this.wlen=0,this.dat=this.dat2=0,this.sample_accum=0,this.sample_accum_time=0,this.ptx=0,this.ptx_written=!1,this.ptx_tofetch=!1,this.dmaofftime_active=!1}}for(var v=new Array(4),b=0;b<4;b++)v[b]=new y;var C=h,k=0,R=function(){},w=null,x=0,D=0,M=0,F={frames:0,buffer:null,pointer:0,currrent:0,average:new SAEO_MAvg(10)},T=new Int16Array(h),V=new Int16Array(1024),I=new Int16Array(1024),P=0,z=0,O=0,L=0,N=0,B=!1,U=0,K=0,G=0;const H=1e-10;function X(){this.rc1=0,this.rc2=0,this.rc3=0,this.rc4=0,this.rc5=0,this.clr=function(){this.rc1=0,this.rc2=0,this.rc3=0,this.rc4=0,this.rc5=0}}for(var q=new Array(h),b=0;b<h;b++)q[b]=new X;var Z=0,j=0,Y=0;const W=0,J=1,Q=2;function $(e,t){var n,r,i;switch(K){case J:t.rc1=Z*e+(1-Z)*t.rc1+H,t.rc2=j*t.rc1+(1-j)*t.rc2,n=t.rc2,t.rc3=Y*n+(1-Y)*t.rc3,t.rc4=Y*t.rc3+(1-Y)*t.rc4,t.rc5=Y*t.rc4+(1-Y)*t.rc5,r=t.rc5;break;case Q:t.rc2=Y*(n=e)+(1-Y)*t.rc2+H,t.rc3=Y*t.rc2+(1-Y)*t.rc3,t.rc4=Y*t.rc3+(1-Y)*t.rc4,r=t.rc4;break;case W:default:return e}return 32767<(i=G?~~r:~~n)?i=32767:i<-32768&&(i=-32768),i}function ee(){F.pointer>=F.frames&&(F.pointer=0,e(F.buffer,F.frames))}function te(e){z?V[P]=e:F.buffer[1][F.pointer]=e}function ne(e){var t,n,r;z?(t=I[P]=e,n=V[P],r=I[P=P+1&O],n=~~((n*N+r*L)/g),r=V[P],e=~~((t*N+r*L)/g),F.buffer[1][F.pointer]=e,F.buffer[0][F.pointer]=n):F.buffer[0][F.pointer]=e}function re(e){for(var t=0;t<C;t++){var n=v[t],r=n.enabled?n.current_sample*n.vol:0;n.sample_accum+=r*e,n.sample_accum_time+=e}}function ie(e,t,n){for(var r=t,i=0;i<n;r++,i++)e[i]=v[r].sample_accum_time?Math.floor(v[r].sample_accum/v[r].sample_accum_time):0,v[r].sample_accum=0,v[r].sample_accum_time=0}function ae(){var e=v[0].enabled?v[0].current_sample*v[0].vol:0;e+=v[1].enabled?v[1].current_sample*v[1].vol:0,e+=v[2].enabled?v[2].current_sample*v[2].vol:0;e=e+=v[3].enabled?v[3].current_sample*v[3].vol:0;SAEV_config.audio.filter&&(e=$(e,q[0])),F.buffer[0][F.pointer++]=e,F.currrent++,ee()}function oe(){ie(T,0,h);var e=T[0]+T[3]+T[1]+T[2];SAEV_config.audio.filter&&(e=$(e,q[0])),F.buffer[0][F.pointer++]=e,F.currrent++,ee()}function se(){var e,t,n,r,i,a,o,s;v[0].enabled?(_=v[0].current_sample*v[0].vol,r=v[0].last_sample*v[0].vol):_=r=0,v[1].enabled?(e=v[1].current_sample*v[1].vol,i=v[1].last_sample*v[1].vol):e=i=0,v[2].enabled?(t=v[2].current_sample*v[2].vol,a=v[2].last_sample*v[2].vol):t=a=0,v[3].enabled?(n=v[3].current_sample*v[3].vol,o=v[3].last_sample*v[3].vol):n=o=0,c=v[0].per,_=_*(256-(s=~~((v[0].evtime%c<<8)/c)))+r*s>>8,c=v[1].per,_+=e*(256-(s=~~((v[1].evtime%c<<8)/c)))+i*s>>8,c=v[2].per,_+=t*(256-(s=~~((v[2].evtime%c<<8)/c)))+a*s>>8;var c=v[3].per,_=_+=n*(256-(s=~~((v[3].evtime%c<<8)/c)))+o*s>>8;SAEV_config.audio.filter&&(_=$(_,q[0])),F.buffer[0][F.pointer++]=_,F.currrent++,ee()}function ce(){var e,t,n,r,i,a,o;v[0].enabled?(l=v[0].current_sample*v[0].vol,r=v[0].last_sample*v[0].vol):l=r=0,v[1].enabled?(e=v[1].current_sample*v[1].vol,i=v[1].last_sample*v[1].vol):e=i=0,v[2].enabled?(t=v[2].current_sample*v[2].vol,a=v[2].last_sample*v[2].vol):t=a=0,v[3].enabled?(n=v[3].current_sample*v[3].vol,o=v[3].last_sample*v[3].vol):n=o=0;var s=3*x,c=v[0],_=c.per-c.evtime,f=~~((_<<12)/s),l=l*(f=c.evtime<x||s<=_?4096:f)+r*(4096-f)>>12;f=~~(((_=(c=v[1]).per-c.evtime)<<12)/s),e=e*(f=c.evtime<x||s<=_?4096:f)+i*(4096-f)>>12,f=~~(((_=(c=v[2]).per-c.evtime)<<12)/s),t=t*(f=c.evtime<x||s<=_?4096:f)+a*(4096-f)>>12,f=~~(((_=(c=v[3]).per-c.evtime)<<12)/s),l+=n=n*(f=c.evtime<x||s<=_?4096:f)+o*(4096-f)>>12;l=l+=e+=t;SAEV_config.audio.filter&&(l=$(l,q[0])),F.buffer[0][F.pointer++]=l,F.currrent++,ee()}function _e(){var e=v[0].enabled?v[0].current_sample*v[0].vol:0,t=v[1].enabled?v[1].current_sample*v[1].vol:0,n=v[2].enabled?v[2].current_sample*v[2].vol:0,r=v[3].enabled?v[3].current_sample*v[3].vol:0;t+=n,n=(e+=r)<<1,r=t<<1,SAEV_config.audio.filter&&(n=$(n,q[0]),r=$(r,q[1])),te(n),ne(r),F.pointer++,F.currrent++,ee()}function fe(){ie(T,0,h);var e=T[0]+T[3],t=T[1]+T[2];e<<=1,t<<=1,SAEV_config.audio.filter&&(e=$(e,q[0]),t=$(t,q[1])),te(e),ne(t),F.pointer++,F.currrent++,ee()}function le(){var e,t,n,r,i,a,o,s,c,_;v[0].enabled?(e=v[0].current_sample*v[0].vol,i=v[0].last_sample*v[0].vol):e=i=0,v[1].enabled?(t=v[1].current_sample*v[1].vol,a=v[1].last_sample*v[1].vol):t=a=0,v[2].enabled?(n=v[2].current_sample*v[2].vol,o=v[2].last_sample*v[2].vol):n=o=0,v[3].enabled?(r=v[3].current_sample*v[3].vol,s=v[3].last_sample*v[3].vol):r=s=0,c=v[0].per,e=e*(256-(_=~~((v[0].evtime%c<<8)/c)))+i*_>>8,c=v[1].per,t=t*(256-(_=~~((v[1].evtime%c<<8)/c)))+a*_>>8,c=v[2].per,t+=n*(256-(_=~~((v[2].evtime%c<<8)/c)))+o*_>>8,c=v[3].per,n=e+=r*(256-(_=~~((v[3].evtime%c<<8)/c)))+s*_>>8,n<<=1,r=t,r<<=1,SAEV_config.audio.filter&&(n=$(n,q[0]),r=$(r,q[1])),te(n),ne(r),F.pointer++,F.currrent++,ee()}function ue(){var e,t,n,r,i,a,o;v[0].enabled?(l=v[0].current_sample*v[0].vol,r=v[0].last_sample*v[0].vol):l=r=0,v[1].enabled?(e=v[1].current_sample*v[1].vol,i=v[1].last_sample*v[1].vol):e=i=0,v[2].enabled?(t=v[2].current_sample*v[2].vol,a=v[2].last_sample*v[2].vol):t=a=0,v[3].enabled?(n=v[3].current_sample*v[3].vol,o=v[3].last_sample*v[3].vol):n=o=0;var s=3*x,c=v[0],_=c.per-c.evtime,f=~~((_<<12)/s),l=l*(f=c.evtime<x||s<=_?4096:f)+r*(4096-f)>>12;f=~~(((_=(c=v[1]).per-c.evtime)<<12)/s),e=e*(f=c.evtime<x||s<=_?4096:f)+i*(4096-f)>>12,f=~~(((_=(c=v[2]).per-c.evtime)<<12)/s),t=t*(f=c.evtime<x||s<=_?4096:f)+a*(4096-f)>>12,f=~~(((_=(c=v[3]).per-c.evtime)<<12)/s),e+=t,t=l+=n=n*(f=c.evtime<x||s<=_?4096:f)+o*(4096-f)>>12,t<<=1,n=e,n<<=1,SAEV_config.audio.filter&&(t=$(t,q[0]),n=$(n,q[1])),te(t),ne(n),F.pointer++,F.currrent++,ee()}function de(e){e=v[e];e.state=0,e.evtime=A,e.intreq2=0,e.dmaenstore=!1,e.dmaofftime_active=!1}function pe(){var e=A;SAER_Events_eventtab[SAEC_Events_EV_AUDIO].active=!1,SAER_Events_eventtab[SAEC_Events_EV_AUDIO].oldcycles=SAEV_Events_currcycle;for(var t=0;t<C;t++){var n=v[t];n.evtime!=A&&e>n.evtime&&(e=n.evtime,SAER_Events_eventtab[SAEC_Events_EV_AUDIO].active=!0)}SAER_Events_eventtab[SAEC_Events_EV_AUDIO].evtime=SAEV_Events_currcycle+e}function Ee(){D=SAEV_Events_currcycle,M=x;for(var e=0;e<h;e++)de(e);pe(),SAER.events.schedule()}function Ae(){k=0,function(){for(var e=0;e<F.buffer.length;e++)SAEF_memset(F.buffer[e],0,0,F.frames);F.pointer=0,F.currrent=0}(),Ee()}function Se(){var e=!1;return 0==k&&(Ee(),e=o.wait=!0),k=4*SAER.playfield.get_maxvpos_nom()*50,e}function me(e){return 0!=(SAEV_Custom_intreq&128<<e)}function he(e){SAER.custom.INTREQ_0(SAEC_Custom_INTF_SETCLR|128<<e)}function ge(e,t){e=v[e];128&t&&(t-=256),e.last_sample=e.current_sample,e.current_sample=t}function ye(e){e=v[e];e.drhpos=SAER.events.current_hpos(),e.dr=!0,1==e.wlen&&(e.dsr=!0)}function ve(e,t){var n=v[e],r=SAEV_Custom_adkcon&1<<e,i=SAEV_Custom_adkcon&16<<e;r||t&&i?3<=e||(e=v[e+1],t&&i?0==n.dat?e.per=65536*SAEC_Events_CYCLE_UNIT:n.dat>S?e.per=n.dat*SAEC_Events_CYCLE_UNIT:e.per=S*SAEC_Events_CYCLE_UNIT:r&&(e.vol=n.dat,e.vol&=127,64<e.vol&&(e.vol=64))):n.dat2=n.dat}function be(e){var t=v[e];t.evtime=t.per,t.evtime<SAEC_Events_CYCLE_UNIT&&SAEF_error("audio.LOADPER%d bug %d",e,t.evtime)}function Ce(e,t){var n=v[e],r=0!=(SAEV_Custom_dmacon&SAEC_Custom_DMAF_DMAEN)&&0!=(SAEV_Custom_dmacon&1<<e),i=n.dmaenstore,a=SAEV_Custom_adkcon&1<<e,o=SAEV_Custom_adkcon&16<<e,s=!a&&!o||a,c=SAER.events.current_hpos();if(n.dmaenstore=r,SAEV_config.audio.mode!=SAEC_Config_Audio_Mode_Off)switch(Se(),2!=n.state&&3!=n.state||!B||(!r&&i&&(n.dmaofftime_active=!0),n.dmaofftime_active&&!i&&r&&(ge(e,255&n.dat2),de(e))),n.state){case 0:r?(n.evtime=A,n.state=1,n.dr=!0,n.drhpos=c,n.wlen=n.len,n.ptx_written=!1,2<n.wlen&&(n.ptx_tofetch=!0),n.dsr=!0):n.dat_written&&!me(e)?(n.state=2,he(e),ve(e,!1),B&&n.per<10*SAEC_Events_CYCLE_UNIT?(ge(e,255&n.dat2),de(e)):Ce(e,!(n.pbufldl=!0))):de(e);break;case 1:if(n.evtime=A,!r)return void de(e);if(!n.dat_written)return;he(e),ye(e),1!=n.wlen&&(n.wlen=n.wlen-1>>>0&65535),n.state=5;break;case 5:if(n.evtime=A,!r)return void de(e);if(!n.dat_written)return;n.ptx_written&&(n.ptx_written=0,n.lc=n.ptx),ve(e,!1),s&&ye(e),n.state=2,be(e),n.pbufldl=!0,n.intreq2=0,Ce(e,!1);break;case 2:if(n.pbufldl&&(ge(e,n.dat2>>8&255),be(e),n.pbufldl=!1),!t)return;o&&ve(e,!0),r?(o&&ye(e),n.intreq2&&o&&he(e)):o&&he(e),n.pbufldl=!0,Ce(e,!(n.state=3));break;case 3:if(n.pbufldl&&(ge(e,255&n.dat2),be(e),n.pbufldl=!1),!t)return;if(r)ve(e,!1),n.intreq2&&s&&he(e),s&&ye(e);else{if(me(e))return void de(e);ve(e,!1),s&&he(e)}n.intreq2=0,n.pbufldl=!0,Ce(e,!(n.state=2))}else de(e)}function ke(e,t){var n=v[e];e<h&&(Ce(e,t),n.dat_written=!1)}function Re(e,t){return e>>1<=t?1:(e=2*Math.PI*t/e,1/(1+1/(e=2*Math.tan(e/2))))}this.led_filter_audio=function(){((G=0)<U||SAER.gui.data.powerled&&0<=U)&&(G=1)},SAER_Audio_deactivate=Ae,this.getpt=function(e,t){var n=v[e],e=n.pt;return n.pt+=2,t&&(n.pt=n.lc),n.ptx_tofetch=!1,e},this.dmal=function(){for(var e=0,t=0;t<h;t++){var n=v[t];n.dr&&(e|=1<<2*t),n.dsr&&(e|=1<<2*t+1),n.dr=n.dsr=!1}return e},this.state_machine=function(){this.update();for(var e=0;e<h;e++){var t=v[e];Ce(e,!1),t.dat_written=!1}pe(),SAER.events.schedule()},this.obtain=function(){if(SAEV_config.audio.mode>=SAEC_Config_Audio_Mode_On){if(!SAEC_info.audio.webAudio)return SAEE_Audio_RequiresWebAudio;0}return SAEE_None},this.setup=function(){B=SAEV_config.cpu.model>=SAEC_Config_CPU_Model_68020||SAEV_config.cpu.speed!=SAEC_Config_CPU_Speed_Original,_=SAEC_Config_Audio_Freq_44100,F.frames=SAEV_config.audio.bufferFrames,F.buffer=new Array(2);for(var e=0;e<F.buffer.length;e++)F.buffer[e]=new Int16Array(F.frames);if(F.pointer=0,F.currrent=0,SAEV_config.audio.mode>=SAEC_Config_Audio_Mode_On&&(l=s=!1,!c&&!p()))return SAEE_Audio_RequiresWebAudio;M=x,D=SAEV_Events_currcycle;var t=3*SAEV_config.audio.stereoSeparation>>1;15<=t&&(t=16),L=(g>>1)-t,N=(g>>1)+t;var n=SAEV_config.audio.stereoDelay;switch(O=0<n?(1<<n)-1:0,(z=t<16||0<O)&&(SAEF_log("audio.setup() mixing enabled"),SAEF_memset(V,P=0,0,1024)),U=-1,K=0,SAEV_config.audio.filter&&(SAEV_config.audio.filter==SAEC_Config_Audio_Filter_On&&(U=1),SAEV_config.audio.filter==SAEC_Config_Audio_Filter_Emul&&(U=0),SAEV_config.audio.filterType==SAEC_Config_Audio_FilterType_A500?K=J:SAEV_config.audio.filterType==SAEC_Config_Audio_FilterType_A1200&&(K=Q)),Z=Re(_,6200),j=Re(_,2e4),Y=Re(_,7e3),this.led_filter_audio(),SAEV_config.audio.interpol){case SAEC_Config_Audio_Interpol_None:switch(SAEV_config.audio.channels){case SAEC_Config_Audio_Channels_Mono:R=ae;break;case SAEC_Config_Audio_Channels_Stereo:R=_e}break;case SAEC_Config_Audio_Interpol_Anti:switch(SAEV_config.audio.channels){case SAEC_Config_Audio_Channels_Mono:R=oe;break;case SAEC_Config_Audio_Channels_Stereo:R=fe}break;case SAEC_Config_Audio_Interpol_RH:switch(SAEV_config.audio.channels){case SAEC_Config_Audio_Channels_Mono:R=se;break;case SAEC_Config_Audio_Channels_Stereo:R=le}break;case SAEC_Config_Audio_Interpol_Crux:switch(SAEV_config.audio.channels){case SAEC_Config_Audio_Channels_Mono:R=ce;break;case SAEC_Config_Audio_Channels_Stereo:R=ue}}return w=null,SAEV_config.audio.interpol==SAEC_Config_Audio_Interpol_Anti&&(w=re),SAEV_config.audio.mode==SAEC_Config_Audio_Mode_Off?(SAER_Events_eventtab[SAEC_Events_EV_AUDIO].active=!1,SAER.events.schedule()):Se(),SAEE_None},this.cleanup=function(){E()},this.reset=function(){o.readoffset=0,o.writeoffset=0,o.wait=!0,F.average.clr();for(var e=0;e<q.length;e++)q[e].clr();for(e=0;e<4;e++){var t=v[e];t.clr(),t.per=m-1,t.vol=0,t.evtime=A}D=SAEV_Events_currcycle,M=x,pe(),SAER.events.schedule(),we=-1},this.pauseResume=function(e){e?!s&&c&&(SAEF_log("audio.pause_sound()"),s=!0):s&&c&&(SAEF_log("audio.resume_sound()"),s=!1,o.wait=!0)},this.mute=function(e){l=e};var we=-1;this.update_adkmasks=function(){var e=SAEV_Custom_adkcon|SAEV_Custom_adkcon>>4;v[0].enabled=0==(1&e),v[1].enabled=0==(2&e),v[2].enabled=0==(4&e),v[3].enabled=0==(8&e),(255&we)!=(255&SAEV_Custom_adkcon)&&(Se(),we=SAEV_Custom_adkcon)},this.update=function(){var e=0;if(SAEV_config.audio.mode!=SAEC_Config_Audio_Mode_Off&&0!=k){for(e=SAEV_Events_currcycle-D;0<e;){for(var t,n=e+1,r=0;r<C;r++)v[r].evtime!=A&&n>v[r].evtime&&(n=v[r].evtime);for(t=Math.round(M),SAEV_config.audio.mode>SAEC_Config_Audio_Mode_Off_Emul&&t<n&&(n=t),M-=n=e<n?e:n,SAEV_config.audio.mode>SAEC_Config_Audio_Mode_Off_Emul&&null!==w&&w(Math.floor(n*SAEC_Events_CYCLE_UNIT_INV)),r=0;r<C;r++)v[r].evtime!=A&&(v[r].evtime-=n);for(e-=n,SAEV_config.audio.mode>SAEC_Config_Audio_Mode_Off_Emul&&t==n&&(M+=x,R()),r=0;r<C;r++)0==v[r].evtime&&(ke(r,!0),0==v[r].evtime&&(SAEF_error("audio.update() evtime == 0 (channel %d)",r),v[r].evtime=A))}D=SAEV_Events_currcycle-e}else D=SAEV_Events_currcycle},this.handler=function(){this.update(),pe()},this.hsync=function(){0<k&&0==--k&&Ae(),this.update()},this.vsync=function(){},this.AUDxDAT=function(e,t){var n=v[e],r=0!=(SAEV_Custom_dmacon&SAEC_Custom_DMAF_DMAEN)&&0!=(SAEV_Custom_dmacon&1<<e);n.dat=t,n.dat_written=!0,2==n.state||3==n.state?r&&(1==n.wlen?(n.wlen=n.len,n.intreq2=!0):n.wlen=n.wlen-1>>>0&65535):(Se(),this.update(),ke(e,!1),pe(),SAER.events.schedule()),n.dat_written=!1},this.AUDxLCH=function(e,t){e=v[e];Se(),this.update(),t&=SAEV_config.chipset.mask==SAEC_Config_Chipset_Mask_OCS?7:31,B&&(e.ptx_tofetch&&1==e.state||e.ptx_written)?(e.ptx=e.lc,e.ptx_written=!0):e.lc=(t<<16|65535&e.lc)>>>0},this.AUDxLCL=function(e,t){e=v[e];Se(),this.update(),B&&(e.ptx_tofetch&&1==e.state||e.ptx_written)?(e.ptx=e.lc,e.ptx_written=!0):e.lc=(4294901760&e.lc|65534&t)>>>0},this.AUDxPER=function(e,t){e=v[e];Se(),this.update();t*=SAEC_Events_CYCLE_UNIT;(t=(t=0==t?m-1:t)<S*SAEC_Events_CYCLE_UNIT?S*SAEC_Events_CYCLE_UNIT:t)<60*SAEC_Events_CYCLE_UNIT&&e.dmaenstore&&(t=60*SAEC_Events_CYCLE_UNIT),e.per==m-1&&t!=m-1&&(e.evtime=SAEC_Events_CYCLE_UNIT,SAEV_config.audio.mode!=SAEC_Config_Audio_Mode_Off&&(pe(),SAER.events.schedule())),e.per=t},this.AUDxLEN=function(e,t){Se(),this.update(),v[e].len=t},this.AUDxVOL=function(e,t){64<(t&=127)&&(t=64),Se(),this.update(),v[e].vol=t}}var SAEV_CIA_bank=null;function SAEO_CIA(){const r=4;const l=(r+6)*SAEC_Events_CYCLE_UNIT>>1,i=3,a=2;var u=0,o=0,d=0,s=0,p=0,E=0,A=0,S=0,m=0,h=0,g=0,y=0,v=0,b=0,C=0,k=0,n=0,c=0,_=0,f=0,R=0,w=0,x=0,D=0,M=0,F=0,T=0,V=0,I=!1,t=!1,P=0,z=0,O=0,L=0,N=0,B=0,U=0,K=0,G=0,H=0,X=0,q=0,Z=0,j=0,Y=0,W=0,J=0,Q=0,$=0,ee=0,te=0,ne=0,re=0,ie=0,ae=0,oe=0,se=0;function ce(e){SAER.custom.INTREQ_0(SAEC_Custom_INTF_SETCLR|e)}function e(){u|=64,u|=32,ce(8)}function _e(){d|=64,d|=32,SAEV_config.chipset.compatible==SAEC_Config_Chipset_Compatible_A1000V?ce(8):ce(8192)}function fe(){u&o&&(128&u||(u|=128,e()))}function le(){d&s&&(128&d||(d|=128,_e()))}function ue(){var e,t=(SAEV_Events_currcycle-SAER_Events_eventtab[SAEC_Events_EV_CIA].oldcycles+re)/l>>>0;n=c=_=f=0,1==(33&p)&&(m<(e=t)?e-=m:e=0,SAEF_assert(e<=v+1),n=e),1==(97&E)&&(h<(e=t)?e-=h:e=0,SAEF_assert(e<=b+1),c=e),1==(33&A)&&(g<(e=t)?e-=g:e=0,SAEF_assert(e<=C+1),_=e),1==(97&S)&&(y<(e=t)?e-=y:e=0,SAEF_assert(e<=k+1),f=e)}function de(){var e,t,n,r,i,a,o,s,c,_,f,f=(n=SAEV_Events_currcycle-SAER_Events_eventtab[SAEC_Events_EV_CIA].oldcycles+re,r=n/l>>>0,f=_=c=s=o=a=i=0,re=n%l,1==(33&p)&&(e=!0,t=r,0<m&&(m<t?(t-=m,m=0):(m-=t,e=!1)),e&&(SAEF_assert(t<=v+1),v+1==t&&(64==(72&p)&&0<J&&0==--J&&(o=1),i=1,65!=(97&E)&&97!=(97&E)||0==b--&&(a=1)),v-=t)),1==(97&E)&&(e=!0,t=r,0<h&&(h<t?(t-=h,h=0):(h-=t,e=!1)),e&&(SAEF_assert(t<=b+1),b+1==t&&(a=1),b-=t)),1==(33&A)&&(e=!0,t=r,0<g&&(g<t?(t-=g,g=0):(g-=t,e=!1)),e&&(SAEF_assert(t<=C+1),C+1==t&&(64==(72&A)&&0<ne&&0==--ne&&(_=1),s=1,65!=(97&S)&&97!=(97&S)||0==k--&&(c=1)),C-=t)),1==(97&S)&&(e=!0,t=r,0<y&&(y<t?(t-=y,y=0):(y-=t,e=!1)),e&&(SAEF_assert(t<=k+1),k+1==t&&(c=1),k-=t)),i&&(u|=1,f=1,v=B,8&p&&(p&=-2)),a&&(u|=2,f=1,b=U,8&E&&(E&=-2)),o&&(u|=8,f=1),s&&(d|=1,f|=2,C=K,8&A&&(A&=-2)),c&&(d|=2,f|=2,k=G,8&S&&(S&=-2)),_&&(d|=8,f|=2),f);1&f&&fe(),2&f&&le()}function pe(){var e=-1,t=-1,n=-1,r=-1,i=l-re;SAER_Events_eventtab[SAEC_Events_EV_CIA].oldcycles=SAEV_Events_currcycle,1==(33&p)&&(e=i+l*(v+m)),1==(97&E)&&(t=i+l*(b+h)),1==(33&A)&&(n=i+l*(C+g)),1==(97&S)&&(r=i+l*(k+y)),SAER_Events_eventtab[SAEC_Events_EV_CIA].active=-1!=e||-1!=t||-1!=n||-1!=r,SAER_Events_eventtab[SAEC_Events_EV_CIA].active&&(i=SAEC_Events_CYCLE_MAX,-1!=e&&(i=e),-1!=t&&t<i&&(i=t),-1!=n&&n<i&&(i=n),-1!=r&&r<i&&(i=r),SAER_Events_eventtab[SAEC_Events_EV_CIA].evtime=SAEV_Events_currcycle+i),SAER.events.schedule()}function Ee(e,t,n){return e==t||SAEV_config.chipset.cia.todBug&&(n&&(!(4095&e)&&(e-1>>>0&16773120)==t))}function Ae(e,t){return(SAER.cpu.pc_in_rom()||0!=w||0!=F)&&(Ee(w,F,e)&&(t&&(d|=4,le()),1))}function Se(e){Ee(R,M,e)&&(u|=4,fe())}this.rethink=function(){64&u&&e(),64&d&&_e()},this.handler=function(){de(),pe()},this.parallelack=function(){u|=16,fe()},this.diskindex=function(){d|=16,le()};var me=0,he=0,ge=0,ye=0,ve=0;function be(){var e={};SAEF_gettimeofday(e,null),me=1e6*e.tv_sec+e.tv_usec,he=R,ve=0}var Ce=0,ke=0;function Re(e){oe=255&~(e<<1|e>>7)}function we(){W=oe,ae=8*SAER.playfield.get_maxvpos()*8,u|=8,fe()}var xe=0,De=0;const Me=14*(r+6)>>1;function Fe(e){De=3,X&&(w++,w&=16777215,Ae(!0,e))}function Te(e){2==De&&Fe(!0)}function Ve(){var e;1==De&&X&&(e=SAER.events.current_hpos(),0<=(e-=xe)||SAEV_config.cpu.speed<0?Fe(!0):(De=2,SAER.events.event2_newevent_xx(-1,-e,0,Te)))}this.b_tod_handler=function(e){X&&(xe=e+Me,Ee(w+(De=1)&16777215,F,!0)&&(De=2,SAER.events.event2_newevent_xx(-1,xe,0,Te)))};function Ie(e){var t=SAEV_Events_currcycle,n=(t-L)*SAEC_Events_CYCLE_UNIT_INV>>>0;e?z+=n:O+=n,L=t}function Pe(e){R++,R&=16777215,Se(!0)}function ze(){var e=q,e=2&(e|=~j)?0:1;e!=t&&(Ie(t),t=e,P=-1)}function Oe(){var e=q;ze(),SAEV_config.chipset.cia.overlay&&(1&e)!=I&&((I=1&e)?SAER.memory.mapOverlay(!1):SAER.memory.mapOverlay(!0))}function Le(e){if(SAEV_config.chipset.cia.type6526){for(var t=0,n=0;n<4;n++)4294967295<(t*=16)&&(t-=4294967296),4294967295<(t+=e%10)&&(t-=4294967296),e=e/10>>>0;return t}return e}function Ne(e){for(var t=0,n=0;n<4;n++)4294967295<(t*=10)&&(t-=4294967296),4294967295<(t+=e/16>>>0)&&(t-=4294967296),e=e/16>>>0;return t}function Be(e){R=SAEV_config.chipset.cia.type6526?Ne(e):e}function Ue(e){M=SAEV_config.chipset.cia.type6526?Ne(e):e}function Ke(e){w=SAEV_config.chipset.cia.type6526?Ne(e):e}function Ge(e){F=SAEV_config.chipset.cia.type6526?Ne(e):e}function He(e){e&=15;switch(ue(),e){case 0:return t=60&SAER.disk.status_ciaa(),t|=SAER.input.handle_joystick_buttons(q,j),t|=3&(q|3^j);case 1:var t=SAEV_config.parallel.enabled?SAER.parallel.direct_read_data():Z&Y|255^Y;return 2&E&&(t&=-129,t|=(4&E?1&E:0)?128:0),2&p&&(t&=-65,t|=(4&p?1&p:0)?64:0),t;case 2:return j;case 3:return Y;case 4:return v-n&255;case 5:return v-n>>>8&255;case 6:return b-c&255;case 7:return b-c>>>8&255;case 8:return T?(T=0,255&Le(x)):255&Le(R);case 9:return T?Le(x)>>>8&255:Le(R)>>>8&255;case 10:return SAEV_config.chipset.cia.type6526?T?Le(x)>>>16&255:Le(R)>>>16&255:(T||(128&E||(T=1),x=R),Le(x)>>>16&255);case 11:if(SAEV_config.chipset.cia.type6526)return T||(128&E||(T=1),x=R),T?Le(x)>>>24:Le(R)>>>24;break;case 12:return W;case 13:return t=-97&u,u=0,t;case 14:return p;case 15:return E}return 0}function Xe(e){var t=15&e;switch(ue(),t){case 0:return n=0,SAEV_config.serial.enabled&&(n=SAER.serial.readstatus($)),SAEV_config.parallel.enabled&&(n|=7&SAER.parallel.direct_read_status()),n=SAER.dongle.cia_read(1,t,n);case 1:var n=Q;return n=SAER.disk.status_ciab(n),2&S&&(n&=-129,n|=(4&S?1&S:0)?128:0),2&A&&(n&=-65,n|=(4&A?1&A:0)?64:0),n;case 2:return $;case 3:return ee;case 4:return C-_&255;case 5:return C-_>>>8&255;case 6:return k-f&255;case 7:return k-f>>>8&255;case 8:return Ve(),V?(V=0,255&Le(D)):255&Le(w);case 9:return Ve(),V?Le(D)>>>8&255:Le(w)>>>8&255;case 10:return Ve(),SAEV_config.chipset.cia.type6526?V?Le(D)>>>16&255:Le(w)>>>16&255:(V||(128&S||(V=1),D=w),Le(D)>>>16&255);case 11:if(SAEV_config.chipset.cia.type6526)return V||(128&S||(V=1),D=w),V?Le(D)>>>24:Le(w)>>>24;break;case 12:return te;case 13:return n=-97&d,d=0,n;case 14:return A;case 15:return S}return 0}function qe(e,t){var n=15&e;switch(!SAEV_config.chipset.cia.overlay&&I&&(SAER.memory.mapOverlay(!0),I=0),n){case 0:q=-196&q|195&t,Oe(),SAER.dongle.cia_write(0,n,t),0<SAEV_config.memory.amaxRom.size&&SAER.disk.amax_bfe001_write(t,j);break;case 1:Z=t,SAEV_config.parallel.enabled&&SAER.parallel.direct_write_data(Z,Y);break;case 2:j=t,Oe();break;case 3:Y=t;break;case 4:de(),B=65280&B|t,pe();break;case 5:de(),B=255&B|t<<8,0==(1&p)&&(v=B),8&p&&(v=B,p|=1,m=i),pe();break;case 6:de(),U=65280&U|t,pe();break;case 7:de(),U=255&U|t<<8,0==(1&E)&&(b=U),8&E&&(b=U,E|=1,h=i),pe();break;case 8:128&E?Ue((4294967040&Le(M)|t)>>>0):(Be((4294967040&Le(R)|t)>>>0),Se(!(H=1)));break;case 9:128&E?Ue((4294902015&Le(M)|t<<8)>>>0):Be((4294902015&Le(R)|t<<8)>>>0);break;case 10:128&E?Ue((4278255615&Le(M)|t<<16)>>>0):(Be((4278255615&Le(R)|t<<16)>>>0),SAEV_config.chipset.cia.type6526||(H=0));break;case 11:SAEV_config.chipset.cia.type6526&&(128&E?Ue((16777215&Le(M)|t<<24)>>>0):(Be((16777215&Le(R)|t<<24)>>>0),H=0));break;case 12:de(),W=t,65==(65&p)&&0==J&&(J=16),pe();break;case 13:128&t?o|=127&t:o&=~t,fe();break;case 14:de(),1&(t&=127)&&!(1&p)&&(m=a),0==(64&t)&&0!=(64&p)&&(ae=0),16&(p=t)&&(p&=-17,v=B),pe();break;case 15:de(),1&t&&!(1&E)&&(h=a),16&(E=t)&&(E&=-17,b=U),pe()}}function Ze(e,t){var n=15&e;switch(n){case 0:SAER.dongle.cia_write(1,n,t),N=t,SAEV_config.serial.enabled&&SAER.serial.writestatus(N,$),SAEV_config.parallel.enabled&&SAER.parallel.direct_write_status(N,$);break;case 1:Q=t,SAER.disk.select(t);break;case 2:$=t,SAEV_config.serial.enabled&&SAER.serial.writestatus(N,$);break;case 3:ee=t;break;case 4:de(),K=65280&K|t,pe();break;case 5:de(),K=255&K|t<<8,0==(1&A)&&(C=K),8&A&&(C=K,A|=1,g=i),pe();break;case 6:de(),G=65280&G|t,pe();break;case 7:de(),G=255&G|t<<8,0==(1&S)&&(k=G),8&S&&(k=G,S|=1,y=i),pe();break;case 8:Ve(),128&S?Ge((4294967040&Le(F)|t)>>>0):(Ke((4294967040&Le(w)|t)>>>0),Ae(!(X=1),!0));break;case 9:Ve(),128&S?Ge((4294902015&Le(F)|t<<8)>>>0):Ke((4294902015&Le(w)|t<<8)>>>0);break;case 10:Ve(),128&S?Ge((4278255615&Le(F)|t<<16)>>>0):(Ke((4278255615&Le(w)|t<<16)>>>0),SAEV_config.chipset.cia.type6526||(X=0));break;case 11:SAEV_config.chipset.cia.type6526&&(Ve(),128&S?Ge((16777215&Le(F)|t<<24)>>>0):(Ke((16777215&Le(w)|t<<24)>>>0),X=0));break;case 12:de(),te=t,0==(64&A)&&(ne=0),65==(65&A)&&0==ne&&(ne=16),pe();break;case 13:128&t?s|=127&t:s&=~t,le();break;case 14:de(),1&(t&=127)&&!(1&A)&&(g=a),16&(A=t)&&(A&=-17,C=K),pe();break;case 15:de(),1&t&&!(1&S)&&(y=a),16&(S=t)&&(S&=-17,k=G),pe()}}function je(){return SAEV_config.chipset.ide||SAEV_config.chipset.pcmcia||SAEV_config.chipset.mbdmac}function Ye(e){e&=61440;return 57344==e||53248==e}function We(e){return!SAEV_config.chipset.ide&&!SAEV_config.chipset.pcmcia||Ye(e)}function Je(e){return!Ye(e)&&0<=SAEV_config.chipset.fatGaryRev}function Qe(){var e,t=(SAEV_Events_currcycle-SAER_Events_eventtab[SAEC_Events_EV_CIA].oldcycles)%l,n=l*r/10>>>0;n<=t?(e=l-t,e+=n):e=t?l+n-t:n-t,e&&SAER.events.do_cycles(e)}function $e(){var e;SAER.events.do_cycles(6*SAEC_Events_CYCLE_UNIT>>1),se&&(e=se,se=0,1&e&&ce(8),2&e&&ce(8192))}function et(e){var t=(3840&e)>>8,n=65535;if(Je(e))return SAER.memory.dummyGet(e,2,!1,0);if(!We(e))return n;switch(e>>12&3){case 0:je()||(Qe(),n=Xe(t)<<8|He(t),$e());break;case 1:Qe(),n=Xe(t)<<8|255,$e();break;case 2:Qe(),n=65280|He(t),$e();break;case 3:SAEV_config.cpu.model==SAEC_Config_CPU_Model_68000&&SAEV_config.cpu.compatible&&(Qe(),n=SAER_CPU_regs.irc,$e())}return n}function tt(e){return(et(e)<<16|et(e+2))>>>0}function nt(e,t){var n=(3840&e)>>8;Je(e)?SAER.memory.dummyPut(e,2,0):We(e)&&(je()&&0==(12288&e)||(Qe(),0==(8192&e)&&Ze(n,t>>8),0==(4096&e)&&qe(n,255&t),$e()))}this.hsync_post=function(e){1==De&&Fe(!1),De=0,SAEV_config.chipset.cia.todHack&&H&&function(e){var t,n=!1;if(0!=ge)if(ge<0)ge=156e3;else if(1<ge)1==--ge&&(SAEF_log("cia.do_tod_hack() enabled"),be());else if(SAEV_config.chipset.cia.tod==SAEC_Config_Chipset_CIA_TOD_VSync?49<=(t=59<=(t=Math.floor(SAER.playfield.get_vblank_hz()+.5))&&t<=61?60:t)&&t<=51&&(t=50):t=SAEV_config.chipset.cia.tod==SAEC_Config_Chipset_CIA_TOD_50Hz?50:60,!(t<=0)&&(t==ke&&(4095&R)==(4095&he)||(SAEF_log("cia.do_tod_hack() reset"),be(),ke=t,n=!0),e||SAEV_config.chipset.cia.tod!=SAEC_Config_Chipset_CIA_TOD_VSync)){if(0<ye){if(0<--ye)return;ye=50}var r={};SAEF_gettimeofday(r,null);e=1e6/t>>>0;e<=1e6*r.tv_sec+r.tv_usec-me&&(me+=e,me+=(ve+=1e6-e*t)/t>>>0,ve%=t,n=!0),n&&(R++,he=R&=16777215,Se(!1))}}(e),0==(15&SAEV_Events_hsync_counter)&&function(){if((SAER.input.keyboard.keysAvail()||ie<3)&&!ae){switch(ie){case 0:oe=0,ie++;break;case 1:Re(253),ie++;break;case 2:Re(254),ie++;break;case 3:oe=255&~SAER.input.keyboard.nextKey()}we()}}()},this.vsync=function(){var e;0<Ce&&Ce--,SAEV_RTC_delayed_write<0?SAEV_RTC_delayed_write=50:0<SAEV_RTC_delayed_write&&0==--SAEV_RTC_delayed_write&&SAER.rtc.write(),Ie(t),(e=z&&!O?255:O&&!z?0:O?~~(255*z/(z+O)):255)<0?e=0:255<e&&(e=255),O=z=0,SAER.gui.data.powerled_brightness=e,P!=SAER.gui.data.powerled_brightness&&(SAER.gui.data.powerled=127<SAER.gui.data.powerled_brightness,SAER.gui.led(SAEC_GUI_LED_POWER,SAER.gui.data.powerled,SAER.gui.data.powerled_brightness),SAER.audio.led_filter_audio()),P=e,L=SAEV_Events_currcycle,this.handler(),0<ae&&(ae-=SAER.playfield.get_maxvpos())<=0&&(ae=0,we())},this.a_tod_inc=function(e){SAEV_config.chipset.cia.todHack&&1==ge||H&&SAER.events.event2_newevent_xx(-1,e+Me,0,Pe)},this.reset=function(){ge=me=0,SAEV_config.chipset.cia.todHack&&(ge=156e3),I=!(De=Ce=ae=0),T=V=ie=0,R=w=j=q=0,H=X=0,u=d=o=s=0,p=E=A=S=4,B=U=K=G=v=b=C=k=65535,M=F=0,N=140,n=c=_=f=te=ne=W=J=re=$=0,pe(),SAER.disk.select_set(Q),SAER.memory.mapOverlay(!1),ze(),SAEV_config.serial.enabled&&SAER.serial.dtr_off()},this.dump=function(){SAEF_log("cia.dump() A: CRA %02x CRB %02x ICR %02x IM %02x TA %04x (%04x) TB %04x (%04x)",p,E,u,o,v,B,b,U),SAEF_log("cia.dump() TOD %06x (%06x) ALARM %06x %c%c CYC=%08X",R,x,M,T?"L":" ",H?" ":"S",SAEV_Events_currcycle),SAEF_log("cia.dump() B: CRA %02x CRB %02x ICR %02x IM %02x TA %04x (%04x) TB %04x (%04x)",A,S,d,s,C,K,k,G),SAEF_log("cia.dump() TOD %06x (%06x) ALARM %06x %c%c CLK=%d",w,D,F,V?"L":" ",X?" ":"S",re/SAEC_Events_CYCLE_UNIT)},SAEV_CIA_bank=new SAEO_Memory_addrbank(tt,et,function(e){var t=(3840&e)>>8,n=255;if(Je(e))return SAER.memory.dummyGet(e,1,!1,0);if(!We(e))return n;switch(e>>12&3){case 0:je()||(Qe(),n=(1&e?He:Xe)(t),$e());break;case 1:Qe(),n=SAEV_config.cpu.model==SAEC_Config_CPU_Model_68000&&SAEV_config.cpu.compatible?1&e?255&SAER_CPU_regs.irc:Xe(t):1&e?255:Xe(t),$e();break;case 2:Qe(),n=SAEV_config.cpu.model==SAEC_Config_CPU_Model_68000&&SAEV_config.cpu.compatible?1&e?He(t):SAER_CPU_regs.irc>>8:1&e?He(t):255,$e();break;case 3:SAEV_config.cpu.model==SAEC_Config_CPU_Model_68000&&SAEV_config.cpu.compatible&&(Qe(),n=1&e?255&SAER_CPU_regs.irc:SAER_CPU_regs.irc>>8,$e())}return n},function(e,t){nt(e,t>>>16),nt(e+2,65535&t)},nt,function(e,t){var n=(3840&e)>>8;Je(e)?SAER.memory.dummyPut(e,1,0):We(e)&&(je()&&0==(12288&e)||(Qe(),0==(8192&e)&&Ze(n,t),0==(4096&e)&&qe(n,t),$e()))},SAEF_Memory_defaultXLate,SAEF_Memory_defaultCheck,null,null,"CIA",function(e){return(SAEV_config.cpu.model>=SAEC_Config_CPU_Model_68020?SAEF_Memory_dummyGetInst32:tt)(e)},function(e){return(SAEV_config.cpu.model>=SAEC_Config_CPU_Model_68020?SAEF_Memory_dummyGetInst16:et)(e)},SAEC_Memory_addrbank_flag_IO|SAEC_Memory_addrbank_flag_CIA,null,16129,12566528)}const SAEC_Disk_Create_Mode_Normal=1,SAEC_Disk_Create_Mode_Custom=2,SAEC_Disk_Create_Type_35_DD=1,SAEC_Disk_Create_Type_35_HD=2,SAEC_Disk_Create_Type_35_DD_PC=3,SAEC_Disk_Create_Type_35_HD_PC=4,SAEC_Disk_Create_Type_525_SD=5;function SAEO_DiskInfo(){this.diskname="",this.hd=!1,this.crc32=0,this.bootblock=new Uint8Array(1024),this.bootblockChecksum=!1,this.bootblockChecksumValid=!1,this.bootblockType=0,this.unreadable=!1,this.clr=function(){this.diskname="",this.hd=!1,this.crc32=0,SAEF_memset(this.bootblock,0,0,1024),this.bootblockChecksum=0,this.bootblockChecksumValid=!1,this.bootblockType=0,this.unreadable=!1}}function SAEO_Disk(){const p=0,s=0,d=0,i=14336;function b(){return SAEV_config.chipset.ntsc?6399:6334}function E(){return SAEV_config.chipset.ntsc?415:350}const n=2,C=11*n,A=4,r=140*SAEC_Events_CYCLE_UNIT;var k=0,c=0,a=0,S=15,f=0,o=0,R=new Uint8Array(544*C),_=0;const l=1,u=2,m=4,h=18,g=24,t=11,y=0;const v=2,w=3;var x=0,D=0,M=0,F=0,T=0,V=0,I=!1,P=new Uint16Array(3),z=new Int8Array(3),O=0,L=0,N=0,B=0,U=0,K=0,G=0,H=0,X=0,q=0,Z=!1,j=0,Y=0,W=0,J=0,Q=!1,$=0,ee=["","","",""];const te=166,ne=0,re=1,ie=2,ae=3,oe=4,se=5;function ce(){this.len=0,this.offs=0,this.bitlen=0,this.track=0,this.sync=0,this.type=se,this.revolutions=0}const _e=0,fe=4294967295,le=2863311530,ue=1431655765,de=-1,pe=0,Ee=1,Ae=2,Se=5,me=7,he=8,ge=9;function e(e){this.num=e,this.diskfile=null,this.writediskfile=null,this.pcdecodedfile=null,this.filetype=de,this.trackdata=new Array(te),this.writetrackdata=new Array(te);for(var t=0;t<te;t++)this.trackdata[t]=new ce,this.writetrackdata[t]=new ce;this.buffered_cyl=0,this.buffered_side=0,this.cyl=0,this.motoroff=!1,this.motordelay=0,this.state=!1,this.wrprot=!1,this.forcedwrprot=!1,this.bigmfmbuf=new Uint16Array(16384*n),this.tracktiming=new Uint16Array(16384*n),this.multi_revolution=0,this.revolution_check=0,this.skipoffset=0,this.mfmpos=0,this.indexoffset=0,this.tracklen=0,this.revolutions=0,this.prevtracklen=0,this.trackspeed=0,this.num_tracks=0,this.write_num_tracks=0,this.num_secs=0,this.num_heads=0,this.hard_num_cyls=0,this.dskeject=!1,this.dskchange=!1,this.dskchange_time=0,this.dskchange_request=!1,this.dskready=!1,this.dskready_up_time=0,this.dskready_down_time=0,this.writtento=0,this.steplimit=0,this.steplimitcycle=0,this.indexhack=!1,this.indexhackmode=0,this.ddhd=0,this.drive_id_scnt=0,this.idbit=0,this.drive_id=0,this.newfile=null,this.crc32=0,this.useturbo=0,this.floppybitcounter=0,this.amax=!1,this.lastdataacesstrack=0,this.lastrev=0,this.track_access_done=!1}for(var ye=new Array(A),ve=0;ve<A;ve++)ye[ve]=new e(ve);var be=new Uint16Array(16384*n);const Ce=[3,2,4,5,7,6,0,1],ke=[14,12,2,10,15,13,1,0,7,6,5,4,8,9,11,3];var Re=0,we=null,xe=0,De=0,Me=0,Fe=0,Te=0,Ve=0,Ie=0,Pe=!1;const ze=0;function Oe(){2&Fe&&(Re&&0<ze&&SAEF_log("disk.amax_check() counter reset PC=%08x",SAER_CPU_getPC()),Re=0,Pe=!1)}function Le(e){for(var t=0;t<16;t++)!Ie||32768&e||(Re++,0<ze&&SAEF_log("disk.amax_diskwrite() counter increase %d PC=%08x",Re,SAER_CPU_getPC())),Ie=32768&e?1:0,e=e<<1&65535;Re&=xe-1,Oe()}function Ne(e,t,n){!((Fe=e)&(Ve=1<<n+3))&&t&Ve&&(Pe=!0,function(){for(var e=255,t=0,n=0;n<16;n++)Re&1<<n&&(t|=1<<ke[n]);if(De<0)Me=e;else{for(e=we[2*t+De],n=val=0;n<8;n++)e&1<<Ce[n]&&(val|=1<<n);Me=val}0<ze&&SAEF_log("disk.amax_load_byte() amax_rom=%d addr=%06x (%06x) data=%02x (%02x) PC=%08x",De,Re,t,e,val,SAER_CPU_getPC())}()),Oe()}function Be(){var e;0!=SAEV_config.memory.amaxRom.size&&(Me=255,Ve=Ie=Te=De=Re=0,(we=null)!==(e=SAEF_ZFile_fopen_file(SAEV_config.memory.amaxRom))?(SAEF_ZFile_fseek(e,0,SEEK_END),xe=SAEF_ZFile_ftell(e),SAEF_ZFile_fseek(e,0,SEEK_SET)):(SAEF_log("disk.amax_init() failed to load rom"),xe=262144),we=new Uint8Array(xe),null!==e&&(SAEF_ZFile_fread(we,0,xe,1,e),SAEF_ZFile_fclose(e)),SAEF_log("disk.amax_init() loaded %d bytes (%dK ROM)",xe,xe>>10))}this.amax_bfe001_write=function(e,t){e&=t;4&e&&!(4&Te)&&(Me=255&(Me<<1|1),0<ze&&SAEF_log("disk.amax_bfe001_write() data shifted")),De=24!=(24&e)?16&e?0:1:-1,Te=e,Oe()};const Ue=5,Ke=0;const Ge=2;function He(e){this.num=e,this.zf=null,this.track=0,this.dat=null,this.dat8=null,this.dat16=null,this.datsz=0,this.revs=0,this.dat_idx=0,this.index_pos=0,this.nr_index=0,this.index_off=new Uint32Array(Ue),this.latency=0,this.pll_mode=0,this.flux=0,this.clock=0,this.clock_centre=0,this.clocked_zeros=0,this.clr=function(){this.zf=null,this.track=0,this.dat16=null,this.dat8=null,this.dat=null,this.datsz=0,this.revs=0,this.dat_idx=0,this.index_pos=0,this.nr_index=0,this.index_off=new Uint32Array(Ue),this.latency=0,this.pll_mode=0,this.flux=0,this.clock=0,this.clock_centre=0,this.clocked_zeros=0}}for(var Xe=new Array(4),ve=0;ve<4;ve++)Xe[ve]=new He(-1);const qe=2e3,Ze=10;const je=25;function Ye(e){e=Xe[e];e.revs&&e.clr()}function We(e){for(var t,n;e.flux<Math.truncate(e.clock/2);){if(-1==(t=function(e){for(var t=0;;){if(e.dat_idx>=e.index_pos){var n=e.nr_index++%e.revs;return e.index_pos=e.index_off[n],e.dat_idx=n?e.index_off[n-1]:0,-1}n=SAEF_be16toh(e.dat16[e.dat_idx++]);if(0!=n){4294967295<(t+=n)&&(t-=4294967296);break}4294967295<(t+=65536)&&(t-=4294967296)}for(var r=t*je;4294967295<r;)r-=4294967296;return 2147483648&r?r-4294967296:r}(e)))return-1;e.flux+=t,e.clocked_zeros=0}return e.latency+=e.clock,e.flux-=e.clock,e.flux>=Math.truncate(e.clock/2)?(e.clocked_zeros++,0):(e.pll_mode!=Ke?(1<=e.clocked_zeros&&e.clocked_zeros<=3?(n=Math.truncate(e.flux/(e.clocked_zeros+1)),e.clock+=Math.truncate(n/10)):e.clock+=Math.truncate((e.clock_centre-e.clock)/10),e.clock=Math.max((n=e.clock_centre,Math.truncate(n*(100-Ze)/100)),Math.min((n=e.clock_centre,Math.truncate(n*(100+Ze)/100)),e.clock))):e.clock=e.clock_centre,t=e.pll_mode==Ge?Math.truncate(e.flux/2):0,e.latency+=e.flux-t,e.flux=t,1)}function Je(e,t,n){for(var r,i,a,o,s=Xe[t],c=s.latency=r=0;-1!=(o=We(s));c++)0==(15&c)&&(e[c>>4]=0),o&&(e[c>>4]|=32768>>(15&c)),7==(7&c)&&(n[c>>3]=s.latency-r,r=s.latency);for(7&c&&(n[c>>3]=Math.floor(8*(s.latency-r)/(7&c))),i=Math.floor(r/(c>>3)),a=0;a<c+7>>3;a++)n[a]=Math.floor(1e3*n[a]/i);ye[t].tracklen=c}function Qe(){var e=SAEV_config.floppy.speed;return e<=10&&(e=100),Math.floor(100*(SAEV_config.chipset.ntsc?1812:1829)/e)}function $e(e){e=Math.truncate(Qe()*e.tracklen/(2*b()*e.ddhd*8));return e=e<=0?1:e}function et(e){switch(e.drive_id){case le:return"3.5HD";case ue:return"5.25SD";case fe:return"3.5DD";case _e:return"NONE"}return"UNKNOWN"}function tt(e){switch(SAEV_config.floppy.drive[e.num].type){case SAEC_Config_Floppy_Type_35_HD:null===e.diskfile||e.ddhd<=1?e.drive_id=fe:e.drive_id=le;break;case SAEC_Config_Floppy_Type_35_DD_ESCOM:case SAEC_Config_Floppy_Type_35_DD:default:e.drive_id=fe;break;case SAEC_Config_Floppy_Type_525_SD:e.drive_id=ue;break;case SAEC_Config_Floppy_Type_None:case SAEC_Config_Floppy_Type_35_DD_PC:case SAEC_Config_Floppy_Type_35_HD_PC:e.drive_id=_e}s&&SAEF_log("disk.drive_settype_id() DF%d: set to %s",e.num,et(e))}function nt(e){e.filetype===Se&&Ye(e.num),e.filetype=de,SAEF_ZFile_fclose(e.diskfile),e.diskfile=null,e.writediskfile=null,e.pcdecodedfile=null}function rt(e,t){var n=ye[e],r=x==w&&n.state&&!((S|f)&1<<e),i=SAER.gui.data;!t&&n.state==i.drive_motor[e]&&n.cyl==i.drive_track[e]&&k==i.drive_side&&n.crc32==i.crc32[e]&&r==i.drive_writing[e]&&i.df[e]==SAEV_config.floppy.drive[e].file.name||(i.df[e]=SAEV_config.floppy.drive[e].file.name,i.crc32[e]=n.crc32,i.drive_motor[e]=n.state,i.drive_track[e]=n.cyl,i.drive_side=o&1<<e?a:k,i.drive_writing[e]=r,SAER.gui.led(e+SAEC_GUI_LED_DF0,(i.drive_motor[e]?1:0)|(i.drive_writing[e]?2:0),-1))}function it(e){var t,n,r=ye[e];r.amax=!1,nt(r),r.motoroff=!0,r.idbit=0,r.drive_id=0,r.drive_id_scnt=0,r.lastdataacesstrack=-1,f&=~(1<<e),(SAEV_config.floppy.drive[e].type<=SAEC_Config_Floppy_Type_None||SAEV_config.floppy.drive[e].type>=SAEC_Config_Floppy_Type_35_DD_PC)&&(f|=1<<e),o&=~(1<<e),SAEV_config.floppy.drive[e].type>=SAEC_Config_Floppy_Type_35_DD_PC&&(o|=1<<e),t=e,(n=SAER.gui.data).df[t]="",n.crc32[t]=0,n.drive_disabled[t]=!1,SAEV_config.floppy.drive[t].type<=SAEC_Config_Floppy_Type_None&&(n.drive_disabled[t]=!0),(r.indexhackmode=0)==e&&SAEV_config.floppy.drive[e].type==SAEC_Config_Floppy_Type_35_DD&&(r.indexhackmode=1),r.dskchange_time=0,r.dskchange_request=!1,r.dskchange=!1,r.dskready_down_time=0,r.dskready_up_time=0,r.buffered_cyl=-1,r.buffered_side=-1,SAER.gui.led(e+SAEC_GUI_LED_DF0,0,-1),tt(r),r.newfile=null,_t(r,SAEV_config,e,SAEV_config.floppy.drive[e].file,!1)||SAER.disk.eject(e)}function at(e){e.prevtracklen&&(e.mfmpos=Math.floor(e.mfmpos*Math.floor(1e3*e.tracklen/e.prevtracklen)/1e3),e.mfmpos>=e.tracklen&&(e.mfmpos=e.tracklen-1)),e.mfmpos%=e.tracklen,e.prevtracklen=e.tracklen}function ot(e){e.tracklen=2*b()*e.ddhd*8,e.revolutions=1,e.trackspeed=Qe(),e.buffered_side=-1,e.skipoffset=-1,e.tracktiming[0]=0,SAEF_memset(e.bigmfmbuf,0,43690,2*b()*e.ddhd>>1),at(e)}function st(e,t){var n=new Uint8Array(12);if(SAEF_ZFile_fseek(e.diskfile,0,SEEK_SET),SAEF_ZFile_fread(n,0,1,8,e.diskfile),0==SAEF_CompareArray(n,SAEF_String2Array("UAE-1ADF"),8)){SAEF_ZFile_fread(n,0,1,4,e.diskfile),e.num_tracks=256*n[2]+n[3];for(var r=12+12*e.num_tracks,i=0;i<e.num_tracks;i++){var a=e.trackdata[i];SAEF_ZFile_fread(n,0,12,1,e.diskfile),a.type=n[3],a.revolutions=n[2]+1,a.len=65536*n[5]+256*n[6]+n[7],a.bitlen=65536*n[9]+256*n[10]+n[11],a.offs=r,2e4<a.len&&t&&(e.ddhd=2),a.track=i,r+=a.len}return 1}}function ct(e){var t=e.lastIndexOf(".");if(-1!=t&&t+1!=e.length){t=e.substring(t+1);if("adf"==(t=t.toLowerCase())||"adz"==t||"st"==t||"ima"==t||"img"==t)return SAEF_log("disk.isrecognizedext() extention '%s' found",t),1;SAEF_log("disk.isrecognizedext() unknow extention '%s'",t)}else SAEF_log("disk.isrecognizedext() no extention")}function _t(e,t,n,r,i){var a=new Uint8Array(12),o=null;nt(e);var s=function(e,t,n,r,i,a){var o=!1,s=0,c=a?null:null;if(i&&(s=0),r&&(o=!!e.floppy.readOnly),n||!a){n=SAEF_ZFile_fopen_file(t);return null!==n?(i&&(s=!1!==t.crc32?t.crc32:SAEF_ZFile_crc32(n)),a?c=n:SAEF_ZFile_fclose(n),[!0,o,s,c]):[!1,!1,0,null]}}(t,r,!0,!0,!0,!0);if(e.wrprot=s[1],e.crc32=s[2],e.diskfile=s[3],e.forcedwrprot=r.prot,e.forcedwrprot&&(e.wrprot=!0),e.ddhd=1,e.num_heads=2,e.num_secs=0,e.hard_num_cyls=t.floppy.drive[n].type==SAEC_Config_Floppy_Type_525_SD?40:80,e.tracktiming[0]=0,e.useturbo=0,e.indexoffset=0,i||(e.dskeject=!1),e.motoroff||(e.dskready_up_time=312*h+(511&Math.decimalRandom()),e.dskready_down_time=0),null!==e.diskfile){i||(e.newfile=SAEF_CloneObject(r)),SAEF_memset(a,0,0,a.length);var c=0;null!==e.diskfile&&(SAEF_ZFile_fread(a,0,1,8,e.diskfile),SAEF_ZFile_fseek(e.diskfile,0,SEEK_END),c=SAEF_ZFile_ftell(e.diskfile),SAEF_ZFile_fseek(e.diskfile,0,SEEK_SET));var _,t=0;if(!(t=!(t=ct(r.name)?1:t)&&e.diskfile&&ct(SAEF_ZFile_getname(e.diskfile))?1:t)&&SAEV_config.floppy.drive[n].type>=SAEC_Config_Floppy_Type_35_DD_PC&&(t=1),0==SAEF_CompareArray(a,SAEF_String2Array("SCP"),3)){if(e.wrprot=!0,!function(e,t){var n=Xe[t],r=new Uint8Array(16);if(r[0]=0,Ye(t),SAEF_ZFile_fread(r,0,r.length,1,e),0==SAEF_CompareArray(r,SAEF_String2Array("SCP"),3))if(0!=r[5]){if(0==r[9]||16==r[9])return n.zf=e,n.revs=Math.min(r[5],Ue),ye[t].num_tracks=r[7]+1,SAEF_log("disk.scp_open() ok, %d tracks",ye[t].num_tracks),1;SAEF_warn("disk.scp_open() unsupported bit cell time width (%d)",r[9])}else SAEF_warn("disk.scp_open() invalid revolution count (%d)",r[5]);else SAEF_warn("disk.scp_open() header missing")}(e.diskfile,e.num))return SAEF_ZFile_fclose(e.diskfile),void(e.diskfile=null);e.filetype=Se}else if(0==SAEF_CompareArray(a,SAEF_String2Array("UAE-1ADF"),8))st(e,e.ddhd),e.filetype=Ae,e.num_secs=11,1<e.ddhd&&(e.num_secs=22);else if(0==SAEF_CompareArray(a,SAEF_String2Array("UAE--ADF"),8)){var f=648;e.wrprot=!0,e.filetype=Ee,e.num_tracks=160,e.num_secs=11,SAEF_ZFile_fseek(e.diskfile,8,SEEK_SET);for(var l=0;l<160;l++)o=e.trackdata[l],SAEF_ZFile_fread(a,0,4,1,e.diskfile),o.sync=256*a[0]+a[1],o.len=256*a[2]+a[3],o.offs=f,o.revolutions=1,0==o.sync?(o.type=ne,o.bitlen=0):(o.type=ie,o.bitlen=8*o.len),f+=o.len}else if(!t||327680!=c&&163840!=c&&368640!=c&&184320!=c&&1228800!=c&&737280!=c&&1474560!=c&&819200!=c&&1638400!=c&&1720320!=c&&746496!=c&&1492992!=c&&829440!=c&&1658880!=c&&1741824!=c&&755712!=c&&1511424!=c&&839680!=c&&1679360!=c&&1763328!=c&&368640!=c&&737280!=c&&409600!=c&&819200!=c&&373248!=c&&746496!=c&&414720!=c&&829440!=c&&377856!=c&&755712!=c&&419840!=c&&839680!=c)if(262144!=c&&524288!=c||17!=a[0]||17!=a[1]&&20!=a[1]){var u=0;if(e.filetype=pe,e.num_tracks=0,901631<c){for(l=80;l<=83;l++){if(c==22*l*512*2){e.num_secs=22,e.num_tracks=c/11264,e.ddhd=2;break}if(c==11*l*512*2){e.num_secs=11,e.num_tracks=c/5632;break}if(c==12*l*512*2){e.num_secs=12,e.num_tracks=c/6144,u=1;break}if(c==24*l*512*2){e.num_secs=24,e.num_tracks=c/12288,e.ddhd=2,u=1;break}}0==e.num_tracks&&(e.num_secs=22,e.num_tracks=Math.floor(c/11264),e.ddhd=2)}else e.num_secs=11,e.num_tracks=Math.floor(c/5632);if(!u&&e.num_tracks>te)return SAEF_warn("disk.drive_insert() Your diskfile is too big, %d bytes!",c),SAEF_ZFile_fclose(e.diskfile),void(e.diskfile=null);for(l=0;l<e.num_tracks;l++)(o=e.trackdata[l]).type=u?oe:ne,o.len=512*e.num_secs,o.bitlen=0,o.offs=512*l*e.num_secs,o.revolutions=1}else{e.filetype=262144==c?he:ge,e.num_tracks=1760/(e.num_secs=11);for(l=0;l<e.num_tracks;l++)(o=e.trackdata[l]).type=ne,o.len=512*e.num_secs,o.bitlen=0,o.offs=512*l*e.num_secs-(e.filetype==he?512:263168),o.track=l,o.revolutions=1}else{for(e.num_secs=9,e.ddhd=1,_=2;0<_;_--){if(c==720*_*512||c==729*_*512||c==738*_*512){e.num_secs=9,e.ddhd=1;break}if(c==1440*_*512||c==1458*_*512||c==1476*_*512){e.num_secs=18,e.ddhd=2;break}if(c==800*_*512||c==810*_*512||c==820*_*512){e.num_secs=10,e.ddhd=1;break}if(c==1600*_*512||c==1620*_*512||c==1640*_*512){e.num_secs=20,e.ddhd=2;break}if(c==1680*_*512||c==1701*_*512||c==1722*_*512){e.num_secs=21,e.ddhd=2;break}if(c==360*_*512){e.num_secs=9,e.ddhd=1;break}if(c==320*_*512){e.num_secs=8,e.ddhd=1;break}if(c==1200*_*512){e.num_secs=15,e.ddhd=1;break}}e.num_tracks=Math.floor(c/(512*e.num_secs)),e.filetype=me;for(var o=e.trackdata[0],l=0;l<e.num_tracks;l++)o.type=ae,o.len=512*e.num_secs,o.bitlen=0,o.offs=512*l*e.num_secs,1==_&&((++o).type=se,o.len=512*e.num_secs),o.revolutions=1,o++;1==(e.num_heads=_)&&(e.num_tracks*=2)}return tt(e),yt(e,!0),e.mfmpos=((65535&Math.decimalRandom())<<16|65535&Math.decimalRandom())>>>0,e.mfmpos%=e.tracklen,e.prevtracklen=0,i||(rt(e.num,!1),e.num),1}ot(e)}function ft(e){nt(e),e.dskeject=!1,e.dskchange=!0,e.ddhd=1,e.dskchange_time=0,e.dskready=0,e.dskready_up_time=0,e.dskready_down_time=0,e.crc32=0,tt(e),0<p&&SAEF_log("disk.drive_eject() %d",e.num)}function lt(e){return SAEV_config.floppy.readOnly||e.wrprot||e.forcedwrprot||null===e.diskfile}function ut(){for(var e=1+(Math.decimalRandom()>>>4&7);0<e--;)N<<=1,N|=4096&Math.decimalRandom()?1:0,N&=65535,L++,L&=15}function dt(e){return null===e.diskfile&&0<=e.dskchange_time}function pt(e,t){var n;dt(e)||(e.dskchange=!1),e.steplimit&&SAEV_Events_currcycle-e.steplimitcycle<r?SAEF_log("disk.drive_step() ignored df%d, cycle %d",e.num,Math.floor((SAEV_Events_currcycle-e.steplimitcycle)*SAEC_Events_CYCLE_UNIT_INV)):(n=e,SAEV_config.cpu.speed==SAEC_Config_CPU_Speed_Original&&(n.steplimit=4,n.steplimitcycle=SAEV_Events_currcycle),t?e.cyl&&e.cyl--:(t=e.hard_num_cyls,e.cyl<t+3&&e.cyl++,e.cyl>=t&&SAEF_warn("disk.drive_step() program tried to step over track %d",t)),ut(),2<p&&SAEF_log("disk.drive_step() %d",e.cyl))}function Et(e){return 0==e.cyl}function At(e,t){e.motoroff&&!t&&(e.dskready_up_time=312*h+(511&Math.decimalRandom()),ut(),2<p&&SAEF_log("disk.drive_motor() on")),!e.motoroff&&t&&(e.drive_id_scnt=0,e.dskready_down_time=312*g+(511&Math.decimalRandom()),s&&SAEF_log("disk.drive_motor() Selected DF%d: reset id shift reg.",e.num),2<p&&SAEF_log("disk.drive_motor() off"),SAEV_config.cpu.model<=SAEC_Config_CPU_Model_68010&&SAEV_config.cpu.speed==SAEC_Config_CPU_Speed_Original&&(e.motordelay=1,SAER.events.event2_newevent_xx(-1,30*SAEC_Events_CYCLE_UNIT,e.num,function(e){ye[e].motordelay=0}))),e.motoroff=t,e.motoroff?(e.dskready=0,e.dskready_up_time=0):e.dskready_down_time=0}function St(e,t,n,r,i,a,o){0!=o&&(0==n.track&&(t==he?(SAEF_memset(i,a,0,512<o?512:o),0==r&&(i.set(SAEF_String2Array("KICK"),a),o-=512)):t==ge&&(SAEF_memset(i,a,0,512<o?512:o),0==r?(i.set(SAEF_String2Array("KICKSUP0"),a),o-=1024):512==r&&(o-=512))),0<=(r=n.offs+r)&&0<o&&(SAEF_ZFile_fseek(e,r,SEEK_SET),SAEF_ZFile_fread(i,a,1,o,e)))}function mt(e,t,n){for(var r=0;n--;){var i=21845&e[t],a=1431655765&~((r<<16|i)>>>0);e[t++]=i|(a<<1&a>>>1)>>>0&65535,r=i}}const ht=[42,41,36,37,18,17,20,21,74,73,68,69,82,81,84,85];function gt(e,t,n,r){for(var i,a=0,o=0;o<r;o++)t[n]=(i=e[a++],(i=ht[i>>4]<<8|ht[15&i])|(320&i?0:128)),t[n]|=1&t[n-1]||16384&t[n]?0:32768,n++;return n}function yt(e,t){var n=2*e.cyl+k,r=e.trackdata[n];if(null===e.diskfile||n>=e.num_tracks)ot(e);else if(t||e.buffered_cyl!=e.cyl||e.buffered_side!=k){e.indexoffset=0,e.multi_revolution=0,e.tracktiming[0]=0,e.skipoffset=-1,e.revolutions=1;t=e.lastdataacesstrack==2*e.cyl+k;if(x||t||(e.track_access_done=!1),e.writediskfile&&0<e.writetrackdata[n].bitlen){var i=e.writetrackdata[n];e.tracklen=i.bitlen,e.revolutions=i.revolutions;var a=i.bitlen+7>>>3,o=new Uint8Array(a);St(e.writediskfile,e.filetype,i,0,o,0,a),a=e.tracklen+15>>4;for(var s=0,c=0;s<a;s++,c+=2)e.bigmfmbuf[s]=o[c]<<8|o[c+1];0<p&&SAEF_log('disk.drive_fill_bigbuf() track %d, length %d read from "saveimage"',n,e.tracklen)}else if(e.filetype==Se)!function(e,t,n,r){var i,a,o=Xe[n],s=new Uint8Array(4),c=new ArrayBuffer(12),_=new Uint8Array(c),f=new Uint32Array(c),l=new Uint32Array(Ue);if(ye[n].multi_revolution=1,ye[n].skipoffset=-1,o.dat16=null,o.dat8=null,o.dat=null,o.datsz=0,SAEF_ZFile_fseek(o.zf,16+4*r,SEEK_SET),SAEF_ZFile_fread(_,0,c.byteLength,1,o.zf),i=SAEF_le32toh(f[0]),SAEF_ZFile_fseek(o.zf,i,SEEK_SET),SAEF_ZFile_fread(s,0,s.length,1,o.zf),0==SAEF_CompareArray(s,SAEF_String2Array("TRK"),3)){if(s[3]==r){for(a=0;a<o.revs;a++)SAEF_ZFile_fread(_,0,c.byteLength,1,o.zf),l[a]=i+SAEF_le32toh(f[2]),o.index_off[a]=SAEF_le32toh(f[1]),o.datsz+=o.index_off[a];for(o.dat=new ArrayBuffer(2*o.datsz),o.dat8=new Uint8Array(o.dat),o.dat16=new Uint16Array(o.dat),a=o.datsz=0;a<o.revs;a++)SAEF_ZFile_fseek(o.zf,l[a],SEEK_SET),SAEF_ZFile_fread(o.dat8,2*o.datsz,2*o.index_off[a],1,o.zf),o.datsz+=o.index_off[a],o.index_off[a]=o.datsz;return o.track=r,o.pll_mode=Ge,o.dat_idx=0,o.index_pos=o.index_off[0],o.clock=o.clock_centre=qe,o.nr_index=0,o.flux=0,o.clocked_zeros=0,Je(e,n,t)}SAEF_warn("disk.scp_loadtrack() track error (%d != %d)",s[3],r)}else SAEF_warn("disk.scp_loadtrack() track header not found")}(e.bigmfmbuf,e.tracktiming,e.num,n);else if(r.type==ae)!function(e){var t,n,r=2*e.cyl+k,i=new Uint8Array(1e3),a=e.trackdata[r],o=e.bigmfmbuf,s=0,c=0;for(o[+s]=37460,SAEF_memset(i,0,78,40),SAEF_memset(i,40,0,12),i[52]=194,i[53]=194,i[54]=194,i[55]=252,SAEF_memset(i,56,78,40),c=gt(i,o,1,96),o[53]=21028,o[54]=21028,o[55]=21028,t=0;t<e.num_secs;t++)s=c,SAEF_memset(i,0,0,12),i[12]=161,i[13]=161,i[14]=161,i[15]=254,i[16]=e.cyl,i[17]=k,i[18]=1+t,i[19]=2,n=SAEF_crc16(i,12,8),i[20]=n>>8,i[21]=255&n,SAEF_memset(i,22,78,22),SAEF_memset(i,44,0,12),i[56]=161,i[57]=161,i[58]=161,i[59]=251,St(e.diskfile,e.filetype,a,512*t,i,60,512),n=SAEF_crc16(i,56,516),i[572]=n>>8,i[573]=255&n,0<(n=Math.floor(6154/e.num_secs)-574/e.ddhd)&&SAEF_memset(i,574,78,n),c=gt(i,o,s,574+76/e.ddhd),o[s+12]=17545,o[s+13]=17545,o[s+14]=17545,o[s+56]=17545,o[s+57]=17545,o[s+58]=17545;for(;c<6250;)e.bigmfmbuf[c++]=37460;e.skipoffset=0,e.tracklen=16*c,0<p&&SAEF_log("disk.decode_pcdos() read track %d, len %d bytes",r,e.tracklen/8)}(e);else if(r.type==ne)!function(e){var t=2*e.cyl+k,n=E(),r=544*e.num_secs+E(),i=e.trackdata[t];SAEF_memset(e.bigmfmbuf,0,43690,r),e.skipoffset=2*Math.floor(8*E()/3),e.tracklen=2*r*8;for(var a=0,o=0;o<e.num_secs;o++){var s=new Uint8Array(544),c=new Uint16Array(545),_=0,f=0;s[0]=s[1]=0,s[2]=s[3]=161,s[4]=255,s[5]=t,s[6]=o,s[7]=e.num_secs-o;for(var l=8;l<24;l++)s[l]=0;St(e.diskfile,e.filetype,i,512*o,s,32,512),c[0]=a?10922:43690,c[1]=43690,c[2]=c[3]=17545;var u=(s[4]<<24|s[5]<<16|s[6]<<8|s[7])>>>0,d=u>>>1;for(u&=1431655765,d&=1431655765,c[4]=d>>>16,c[5]=65535&d,c[6]=u>>>16,c[7]=65535&u,l=8;l<48;l++)c[l]=43690;for(l=0;l<512;l+=4)d=(u=(s[l+32]<<24|s[l+33]<<16|s[l+34]<<8|s[l+35])>>>0)>>>1,u&=1431655765,d&=1431655765,c[32+(l>>1)]=d>>>16,c[33+(l>>1)]=65535&d,c[256+(l>>1)+32]=u>>>16,c[256+(l>>1)+33]=65535&u;for(l=4;l<24;l+=2)_=(_^(c[l]<<16|c[l+1])>>>0)>>>0;for(u=d=_,d>>>=1,c[24]=d>>>16,c[25]=65535&d,c[26]=u>>>16,c[27]=65535&u,l=32;l<544;l+=2)f=(f^(c[l]<<16|c[l+1])>>>0)>>>0;for(u=d=f,d>>>=1,c[28]=d>>>16,c[29]=65535&d,c[30]=u>>>16,c[31]=65535&u,c[544]=0,mt(c,4,541),l=0;l<544;l++)e.bigmfmbuf[n%r]=c[l],n++;a=1&c[l-1],e.bigmfmbuf[n%r]=c[l]}0<p&&SAEF_log("disk.decode_amigados() read track %d",t)}(e);else if(r.type==oe)!function(e){var t=2*e.cyl+k,n=E(),r=520*e.num_secs+E(),i=e.trackdata[t];SAEF_memset(e.bigmfmbuf,0,43690,r),e.skipoffset=2*Math.floor(8*E()/3),e.tracklen=2*r*8;for(var a=0;a<e.num_secs;a++){var o,s,c=new Uint8Array(520),_=new Uint16Array(520);for(c[0]=t,c[1]=a,c[2]=0,c[3]=0,St(e.diskfile,e.filetype,i,512*a,c,4,512),_[0]=43690,_[1]=17545,_[2]=17545,_[3]=10922,f=0;f<512;f+=4)s=(o=(c[f+4]<<24|c[f+5]<<16|c[f+6]<<8|c[f+7])>>>0)>>>1,o&=1431655765,s&=1431655765,_[f+8+0]=s>>>16,_[f+8+1]=65535&s,_[f+8+2]=o>>>16,_[f+8+3]=65535&o;mt(_,8,512);for(var f=8,l=32767&_[f++];f<520;)l^=_[f++];for(c[2]=l>>8,c[3]=l,s=(o=(c[0]<<24|c[1]<<16|c[2]<<8|c[3])>>>0)>>>1,o&=1431655765,s&=1431655765,_[4]=s>>>16,_[5]=65535&s,_[6]=o>>>16,_[7]=65535&o,mt(_,4,4),f=0;f<520;f++)e.bigmfmbuf[n%r]=_[f],n++}0<p&&SAEF_log("disk.decode_diskspare() read track %d",t)}(e);else if(r.type!=se){i=e.writetrackdata[n],t=r.type==re?0:1;e.tracklen=r.bitlen+16*t,e.bigmfmbuf[0]=r.sync;a=i.bitlen+7>>>3,o=new Uint8Array(a);St(e.diskfile,e.filetype,r,0,o,0,a),a=e.tracklen+15>>4;for(s=t,c=0;s<a;s++,c+=2)e.bigmfmbuf[s]=o[c]<<8|o[c+1];2<p&&SAEF_log("disk.drive_fill_bigbuf() rawtrack %d image offset $%x",n,r.offs)}e.buffered_side=k,e.buffered_cyl=e.cyl,0==e.tracklen&&(e.tracklen=2*b()*e.ddhd*8,SAEF_memset(e.bigmfmbuf,0,0,2*b()*e.ddhd>>1)),e.trackspeed=$e(e),at(e)}}const vt=1431655765;function bt(e,t,n){return 65535&(e[t]<<n|e[t+1]>>16-n)}function Ct(e,t,n){return((bt(e,t,n)<<16|bt(e,t+1,n))&vt)>>>0}function kt(e,t,n,r,i,a,o,s){var c=0,_=0,r=b()*r,f=0,l=0,u=0,d=0,p=0,E=new Uint8Array(544),A=0,S=0,m=2*r-540,h=new Uint32Array(4),g=0,y=!1;for(SAEF_memset(o,0,0,C),SAEF_memcpy(e,r,e,0,r);_<n;){for(;17545!=bt(e,S,g);){if(m<=S)return SAEF_log("disk.decode_buffer() sync not found (1)"),1;16==++g&&(g=0,S++)}for(;17545==bt(e,S,g);){if(m<=S)return SAEF_log("disk.decode_buffer() sync not found (2)"),1;S++}f=Ct(e,S,g),l=Ct(e,S+2,g),S+=4;var v=(65280&(d=(f<<1|l)>>>0))>>8;if(n<1+v){if(SAEF_log("disk.decode_buffer() weird sector number %d (id $%08x, offset %d)",v,d,S),i==Ae)return 1}else{for(y=!1,u=(f^l)>>>0,c=0;c<4;c++)f=Ct(e,S,g),l=Ct(e,S+8,g),S+=2,(p=(f<<1|l)>>>0)&&!s&&(y=!0),h[c]=p,u=(u^(f^l)>>>0)>>>0;if(y&&(SAEF_log("disk.decode_buffer() sector %d header: %08X %08X %08X %08X",v,h[0],h[1],h[2],h[3]),i==Ae))return 1;if(f=Ct(e,S+=8,g),l=Ct(e,S+2,g),S+=4,(f<<1|l)>>>0==u){if((16711680&d)>>>16==2*t+k){for(f=Ct(e,S,g),l=Ct(e,S+2,g),S+=4,u=(f<<1|l)>>>0,A=32,c=0;c<128;c++)f=Ct(e,S,g),l=Ct(e,S+256,g),S+=2,E[A++]=(p=(f<<1|l)>>>0)>>>24,E[A++]=p>>>16&255,E[A++]=p>>>8&255,E[A++]=255&p,u=(u^(f^l)>>>0)>>>0;if(u){if(SAEF_log("disk.decode_buffer() sector %d, data checksum error",v),i==Ae)return 1}else S+=256,o[v]=1,_++,R.set(E.subarray(32,544),512*v)}else if(SAEF_log("disk.decode_buffer() mismatched track (%d <> %d) on sector %d header (%08X)",(16711680&d)>>>16,2*t+k,v,d),i==Ae)return 1}else if(SAEF_log("disk.decode_buffer() sector %d, header checksum error (%08X != %08X) ",v,(f<<1|l)>>>0,u),i==Ae)return 1}}if(i==Ae&&(0==_||_<0))return 1;0==_?SAEF_log("disk.decode_buffer() unsupported format"):_<0&&SAEF_log("disk.decode_buffer() sector labels ignored"),a.value=n}function Rt(e,t,n,r){var i=new Uint8Array(12);t.revolutions=1,t.bitlen=n,t.type=r,i[0]=0,i[1]=0,i[2]=0,i[3]=t.type,i[4]=t.len>>>24,i[5]=t.len>>>16&255,i[6]=t.len>>>8&255,i[7]=255&t.len,i[8]=t.bitlen>>>24,i[9]=t.bitlen>>>16&255,i[10]=t.bitlen>>>8&255,i[11]=255&t.bitlen,SAEF_ZFile_fseek(e,12+12*t.track,SEEK_SET),SAEF_ZFile_fwrite(i,0,i.length,1,e),t.len>Math.floor((n+7)/8)&&(SAEF_memset(n=new Uint8Array(t.len),0,0,t.len),SAEF_ZFile_fseek(e,t.offs,SEEK_SET),SAEF_ZFile_fwrite(n,0,1,t.len,e)),0<p&&SAEF_log("disk.diskfile_update() track %d, raw track length %d written (total size %d)",t.track,Math.floor((t.bitlen+7)/8),t.len)}function wt(e){var t={value:0},n=new Uint8Array(C);if(kt(e.bigmfmbuf,e.cyl,e.num_secs,e.ddhd,e.filetype,t,n,!1))return 2;if(!t.value)return 2;e.filetype==Ae&&Rt(e.diskfile,e.trackdata[2*e.cyl+k],512*t.value*8,ne);for(var r=0;r<t.value;r++)SAEF_ZFile_fseek(e.diskfile,e.trackdata[2*e.cyl+k].offs+512*r,SEEK_SET),SAEF_ZFile_fwrite(R,512*r,1,512,e.diskfile);return 0}function xt(e,t,n,r){var i=Math.floor((r+7)/8);i>n.len&&(SAEF_warn("disk.drive_write_ext2() image file's track %d is too small (%d < %d)",n.track,n.len,i),i=n.len),Rt(t,n,r,re);for(var a=0;a<n.len>>1;a++)be[a]=e[a];return SAEF_ZFile_fseek(t,n.offs,SEEK_SET),SAEF_ZFile_fwrite(be,0,1,i,t),1}function Dt(e,t,n){var r=bt(e,t,n),i=0;r&=21845;for(var a=0;a<8;a++)i>>=1,1&r&&(i|=128),r>>=2;return i}function Mt(e){var t=-1,n=2*e.cyl+k;if(lt(e)||e.trackdata[n].type==se)e.buffered_side=2;else{switch(e.writediskfile&&xt(e.bigmfmbuf,e.writediskfile,e.writetrackdata[n],_?8*M:e.tracklen),e.filetype){case pe:return void(wt(e)&&(SAEV_config.floppy.autoEXT2?function(e,t){if(e.filetype!=pe)return;var n=SAEV_config.floppy.drive[e.num].file,r=2==e.ddhd,i=n.name;if(0==i.length)return;var a=null;if(1==t){if(null===(a=_n(i,SAEC_Disk_Create_Mode_Custom,r?SAEC_Disk_Create_Type_35_HD:SAEC_Disk_Create_Type_35_DD,"",!1,!1,e.diskfile)))return}else{if(2!=t)return;t=SAEF_ZFile_fopen_load_zfile(e.diskfile);if(null===t)return;if(SAEF_ZFile_fclose(e.diskfile),(e.diskfile=null)===(a=_n(i,SAEC_Disk_Create_Mode_Custom,r?SAEC_Disk_Create_Type_35_HD:SAEC_Disk_Create_Type_35_DD,"",!1,!1,t)))return SAEF_ZFile_fclose(t)}SAEF_ZFile_fclose(e.diskfile),e.diskfile=a,e.filetype=Ae,st(e,e.ddhd),Mt(e),yt(e,!0),SAEF_log("disk.convert_adf_to_ext2() converted '%s' to ADF-EXT2",n.name)}(e,SAEV_config.floppy.autoEXT2):Q||(Q=!0,alert("Disk in DF"+e.num+" does use a non-standard floppy disk format.\nYou may need to use a custom floppy disk image file instead of a standard one\nor enable 'Auto convert to EXT2' in the floppy-page.\n\nThis message will not appear again."))));case Ee:break;case Ae:return void((t=!_?wt(e):t)&&(SAEF_warn("disk.drive_write_data() not an amigados track %d (error %d), writing as raw track",2*e.cyl+k,t),xt(e.bigmfmbuf,e.diskfile,e.trackdata[2*e.cyl+k],_?8*M:e.tracklen)));case Se:break;case me:(t=function(e,t,n){var r,i=e.num_secs,a=b()*e.ddhd,o=e.bigmfmbuf,s=0,c=2*a-518,_=0,f=0,l=0,u=-1,d=new Uint8Array(24),p=new Uint8Array(516),E=0,A=0;for(SAEF_memset(d,0,0,24),SAEF_memcpy(o,a,o,0,a),p[0]=p[1]=p[2]=161,p[3]=251;f<i;){for(var S=0;17545!=bt(o,s,l);){if(S++,c<=s)return-1;16==++l&&(l=0,s++),0<=u&&43<=S/16&&(u=-1)}for(S=0;17545==bt(o,s,l);){if(S++,c<=s)return-1;s++}if(!(S<3))if(254!=(r=Dt(o,s++,l)))if(251==r||250==r){if(!(u<0)){for(A=0;A<512;A++)p[A+4]=Dt(o,s++,l);if(E=Dt(o,s++,l)<<8|Dt(o,s++,l),SAEF_crc16(p,0,516)==E){if(f++,n&&d[u])break;d[u]||(_++,d[u]=1,SAEF_ZFile_fseek(t,e.trackdata[2*e.cyl+k].offs+512*u,SEEK_SET),SAEF_ZFile_fwrite(p,4,1,512,t)),u=-1}else SAEF_warn("disk.drive_write_pcdos() track %d, sector %d data checksum error",2*e.cyl+k,u+1)}}else SAEF_warn("disk.drive_write_pcdos() track %d: unknown address mark %02X",2*e.cyl+k,r);else{var m=new Uint8Array(8),h=Dt(o,s++,l),g=Dt(o,s++,l),u=Dt(o,s++,l),y=Dt(o,s++,l),E=Dt(o,s++,l)<<8|Dt(o,s++,l);for(m[0]=m[1]=m[2]=161,m[3]=r,m[4]=h,m[5]=g,m[6]=u,m[7]=y,A=0;A<28;A++)Dt(o,s++,l);if(SAEF_crc16(m,0,8)!=E||h!=e.cyl||g!=k||2!=y||u<1||u>e.num_secs||u>=d.length)return SAEF_warn("disk.drive_write_pcdos() track %d, corrupted sector header",2*e.cyl+k),-1;u--}}return n||_==e.num_secs||SAEF_warn("disk.drive_write_pcdos() track %d, %d corrupted sectors ignored",2*e.cyl+k,e.num_secs-_),_}(e,e.diskfile,0))<0&&SAEF_log("disk.drive_write_data() not a PC formatted track %d (error %d)",2*e.cyl+k,t)}e.tracktiming[0]=0}}function Ft(e,t){if(!(0<e.dskchange_time)){for(var n=0;n<A;n++)ye[n].num!=e.num&&0<ye[n].dskchange_time&&ye[n].dskchange_time+1>=t&&(t=ye[n].dskchange_time+1);e.dskchange_time=t,0<p&&SAEF_log("disk.setdskchangetime() delayed insert enable %d",t)}}function Tt(e,t,n){var r=ye[e];n?_t(r,SAEV_config,e,t,!1):(r.dskeject=!1,r.newfile=SAEF_CloneObject(t),0==t.size?SAER.disk.eject(e):!dt(r)||0<r.dskchange_time?r.dskeject=!0:Ft(r,312))}function Vt(e){S=SAEV_config.chipset.compatible==SAEC_Config_Chipset_Compatible_A1000V?e>>3&3:e>>3&15,k=1-(e>>2&1),c=e>>1&1}function It(e){var t=2*e.cyl+k;return t>=e.num_tracks||(e.filetype==Ae&&0==e.trackdata[t].bitlen&&e.trackdata[t].type!=ne||e.trackdata[t].type==se)}function Pt(e,t){return e[t>>4]&1<<15-(15&t)?1:0}function zt(e){SAEF_log("disk.dumpdisk() %s",e)}function Ot(){SAER.custom.INTREQ(SAEC_Custom_INTF_SETCLR|SAEC_Custom_INTF_DSKBLK),_=0,x=y,F=D=0}function Lt(e){e.revolution_check||(e.trackspeed=$e(e),d&&SAEF_log("disk.fetchnextrevolution() DMA=%d %d %d/%d %d %d %d",x,e.trackspeed,e.mfmpos,e.tracklen,e.indexoffset,e.floppybitcounter),e.revolution_check=2,e.multi_revolution&&e.filetype===Se&&Je(e.bigmfmbuf,e.num,e.tracktiming))}function Nt(){d&&SAEF_log("disk.do_disk_index() %d",H),H||(H=2,SAER.cia.diskindex())}function Bt(){G=0<SAEV_config.floppy.randomBitsMax?(Math.decimalRandom()>>>4)%(SAEV_config.floppy.randomBitsMax-SAEV_config.floppy.randomBitsMin+1)+SAEV_config.floppy.randomBitsMin:0}function Ut(e,t){var n,r;x<w&&(n=e.tracktiming[t>>3],(r=Math.floor($e(e)*n/1e3))<700||3e3<r?++$<50&&SAEF_warn("disk.updatetrackspeed() corrupted trackspeed value %d %d (%d/%d)",n,r,t,e.tracklen):e.trackspeed=r)}function Kt(){if(SAEF_Custom_dmaen(SAEC_Custom_DMAF_DSKEN)&&15==L&&O&&x==v&&0<=D){if(0<D){if(1==D&&1==M)return Ot(),0;if(100<SAEV_config.floppy.speed&&z[0]&&z[1]&&z[2])for(;z[0];){var e=SAER.disk.DSKDATR();SAER_Memory_chipPut16_indirect(V,e),V+=2}if(0<SAER.disk.fifostatus())return SAEF_warn("disk.doreaddma() fifo overflow detected, retrying..."),-1;SAER.disk.DSKDAT(N),D--}return 1}return 0}function Gt(e){U=SAEV_Events_currcycle+t*SAEC_Events_CYCLE_UNIT,x!=y&&(e||(O=1),SAER.custom.INTREQ(SAEC_Custom_INTF_SETCLR|SAEC_Custom_INTF_DSKSYN)),1024&SAEV_Custom_adkcon&&(L=15)}function Ht(){1<p&&zt("DSKLEN");for(var e=0;e<3;e++)z[e]=!1;for(var t=I=0;t<A;t++){var n,r=ye[t];(S|f)&1<<t||(n=2*r.cyl+k,n=r.trackdata[n],x==w&&(N=0,r.tracklen=_?i:b()*r.ddhd*8*2,r.trackspeed=Qe(),r.skipoffset=-1,at(r)),n.type==ie&&(r.mfmpos=0,N=L=0)),r.floppybitcounter=0}O=1024&SAEV_Custom_adkcon?0:1,N==B&&Gt(!0)}this.insert=function(e,t){Tt(e,t,!1)},this.insert_force=function(e,t){Tt(e,t,!0)},this.eject=function(e){ft(ye[e]),SAEV_config.floppy.drive[e].file.clr(),ye[e].newfile=null,rt(e,!(ee[e]=""))},this.vsync=function(){!function(){for(var e=0;e<A;e++){var t=ye[e];t.dskeject&&(ft(t),Ft(t,31200))}}();for(var e,t,n=0;n<A;n++)SAEV_config.floppy.drive[n].type>SAEC_Config_Floppy_Type_None&&(e=ye[n],t=SAEV_config.floppy.drive[n].file,0==e.dskchange_time&&t.name!==ee[n]&&(this.insert_force(n,t),ee[n]=t.name))},this.select_set=function(e){q=1&(X=e),Vt(e)},this.select=function(e){var t,n=SAEV_config.chipset.compatible==SAEC_Config_Chipset_Compatible_A1000V,r=S;Vt(e);var i=1&e;if(Z)for(t=0;t<A;t++)(a=ye[t]).amax&&Ne(e,X,t);if(!n&&(128&X)!=(128&e))for(t=0;t<4;t++)1<ye[t].indexhackmode&&!((S|f)&1<<t)&&(ye[t].indexhack=!0);if(q!=i&&(q=i))for(t=0;t<A;t++)(r|f)&1<<t||(pt(ye[t],c),1<ye[t].indexhackmode&&128&e&&(ye[t].indexhack=!0));if(n)for(t=0;t<2;t++){var a=ye[t],o=32<<t;S&1<<t||f&1<<t||(!(X&o)&&e&o?At(a,1):X&o&&!(e&o)&&At(a,0))}else for(t=0;t<A;t++){a=ye[t];!((S|f)&1<<t)&&r&1<<t&&(a.drive_id_scnt++,a.drive_id_scnt&=31,a.idbit=a.drive_id&1<<31-a.drive_id_scnt?1:0,f&1<<t||(0==(128&X)||0==(128&e)?At(a,0):128&X&&At(a,1)),SAEV_config.chipset.df0idhw||0!=t||(a.idbit=0),s&&SAEF_log("disk.select() sel %d id %s ($%08X) [$%08x, bit #%02d: %d]",t,et(a),a.drive_id,a.drive_id<<a.drive_id_scnt>>>0,31-a.drive_id_scnt,a.idbit))}for(t=0;t<A;t++)ye[t].state=!(S&1<<t)|!ye[t].motoroff,rt(t,!1);X=e},this.status_ciaa=function(){var e=60;if(SAEV_config.chipset.compatible==SAEC_Config_Chipset_Compatible_A1000V){for(var t=0;t<2;t++){var n=ye[t];(S>>3|f)&1<<t||(n.dskchange&&(e&=-33),Et(n)&&(e&=-17))}return 2<p&&SAEF_log("disk.status_ciaa() pc $%08x, status $%02x",SAER_CPU_getPC(),e),e}for(var r,t=0;t<A;t++)(n=ye[t]).amax?Pe&&(r=e,128&Me||(r&=-33),e=r):(S|f)&1<<t?(S|f)&1<<t||n.idbit&&(e&=-33):(n.motoroff?(SAEV_config.chipset.df0idhw||0<t?n.idbit&&SAEV_config.floppy.drive[t].type!=SAEC_Config_Floppy_Type_35_DD_ESCOM&&(e&=-33):n.dskready&&(e&=-33),!SAEV_config.chipset.df0idhw&&0==t&&n.motordelay&&(e&=-33)):n.dskready&&!n.indexhack&&SAEV_config.floppy.drive[t].type!=SAEC_Config_Floppy_Type_35_DD_ESCOM&&(e&=-33),Et(n)&&(e&=-17),lt(n)&&(e&=-9),n.dskchange&&SAEV_config.floppy.drive[t].type!=SAEC_Config_Floppy_Type_525_SD&&(e&=-5));return e},this.status_ciab=function(e){if(SAEV_config.chipset.compatible==SAEC_Config_Chipset_Compatible_A1000V){e|=128;for(var t=0;t<2;t++){var n=ye[t];(S>>3|f)&1<<t||lt(n)&&(e&=-129)}2<p&&SAEF_log("disk.status_ciab() pc $%08x, status $%02x",SAER_CPU_getPC(),e)}return e},this.handler=function(e){var t=255&e,e=e>>>8;SAER.events.current_hpos();SAER.events.event2_remevent(SAEC_Events_EV2_DISK),this.update(e),x||(t&m<<0&&Lt(ye[0]),t&m<<1&&Lt(ye[1]),t&m<<2&&Lt(ye[2]),t&m<<3&&Lt(ye[3])),t&u&&SAER.custom.INTREQ(SAEC_Custom_INTF_SETCLR|SAEC_Custom_INTF_DSKSYN),t&l&&Nt()},this.fifostatus=function(){return z[0]&&z[1]&&z[2]?1:z[0]||z[1]||z[2]?0:-1},this.DSKBYTR=function(e){this.update(e);var t=T;T&=32767,N==B&&0<U-SAEV_Events_currcycle&&(t|=4096,1<p&&zt("disk.DSKBYTR() SYNC")),x!=y&&SAEF_Custom_dmaen(SAEC_Custom_DMAF_DSKEN)&&(t|=16384),16384&F&&(t|=8192),2<p&&SAEF_log("disk.DSKBYTR() $%04X, hpos %d",t,e);for(var n=0;n<A;n++){var r=ye[n];r.motoroff||(S|f)&1<<n||(r.lastdataacesstrack=2*r.cyl+k,d&&!r.track_access_done&&SAEF_log("disk.DSKBYTR()"),r.track_access_done=!0)}return t},this.hsync=function(){for(var e=0;e<A;e++){var t=ye[e];t.steplimit&&t.steplimit--,t.revolution_check&&t.revolution_check--,0<t.dskready_down_time&&t.dskready_down_time--,0<t.dskready_up_time&&!dt(t)&&(t.dskready_up_time--,0!=t.dskready_up_time||t.motoroff||(t.dskready=!0)),0<t.dskchange_time&&(t.dskchange_time--,0==t.dskchange_time&&(_t(t,SAEV_config,e,t.newfile,!1),0<p&&SAEF_log("disk.hsync() delayed insert, drive %d, image '%s', size %d",e,t.newfile.name,t.newfile.size),rt(e,!1)))}H&&H--,j?--j||Ot():(this.update(SAER.playfield.get_maxhpos()),0)},this.update=function(e){var t;if(K<0)K=-K;else if(!((t=(e<<8)-K)<=0)){for((K+=t)>=SAER.playfield.get_maxhpos()<<8&&(K%=256),i=0;i<A;i++)!(n=ye[i]).motoroff&&n.tracklen&&n.trackspeed&&(n.floppybitcounter+=t,(S|f)&1<<i?(n.mfmpos+=Math.floor(n.floppybitcounter/n.trackspeed),n.mfmpos%=n.tracklen,n.floppybitcounter%=n.trackspeed):(n.diskfile&&yt(n,!1),n.mfmpos%=n.tracklen));for(var n,r=!1,i=0;i<A;i++)!(n=ye[i]).motoroff&&n.trackspeed&&((S|f)&1<<i||((x==w&&O?function(e,t){var n=[0,0,0,0];for(a=0;a<A;a++){var r=ye[a];n[a]=0,r.motoroff||(S|f)&1<<a||(n[a]=1)}for(;t>=e.trackspeed;){for(a=0;a<A;a++)n[a]&&(ye[a].mfmpos++,ye[a].mfmpos%=e.tracklen);if(SAEF_Custom_dmaen(SAEC_Custom_DMAF_DSKEN)&&x==w&&0<D&&I&&(L++,!(L&=15))){if(100<SAEV_config.floppy.speed&&!z[0]&&!z[1]&&!z[2])for(;!z[2];){var i=SAER_Memory_chipGet16_indirect(V);SAER.disk.DSKDAT(i),V+=2}if(0<=SAER.disk.fifostatus()){for(var i=SAER.disk.DSKDATR(),a=0;a<A;a++){r=ye[a];n[a]&&(r.bigmfmbuf[r.mfmpos>>4]=i,r.bigmfmbuf[1+(r.mfmpos>>4)]=21845,r.writtento=1),Z&&Le(i)}if(--D<=0)for(Ot(),a=0;a<A;a++)(e=ye[a]).writtento=0,e.motoroff||(S|f)&1<<a||Mt(e)}}t-=e.trackspeed}}:function(e,t){for(;t>=e.trackspeed;){if(e.tracktiming[0]&&Ut(e,e.mfmpos),N<<=1,N&=65535,dt(e)||(It(e)?N|=4096&Math.decimalRandom()?1:0:N|=Pt(e.bigmfmbuf,e.mfmpos)),Kt()<0)return N>>=1;if(e.mfmpos++,e.mfmpos%=e.tracklen,e.mfmpos==e.indexoffset&&(2<p&&e.indexhack&&SAEF_log("disk.disk_doupdate_read() indexhack cleared"),e.indexhack=!1,Nt()),0==e.mfmpos&&(Lt(e),e.tracktiming[0]&&Ut(e,e.mfmpos)),e.mfmpos==e.skipoffset){Bt();for(var n=G;0<n--;)e.mfmpos++,e.mfmpos%=e.tracklen,e.mfmpos==e.indexoffset&&(2<p&&e.indexhack&&SAEF_log("disk.disk_doupdate_read() indexhack cleared"),e.indexhack=!1,Nt()),0==e.mfmpos&&(Lt(e),e.tracktiming[0]&&Ut(e,e.mfmpos))}7==(7&L)&&(T=255&N,T|=32768),N==B&&Gt(!1),L++,L&=15,t-=e.trackspeed}})(n,n.floppybitcounter),n.floppybitcounter%=n.trackspeed,r=!0));r||x!=v||function(e){for(;e>=Qe();)N<<=1,N&=65535,Kt(),7==(7&L)&&(T=255&N,T|=32768),L++,L&=15,e-=Qe()}(t),x!=y&&O&&0==M&&0==D&&Ot(),function(e){for(var t=SAER.playfield.get_maxhpos()<<8,n=0,r=0;r<A;r++){var i=ye[r];if(!i.motoroff&&(i.trackspeed&&!((S|f)&1<<r))){var a=i.mfmpos;i.tracktiming[0]&&Ut(i,a);for(var o=0,s=N,c=e;c<SAER.playfield.get_maxhpos()<<8;){if(i.tracktiming[0]&&Ut(i,a),c+=i.trackspeed,x==w&&(x!=w||O)||(s=s<<1>>>0,dt(i)||(s=It(i)?(s|(4096&Math.decimalRandom()?1:0))>>>0:(s|Pt(i.bigmfmbuf,a))>>>0),x!=v&&(65535&s)==B&&0!=B&&(o|=u)),a++,a%=i.tracklen,x||(0==a&&(o|=m<<i.num),a==i.indexoffset&&(o|=l)),x!=w&&a==i.skipoffset){Bt();for(var _=G;0<_--;)a++,a%=i.tracklen,x||(0==a&&(o|=m<<i.num),a==i.indexoffset&&(o|=l))}if(o)break}i.tracktiming[0]&&Ut(i,i.mfmpos),o&&c<t&&(t=c,n=o)}}n&&t>>8<SAER.playfield.get_maxhpos()&&SAER.events.event2_newevent(SAEC_Events_EV2_DISK,t-e>>8,t>>8<<8|n)}(K)}},this.update_adkcon=function(e,t){var n=SAEV_Custom_adkcon;32768&t?n|=32767&t:n&=~t,1024&n&&!(1024&SAEV_Custom_adkcon)&&(L=0)},this.DSKLEN=function(e,t){var n,r=F,i=0;if(this.update(t),M=D=16383&(F=e),32768&e&&32768&r){if(x==v)return void SAEF_warn("disk.DSKLEN() read DMA length rewrite %d -> %d ($%04x), PC=$%x",16383&r,16383&e,e,SAER_CPU_getPC());x=v,Ht()}if(!(32768&e)&&x!=y){if(0<p&&x==v&&SAEF_warn("disk.DSKLEN() read DMA aborted, %d words left, PC=$%x",D,SAER_CPU_getPC()),x==w)for(SAEF_warn("disk.DSKLEN() write DMA aborted, %d words left, PC=$%x",D,SAER_CPU_getPC()),c=0;c<A;c++){var a=ye[c];a.writtento&&Mt(a)}x=y}if(x!=y)if(0==D&&O)Ot();else{if(16384&e&&16384&r){if(0==D)return;if(1==D)return void Ot();if(x==w)return void SAEF_warn("disk.DSKLEN() write DMA length rewrite %d -> %d, PC=$%x",16383&r,16383&e,SAER_CPU_getPC());x=w,Ht()}for(c=0;c<A;c++)(o=ye[c]).motoroff||S&1<<c||x==v&&(o.lastdataacesstrack=2*o.cyl+k,o.track_access_done=!0,d&&SAEF_log("disk.DSKLEN() DMA"));for(c=n=0;c<A;c++){var o=ye[c];if(o.writtento=0,!o.motoroff&&(n|=1<<c,0==(S&1<<c)))break}for(4==c?(Z||SAEF_log("disk.DSKLEN() %s DMA started, drvmask=$%x motormask=$%x PC=$%08x",x==w?"write":"read",15^S,n,SAER_CPU_getPC()),i=1):0<p&&SAEF_log("disk.DSKLEN() %s DMA started, drvmask=%x track %d mfmpos %d dmaen=%d PC=$%08X",x==w?"write":"read",15^S,2*ye[c].cyl+k,ye[c].mfmpos,O,SAER_CPU_getPC()),c=0;c<A;c++)rt(c,!1);if(x==v||x==w){for(c=0;c<A;c++){o=ye[c];if(!(S&1<<c)&&(o.filetype!=pe&&o.filetype!=he&&o.filetype!=ge))break}if(!(c<A)){for(var s=0,c=0;c<A;c++){o=ye[c];if(!o.motoroff&&((o.useturbo||!(0<SAEV_config.floppy.speed))&&!(S&1<<c))){var _=-16&o.mfmpos;if(yt(o,!1),x==v){if(1024&SAEV_Custom_adkcon){for(u=0;u<o.tracklen;u+=16)if(_+=16,_%=o.tracklen,o.bigmfmbuf[_>>4]==B){_+=16,_%=o.tracklen;break}if(u>=o.tracklen)return}for(;0<D--;)SAER_Memory_chipPut16_indirect(V,o.bigmfmbuf[_>>4]),V+=2,_+=16,_%=o.tracklen;o.mfmpos=_,SAER.custom.INTREQ(SAEC_Custom_INTF_SETCLR|SAEC_Custom_INTF_DSKSYN),s=2}else if(x==w){for(u=0;u<D;u++){var f=SAER_Memory_chipGet16_indirect(V+2*u);o.bigmfmbuf[_>>4]=f,Z&&Le(f),_+=16,_%=o.tracklen}o.mfmpos=_,Mt(o),s=2}}}if(!s&&i){for(var l=-1;0<D--;){if(x==w){f=SAER_Memory_chipGet16_indirect(V);if(Z&&(Le(f),f))for(var u=0;u<16;u++)f&1<<u&&l++}else SAER_Memory_chipPut16_indirect(V,0);V+=2}s=0==l?1:(SAER.custom.INTREQ(SAEC_Custom_INTF_SETCLR|SAEC_Custom_INTF_DSKSYN),2)}return s?(j=s,void(x=y)):void 0}}}},this.DSKSYNC=function(e,t){t!=B&&(this.update(e),B=t)},this.DSKDAT=function(e){z[2]?SAEF_warn("disk.DSKDAT() FIFO overflow!"):(z[2]=z[1],P[2]=P[1],z[1]=z[0],P[1]=P[0],z[0]=x==w?2:1,P[0]=e,I=1)},this.DSKDATR=function(){for(var e=0,t=2;0<=t;t--)if(z[t]){z[t]=0,e=P[t];break}return t<0?SAEF_warn("disk.DSKDATR() FIFO underflow!"):0<x&&x<3&&D<=0&&this.fifostatus()<0&&Ot(),e},this.DSKPTH=function(e){e&=SAEV_config.chipset.mask==SAEC_Config_Chipset_Mask_OCS?7:31,V=(e<<16|65535&V)>>>0},this.DSKPTL=function(e){V=(4294901760&V|e)>>>0},this.dmal=function(){var e=0;return x&&(3==x?(e=3*(z[0]?1:0)+12*(z[1]?1:0)+48*(z[2]?1:0),e^=63,2==D&&(e&=-49),1==D&&(e&=-61)):e=16*(z[0]?1:0)+4*(z[1]?1:0)+(z[2]?1:0)),e},this.getpt=function(){var e=V;return V+=2,e},this.setup=function(){for(var e=A-1;0<=e;e--){var t=ye[e];tt(t),_t(t,SAEV_config,e,SAEV_config.floppy.drive[e].file,!1)||this.eject(e)}dt(ye[0])&&SAEF_log("disk.setup() No disk in drive DF0."),Be()},this.cleanup=function(){for(var e=0;e<A;e++)nt(ye[e])},this.reset=function(){f=x=K=0;for(var e=A-1;0<=e;e--)it(e);(function(){if(Z=!1,0<SAEV_config.memory.amaxRom.data.length){var e;for(Z=!0,e=0;e<A;e++)if(ye[e].amax)return;for(e=0;e<A;e++)if(1<<e&f)return ye[e].amax=!0,SAEF_log("disk.setamax() using DF%d",e);SAEF_warn("disk.setamax() no drive available. (disable an drive to make it working)")}})(),Q=!1,$=j=0,ee=["","","",""]};const Xt=512,qt=488,Zt=72,jt=1760,Yt=[68,79,83,0,192,32,15,25,0,0,3,112,67,250,0,24,78,174,255,160,74,128,103,10,32,64,32,104,0,22,112,0,78,117,112,255,96,250,100,111,115,46,108,105,98,114,97,114,121],Wt=[68,79,83,1,227,61,14,114,0,0,3,112,67,250,0,62,112,37,78,174,253,216,74,128,103,12,34,64,8,233,0,6,0,34,78,174,254,98,67,250,0,24,78,174,255,160,74,128,103,10,32,64,32,104,0,22,112,0,78,117,112,255,78,117,100,111,115,46,108,105,98,114,97,114,121,0,101,120,112,97,110,115,105,111,110,46,108,105,98,114,97,114,121,0,0,0];function Jt(e,t,n,r){for(var i=0,a=0;a<Xt;a+=4)4294967295<(i+=(e[t+a]<<24|e[t+a+1]<<16|e[t+a+2]<<8|e[t+a+3])>>>0)&&(i-=4294967296);return(i=-i)<0&&(i+=4294967296),null!==n&&(n[r]=i>>>24,n[r+1]=i>>>16&255,n[r+2]=i>>>8&255,n[r+3]=255&i),i}function Qt(e,t){var n={};SAEF_gettimeofday(n,null);var r={days:0,mins:0,ticks:0};SAEF_timeval_to_amiga(n,r,50),r.days==Y&&r.mins==W&&r.ticks==J&&(r.ticks++,3e3<=r.ticks&&(r.ticks=0,r.mins++,1440<=r.mins&&r.days++)),Y=r.days,W=r.mins,J=r.ticks,e[t+0]=r.days>>>24,e[t+1]=r.days>>>16&255,e[t+2]=r.days>>>8&255,e[t+3]=255&r.days,e[t+4]=r.mins>>>24,e[t+5]=r.mins>>>16&255,e[t+6]=r.mins>>>8&255,e[t+7]=255&r.mins,e[t+8]=r.ticks>>>24,e[t+9]=r.ticks>>>16&255,e[t+10]=r.ticks>>>8&255,e[t+11]=255&r.ticks}function $t(e,t,n){var r,i,a,o,s,c=ye[t],_=c.dskchange_time,f=new Uint8Array(C),l=0,u=0;n.clr(),n.unreadable=!0;var d,p=c.cyl,E=k;if(c.cyl=0,k=0,!_t(c,e,t,e.floppy.drive[t].file,!0)||null===c.diskfile)return c.cyl=p,k=E,1;if(n.crc32=c.crc32,n.unreadable=!1,kt(c.bigmfmbuf,c.cyl,11,c.ddhd,c.filetype,{value:0},f,!0),n.hd=2==c.ddhd,c.cyl=p,k=E,2!=(u=0==f[0]||0==f[1]?2:u)){for(s=i=o=0;s<1024;s+=4){n.bootblock[s]=R[s],n.bootblock[s+1]=R[s+1],n.bootblock[s+2]=R[s+2],n.bootblock[s+3]=R[s+3];l=(R[s]<<24|R[s+1]<<16|R[s+2]<<8|R[s+3])>>>0;0==s?r=l:4==s&&(o=l,l=0),4294967295<(a=i+l)&&(a-=4294967296),a<i&&4294967295<++i&&(i-=4294967296),4294967295<(i+=l)&&(i-=4294967296)}if(10!=(u=1263092555==r?10:u)&&3!=(u=(i=(4294967295^i)>>>0)!=(n.bootblockChecksum=o)?3:u)&&(n.bootblockChecksumValid=!0,R[4]=R[5]=R[6]=R[7]=0,2925406252==SAEF_crc32(R,0,49)&&(n.bootblockType=1),u=1146049280==r?10:1146049281==r||1146049282==r||1146049283==r?11:1146049284==r||1146049285==r||1146049286==r||1146049287==r?12:4,l=SAEF_crc32(R,8,84),10<=u&&3780692555==l&&(n.bootblockType=2)),d=40,e=f,p=ye[t],E=p.cyl,p.cyl=d,p.buffered_cyl=-1,yt(p,!0),kt(p.bigmfmbuf,p.cyl,11,p.ddhd,p.filetype,{value:0},e,!0),p.cyl=E,p.buffered_cyl=-1,f[0]&&!Jt(R,0,null,0)&&0==R[0]&&0==R[1]&&0==R[2]&&2==R[3]&&0==R[508]&&0==R[509]&&0==R[510]&&1==R[511]){for(var A=R[432],S=433,m="";0<=--A;)m+=String.fromCharCode(R[S++]);n.diskname=m}}return nt(c),1<_&&(ft(c),SAEV_config.floppy.drive[t].file.clr(),c.dskchange_time=_,SAER.disk.insert(t,c.newfile)),u}function en(e,t,n){SAEF_ZFile_fseek(e,n,SEEK_SET),SAEF_ZFile_fwrite(t,0,Xt,1,e)}function tn(e){for(var t=(e=e.toUpperCase()).length,n=0;n<e.length;n++)t*=13,t+=e.charCodeAt(n),t&=2047;return t%=(Xt>>2)-56}function nn(e,t){for(var n=t.block;255!=e[n];){if(0==e[n])return e[n]=1,t.block=n;n++}for(n=0;255!=e[n];){if(0==e[n])return e[n]=1,t.block=n;n++}return-1}function rn(e,t,n){e[t+0]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=255&n}function an(e,t,n,r,i,a,o){var s=new Uint8Array(Xt),c=new Uint8Array(Xt),_=nn(a,o),f=nn(a,o),l=1;SAEF_ZFile_fseek(i,0,SEEK_END);var u=SAEF_ZFile_ftell(i);SAEF_ZFile_fseek(i,0,SEEK_SET);var d=Math.floor((u+qt-1)/qt);SAEF_memset(t,0,0,Xt),rn(t,0,2),rn(t,4,_),rn(t,8,d>Zt?Zt:d),rn(t,16,f),rn(t,Xt-188,u),Qt(t,Xt-92),t[Xt-80]=r.length,t.set(SAEF_String2Array(r),Xt-79),rn(t,Xt-12,n),rn(t,Xt-4,-3>>>0);for(var p=0,E=0;0<u;){var A=f,S=E;p==Zt&&(p=0,E=nn(a,o),l>Zt+1?(rn(c,8,Zt),rn(c,Xt-8,E),rn(c,4,S),Jt(c,0,c,20),en(e,c,S*Xt)):rn(t,504,E),SAEF_memset(c,0,0,Xt),rn(c,0,16),rn(c,Xt-12,_),rn(c,Xt-4,-3>>>0)),SAEF_memset(s,0,0,Xt),rn(s,0,8),rn(s,4,_),rn(s,8,l++),rn(s,12,u>qt?qt:u),SAEF_ZFile_fread(s,24,u>qt?qt:u,1,i),rn(s,16,f=(f=0)<(u-=qt)?nn(a,o):f),Jt(s,0,s,20),en(e,s,A*Xt),l<=Zt+1?rn(t,308-4*p,A):rn(c,308-4*p,A),p++}return l>Zt&&(rn(c,8,p),Jt(c,0,c,20),en(e,c,E*Xt)),Jt(t,0,t,20),en(e,t,_*Xt),_}function on(e,t){var n=new Uint8Array(Xt),r=new Uint8Array(Xt),i=new Uint8Array(jt+8),a=qt,o="runme.exe",s="startup-sequence",c={block:880};SAEF_ZFile_fseek(e,0,SEEK_END);var _=SAEF_ZFile_ftell(e),f=Math.floor((_+a-1)/a);if(7+f+Math.floor((f+Zt-1)/Zt)>jt)return 0;i[880]=1,i[881]=1,i[0]=1,i[1]=1,i[1760]=-1;var _=(l=r,_=880,a="s",f=nn(i,f=c),SAEF_memset(l,0,0,Xt),rn(l,0,2),rn(l,4,f),Qt(l,420),l[432]=a.length,l.set(SAEF_String2Array(a),433),rn(l,500,_),rn(l,508,2),f),l=SAEF_ZFile_fopen_empty(e,"runme.adf",o.length);SAEF_ZFile_fwrite(SAEF_String2Array(o),0,o.length,1,l);f=an(t,n,_,s,l,i,c);return SAEF_ZFile_fclose(l),rn(r,24+4*tn(s),f),Jt(r,0,r,20),en(t,r,_*Xt),f=an(t,n,880,o,e,i,c),c=n,30<(e=SAEF_ZFile_getfilename(e)).length&&(e=e.substr(0,30)),dn2=e,0==dn2.length&&(dn2="empty"),SAEF_memset(c,0,0,Xt),c[3]=2,c[15]=72,c[312]=c[313]=c[314]=c[315]=255,c[318]=3,c[319]=113,c[432]=dn2.length,c.set(SAEF_String2Array(dn2),433),c[511]=1,Qt(c,420),SAEF_memcpy(c,472,c,420,12),SAEF_memcpy(c,484,c,420,12),rn(n,24+4*tn(o),f),rn(n,24+4*tn("s"),_),Jt(n,0,n,20),en(t,n,880*Xt),function(e,t){SAEF_memset(e,0,0,Xt);for(var n=0;;){for(var r=0,i=0;i<32&&255!=t[2+32*n+i];i++)t[2+32*n+i]||(r|=1<<i);if(r>>>=0,e[4+4*n]=r>>>24,e[4+4*n+1]=r>>>16&255,e[4+4*n+2]=r>>>8&255,e[4+4*n+3]=255&r,255==t[2+32*n+i])break;n++}Jt(e,0,e,0)}(n,i),en(t,n,881*Xt),_=1,SAEF_memset(i=n,0,0,Xt),_?i.set(Yt):i.set(SAEF_String2Array("DOS")),en(t,n,0*Xt),1}function sn(e,t,n){n?e.set(t?Wt:Yt):(e[0]=68,e[1]=79,e[2]=83,e[3]=t?1:0)}function cn(e,t,n,r){n=0<n.length?n:"empty";e[3]=2,e[15]=72,e[312]=e[313]=e[314]=e[315]=255,e[318]=t+1>>8&255,e[319]=t+1&255,e[432]=n.length,e.set(SAEF_String2Array(n),433),e[511]=1,Qt(e,420),SAEF_memcpy(e,472,e,420,12),SAEF_memcpy(e,484,e,420,12),Jt(e,0,e,20),SAEF_memset(e,516,255,2*t>>3),r==SAEC_Disk_Create_Type_35_DD?e[626]=63:e[732]=224,Jt(e,512,e,512)}function _n(e,t,n,r,i,a,o){var s,c=1,_=!1,f=2*(t==SAEC_Disk_Create_Mode_Custom?83:80),l=901120,u=11;n!=SAEC_Disk_Create_Type_35_DD_PC&&n!=SAEC_Disk_Create_Type_35_HD_PC||(l=737280,u=9);var d=2*b();n==SAEC_Disk_Create_Type_35_HD||n==SAEC_Disk_Create_Type_35_HD_PC?(l<<=1,d<<=1,c=2):n==SAEC_Disk_Create_Type_525_SD&&(l>>=1,f>>=1),null!==o&&(s=SAEF_ZFile_ftell(o),SAEF_ZFile_fseek(o,0,SEEK_SET));var p=SAEF_ZFile_fopen_empty(null,e,l),E=new Uint8Array(32768);if(null!==p){var A=2*u*512;if(SAEF_memset(E,0,0,32768),t==SAEC_Disk_Create_Mode_Normal){for(y=0;y<l;y+=A)SAEF_memset(E,0,0,A),n<=SAEC_Disk_Create_Type_35_HD&&(0==y?sn(E,i,a):y==l>>1&&cn(E,l/1024,r,n)),SAEF_ZFile_fwrite(E,0,A,1,p);_=!0}else{var t=new Uint8Array(4),S=new Uint8Array(12),m=new Uint8Array(12),h=d;SAEF_ZFile_fwrite(SAEF_String2Array("UAE-1ADF"),0,8,1,p),t[0]=0,t[1]=0,t[2]=0,t[3]=f,SAEF_ZFile_fwrite(t,0,4,1,p),S[0]=0,S[1]=0,S[2]=0,S[3]=1,S[4]=0,S[5]=0,S[6]=h>>8,S[7]=255&h,S[8]=0,S[9]=0,S[10]=0,S[11]=0,m.set(S),m[3]=0,m[9]=8*h>>16&255,m[10]=8*h>>8&255,m[11]=8*h&255;for(var g=i||a||0<r.length,y=0;y<f;y++){var v=new Uint8Array(12);g||null!==o?v.set(m):v.set(S),SAEF_ZFile_fwrite(v,0,v.length,1,p)}for(y=0;y<f;y++)SAEF_memset(E,0,0,32768),null!==o?SAEF_ZFile_fread(E,0,11*c,512,o):g&&(0==y?sn(E,i,a):80==y&&cn(E,880*c,r,n)),SAEF_ZFile_fwrite(E,0,h,1,p);_=!0}}return null!==o&&SAEF_ZFile_fseek(o,s,SEEK_SET),_?p:null}this.examine=function(e,t){return 1!=$t(SAEV_config,t,e)?SAEE_None:SAEE_Internal},this.EXE2ADF=function(e){var t=SAEF_ZFile_getname(e),n="",r=t.lastIndexOf(".");-1!=r?(n=t.substr(0,r),n+=".ADF"):n=t+".ADF";r=SAEF_ZFile_fopen_empty(e,n,901120);return null===r?null:(on(e,r)?(SAEF_ZFile_fseek(r,0,SEEK_SET),SAEF_ZFile_fclose(e),e=null,SAEF_log("disk.EXE2ADF() converted '%s' to '%s'",t,n)):(SAEF_ZFile_fclose(r),r=null,guru(sprintf("Can't convert '%s' to ADF.",t))),r)},this.create=function(e,t,n,r,i,a,o){a=_n(t,n,r,i,a,o,null);if(null===a)return!1;switch(r){case SAEC_Disk_Create_Type_35_DD:SAEV_config.floppy.drive[e].type=SAEC_Config_Floppy_Type_35_DD;break;case SAEC_Disk_Create_Type_35_HD:SAEV_config.floppy.drive[e].type=SAEC_Config_Floppy_Type_35_HD;break;case SAEC_Disk_Create_Type_35_DD_PC:SAEV_config.floppy.drive[e].type=SAEC_Config_Floppy_Type_35_DD_PC;break;case SAEC_Disk_Create_Type_35_HD_PC:SAEV_config.floppy.drive[e].type=SAEC_Config_Floppy_Type_35_HD_PC;break;case SAEC_Disk_Create_Type_525_SD:SAEV_config.floppy.drive[e].type=SAEC_Config_Floppy_Type_525_SD}o=SAEF_ZFile_getdata(a,0,-1),r=SAEV_config.floppy.drive[e].file;return r.name=SAEF_ZFile_getname(a),r.data=SAEF_Array2String(o),r.size=SAEF_ZFile_size(a),r.prot=!1,SAEF_ZFile_fclose(a),!0}}var SAEV_RTC_bank=null,SAEV_RTC_delayed_write=0;function SAEO_RTC(){const i=!1;var a=0,o=0,s=0;var c=null,_=null;function n(e){this.tm_sec=e.getSeconds(),this.tm_min=e.getMinutes(),this.tm_hour=e.getHours(),this.tm_mday=e.getDate(),this.tm_mon=e.getMonth(),this.tm_year=e.getFullYear()-1900,this.tm_wday=e.getDay(),this.tm_yday=0,this.tm_isdst=!1}function t(){var e,t=new Date;return SAEV_config.chipset.rtc.adjust&&(e=t.valueOf(),t.setTime(e+1e3*SAEV_config.chipset.rtc.adjust)),new n(t)}function r(e,t){var n=0;if(SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_MSM6242B||SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_MSM6242B_A2000)switch(e){case 0:n=t.tm_sec%10;break;case 1:n=t.tm_sec/10>>>0;break;case 2:n=t.tm_min%10;break;case 3:n=t.tm_min/10>>>0;break;case 4:n=t.tm_hour%10;break;case 5:4&s?n=t.tm_hour/10>>>0:(n=t.tm_hour%12/10>>>0,n|=12<=t.tm_hour?4:0);break;case 6:n=t.tm_mday%10;break;case 7:n=t.tm_mday/10>>>0;break;case 8:n=(t.tm_mon+1)%10;break;case 9:n=(t.tm_mon+1)/10>>>0;break;case 10:n=t.tm_year%10;break;case 11:n=t.tm_year/10>>>0&15;break;case 12:n=t.tm_wday;break;case 13:n=a;break;case 14:n=o;break;case 15:n=s}else if(SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_RF5C01A){var r=3&a;if(2<=r&&e<13)return c[e]>>(2==r?0:4)&15;if(1==r&&e<13)return n=_[e],i&&SAEF_log("rtc.get8(0x%X, ct) ALARM (0x%x)",e,n),n;switch(e){case 0:n=t.tm_sec%10;break;case 1:n=t.tm_sec/10>>>0;break;case 2:n=t.tm_min%10;break;case 3:n=t.tm_min/10>>>0;break;case 4:n=t.tm_hour%10;break;case 5:1&_[10]?n=t.tm_hour/10>>>0:(n=t.tm_hour%12/10>>>0,n|=12<=t.tm_hour?2:0);break;case 6:n=t.tm_wday;break;case 7:n=t.tm_mday%10;break;case 8:n=t.tm_mday/10>>>0;break;case 9:n=(t.tm_mon+1)%10;break;case 10:n=(t.tm_mon+1)/10>>>0;break;case 11:n=t.tm_year%100%10;break;case 12:n=t.tm_year%100/10>>>0;break;case 13:n=a;break;case 14:case 15:n=0}}return i&&SAEF_log("rtc.get8(0x%X, ct) (0x%x)",e,n),n}function f(e){return 32768<=(65535&e)&&0<=SAEV_config.chipset.fatGaryRev?SAER.memory.dummyGet(e,2,!1,0):l(e)<<8|l(e+1)}function l(e){return 32768<=(65535&e)&&0<=SAEV_config.chipset.fatGaryRev||2==(3&(e&=63))||0==(3&e)||SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_None?SAER.memory.dummyGet(e,1,!1,0):r(e>>2,t())}function u(e,t){32768<=(65535&e)&&0<=SAEV_config.chipset.fatGaryRev?SAER.memory.dummyPut(e,2,t):(d(e,t>>8),d(e+1,255&t))}function d(e,t){if(32768<=(65535&e)&&0<=SAEV_config.chipset.fatGaryRev)SAER.memory.dummyPut(e,1,t);else if(1==(1&(e&=63))&&SAEV_config.chipset.rtc.type!=SAEC_Config_RTC_Type_None){if(e>>=2,t&=15,SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_MSM6242B||SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_MSM6242B_A2000)switch(i&&SAEF_log("rtc.put8(0x%X, 0x%x)",e,t),e){case 13:a=9&t;break;case 14:o=t;break;case 15:s=t}else if(SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_RF5C01A){var n=3&a;if(2<=n&&e<13){var r=c[e];return c[e]&=2==n?240:15,c[e]|=t<<(2==n?0:4),void(c[e]!=r&&(SAEV_RTC_delayed_write=-1))}if(1==n&&e<13){i&&SAEF_log("rtc.put8(0x%X, 0x%x) ALARM",e,t);r=_[e];return _[e]=t,_[0]=_[1]=_[9]=_[12]=0,_[3]&=-9,_[5]&=-13,_[6]&=-9,_[8]&=-13,_[10]&=-15,_[11]&=-13,void(_[e]!=r&&(SAEV_RTC_delayed_write=-1))}switch(i&&SAEF_log("rtc.put8(0x%X, 0x%x)",e,t),e){case 13:a=t;break;case 14:o=t;break;case 15:s=t}}SAEV_RTC_delayed_write=-1}}this.write=function(){SAEV_config.chipset.rtc.type,SAEC_Config_RTC_Type_None},this.hardreset=function(){switch(SAEV_config.chipset.rtc.type){case SAEC_Config_RTC_Type_None:type="none";break;case SAEC_Config_RTC_Type_MSM6242B:type="MSM6242B";break;case SAEC_Config_RTC_Type_RF5C01A:type="RF5C01A";break;case SAEC_Config_RTC_Type_MSM6242B_A2000:type="MSM6242B A2000"}if(SAEF_log("rtc.hardreset() type '%s'",type),SAEV_RTC_delayed_write=0,SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_MSM6242B||SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_MSM6242B_A2000)a=1,o=0,s=4,_=c=null;else if(SAEV_config.chipset.rtc.type==SAEC_Config_RTC_Type_RF5C01A){a=8,s=o=0,c=new Uint8Array(16),_=new Uint8Array(16);for(var e=0;e<16;e++)c[e]=_[e]=0;_[10]=1}SAEV_RTC_bank.name="Battery backed up clock ("+type+")"},SAEV_RTC_bank=new SAEO_Memory_addrbank(function(e){return 32768<=(65535&e)&&0<=SAEV_config.chipset.fatGaryRev?SAER.memory.dummyGet(e,4,!1,0):(f(e)<<16|f(e+2))>>>0},f,l,function(e,t){32768<=(65535&e)&&0<=SAEV_config.chipset.fatGaryRev?SAER.memory.dummyPut(e,4,t):(u(e,t>>>16),u(e+2,65535&t))},u,d,SAEF_Memory_defaultXLate,SAEF_Memory_defaultCheck,null,null,"Battery backed up clock (none)",SAEF_Memory_dummyGetInst32,SAEF_Memory_dummyGetInst16,SAEC_Memory_addrbank_flag_IO,null,63,14155776)}const SAEC_CPU_halt_BUS_ERROR_DOUBLE_FAULT=1,SAEC_CPU_halt_DOUBLE_FAULT=2,SAEC_CPU_halt_OPCODE_FETCH_FROM_NON_EXISTING_ADDRESS=3,SAEC_CPU_halt_AUTOCONFIG_CONFLICT=7;function SAEO_M68K(){var s=!1;this.halted=0;var c=this.stopped=!1,n=!1;this.setup=function(){return SAER.cpu.setup()},this.dump=function(){SAER.cpu.dump()},this.cpureset=function(){if(s=SAEV_config.cpu.resetDelay,SAEF_setSpcFlags(SAEC_spcflag_CHECK),SAEV_config.cpu.compatible&&SAEV_config.cpu.model<=SAEC_Config_CPU_Model_68020)SAER.playfield.custom_reset(!1,!1);else{var e=SAER_CPU_getPC()+2,t=SAER_Memory_getBank(e);if(t.check(e,2)){SAEF_log("cpu.cpureset() PC=%x (%s)...",e-2,t.name);var n=SAER_Memory_get16(e);if(SAER.playfield.custom_reset(!1,!1),t===SAER_Memory_getBank(e))return;if(20176==(-8&n)){n=SAER_CPU_regs.a[7&n];return n<524288&&(n+=16252928),SAEF_log("cpu.cpureset() reset/jmp combination at %08x emulated -> %x",e,n),void SAER.cpu.setPC_normal(n-2)}}SAEF_log("cpu.cpureset() PC=%x (%s), invalid memory -> %x.",e,t.name,16252930),SAER.playfield.custom_reset(!1,!1),SAER.cpu.setPC_normal(16252928)}};var r=!(this.cpu_halt=function(e){this.halted||(SAEF_log("CPU halted: reason = %d PC=%08x",e,SAER_CPU_getPC()),this.halted=e,SAER.gui.data.cpu_halted=e,SAER.gui.led(SAEC_GUI_LED_CPU,0,-1),0<=e&&(SAER_CPU_regs.intmask=7,SAER_Audio_deactivate()),SAEF_setSpcFlags(SAEC_spcflag_CHECK))}),i=!0;function _(e){for(this.stopped=!1,SAEF_clrSpcFlags(SAEC_spcflag_STOP),SAEF_assert(e<8&&0<=e);(SAER_CPU_exception(e+24),SAER_CPU_regs.intmask=e,SAEV_config.cpu.compatible)&&!((e=SAER.custom.intlev())<=0||SAER_CPU_regs.intmask>=e););SAER.m68k.doint()}this.is_keyboardreset=function(){return r},this.is_hardreset=function(){return i},this.m68k_pause=function(){SAEV_command==SAEC_command_Pause?(SAEV_command=0,SAER.paused||(SAEF_log("->pause"),SAER.paused=!0,SAER.pause_program(1))):SAEV_command==SAEC_command_Resume?(SAEV_command=0,SAER.paused&&(SAEF_log("->resume"),SAER.pause_program(0),SAER.paused=!1,n=!1)):SAEV_command!=-SAEC_command_Quit&&SAEV_command!=-SAEC_command_Reset&&SAEV_command!=-SAEC_command_KeyboardReset&&SAEV_command!=-SAEC_command_HardReset||(SAEF_log("->stop"),SAER.paused=!1),SAER.paused?setTimeout(function(){SAER.m68k.m68k_pause()},500):setTimeout(function(){SAER.m68k.m68k_cycle(0,0)},0)},this.m68k_cycle=function(e,t){try{if(0<SAEV_command){if(r=SAEV_command==SAEC_command_KeyboardReset,i=0!=((SAEV_command==SAEC_command_HardReset?1:0)|e),SAEV_command==SAEC_command_Quit)return void this.m68k_gone();if(SAEV_command==SAEC_command_Pause)return void this.m68k_pause();SAEV_Events_currcycle=SAEV_Events_vsync_counter=SAEV_Events_hsync_counter=e=SAEV_command=0,SAER_Events_eventtab[SAEC_Events_EV_HSYNC].oldcycles=0,SAER.playfield.custom_reset(i,r),function(e){SAEV_spcflags=0,SAEF_setSpcFlags(SAEC_spcflag_CHECK),this.halted=0,c=!1,SAER.gui.data.cpu_halted=0,SAER.gui.led(SAEC_GUI_LED_CPU,0,-1),n=s=!1,SAER.cpu.reset(e)}(i),i&&(SAER.memory.clear(),SAEF_log("m68k.m68k_cycle() hardreset, memory cleared.")),0==SAEV_config.audio.mode&&(SAER_Events_eventtab[SAEC_Events_EV_AUDIO].active=!1),SAER.cpu.setPC_normal(SAER_CPU_regs.pc),"function"==typeof SAEV_config.hook.event.reseted&&SAEV_config.hook.event.reseted(i),i=!1}t&&(SAER.playfield.custom_prepare(),t=0),SAEF_clrSpcFlags(SAEC_spcflag_MODE_CHANGE),this.halted&&this.cpu_halt(this.halted),!1!==n&&(SAEV_Events_reflowtime=SAEF_now()-n),SAER_CPU_run_func(),n=SAEF_now(),setTimeout(function(){SAER.m68k.m68k_cycle(e,t)},0)}catch(e){if(this.m68k_gone(),!(e instanceof SAEO_Error))throw e;"function"==typeof SAEV_config.hook.log.error?SAEV_config.hook.log.error(e.err,e.msg):alert(e.msg)}},this.m68k_go=function(e){SAER.events.reset_frame_rate_hack(),SAER.running=!0,setTimeout(function(){SAER.m68k.m68k_cycle(1,1)},0)},this.m68k_gone=function(){SAER.running=!1,SAER.leave_program()},this.m68k_setstopped=function(){this.stopped=!0,0==(SAEV_spcflags&SAEC_spcflag_DOTRACE)?SAEF_setSpcFlags(SAEC_spcflag_STOP):this.m68k_resumestopped()},this.m68k_resumestopped=function(){this.stopped&&(this.stopped=!1,SAER_CPU_fill_prefetch(),SAEF_clrSpcFlags(SAEC_spcflag_STOP))},this.doint=function(){SAEV_config.cpu.compatible&&SAEV_config.cpu.model<SAEC_Config_CPU_Model_68020?SAEF_setSpcFlags(SAEC_spcflag_INT):SAEF_setSpcFlags(SAEC_spcflag_DOINT)},this.doint_trace=function(e){SAEV_config.cpu.compatible&&SAEV_config.cpu.model<SAEC_Config_CPU_Model_68020?SAEF_setSpcFlags(SAEC_spcflag_INT):SAEF_setSpcFlags(SAEC_spcflag_DOINT),(e?SAEF_setSpcFlags:SAEF_clrSpcFlags)(SAEC_spcflag_TRACE)},this.do_specialties=function(e){if(SAEV_spcflags&SAEC_spcflag_MODE_CHANGE)return!0;if(SAEV_spcflags&SAEC_spcflag_CHECK){if(this.halted&&(SAEF_clrSpcFlags(SAEC_spcflag_CHECK),function(){for(;SAER.m68k.halted;){var e=SAER.playfield.get_vpos();if(0==e&&c&&(c=!1,SAEF_sleep(8)),e&&(c=!0),SAER.events.do_cycles(8*SAEC_Events_CYCLE_UNIT),SAEV_spcflags&SAEC_spcflag_COPPER&&SAER.copper.cycle(),SAEV_spcflags&&SAEV_spcflags&(SAEC_spcflag_BRK|SAEC_spcflag_MODE_CHANGE))return 1}}()))return!0;if(s){for(var t=60,n=-1;0<t&&0==SAEV_command;)SAER.events.do_cycles(8*SAEC_Events_CYCLE_UNIT),SAEV_spcflags&SAEC_spcflag_COPPER&&SAER.copper.cycle(),SAEV_Events_timeframes!=n&&(n=SAEV_Events_timeframes,t--);s=!1}SAEF_clrSpcFlags(SAEC_spcflag_CHECK)}for(SAEV_spcflags&SAEC_spcflag_COPPER&&SAER.copper.cycle();SAEV_spcflags&SAEC_spcflag_BLTNASTY&&SAEF_Custom_dmaen(SAEC_Custom_DMAF_BLTEN)&&0<e&&!SAEV_config.chipset.blitter.cycle_exact;){var r=SAER.blitter.blitnasty();if(r<0)break;0<r?(e-=r*SAEC_Events_CYCLE_UNIT*2)<SAEC_Events_CYCLE_UNIT&&(e=0):r=4,SAER.events.do_cycles(r*SAEC_Events_CYCLE_UNIT),SAEV_spcflags&SAEC_spcflag_COPPER&&SAER.copper.cycle()}SAEV_spcflags&SAEC_spcflag_DOTRACE&&SAER_CPU_exception(9);for(var i,a,o=!0;SAEV_spcflags&SAEC_spcflag_STOP&&!(SAEV_spcflags&SAEC_spcflag_BRK);)if(o||SAER.events.do_cycles(4*SAEC_Events_CYCLE_UNIT),o=!1,SAEV_spcflags&SAEC_spcflag_COPPER&&SAER.copper.cycle(),SAEV_spcflags&(SAEC_spcflag_INT|SAEC_spcflag_DOINT)&&(a=SAER.custom.intlev(),SAEF_clrSpcFlags(SAEC_spcflag_INT|SAEC_spcflag_DOINT),0<a&&a>SAER_CPU_regs.intmask&&_(a)),SAEV_spcflags&SAEC_spcflag_MODE_CHANGE)return this.m68k_resumestopped(),!0;return SAEV_spcflags&SAEC_spcflag_TRACE&&(SAER_CPU_regs.t0&&SAEV_config.cpu.model>=SAEC_Config_CPU_Model_68020?(SAER.cpu.setPC_normal(SAER_CPU_getPC()),SAER_CPU_fill_prefetch(),(20083==(i=SAER_Memory_get16(SAER_CPU_regs.pc))||20084==i||20085==i||20087==i||20086==i||20096==(65472&i)||20160==(65472&i)||24832==(65280&i)||24576==(61440&i)&&ccTab[i>>8&15]()||20560==(61680&i)&&!ccTab[i>>8&15]()&&!0&SAER_CPU_regs.d[7&i])&&(SAEF_clrSpcFlags(SAEC_spcflag_TRACE),SAEF_setSpcFlags(SAEC_spcflag_DOTRACE))):SAER_CPU_regs.t1&&(SAEF_clrSpcFlags(SAEC_spcflag_TRACE),SAEF_setSpcFlags(SAEC_spcflag_DOTRACE))),SAEV_spcflags&SAEC_spcflag_INT&&(a=SAER.custom.intlev(),SAEF_clrSpcFlags(SAEC_spcflag_INT|SAEC_spcflag_DOINT),0<a&&(a>SAER_CPU_regs.intmask||7==a)&&_(a)),SAEV_spcflags&SAEC_spcflag_DOINT&&(SAEF_clrSpcFlags(SAEC_spcflag_DOINT),SAEF_setSpcFlags(SAEC_spcflag_INT)),!!(SAEV_spcflags&SAEC_spcflag_BRK)&&(SAEF_clrSpcFlags(SAEC_spcflag_BRK),!0)}}var SAER_CPU_regs=null,SAER_CPU_setPC=null,SAER_CPU_getPC=null,SAER_CPU_exception=null,SAER_CPU_run_func=null,SAER_CPU_fill_prefetch=null,SAEV_CPU_cycles=0;function SAEO_CPU(){function i(e){this.num=e}i.prototype=new Error;var _=0,f=0,l=0,u=!1,d=!1,p=!1,E=0;const n=8,r=4,a=2,o=1,s=3,c=15,A=64,S=A-1,m=~((A<<2)-1)>>>0;function e(){this.data=0,this.tag=0,this.valid=!1}for(var h=new Array(A),t=0;t<A;t++)h[t]=new e;const g=8192,y=4096,v=2048,b=1024;const C=256,k=16,R=8,w=4,x=2,D=1,M=13075,F=16159,T=16,V=T-1,I=~((T<<4)-1)>>>0;function P(){this.data=new Uint32Array(4),this.valid=[!1,!1,!1,!1],this.tag=0}for(var z=new Array(T),t=0;t<T;t++)z[t]=new P;for(var O=new Array(T),t=0;t<T;t++)O[t]=new P;var L=0,N=0,B=0,U=0,K=0,G=0,H=0,X=0;var q=new function(){this.a=new Uint32Array(8),this.d=new Uint32Array(8),this.pc=0,this.pc_p=0,this.pc_oldp=0,this.opcode=0,this.instruction_pc=0,this.db=0,this.irc=0,this.ir=0,this.usp=0,this.isp=0,this.msp=0,this.t1=!1,this.t0=!1,this.s=!1,this.m=!1,this.intmask=0,this.x=!1,this.n=!1,this.z=!1,this.v=!1,this.c=!1,this.stopped=!1,this.halted=0,this.vbr=0,this.sfc=0,this.dfc=0,this.cacr=0,this.caar=0,this.prefetch020=new Uint32Array(4),this.prefetch020addr=0,this.cacheholdingdata020=0,this.cacheholdingaddr020=0};SAER_CPU_regs=q;const Z=8192;var j=0,Y=0,W=0,J=0;const Q=2;var $=Q,ee=null,te=null,ne=null,re=null,ie=null,ae=null,oe=null,se=null,ce=null,_e=null,fe=null;const le=1,ue=2,de=3,pe=4,Ee=5,Ae=6,Se=7,me=8,he=9,ge=10,ye=11,ve=12,be=["T","F","HI","LS","CC","CS","NE","EQ","VC","VS","PL","MI","GE","LT","GT","LE"];var Ce=[],ke=[],Re=[],we=[],xe=[],De=[],Me=[],Fe=[],Te=[],Ve=0;function Ie(){q.prefetch020addr=4294967295,q.cacheholdingaddr020=4294967295,function(){var e=SAEV_config.cpu.compatible;if(SAEV_config.cpu.model==SAEC_Config_CPU_Model_68020){if(q.cacr&n){for(var t=0;t<A;t++)h[t].valid=!1;q.cacr&=~n}q.cacr&r&&(h[q.caar>>>2&S].valid=!1,q.cacr&=~r)}else if(SAEV_config.cpu.model==SAEC_Config_CPU_Model_68030){if(q.cacr&R){if(e)for(t=0;t<T;t++)z[t].valid[0]=!1,z[t].valid[1]=!1,z[t].valid[2]=!1,z[t].valid[3]=!1;q.cacr&=~R}if(q.cacr&w&&(z[q.caar>>>4&V].valid[q.caar>>>2&3]=0,q.cacr&=~w),q.cacr&v){if(e)for(t=0;t<T;t++)O[t].valid[0]=!1,O[t].valid[1]=!1,O[t].valid[2]=!1,O[t].valid[3]=!1;q.cacr&=~v}q.cacr&b&&(O[q.caar>>>4&V].valid[q.caar>>>2&3]=0,q.cacr&=~b)}}()}function Pe(e){var t,n,r;q.cacheholdingaddr020!=(e=(-4&e)>>>0)&&(r=e>>>2&S,t=(e&m|(q.s?1:0))>>>0,(n=h[r]).valid&&n.tag==t?(q.cacheholdingaddr020=e,q.cacheholdingdata020=n.data):(r=SAER_Memory_banks[e>>>16].getInst32(e),q.cacr&a||(n.tag=t,n.valid=0!=(q.cacr&o),n.data=r),q.cacheholdingaddr020=e,q.cacheholdingdata020=r))}function ze(e,t,n){var r=(t=(-4&t)>>>0)>>>4&V;return n.tag=(t&I|(q.s?1:0))>>>0,n.lws=t>>>2&3,e[r]}function Oe(e,t,n,r){e.tag!=n&&(e.valid[0]=e.valid[1]=e.valid[2]=e.valid[3]=!1),e.tag=n,e.valid[r]=!0,e.data[r]=t}function Le(e){if(q.cacheholdingaddr020!=(e=(-4&e)>>>0)){var t={},n=ze(z,e,t);if(n.valid[t.lws]&&n.tag==t.tag)return q.cacheholdingaddr020=e,void(q.cacheholdingdata020=n.data[t.lws]);var r=SAER_Memory_banks[e>>>16].getInst32(e);(q.cacr&(x|D))==D&&Oe(n,r,t.tag,t.lws),(q.cacr&(k|D))!=(k|D)||0!=t.lws||n.valid[1]||n.valid[2]||n.valid[3]||SAER_Memory_banktype[e>>>16]!=SAEC_Memory_banktype_FAST32||(n.data[1]=SAER_Memory_banks[e+4>>>16].getInst32(e+4),n.data[2]=SAER_Memory_banks[e+8>>>16].getInst32(e+8),n.data[3]=SAER_Memory_banks[e+12>>>16].getInst32(e+12),n.valid[1]=n.valid[2]=n.valid[3]=!0),q.cacheholdingaddr020=e,q.cacheholdingdata020=r}}function Ne(e){return 0!=SAER_Memory_cachable[e>>>16]}function Be(e,t){return q.cacr&C&&Ne(e)?(r=t,s=3&(n=e),_=ze(O,n,c={}),n=(-4&n)>>>0,_.valid[c.lws]&&_.tag==c.tag?(i=_.data[c.lws],0<SAEV_AutoConf_boot_rom_type&&(a=SAER_Memory_get32(n))!=i&&(SAEF_warn("cpu.read_dcache030x() data cache mismatch %d %d %08x %08x != %08x %08x %d PC=%08x",r,s,n,a,i,c.tag,c.lws,et()),i=a)):Oe(_,i=SAER_Memory_get32(n),c.tag,c.lws),0==r?255&(i>>>=8*(3-s)):1==r&&s<=2?65535&(i>>>=8*(2-s)):2==r&&0==s?((q.cacr&(y|C))!=(y|C)||0!=c.lws||_.valid[1]||_.valid[2]||_.valid[3]||SAER_Memory_banktype[n>>16]!=SAEC_Memory_banktype_FAST32||(_.data[1]=SAER_Memory_get32(n+4),_.data[2]=SAER_Memory_get32(n+8),_.data[3]=SAER_Memory_get32(n+12),_.valid[1]=_.valid[2]=_.valid[3]=!0),i>>>0):((_=ze(O,n+=4,c={})).valid[c.lws]&&_.tag==c.tag?(o=_.data[c.lws],0<SAEV_AutoConf_boot_rom_type&&(a=SAER_Memory_get32(n))!=o&&(SAEF_warn("cpu.read_dcache030x() data cache mismatch %d %d %08x %08x != %08x %08x %d PC=%08x",r,s,n,a,o,c.tag,c.lws,et()),o=a)):Oe(_,o=SAER_Memory_get32(n),c.tag,c.lws),1==r&&3==s?65535&(i<<8|o>>>24):2==r&&1==s?(i<<8|o>>>24)>>>0:2==r&&2==s?(i<<16|o>>>16)>>>0:2==r&&3==s?(i<<24|o>>>8)>>>0:(SAEF_warn("cpu.read_dcache030x() weirdness!?"),0))):(2==t?SAER_Memory_get32:1==t?SAER_Memory_get16:SAER_Memory_get8)(e);var n,r,i,a,o,s,c,_}function Ue(e){return Be(e,2)}function Ke(e){return Be(e,1)}function Ge(e){return Be(e,0)}function He(e,t,n){var r,i,a,o,s,c,_,f;q.cacr&C&&Ne(e)&&(i=t,a=n,s=3&(r=e),c=0!=(q.cacr&g),f=ze(O,r,_={}),2==a&&0==s&&c?Oe(f,i,_.tag,_.lws):(((o=f.tag==_.tag&&f.valid[_.lws])||c)&&(2==a?o?(f.data[_.lws]&=~(4294967295>>>8*s),f.data[_.lws]|=i>>>8*s):f.valid[_.lws]=!1:1==a?o?(f.data[_.lws]&=~(4294901760>>>8*s),f.data[_.lws]|=i<<16>>>8*s):f.valid[_.lws]=!1:0==a&&(o?(f.data[_.lws]&=~(4278190080>>>8*s),f.data[_.lws]|=i<<24>>>8*s):f.valid[_.lws]=!1)),0==a||1==a&&s<=2||2==a&&0==s||((o=(r=ze(O,r+4,_={})).tag==_.tag&&r.valid[_.lws])||c)&&(2==a?o?(r.data[_.lws]&=4294967295>>>8*s,r.data[_.lws]|=i<<8*(4-s)):r.valid[_.lws]=!1:1==a&&(o?(r.data[_.lws]&=16777215,r.data[_.lws]|=i<<24):r.valid[_.lws]=!1)))),(2==n?SAER_Memory_put32:1==n?SAER_Memory_put16:SAER_Memory_put8)(e,t)}function Xe(e,t){He(e,t,2)}function qe(e,t){He(e,t,1)}function Ze(e,t){He(e,t,0)}function je(e){var t,e=et()+e;return 2&e?(t=65535&q.prefetch020[0],q.prefetch020[0]=q.prefetch020[1],Pe(e+2+4),q.prefetch020[1]=q.cacheholdingdata020,q.db=q.prefetch020[0]>>>16):(t=q.prefetch020[0]>>>16,q.db=q.prefetch020[0]),t}function Ye(e){return(je(e)<<16|je(e+2))>>>0}function We(e){var t,e=et()+e;return 2&e?(t=65535&q.prefetch020[0],q.prefetch020[0]=q.prefetch020[1],Le(e+2+4),q.prefetch020[1]=q.cacheholdingdata020):t=q.prefetch020[0]>>>16,t}function Je(e){return(We(e)<<16|We(e+2))>>>0}function Qe(){var e,t;SAEV_config.cpu.compatible&&(SAEV_config.cpu.model==SAEC_Config_CPU_Model_68030?(Le(t=(-4&et())>>>0),q.prefetch020[0]=q.cacheholdingdata020,Le(4+t),q.prefetch020[1]=q.cacheholdingdata020,q.irc=We(0)):SAEV_config.cpu.model==SAEC_Config_CPU_Model_68020?(Pe(e=(-4&et())>>>0),q.prefetch020[0]=q.cacheholdingdata020,Pe(4+e),q.prefetch020[1]=q.cacheholdingdata020,q.irc=je(0)):SAEV_config.cpu.model<=SAEC_Config_CPU_Model_68010&&(e=et(),q.ir=SAER_Memory_banks[e>>>16].getInst16(e),q.irc=SAER_Memory_banks[e+2>>>16].getInst16(e+2)))}function $e(e){q.instruction_pc=q.pc=e,q.pc_p=q.pc_oldp=e}function et(){return q.pc+(q.pc_p-q.pc_oldp)}function tt(){$e(et())}function nt(e){q.instruction_pc=q.pc=e}function rt(){return q.pc}function it(e){q.pc+=e}function at(){return rt()+$}function ot(e){nt(e),$=Q,Qe()}function st(){it($),$=Q,q.ir=ut(2)}function ct(){it($),$=Q,q.irc=je(0)}function _t(){it($),$=Q,q.irc=We(0)}function ft(){var e=SAER_Memory_banks[q.pc_p>>>16].getInst16(q.pc_p);return q.pc_p+=2,e}function lt(){var e=SAER_Memory_banks[q.pc_p>>>16].getInst32(q.pc_p);return q.pc_p+=4,e}function ut(e){var t=q.irc;return q.irc=q.db=SAER_Memory_banks[q.pc+e>>>16].getInst16(q.pc+e),t}function dt(e){return(ut(e)<<16|ut(e+2))>>>0}function pt(){var e=$;return $+=2,ut(e+2)}function Et(){var e=$;return $+=4,dt(e+2)}function At(e){e=SAER_Memory_get8(e);return q.db=e<<8|e,e}function St(e){e=SAER_Memory_get16(e);return q.db=e}function mt(e){return(St(e)<<16|St(e+2))>>>0}function ht(e,t){q.db=t<<8|t,SAER_Memory_put8(e,t)}function gt(e,t){q.db=t,SAER_Memory_put16(e,t)}function yt(e,t){gt(e,t>>>16),gt(e+2,65535&t)}function vt(){var e=$;return $+=2,je(e)}function bt(){var e=$;return $+=4,Ye(e)}function Ct(){var e=$;return $+=2,We(e)}function kt(){var e=$;return $+=4,Je(e)}function Rt(){return(q.x?1:0)<<4|(q.n?1:0)<<3|(q.z?1:0)<<2|(q.v?1:0)<<1|(q.c?1:0)}function wt(e){q.x=1==(e>>4&1),q.n=1==(e>>3&1),q.z=1==(e>>2&1),q.v=1==(e>>1&1),q.c=1==(1&e)}function xt(){return(q.t1?1:0)<<15|(q.t0?1:0)<<14|(q.s?1:0)<<13|(q.m?1:0)<<12|q.intmask<<8|(q.x?1:0)<<4|(q.n?1:0)<<3|(q.z?1:0)<<2|(q.v?1:0)<<1|(q.c?1:0)}function Dt(e){var t=q.m,n=q.s;q.x=1==(e>>4&1),q.n=1==(e>>3&1),q.z=1==(e>>2&1),q.v=1==(e>>1&1),q.c=1==(1&e);var r=1==(e>>15&1),i=1==(e>>14&1),a=1==(e>>13&1),o=1==(e>>12&1),e=e>>8&7;q.t1==r&&q.t0==i&&q.s==a&&q.m==o&&q.intmask==e||(q.t1=r,q.t0=i,q.s=a,q.m=o,q.intmask=e,SAEV_config.cpu.model>=SAEC_Config_CPU_Model_68020?n!=q.s?n?(t?q.msp=q.a[7]:q.isp=q.a[7],q.a[7]=q.usp):(q.usp=q.a[7],q.a[7]=q.m?q.msp:q.isp):n&&t!=q.m&&(t?(q.msp=q.a[7],q.a[7]=q.isp):(q.isp=q.a[7],q.a[7]=q.msp)):(q.t0=q.m=0,n!=q.s&&(n?(q.isp=q.a[7],q.a[7]=q.usp):(q.usp=q.a[7],q.a[7]=q.isp))),SAER.m68k.doint_trace(q.t1||q.t0))}function Mt(e){return 2==e||3==e||4==e||8==e||10==e||11==e?q.instruction_pc:et()}function Ft(e){var t;if(!(SAEV_config.cpu.model>SAEC_Config_CPU_Model_68000)){if(24<=e&&e<=31)t=48;else if(32<=e&&e<=47)t=34;else switch(e){case 2:case 3:t=50;break;case 4:t=34;break;case 5:t=38;break;case 6:t=40;break;case 7:case 8:case 9:case 10:case 11:t=34;break;default:t=4}e=t*SAEC_Events_CYCLE_UNIT>>1,t=0==j||SAEV_config.cpu.speed==SAEC_Config_CPU_Speed_Maximum?e:Math.floor(e*j/Z),SAER.events.do_cycles(t)}}function Tt(e){var t,n=q.s,r=e,i=!0,a=24<=e&&e<32;a&&SAEV_config.cpu.model<=SAEC_Config_CPU_Model_68010&&(r=ae(16777201|e-24<<1));var o=xt();if(q.s||(q.usp=q.a[7],SAEV_config.cpu.model>=SAEC_Config_CPU_Model_68020?q.a[7]=q.m?q.msp:q.isp:q.a[7]=q.isp,q.s=!0),1&q.a[7]&&SAEV_config.cpu.model<SAEC_Config_CPU_Model_68020)2==e||3==e?SAER.m68k.cpu_halt(SAEC_CPU_halt_DOUBLE_FAULT):Pt(q.ir,q.a[7]);else if((2==e||3==e)&&E<0)SAER.m68k.cpu_halt(SAEC_CPU_halt_DOUBLE_FAULT);else{if(SAEV_config.cpu.model>SAEC_Config_CPU_Model_68000)if(t=Mt(e),2==e||3==e){var s=(n?4:0)|(d?2:1);s|=u?0:64,s|=32;for(var c=0;c<36;c++)On(0);Ln(l),On(0),On(0),On(0),On(s),On(45056+4*r),SAEF_log("cpu.exception() %d (%x) at %x -> %x!",e,q.instruction_pc,t,SAER_Memory_get32(q.vbr+4*r))}else 5==e||6==e||7==e||9==e?(Ln(q.instruction_pc),On(8192+4*r)):q.m&&a?(On(4*r),Ln(t),On(o),q.s=!0,q.msp=q.a[7],q.m=!1,q.a[7]=q.isp,On(4096+4*r)):On(4*r);else Ft(e),t=Mt(e),2!=e&&3!=e||(n=(n?4:0)|(d?2:1),n|=u?0:16,n|=p?8:0,n|=-32&_,E=-1,Ln(f),On(o),On(_),Ln(l),On(n),SAEF_log("cpu.exception() %d (%x) at %x -> %x!",e,l,t,SAER_Memory_get32(q.vbr+4*r)),i=!1);i&&(Ln(t),On(o));r=se(q.vbr+4*r);E=0,1&r?2==e||3==e?SAER.m68k.cpu_halt(SAEC_CPU_halt_DOUBLE_FAULT):Pt(q.ir,r):($e(r),Qe(),e=e,SAEF_clrSpcFlags(SAEC_spcflag_TRACE|SAEC_spcflag_DOTRACE),q.t1&&!q.t0&&(5==e||6==e||7==e||32<=e&&e<=47)&&SAEF_setSpcFlags(SAEC_spcflag_DOTRACE),q.t1=q.t0=q.m=!1)}}function Vt(e){return 2!=e&&3!=e&&4!=e&&8!=e&&10!=e&&11!=e&&ne(),Tt(e),[0,0,0]}function It(e,t,n,r,i,a,o){SAEV_config.cpu.model>=SAEC_Config_CPU_Model_68020?f=4294967295==a?q.instruction_pc:a:4294967295==a?(f=et(),o&&(f+=2)):f=a,l=t,_=e,u=n,d=r,p=i,Tt(3)}function Pt(e,t){It(e,t,!0,!1,!0,4294967295,!1)}function zt(e,t){return It(e,t,0,1,!1,4294967295,!0),[0,0,0]}function Ot(e){return(e&(SAEV_config.cpu.addressSpace24?16777215:4294967295))>>>0}function Lt(e){var t=et(),n=(4294443008&Ot(t))>>>0==16252928,r=(4294901760&Ot(t))>>>0==SAEV_AutoConf_base&&SAEV_AutoConf_boot_rom_type;return SAEV_Memory_cloantoRom&&28928==(61696&e)?(q.d[e>>9&7]=Xn(255&e),SAER.cpu.incPC_normal(2),Qe(),1):(20091==e&&n&&0==SAER_Memory_get32(16)&&SAEF_fatal(SAEE_CPU_Requires68020,"The selected kickstart-rom does require a 68020 and 32bit address-space"),65293==e&&r?(SAEF_log("cpu.illegal() STOP replacement, pc %08x",t),m68k_setstopped(),1):40960==(61440&e)&&r?(SAEF_log("cpu.illegal() Trap %03X at %08X, call...",4095&e,t),SAER.cpu.incPC_normal(2),SAER.autoconf.m68k_handle_trap(4095&e),Qe(),1):61440==(61440&e)?(++J<20&&SAEF_log("cpu.illegal() B-Trap %04X at %08X -> %08X (VBR %08X)",e,t,SAER_Memory_get32(q.vbr+44),q.vbr),void Vt(11)):40960==(61440&e)?(++J<20&&SAEF_log("cpu.illegal() A-Trap %04X at %08X -> %08X (VBR %08X)",e,t,SAER_Memory_get32(q.vbr+40),q.vbr),void Vt(10)):(++J<20&&SAEF_log("cpu.illegal() op %04x, pc %08x -> %08x",e,t,SAER_Memory_get32(q.vbr+16)),void Vt(4)))}function Nt(e){return ne(),Lt(e)?[4,0,0]:[0,0,0]}function Bt(){SAEF_warn("cpu.bus_error() PC %08x",et());try{Tt(2)}catch(e){if(!(e instanceof i))throw e;SAER.m68k.cpu_halt(SAEC_CPU_halt_BUS_ERROR_DOUBLE_FAULT)}}function Ut(){for(var t=!1;!t;)try{for(;!t;){q.instruction_pc=et(),q.opcode=q.ir,SAER.events.do_cycles(W);var e=Ce[q.opcode].f(Ce[q.opcode].p);W=e[0]*Y,SAEV_CPU_cycles=W,SAEV_spcflags&&SAER.m68k.do_specialties(W)&&(t=!0)}}catch(e){if(!(e instanceof i))throw e;Bt(),SAEV_spcflags&&SAER.m68k.do_specialties(W)&&(t=!0)}}function Kt(){for(var t=!1;!t;)try{for(;!t;){q.instruction_pc=et(),q.opcode=q.irc,SAER.events.do_cycles(W);var e=Ce[q.opcode].f(Ce[q.opcode].p);W=e[0]*Y,SAEV_CPU_cycles=W,SAEV_spcflags&&SAER.m68k.do_specialties(W)&&(t=!0)}}catch(e){if(!(e instanceof i))throw e;Bt(),SAEV_spcflags&&SAER.m68k.do_specialties(W)&&(t=!0)}}function Gt(){for(var t=!1;!t;)try{for(;!t;){q.instruction_pc=et(),q.opcode=ft(),SAER.events.do_cycles(W);var e=Ce[q.opcode].f(Ce[q.opcode].p);W=e[0]*Y,SAEV_CPU_cycles=W,SAEV_spcflags&&SAER.m68k.do_specialties(W)&&(t=!0)}}catch(e){if(!(e instanceof i))throw e;Bt(),SAEV_spcflags&&SAER.m68k.do_specialties(W)&&(t=!0)}}function Ht(e,t){var n=(65535&e)*(65535&t),r=(e>>>16&65535)*(65535&t),i=(65535&e)*(t>>>16&65535),e=(e>>>16&65535)*(t>>>16&65535),t=n+((r<<16&4294901760)>>>0);return 4294967295<t&&(t-=4294967296),t<n&&e++,4294967295<(t=(n=t)+((i<<16&4294901760)>>>0))&&(t-=4294967296),t<n&&e++,4294967295<(e+=(r>>>16&65535)+(i>>>16&65535))&&(e-=4294967296),[t,e]}function Xt(e,t,n){var r,i,a=0;if(n<=e)return[1,0,0];for(r=0;r<32;r++)i=0!=(2147483648&e),e=e<<1>>>0,2147483648&t&&e++,t=t<<1>>>0,a=a<<1>>>0,(i||n<=e)&&(a=(1|a)>>>0,e-=n);return[0,a,e]}this.setup=function(){if(!function(){j=0,SAEV_config.cpu.speed==SAEC_Config_CPU_Speed_Maximum||(SAEV_config.cpu.speedThrottle<0||0<SAEV_config.cpu.speedThrottle)&&(j=Math.floor(1e3*Z/(1e3+SAEV_config.cpu.speedThrottle)));{var e;Y=SAEC_Events_CYCLE_UNIT/2,SAEV_config.cpu.clock.multiplier?Y=256<=SAEV_config.cpu.clock.multiplier?SAEC_Events_CYCLE_UNIT/(SAEV_config.cpu.clock.multiplier>>8):SAEC_Events_CYCLE_UNIT*SAEV_config.cpu.clock.multiplier:SAEV_config.cpu.clock.frequency&&(e=8*(SAEV_config.chipset.ntsc?SAEC_Playfield_CLOCK_NTSC:SAEC_Playfield_CLOCK_PAL),Y=Math.floor(SAEC_Events_CYCLE_UNIT*e/SAEV_config.cpu.clock.frequency))}Y<1&&(Y=1);SAEF_log("cpu.update_cycles() cycleunit: %d (%.3f), cycles_mult %d",Y,Y/SAEC_Events_CYCLE_UNIT,j)}(),SAER_CPU_run_func=SAEV_config.cpu.model<SAEC_Config_CPU_Model_68020?SAEV_config.cpu.compatible?Ut:Gt:SAEV_config.cpu.compatible?Kt:Gt,SAEV_config.cpu.compatible?(ee=at,te=ot,SAEV_config.cpu.model<SAEC_Config_CPU_Model_68020?(ne=st,re=pt,ie=Et,ae=At,oe=St,se=mt,ce=ht,_e=gt,fe=yt):SAEV_config.cpu.model==SAEC_Config_CPU_Model_68020?(ne=ct,re=vt,ie=bt,se=SAER_Memory_get32,fe=SAER_Memory_put32,oe=SAER_Memory_get16,_e=SAER_Memory_put16,ae=SAER_Memory_get8,ce=SAER_Memory_put8):SAEV_config.cpu.model==SAEC_Config_CPU_Model_68030&&(ne=_t,re=Ct,ie=kt,ae=Ge,oe=Ke,se=Ue,ce=Ze,_e=qe,fe=Xe)):(ee=et,te=$e,ne=tt,re=ft,ie=lt,se=SAER_Memory_get32,fe=SAER_Memory_put32,oe=SAER_Memory_get16,_e=SAER_Memory_put16,ae=SAER_Memory_get8,ce=SAER_Memory_put8),Ce.length&&Ve==SAEV_config.cpu.model)SAEF_log("cpu.setup_core() instruction table is cached");else if(Ve=SAEV_config.cpu.model,!Ec())return SAEE_CPU_Internal;return ke.length||oc(),Re.length||cc(),SAEE_None},this.reset=function(e){q.a[7]=SAER_Memory_get32(0),this.setPC_normal(SAER_Memory_get32(4)),q.t1=!1,q.t0=!1,q.s=!0,q.m=!1,q.intmask=7,q.x=q.n=q.z=q.v=q.c=!1,q.vbr=q.sfc=q.dfc=0,q.irc=65535,q.db=0,SAEV_config.cpu.model==SAEC_Config_CPU_Model_68020?(q.caar=0,q.cacr=n,Ie()):SAEV_config.cpu.model==SAEC_Config_CPU_Model_68030&&(q.caar=0,q.cacr=v|R,Ie()),SAER.memory.a3000_fakekick(!1),H&=2147483647,K&=2147483647,G&=2147483647,(e||q.halted)&&(L=N=0,B=U=0,K=G=H=0),X=0,Qe(),J=0},this.dump=function(){for(var e="",t=0;t<8;t++)e+=sprintf("D%d $%08x ",t,q.d[t]);for(e+="\n",t=0;t<8;t++)e+=sprintf("A%d $%08x ",t,q.a[t]);e+="\n",q.s||(q.usp=q.a[7]),q.s&&q.m&&(q.msp=q.a[7]),q.s&&!q.m&&(q.isp=q.a[7]),e+=sprintf("PC $%08x USP $%08x ISP $%08x ",et(),q.usp,q.isp),Ve>=SAEC_Config_CPU_Model_68020&&(e+=sprintf("MSP $%08x ",q.msp)),Ve>=SAEC_Config_CPU_Model_68010&&(e+=sprintf("SFC $%08x DFC $%08x VBR $%08x",q.sfc,q.dfc,q.vbr)),e+="\n",e+=sprintf("SR T=%d%d S=%d M=%d IMASK=%d X=%d N=%d Z=%d V=%d C=%d\n",q.t1?1:0,q.t0?1:0,q.s?1:0,q.m?1:0,q.intmask,q.x?1:0,q.n?1:0,q.z?1:0,q.v?1:0,q.c?1:0),Ve>=SAEC_Config_CPU_Model_68020&&(e+=function(){if(!SAEV_config.cpu.compatible)return"CACHE disabled\n";var e=sprintf("CACR $%08x CAAR $%08x\n",q.cacr,q.caar);if(SAEV_config.cpu.model==SAEC_Config_CPU_Model_68020){e+="68020 inst-cache:\n";for(var t=0;t<A;t+=4){for(var n=0;n<4;n++){var r=t+n,i=-2&(a=h[r]).tag;e+=sprintf("%08X:%08X%s ",i|=r<<2,a.data,a.valid?"*":" ")}e+="\n"}}else if(SAEV_config.cpu.model==SAEC_Config_CPU_Model_68030){e+="68030 inst-cache: ["+(q.cacr&D?"enabled":"disabled")+"]\n";for(t=0;t<T;t++){i=-2&(a=z[t]).tag;e+=sprintf("%02d %08X: ",t,i|=t<<4);for(n=0;n<4;n++)e+=sprintf("%08X%s ",a.data[n],a.valid[n]?"*":" ");e+="\n"}e+="68030 data-cache: ["+(q.cacr&C?"enabled":"disabled")+"]\n";for(t=0;t<T;t++){var a,i=-2&(a=O[t]).tag;e+=sprintf("%02d %08X: ",t,i|=t<<4);for(n=0;n<4;n++)e+=sprintf("%08X%s ",a.data[n],a.valid[n]?"*":" ");e+="\n"}}return e}()),SAEF_log(e)},SAER_CPU_fill_prefetch=Qe,SAER_CPU_setPC=$e,SAER_CPU_getPC=et,this.setPC_normal=function(e){SAEV_config.cpu.compatible?(q.pc_p=q.pc_oldp=0,nt(e)):$e(e)},this.getPC_normal=function(){return(SAEV_config.cpu.compatible?rt:et)()},this.incPC_normal=function(e){SAEV_config.cpu.compatible?it(e):q.pc_p+=e},SAER_CPU_exception=Tt,this.exception2=function(e,t,n,r){throw f=et()+0,l=e,u=0==t,d=0==(1&r),_=q.opcode,p=0!=E,new i(2)},this.pc_in_rom=function(){return 16252928==(4294443008&Ot(et()))};const qt=1,Zt=2,jt=3,Yt=4,Wt=5,Jt=6,Qt=7,$t=8;function en(e){switch(e){case 0:case 1:case 2048:case 2049:return 68010<=Ve;case 2:return 68020<=Ve;case 2050:return 68020==Ve||68030==Ve;case 2051:case 2052:return 68020<=Ve}}const tn=!1;function nn(e,t,n,r){var i,a,o,s;switch(n>>13){case 0:case 2:case 3:return function(e,t,n){var r,i,a=t>>9&1,o=null,s=H;switch(t>>10&31){case 16:o="TC",r=4,a?fe(n,H):H=se(n);break;case 18:o="SRP",r=8,a?(fe(n,L),fe(n+4,N)):(L=se(n),N=se(n+4));break;case 19:o="CRP",r=8,a?(fe(n,B),fe(n+4,U)):(B=se(n),U=se(n+4));break;case 24:o="MMUSR",r=2,a?_e(n,X):X=oe(n);break;case 2:o="TT0",r=4,a?fe(n,K):K=se(n);break;case 3:o="TT1",r=4,a?fe(n,G):G=se(n)}return null===o||(tn&&(8==r?(t=se(n),i=se(n+4),a?SAEF_log("I_MMU_PMOVE %s,%08X%08X PC=%08X",o,t,i,e):SAEF_log("I_MMU_PMOVE %08X%08X,%s PC=%08X",t,i,o,e)):(i=(4==r?se:oe)(n),a?SAEF_log("I_MMU_PMOVE %s,%08X PC=%08X",o,i,e):SAEF_log("I_MMU_PMOVE %08X,%s PC=%08X",i,o,e))),1&SAEV_config.chipset.mbdmac&&0<SAEV_config.memory.ramsey.lowSize&&s!=H&&SAER.memory.a3000_fakekick(0!=(2147483648&H)),!1)}(e,n,r);case 1:return function(e,t){var n=31&t,r=t>>5&3,i="";switch(t>>10&7){case 6:i=sprintf("FC=%x MASK=%x EA=%08x",n,r,0);break;case 4:i=sprintf("FC=%x MASK=%x",n,r);break;case 1:i="ALL";break;default:return 1}return tn&&SAEF_log("I_MMU_PFLUSH %s PC=%08X",i,e),0}(e,n);case 4:return i=e,a=n,o=r,tn&&(s="",SAEF_log("I_MMU_PTEST%c %02X,%08X,#%X%s PC=%08X",a>>9&1?"W":"R",15&a,o,a>>10&7,s=a>>8&1?sprintf(",A%d",a>>4&15):s,i)),X=0;default:return 1}}const rn=1,an=2,on=3,sn=4,cn=5,_n=6,fn=7,ln=8,un=10,dn=11,pn=12,En=13,An=20,Sn=21,mn=22,hn=23,gn=24,yn=25;var vn=new function(){this.memory=null,this.pc=0,this.io=0,this.fmt8="%x",this.fmt16="%x",this.fmt32="%x"},bn=null;function Cn(e){vn.pc=e,vn.io=0}function kn(){return vn.pc+vn.io}function Rn(e){vn.io+=e}function wn(){vn.pc+=vn.io,vn.io=0}function xn(e){return vn.memory[e]<<8|vn.memory[e+1]}function Dn(e){return(vn.memory[e]<<24|vn.memory[e+1]<<16|vn.memory[e+2]<<8|vn.memory[e+3])>>>0}function Mn(){var e=xn(vn.pc+vn.io);return Rn(2),e}function Fn(){var e=Dn(vn.pc+vn.io);return Rn(4),e}function Tn(e){switch(e){case 0:return"s";case 1:return"b";case 2:return"w";case 4:return"l";default:return"?"}}function Vn(e,t){var n=e>>12&7,r=(r=function(e){switch(e){case 0:return"SFC";case 1:return"DFC";case 2048:return"USP";case 2049:return"VBR";case 2:return"CACR";case 2050:return"CAAR";case 2051:return"MSP";case 2052:return"ISP";case 3:return"TC";case 4:return"ITT0";case 5:return"ITT1";case 6:return"DTT0";case 7:return"DTT1";case 2053:return"MMUSR";case 2054:return"URP";case 2055:return"SRP"}return"???"}(4095&e)).toLowerCase(),r=t?32768&e?r+",a"+n:r+",d"+n:32768&e?"a"+n+","+r:"d"+n+","+r;return r}function In(e,t,n){var r,i="",a=t>>12&7,o=(32768&t?q.a:q.d)[a],s=t>>9&3;return 0==(2048&t)&&(o=qn(65535&o)),s&&(o=(o<<s&4294967295)>>>0),256&t?(r=0,128&t&&(e=0),64&t&&(o=0),32==(48&t)&&(e=Zn(e,qn(Mn())),0),48==(48&t)&&(e=Zn(e,Fn()),0),2==(3&t)&&(r=qn(Mn()),0),3==(3&t)&&(r=Fn(),0),0==(4&t)&&(e=Zn(e,o),0),3&t&&(e=Dn(e),0),4&t&&(e=Zn(e,o),0),Zn(e,r)):Zn(Zn(e,Xn(255&t)),o),i+=-1!=n?sprintf("(%d,a%d,%s%d.%s*%d)",Kn(255&t),n,32768&t?"a":"d",a,2048&t?"l":"w",1<<s):sprintf("(%d,pc,%s%d.%s*%d)",Kn(255&t),32768&t?"a":"d",a,2048&t?"l":"w",1<<s)}function Pn(e,t,n,r){switch(t){case rn:return sprintf("d%d",n);case an:return sprintf("a%d",n);case on:return sprintf("-(a%d)",n);case sn:return sprintf("(a%d)+",n);case cn:var i=Hn(qn(Mn()));return sprintf("%d(A%d)",i,n);case _n:return sprintf(10==config_da.radix?"#%d":"#"+vn.fmt8,n);case fn:var a=(1==n?Mn:Fn)();return sprintf(10==config_da.radix?"#%d":1==n?"#"+vn.fmt16:"#"+vn.fmt32,a);case ln:var o=kn(),i=Hn(0==n?qn(Mn()):255==n?Fn():Xn(n));return config_da.reloc?sprintf("<"+vn.fmt32+">",o+i):sprintf("<%d>",i);case un:return function(e,t){var n=e>>3;if(7==n)switch(7&e){case 0:var r=Mn();return sprintf(10==config_da.radix?"(%d)":"("+vn.fmt16+")",r);case 1:var r=Fn();return sprintf(10==config_da.radix?"(%d)":"("+vn.fmt32+")",r);case 2:var i=kn(),r=qn(Mn());return config_da.reloc?sprintf(vn.fmt32,Zn(i,r)):sprintf(10==config_da.radix?"%d(pc)":vn.fmt32+"(pc)",Hn(r));case 3:return In(i=kn(),r=Mn(),-1);case 4:r=0;switch(t){case 1:return r=255&Mn(),sprintf(10==config_da.radix?"#%d":"#"+vn.fmt8,Kn(r));case 2:return r=Mn(),sprintf(10==config_da.radix?"#%d":"#"+vn.fmt16,Gn(r));case 4:return r=Fn(),sprintf(10==config_da.radix?"#%d":"#"+vn.fmt32,Hn(r))}}else{var a=7&e;switch(n){case 0:return sprintf("d%d",a);case 1:return sprintf("a%d",a);case 2:return sprintf("(a%d)",a);case 3:return sprintf("(a%d)+",a);case 4:return sprintf("-(a%d)",a);case 5:r=qn(Mn());return sprintf(10==config_da.radix?"%d(a%d)":vn.fmt32+"(a%d)",r,a);case 6:r=Mn();return In(q.a[a],r,a)}}return"???"}(n,r);case dn:return"ccr";case pn:return"sr";case En:return"usp";case An:o=2048&e?q.d[e>>6&7]:e>>6&31,i=32&e?31&q.d[7&e]:31&e;return sprintf("{%d:%d}",o,i=0==i?32:i);case Sn:return function(e,t){for(var n=[0,0,0,0,0,0,0,0],r=[0,0,0,0,0,0,0,0],i="",a=0;a<16;a++)e&1<<(t?15-a:a)&&(a<8?n[a]=1:r[a-8]=1);var o=n.indexOf(1),s=n.lastIndexOf(1);return-1!=o&&(i+="d"+o,s!=o&&(i+="-d"+s)),o=r.indexOf(1),s=r.lastIndexOf(1),-1!=o&&(i.length&&(i+="/"),i+="a"+o,s!=o&&(i+="-a"+s)),i}(e,n);case mn:return Vn(e,n);case hn:return c=(s=e)>>12&7,bn=2048&s?"muls":"mulu",1024&s?"d"+(7&s)+"-d"+c:"d"+c;case gn:return c=(s=e)>>12&7,bn=2048&s?"divs":"divu",1024&s?"d"+(7&s)+":d"+c:"d"+c;case yn:return"FIXME"}var s,c}function zn(e){var t=e.mn;if("illegal"==(t=t.toLowerCase()))return t;bn=null;var n,r="";return e.d&&(n=0!=e.d.ext&&(1==e.d.ext?Mn:Fn)(),e.d.z?r+="."+Tn(e.d.z):e.d.z2&&(r+="."+Tn(e.d.z2)),e.d.sm&&e.d.dm?(r+=" ",r+=Pn(n,e.d.sm,e.d.s,e.d.z),r+=",",r+=Pn(n,e.d.dm,e.d.d,e.d.z)):e.d.dm&&(r+=" ",r+=Pn(n,e.d.dm,e.d.d,e.d.z))),null!==bn?bn+r:t+r}function On(e){q.a[7]-=2,_e(q.a[7],e)}function Ln(e){q.a[7]-=4,fe(q.a[7],e)}function Nn(){var e=oe(q.a[7]);return q.a[7]+=2,e}function Bn(){var e=se(q.a[7]);return q.a[7]+=4,e}config_da=new function(){this.code="",this.offset=0,this.limit=32,this.radix=16,this.prefx="$",this.width=0,this.reloc=!0},this.getConfig_da=function(){return config_da},this.setup_da=function(e){return Ve=e,Ec()?(oc(),cc(),SAEE_None):SAEE_CPU_Internal},this.disassemble=function(){var e,t;!function(){if(0<config_da.code.length&&(vn.memory=new Uint8Array(config_da.code.length),vn.memory.set(SAEF_String2Array(config_da.code,0,config_da.code.length)),config_da.code=""),null===vn.memory)throw 1;kn()>=vn.memory.length&&(vn.pc=vn.io=0),config_da.limit<=0&&(config_da.limit=8),vn.fmt8=vn.fmt16=vn.fmt32=config_da.prefx,0==config_da.width?(vn.fmt8+="%x",vn.fmt16+="%x",vn.fmt32+="%x"):(vn.fmt8+="%02x",vn.fmt16+="%04x",vn.fmt32+=24==config_da.width?"%06x":"%08x")}(),Cn(config_da.offset);for(var n=[],r=0;r++<config_da.limit;){for(var i=vn.pc,a=[],o=0;o<5;o++)a.push(xn(i+2*o));e=Mn(),t=zn(Ce[e]),e=vn.io>>1,n.push([i,a,e,t]),wn()}return n},this.diss=function(e,t){void 0===e&&(e=ee()),void 0!==t&&0!=t||(t=8);var n=SAER_Memory_getBank(e);vn.memory=n.baseaddr,Cn(e-n.start);for(var r=0;r++<t;){var i="";i+=sprintf("$%08x: ",vn.pc+n.start);for(var a=0;a<5;a++)i+=sprintf("$%04x ",xn(vn.pc+2*a));var o=Mn();i+=zn(Ce[o]),SAEF_log(i+=sprintf(" (%d)",vn.io>>1)),wn()}};const Un=[[],[1,1,1,1,1,1,1,2],[2,2,2,2,2,2,2,2],[],[4,4,4,4,4,4,4,4]];function Kn(e){return 128&e?e-256:e}function Gn(e){return 32768&e?e-65536:e}function Hn(e){return 2147483648&e?e-4294967296:e}function Xn(e){return 128&e?(4294967040|e)>>>0:e}function qn(e){return 32768&e?(4294901760|e)>>>0:e}function Zn(e,t){t=e+t;return 4294967295<t?t-4294967296:t}function jn(e,t,n,r,i){e=0!=(e&r),t=0!=(t&r),r=0!=(n&r);q.v=e&&t&&!r||!e&&!t&&r,q.c=e&&t||!r&&t||e&&!r,q.x=q.c,q.n=r,i?0!=n&&(q.z=!1):q.z=0==n}function Yn(e,t,n,r,i){e=0!=(e&r),t=0!=(t&r),r=0!=(n&r);q.v=!e&&t&&!r||e&&!t&&r,q.c=e&&!t||r&&!t||e&&r,q.x=q.c,q.n=r,i?0!=n&&(q.z=!1):q.z=0==n}function Wn(e,t,n,r){e=0!=(e&r),t=0!=(t&r),r=0!=(n&r);q.v=!e&&t&&!r||e&&!t&&r,q.c=e&&!t||r&&!t||e&&r,q.n=r,q.z=0==n}function Jn(e,t,n,r){e=0!=(e&n),n=0!=(t&n);q.v=e&&n,q.c=e||n,q.x=q.c,q.n=n,r?0!=t&&(q.z=!1):q.z=0==t}function Qn(e,t){q.n=0!=(e&t),q.z=0==e,q.v=q.c=!1}function $n(e){var t=q.d[e.Rx];return q.d[e.Rx]=q.d[e.Ry],q.d[e.Ry]=t,ne(),e.cyc}function er(e){var t=q.a[e.Rx];return q.a[e.Rx]=q.a[e.Ry],q.a[e.Ry]=t,ne(),e.cyc}function tr(e){var t=q.d[e.Rx];return q.d[e.Rx]=q.a[e.Ry],q.a[e.Ry]=t,ne(),e.cyc}function nr(e){return q.a[e.An]=Re[e.ea](4),ne(),e.cyc}function rr(e){return Ln(Re[e.ea](4)),ne(),e.cyc}function ir(e){var t=qn(re());return Ln(q.a[e.An]),q.a[e.An]=q.a[7],q.a[7]=Zn(q.a[7],t),ne(),e.cyc}function ar(e){var t=ie();return Ln(q.a[e.An]),q.a[e.An]=q.a[7],q.a[7]=Zn(q.a[7],t),ne(),e.cyc}function or(e){return q.a[7]=q.a[e.An],q.a[e.An]=Bn(),ne(),e.cyc}function sr(e){var t=we[e.sea]();return xe[e.dea](t),Qn(t,e.zm),ne(),e.cyc}function cr(e){var t=De[e.sea]();return Me[e.dea](t),Qn(t,e.zm),ne(),e.cyc}function _r(e){var t=Fe[e.sea]();return Te[e.dea](t),Qn(t,e.zm),ne(),e.cyc}function fr(e){var t=De[e.ea]();return q.a[e.An]=qn(t),ne(),e.cyc}function lr(e){var t=Fe[e.ea]();return q.a[e.An]=t,ne(),e.cyc}function ur(e){var t=Xn(e.data);return q.d[e.Dn]=t,Qn(t,e.zm),ne(),e.cyc}function dr(e){var t,n,r=re(),i=e.ea>>3==4,a=7&e.ea,o=Re[i?16|a:e.ea](2),s=i?15:0,c=0;if(i){for(t=n=0;t<16;t++)r&1<<t&&(n+=2);o-=n,68020<=Ve&&(q.a[a]-=n)}for(t=0;t<16;t++)r&1<<(t^s)&&(_e(o,t<8?65535&q.d[t]:65535&q.a[7&t]),o+=2,c++);return i&&Ve<68020&&(q.a[a]-=n),ne(),[e.cyc[0]+4*c,e.cyc[1],c]}function pr(e){var t,n,r=re(),i=e.ea>>3==4,a=7&e.ea,o=Re[i?16|a:e.ea](4),s=i?15:0,c=0;if(i){for(t=n=0;t<16;t++)r&1<<t&&(n+=4);o-=n,68020<=Ve&&(q.a[a]-=n)}for(t=0;t<16;t++)r&1<<(t^s)&&(fe(o,t<8?q.d[t]:q.a[7&t]),o+=4,c++);return i&&Ve<68020&&(q.a[a]-=n),ne(),[e.cyc[0]+8*c,e.cyc[1],2*c]}function Er(e){for(var t=re(),n=e.ea>>3==3,r=7&e.ea,i=Re[n?16|r:e.ea](2),a=0,o=0;o<16;o++)t&1<<o&&(o<8?q.d[o]=qn(oe(i)):q.a[7&o]=qn(oe(i)),i+=2,a++);return n&&(q.a[r]=i),ne(),[e.cyc[0]+4*a,e.cyc[1]+a,0]}function Ar(e){for(var t=re(),n=e.ea>>3==3,r=7&e.ea,i=Re[n?16|r:e.ea](4),a=0,o=0;o<16;o++)t&1<<o&&(o<8?q.d[o]=se(i):q.a[7&o]=se(i),i+=4,a++);return n&&(q.a[r]=i),ne(),[e.cyc[0]+8*a,e.cyc[1]+2*a,0]}function Sr(e){var t=re(),n=65535&q.d[e.Dn],t=Zn(q.a[e.An],qn(t));return ce(t,n>>8),ce(t+2,255&n),ne(),e.cyc}function mr(e){var t=re(),n=q.d[e.Dn],t=Zn(q.a[e.An],qn(t));return ce(t,n>>>24),ce(t+2,n>>>16&255),ce(t+4,n>>>8&255),ce(t+6,255&n),ne(),e.cyc}function hr(e){var t=re(),t=Zn(q.a[e.An],qn(t)),t=ae(t)<<8|ce(t+2);return q.d[e.Dn]=4294901760&q.d[e.Dn]|t,ne(),e.cyc}function gr(e){var t=re(),t=Zn(q.a[e.An],qn(t)),t=(ae(t)<<24|ae(t+2)<<16|ae(t+4)<<8|ce(t+6))>>>0;return q.d[e.Dn]=t,ne(),e.cyc}function yr(e){var t=Fe[e.ea](),n=q.d[e.Dn],r=t+n;return 4294967295<r&&(r-=4294967296),jn(t,n,q.d[e.Dn]=r,2147483648,!1),ne(),e.cyc}function vr(e){var t=Re[e.ea](4),n=q.d[e.Dn],r=se(t),i=n+r;return 4294967295<i&&(i-=4294967296),fe(t,i),jn(n,r,i,2147483648,!1),ne(),e.cyc}function br(e){var t=De[e.ea](),n=65535&q.d[e.Dn],r=t+n;return 65535<r&&(r-=65536),q.d[e.Dn]=4294901760&q.d[e.Dn]|r,jn(t,n,r,32768,!1),ne(),e.cyc}function Cr(e){var t=Re[e.ea](2),n=65535&q.d[e.Dn],r=oe(t),i=n+r;return 65535<i&&(i-=65536),_e(t,i),jn(n,r,i,32768,!1),ne(),e.cyc}function kr(e){var t=we[e.ea](),n=255&q.d[e.Dn],r=t+n;return 255<r&&(r-=256),q.d[e.Dn]=4294967040&q.d[e.Dn]|r,jn(t,n,r,128,!1),ne(),e.cyc}function Rr(e){var t=Re[e.ea](1),n=255&q.d[e.Dn],r=ae(t),i=n+r;return 255<i&&(i-=256),ce(t,i),jn(n,r,i,128,!1),ne(),e.cyc}function wr(e){var t=Fe[e.ea](),n=q.d[e.Dn],r=n-t;return r<0&&(r+=4294967296),Yn(t,n,q.d[e.Dn]=r,2147483648,!1),ne(),e.cyc}function xr(e){var t=Re[e.ea](4),n=q.d[e.Dn],r=se(t),i=r-n;return i<0&&(i+=4294967296),fe(t,i),Yn(n,r,i,2147483648,!1),ne(),e.cyc}function Dr(e){var t=De[e.ea](),n=65535&q.d[e.Dn],r=n-t;return r<0&&(r+=65536),q.d[e.Dn]=4294901760&q.d[e.Dn]|r,Yn(t,n,r,32768,!1),ne(),e.cyc}function Mr(e){var t=Re[e.ea](2),n=65535&q.d[e.Dn],r=oe(t),i=r-n;return i<0&&(i+=65536),_e(t,i),Yn(n,r,i,32768,!1),ne(),e.cyc}function Fr(e){var t=we[e.ea](),n=255&q.d[e.Dn],r=n-t;return r<0&&(r+=256),q.d[e.Dn]=4294967040&q.d[e.Dn]|r,Yn(t,n,r,128,!1),ne(),e.cyc}function Tr(e){var t=Re[e.ea](1),n=255&q.d[e.Dn],r=ae(t),i=r-n;return i<0&&(i+=256),ce(t,i),Yn(n,r,i,128,!1),ne(),e.cyc}function Vr(e){var t=Fe[e.ea](),n=q.d[e.Dn],r=n-t;return r<0&&(r+=4294967296),Wn(t,n,r,2147483648),ne(),e.cyc}function Ir(e){var t=De[e.ea](),n=65535&q.d[e.Dn],r=n-t;return r<0&&(r+=65536),Wn(t,n,r,32768),ne(),e.cyc}function Pr(e){var t=we[e.ea](),n=255&q.d[e.Dn],r=n-t;return r<0&&(r+=256),Wn(t,n,r,128),ne(),e.cyc}function zr(e){return Te[e.ea](0),q.z=!0,q.n=q.v=q.c=!1,ne(),e.cyc}function Or(e){return Me[e.ea](0),q.z=!0,q.n=q.v=q.c=!1,ne(),e.cyc}function Lr(e){return xe[e.ea](0),q.z=!0,q.n=q.v=q.c=!1,ne(),e.cyc}function Nr(e){var t=q.d[e.Dn],n=0-t;return n<0&&(n+=4294967296),Jn(t,q.d[e.Dn]=n,2147483648,!1),ne(),e.cyc}function Br(e){var t=65535&q.d[e.Dn],n=0-t;return n<0&&(n+=65536),q.d[e.Dn]=4294901760&q.d[e.Dn]|n,Jn(t,n,32768,!1),ne(),e.cyc}function Ur(e){var t=255&q.d[e.Dn],n=0-t;return n<0&&(n+=256),q.d[e.Dn]=4294967040&q.d[e.Dn]|n,Jn(t,n,128,!1),ne(),e.cyc}function Kr(e){var t=Re[e.ea](4),n=se(t),r=0-n;return r<0&&(r+=4294967296),fe(t,r),Jn(n,r,2147483648,!1),ne(),e.cyc}function Gr(e){var t=Re[e.ea](2),n=oe(t),r=0-n;return r<0&&(r+=65536),_e(t,r),Jn(n,r,32768,!1),ne(),e.cyc}function Hr(e){var t=Re[e.ea](1),n=ae(t),r=0-n;return r<0&&(r+=256),ce(t,r),Jn(n,r,128,!1),ne(),e.cyc}function Xr(e){var t=De[e.ea](),n=65535&q.d[e.Dn],r=t^n,n=(t=32768&t?65536-t:t)*(n=32768&n?65536-n:n);return q.d[e.Dn]=n=n&&32768&r?4294967296-n:n,q.n=0!=(2147483648&n),q.z=0==n,q.v=!1,q.c=!1,ne(),e.cyc}function qr(e){var t=De[e.ea]()*(65535&q.d[e.Dn]);return q.d[e.Dn]=t,q.n=0!=(2147483648&t),q.z=0==t,q.v=!1,q.c=!1,ne(),e.cyc}function Zr(e){var t,n,r,i,a=re(),o=Fe[e.ea](),s=a>>12&7,c=q.d[s];return 2048&a?(t=0!=(2147483648&(o^c)),2147483648&c&&(c=4294967296-c),(o=2147483648&o?4294967296-o:o)<32768&&c<32768?(r=0,(n=o*c)&&t&&(n=4294967296-n,r=4294967295),q.v=!1):(n=(i=Ht(o,c))[0],r=i[1],t&&(r=~r>>>0,0==(n=n&&4294967296-n)&&4294967295<++r&&(r-=4294967296)),q.v=!(0!=(1024&a)||0==r&&0==(2147483648&n)||4294967295==(4294967295&r)&&2147483648==(2147483648&n)))):(o<65536&&c<65536?(n=o*c,r=0,q.v=!1):(n=(i=Ht(o,c))[0],r=i[1]),q.v=0==(1024&a)&&0!=r),q.d[s]=n,1024&a&&(q.d[7&a]=r),q.n=0!=(2147483648&r),q.z=0==r&&0==n,q.c=!1,ne(),e.cyc}function jr(e){var t=De[e.ea]();if(q.c=!1,0==t)return Vt(5);var n=q.d[e.Dn],r=n,i=(2147483648&n?1:0)^(32768&t?1:0),a=(n=2147483648&n?4294967296-n:n)/(t=32768&t?65536-t:t)>>>0;return(i?32768<a:32767<a)?q.v=!0:(q.d[e.Dn]=(t=(t=n%t)&&t>>15!=r>>>31?65536-t:t)<<16|(a=a&&i?65536-a:a),q.v=!1,q.z=0==a,q.n=0!=(32768&a)),ne(),e.cyc}function Yr(e){var t=De[e.ea]();if(q.c=!1,0==t)return Vt(5);var n=q.d[e.Dn],r=n/t>>>0;return 65535<r?q.v=!0:(q.d[e.Dn]=n%t<<16|r,q.v=!1,q.z=0==r,q.n=0!=(32768&r)),ne(),e.cyc}function Wr(e){var t=re(),n=Fe[e.ea](),r=t>>12&7,i=7&t;if(q.c=!1,0==n)return Vt(5);if(2048&t)if(1024&t){var a=q.d[r],o=q.d[i],s=o,c=0!=(2147483648&(o^n));2147483648&o&&(o=~o>>>0,0==(a=a&&4294967296-a)&&4294967295<++o&&(o-=4294967296));var _,f=(_=Xt(o,a,n=2147483648&n?4294967296-n:n))[1],o=_[2];if(_[0]||c?2147483648<f:2147483647<f)return q.v=!0,ne(),e.cyc;f&&c&&(f=4294967296-f),o&&(2147483648&o)!=(2147483648&s)&&(o=4294967296-o)}else{a=q.d[r],s=a,c=0!=(2147483648&(a^n));if(f=(a=2147483648&a?4294967296-a:a)/(n=2147483648&n?4294967296-n:n)>>>0,c?2147483648<f:2147483647<f)return q.v=!0,ne(),e.cyc;f&&c&&(f=4294967296-f),(o=a%n)&&(2147483648&o)!=(2147483648&s)&&(o=4294967296-o)}else if(1024&t){if((_=Xt(q.d[i],q.d[r],n))[0])return q.v=!0,ne(),e.cyc;f=_[1],o=_[2]}else f=q.d[r]/n>>>0,o=q.d[r]%n;return q.d[r]=f,i!=r&&(q.d[i]=o),q.v=!1,q.z=0==f,q.n=0!=(2147483648&f),ne(),e.cyc}function Jr(e){var t=q.d[e.Ry],n=q.d[e.Rx],r=t+n+(q.x?1:0);return 4294967295<r&&(r-=4294967296),jn(t,n,q.d[e.Rx]=r,2147483648,!0),ne(),e.cyc}function Qr(e){var t=65535&q.d[e.Ry],n=65535&q.d[e.Rx],r=t+n+(q.x?1:0);return 65535<r&&(r-=65536),q.d[e.Rx]=4294901760&q.d[e.Rx]|r,jn(t,n,r,32768,!0),ne(),e.cyc}function $r(e){var t=255&q.d[e.Ry],n=255&q.d[e.Rx],r=t+n+(q.x?1:0);return 255<r&&(r-=256),q.d[e.Rx]=4294967040&q.d[e.Rx]|r,jn(t,n,r,128,!0),ne(),e.cyc}function ei(e){q.a[e.Ry]-=4;var t=se(q.a[e.Ry]);q.a[e.Rx]-=4;var n=se(q.a[e.Rx]),r=t+n+(q.x?1:0);return 4294967295<r&&(r-=4294967296),fe(q.a[e.Rx],r),jn(t,n,r,2147483648,!0),ne(),e.cyc}function ti(e){q.a[e.Ry]-=2;var t=oe(q.a[e.Ry]);q.a[e.Rx]-=2;var n=oe(q.a[e.Rx]),r=t+n+(q.x?1:0);return 65535<r&&(r-=65536),_e(q.a[e.Rx],r),jn(t,n,r,32768,!0),ne(),e.cyc}function ni(e){q.a[e.Ry]-=Un[1][e.Ry];var t=ae(q.a[e.Ry]);q.a[e.Rx]-=Un[1][e.Rx];var n=ae(q.a[e.Rx]),r=t+n+(q.x?1:0);return 255<r&&(r-=256),ce(q.a[e.Rx],r),jn(t,n,r,128,!0),ne(),e.cyc}function ri(e){var t=q.d[e.Rx],n=q.d[e.Ry],r=n-t-(q.x?1:0);return r<0&&(r+=4294967296),Yn(t,n,q.d[e.Ry]=r,2147483648,!0),ne(),e.cyc}function ii(e){var t=65535&q.d[e.Rx],n=65535&q.d[e.Ry],r=n-t-(q.x?1:0);return r<0&&(r+=65536),q.d[e.Ry]=4294901760&q.d[e.Ry]|r,Yn(t,n,r,32768,!0),ne(),e.cyc}function ai(e){var t=255&q.d[e.Rx],n=255&q.d[e.Ry],r=n-t-(q.x?1:0);return r<0&&(r+=256),q.d[e.Ry]=4294967040&q.d[e.Ry]|r,Yn(t,n,r,128,!0),ne(),e.cyc}function oi(e){q.a[e.Rx]-=4;var t=se(q.a[e.Rx]);q.a[e.Ry]-=4;var n=se(q.a[e.Ry]),r=n-t-(q.x?1:0);return r<0&&(r+=4294967296),fe(q.a[e.Ry],r),Yn(t,n,r,2147483648,!0),ne(),e.cyc}function si(e){q.a[e.Rx]-=2;var t=oe(q.a[e.Rx]);q.a[e.Ry]-=2;var n=oe(q.a[e.Ry]),r=n-t-(q.x?1:0);return r<0&&(r+=65536),_e(q.a[e.Ry],r),Yn(t,n,r,32768,!0),ne(),e.cyc}function ci(e){q.a[e.Rx]-=Un[1][e.Rx];var t=ae(q.a[e.Rx]);q.a[e.Ry]-=Un[1][e.Ry];var n=ae(q.a[e.Ry]),r=n-t-(q.x?1:0);return r<0&&(r+=256),ce(q.a[e.Ry],r),Yn(t,n,r,128,!0),ne(),e.cyc}function _i(e){var t=q.d[e.Dn],n=0-t-(q.x?1:0);return n<0&&(n+=4294967296),Jn(t,q.d[e.Dn]=n,2147483648,!0),ne(),e.cyc}function fi(e){var t=65535&q.d[e.Dn],n=0-t-(q.x?1:0);return n<0&&(n+=65536),q.d[e.Dn]=4294901760&q.d[e.Dn]|n,Jn(t,n,32768,!0),ne(),e.cyc}function li(e){var t=255&q.d[e.Dn],n=0-t-(q.x?1:0);return n<0&&(n+=256),q.d[e.Dn]=4294967040&q.d[e.Dn]|n,Jn(t,n,128,!0),ne(),e.cyc}function ui(e){var t=Re[e.ea](4),n=se(t),r=0-n-(q.x?1:0);return r<0&&(r+=4294967296),fe(t,r),Jn(n,r,2147483648,!0),ne(),e.cyc}function di(e){var t=Re[e.ea](2),n=oe(t),r=0-n-(q.x?1:0);return r<0&&(r+=65536),_e(t,r),Jn(n,r,32768,!0),ne(),e.cyc}function pi(e){var t=Re[e.ea](1),n=ae(t),r=0-n-(q.x?1:0);return r<0&&(r+=256),ce(t,r),Jn(n,r,128,!0),ne(),e.cyc}function Ei(e){var t=Fe[e.ea]()+q.a[e.An];return 4294967295<t&&(t-=4294967296),q.a[e.An]=t,ne(),e.cyc}function Ai(e){var t=qn(De[e.ea]())+q.a[e.An];return 4294967295<t&&(t-=4294967296),q.a[e.An]=t,ne(),e.cyc}function Si(e){var t=Fe[e.ea](),t=q.a[e.An]-t;return t<0&&(t+=4294967296),q.a[e.An]=t,ne(),e.cyc}function mi(e){var t=qn(De[e.ea]()),t=q.a[e.An]-t;return t<0&&(t+=4294967296),q.a[e.An]=t,ne(),e.cyc}function hi(e){var t=Fe[e.ea](),n=q.a[e.An],r=n-t;return r<0&&(r+=4294967296),Wn(t,n,r,2147483648),ne(),e.cyc}function gi(e){var t=qn(De[e.ea]()),n=q.a[e.An],r=n-t;return r<0&&(r+=4294967296),Wn(t,n,r,2147483648),ne(),e.cyc}function yi(e){var t=ie(),n=q.d[e.Dn],r=t+n;return 4294967295<r&&(r-=4294967296),jn(t,n,q.d[e.Dn]=r,2147483648,!1),ne(),e.cyc}function vi(e){var t=re(),n=65535&q.d[e.Dn],r=t+n;return 65535<r&&(r-=65536),q.d[e.Dn]=4294901760&q.d[e.Dn]|r,jn(t,n,r,32768,!1),ne(),e.cyc}function bi(e){var t=255&re(),n=255&q.d[e.Dn],r=t+n;return 255<r&&(r-=256),q.d[e.Dn]=4294967040&q.d[e.Dn]|r,jn(t,n,r,128,!1),ne(),e.cyc}function Ci(e){var t=ie(),n=Re[e.ea](4),r=se(n),i=t+r;return 4294967295<i&&(i-=4294967296),fe(n,i),jn(t,r,i,2147483648,!1),ne(),e.cyc}function ki(e){var t=re(),n=Re[e.ea](2),r=oe(n),i=t+r;return 65535<i&&(i-=65536),_e(n,i),jn(t,r,i,32768,!1),ne(),e.cyc}function Ri(e){var t=255&re(),n=Re[e.ea](1),r=ae(n),i=t+r;return 255<i&&(i-=256),ce(n,i),jn(t,r,i,128,!1),ne(),e.cyc}function wi(e){var t=ie(),n=q.d[e.Dn],r=n-t;return r<0&&(r+=4294967296),Yn(t,n,q.d[e.Dn]=r,2147483648,!1),ne(),e.cyc}function xi(e){var t=re(),n=65535&q.d[e.Dn],r=n-t;return r<0&&(r+=65536),q.d[e.Dn]=4294901760&q.d[e.Dn]|r,Yn(t,n,r,32768,!1),ne(),e.cyc}function Di(e){var t=255&re(),n=255&q.d[e.Dn],r=n-t;return r<0&&(r+=256),q.d[e.Dn]=4294967040&q.d[e.Dn]|r,Yn(t,n,r,128,!1),ne(),e.cyc}function Mi(e){var t=ie(),n=Re[e.ea](4),r=se(n),i=r-t;return i<0&&(i+=4294967296),fe(n,i),Yn(t,r,i,2147483648,!1),ne(),e.cyc}function Fi(e){var t=re(),n=Re[e.ea](2),r=oe(n),i=r-t;return i<0&&(i+=65536),_e(n,i),Yn(t,r,i,32768,!1),ne(),e.cyc}function Ti(e){var t=255&re(),n=Re[e.ea](1),r=ae(n),i=r-t;return i<0&&(i+=256),ce(n,i),Yn(t,r,i,128,!1),ne(),e.cyc}function Vi(e){var t=ie(),n=Fe[e.ea](),r=n-t;return r<0&&(r+=4294967296),Wn(t,n,r,2147483648),ne(),e.cyc}function Ii(e){var t=re(),n=De[e.ea](),r=n-t;return r<0&&(r+=65536),Wn(t,n,r,32768),ne(),e.cyc}function Pi(e){var t=255&re(),n=we[e.ea](),r=n-t;return r<0&&(r+=256),Wn(t,n,r,128),ne(),e.cyc}function zi(e){var t=e.data,n=q.d[e.Dn],r=t+n;return 4294967295<r&&(r-=4294967296),jn(t,n,q.d[e.Dn]=r,2147483648,!1),ne(),e.cyc}function Oi(e){var t=e.data+q.a[e.An];return 4294967295<t&&(t-=4294967296),q.a[e.An]=t,ne(),e.cyc}function Li(e){var t=Re[e.ea](4),n=e.data,r=se(t),i=n+r;return 4294967295<i&&(i-=4294967296),fe(t,i),jn(n,r,i,2147483648,!1),ne(),e.cyc}function Ni(e){var t=e.data,n=65535&q.d[e.Dn],r=t+n;return 65535<r&&(r-=65536),q.d[e.Dn]=4294901760&q.d[e.Dn]|r,jn(t,n,r,32768,!1),ne(),e.cyc}function Bi(e){var t=Re[e.ea](2),n=e.data,r=oe(t),i=n+r;return 65535<i&&(i-=65536),_e(t,i),jn(n,r,i,32768,!1),ne(),e.cyc}function Ui(e){var t=e.data,n=255&q.d[e.Dn],r=t+n;return 255<r&&(r-=256),q.d[e.Dn]=4294967040&q.d[e.Dn]|r,jn(t,n,r,128,!1),ne(),e.cyc}function Ki(e){var t=Re[e.ea](1),n=e.data,r=ae(t),i=n+r;return 255<i&&(i-=256),ce(t,i),jn(n,r,i,128,!1),ne(),e.cyc}function Gi(e){var t=e.data,n=q.d[e.Dn],r=n-t;return r<0&&(r+=4294967296),Yn(t,n,q.d[e.Dn]=r,2147483648,!1),ne(),e.cyc}function Hi(e){var t=e.data,t=q.a[e.An]-t;return t<0&&(t+=4294967296),q.a[e.An]=t,ne(),e.cyc}function Xi(e){var t=Re[e.ea](4),n=e.data,r=se(t),i=r-n;return i<0&&(i+=4294967296),fe(t,i),Yn(n,r,i,2147483648,!1),ne(),e.cyc}function qi(e){var t=e.data,n=65535&q.d[e.Dn],r=n-t;return r<0&&(r+=65536),q.d[e.Dn]=4294901760&q.d[e.Dn]|r,Yn(t,n,r,32768,!1),ne(),e.cyc}function Zi(e){var t=Re[e.ea](2),n=e.data,r=oe(t),i=r-n;return i<0&&(i+=65536),_e(t,i),Yn(n,r,i,32768,!1),ne(),e.cyc}function ji(e){var t=e.data,n=255&q.d[e.Dn],r=n-t;return r<0&&(r+=256),q.d[e.Dn]=4294967040&q.d[e.Dn]|r,Yn(t,n,r,128,!1),ne(),e.cyc}function Yi(e){var t=Re[e.ea](1),n=e.data,r=ae(t),i=r-n;return i<0&&(i+=256),ce(t,i),Yn(n,r,i,128,!1),ne(),e.cyc}function Wi(e){var t=se(q.a[e.Ay]);q.a[e.Ay]+=4;var n=se(q.a[e.Ax]);q.a[e.Ax]+=4;var r=n-t;return r<0&&(r+=4294967296),Wn(t,n,r,2147483648),ne(),e.cyc}function Ji(e){var t=oe(q.a[e.Ay]);q.a[e.Ay]+=2;var n=oe(q.a[e.Ax]);q.a[e.Ax]+=2;var r=n-t;return r<0&&(r+=65536),Wn(t,n,r,32768),ne(),e.cyc}function Qi(e){var t=ae(q.a[e.Ay]);q.a[e.Ay]+=Un[1][e.Ay];var n=ae(q.a[e.Ax]);q.a[e.Ax]+=Un[1][e.Ax];var r=n-t;return r<0&&(r+=256),Wn(t,n,r,128),ne(),e.cyc}function $i(e){var t=255&q.d[e.Dn],t=128&t?65280|t:t;return q.d[e.Dn]=4294901760&q.d[e.Dn]|t,Qn(t,32768),ne(),e.cyc}function ea(e){var t=65535&q.d[e.Dn],t=32768&t?(4294901760|t)>>>0:t;return q.d[e.Dn]=t,Qn(t,2147483648),ne(),e.cyc}function ta(e){var t=255&q.d[e.Dn],t=128&t?(4294967040|t)>>>0:t;return q.d[e.Dn]=t,Qn(t,2147483648),ne(),e.cyc}function na(e){var t=(Fe[e.ea]()&q.d[e.Dn])>>>0;return q.d[e.Dn]=t,Qn(t,e.zm),ne(),e.cyc}function ra(e){var t=65535&De[e.ea]()&q.d[e.Dn];return q.d[e.Dn]=4294901760&q.d[e.Dn]|t,Qn(t,e.zm),ne(),e.cyc}function ia(e){var t=255&we[e.ea]()&q.d[e.Dn];return q.d[e.Dn]=4294967040&q.d[e.Dn]|t,Qn(t,e.zm),ne(),e.cyc}function aa(e){var t=Re[e.ea](4),n=(q.d[e.Dn]&se(t))>>>0;return fe(t,n),Qn(n,e.zm),ne(),e.cyc}function oa(e){var t=Re[e.ea](2),n=65535&q.d[e.Dn]&oe(t);return _e(t,n),Qn(n,e.zm),ne(),e.cyc}function sa(e){var t=Re[e.ea](1),n=255&q.d[e.Dn]&ae(t);return ce(t,n),Qn(n,e.zm),ne(),e.cyc}function ca(e){var t=(q.d[e.Dd]^q.d[e.Dn])>>>0;return q.d[e.Dd]=t,Qn(t,e.zm),ne(),e.cyc}function _a(e){var t=65535&q.d[e.Dd]^65535&q.d[e.Dn];return q.d[e.Dd]=4294901760&q.d[e.Dd]|t,Qn(t,e.zm),ne(),e.cyc}function fa(e){var t=255&q.d[e.Dd]^255&q.d[e.Dn];return q.d[e.Dd]=4294967040&q.d[e.Dd]|t,Qn(t,e.zm),ne(),e.cyc}function la(e){var t=Re[e.ea](4),n=(se(t)^q.d[e.Dn])>>>0;return fe(t,n),Qn(n,e.zm),ne(),e.cyc}function ua(e){var t=Re[e.ea](2),n=oe(t)^65535&q.d[e.Dn];return _e(t,n),Qn(n,e.zm),ne(),e.cyc}function da(e){var t=Re[e.ea](1),n=ae(t)^255&q.d[e.Dn];return ce(t,n),Qn(n,e.zm),ne(),e.cyc}function pa(e){var t=~q.d[e.Dn]>>>0;return q.d[e.Dn]=t,Qn(t,e.zm),ne(),e.cyc}function Ea(e){var t=~(65535&q.d[e.Dn])&e.m;return q.d[e.Dn]=4294901760&q.d[e.Dn]|t,Qn(t,e.zm),ne(),e.cyc}function Aa(e){var t=~(255&q.d[e.Dn])&e.m;return q.d[e.Dn]=4294967040&q.d[e.Dn]|t,Qn(t,e.zm),ne(),e.cyc}function Sa(e){var t=Re[e.ea](4),n=~se(t)>>>0;return fe(t,n),Qn(n,e.zm),ne(),e.cyc}function ma(e){var t=Re[e.ea](2),n=~oe(t)&e.m;return _e(t,n),Qn(n,e.zm),ne(),e.cyc}function ha(e){var t=Re[e.ea](1),n=~ae(t)&e.m;return ce(t,n),Qn(n,e.zm),ne(),e.cyc}function ga(e){var t=(Fe[e.ea]()|q.d[e.Dn])>>>0;return q.d[e.Dn]=t,Qn(t,e.zm),ne(),e.cyc}function ya(e){var t=De[e.ea]()|65535&q.d[e.Dn];return q.d[e.Dn]=4294901760&q.d[e.Dn]|t,Qn(t,e.zm),ne(),e.cyc}function va(e){var t=we[e.ea]()|255&q.d[e.Dn];return q.d[e.Dn]=4294967040&q.d[e.Dn]|t,Qn(t,e.zm),ne(),e.cyc}function ba(e){var t=Re[e.ea](4),n=(q.d[e.Dn]|se(t))>>>0;return fe(t,n),Qn(n,e.zm),ne(),e.cyc}function Ca(e){var t=Re[e.ea](2),n=65535&q.d[e.Dn]|oe(t);return _e(t,n),Qn(n,e.zm),ne(),e.cyc}function ka(e){var t=Re[e.ea](1),n=255&q.d[e.Dn]|ae(t);return ce(t,n),Qn(n,e.zm),ne(),e.cyc}function Ra(e){var t=(ie()&q.d[e.Dn])>>>0;return q.d[e.Dn]=t,Qn(t,e.zm),ne(),e.cyc}function wa(e){var t=65535&re()&q.d[e.Dn];return q.d[e.Dn]=4294901760&q.d[e.Dn]|t,Qn(t,e.zm),ne(),e.cyc}function xa(e){var t=255&re()&q.d[e.Dn];return q.d[e.Dn]=4294967040&q.d[e.Dn]|t,Qn(t,e.zm),ne(),e.cyc}function Da(e){var t=ie(),n=Re[e.ea](4),t=(t&se(n))>>>0;return fe(n,t),Qn(t,e.zm),ne(),e.cyc}function Ma(e){var t=re(),n=Re[e.ea](2),t=t&oe(n);return _e(n,t),Qn(t,e.zm),ne(),e.cyc}function Fa(e){var t=255&re(),n=Re[e.ea](1),t=t&ae(n);return ce(n,t),Qn(t,e.zm),ne(),e.cyc}function Ta(e){var t=(ie()^q.d[e.Dn])>>>0;return q.d[e.Dn]=t,Qn(t,e.zm),ne(),e.cyc}function Va(e){var t=re()^65535&q.d[e.Dn];return q.d[e.Dn]=4294901760&q.d[e.Dn]|t,Qn(t,e.zm),ne(),e.cyc}function Ia(e){var t=255&re()^255&q.d[e.Dn];return q.d[e.Dn]=4294967040&q.d[e.Dn]|t,Qn(t,e.zm),ne(),e.cyc}function Pa(e){var t=ie(),n=Re[e.ea](4),t=(t^se(n))>>>0;return fe(n,t),Qn(t,e.zm),ne(),e.cyc}function za(e){var t=re(),n=Re[e.ea](2),t=t^oe(n);return _e(n,t),Qn(t,e.zm),ne(),e.cyc}function Oa(e){var t=255&re(),n=Re[e.ea](1),t=t^ae(n);return ce(n,t),Qn(t,e.zm),ne(),e.cyc}function La(e){var t=(ie()|q.d[e.Dn])>>>0;return q.d[e.Dn]=t,Qn(t,e.zm),ne(),e.cyc}function Na(e){var t=re()|65535&q.d[e.Dn];return q.d[e.Dn]=4294901760&q.d[e.Dn]|t,Qn(t,e.zm),ne(),e.cyc}function Ba(e){var t=255&re()|255&q.d[e.Dn];return q.d[e.Dn]=4294967040&q.d[e.Dn]|t,Qn(t,e.zm),ne(),e.cyc}function Ua(e){var t=ie(),n=Re[e.ea](4),t=(t|se(n))>>>0;return fe(n,t),Qn(t,e.zm),ne(),e.cyc}function Ka(e){var t=re(),n=Re[e.ea](2),t=t|oe(n);return _e(n,t),Qn(t,e.zm),ne(),e.cyc}function Ga(e){var t=255&re(),n=Re[e.ea](1),t=t|ae(n);return ce(n,t),Qn(t,e.zm),ne(),e.cyc}function Ha(e){var t,n,r=q.d[e.Dy],i=e.ir?63&q.d[e.cr]:e.cr;return i?(t=0!=(2147483648&r),n=~((1<<32-i)-1)>>>0,q.x=q.c=0!=(r&1<<32-i),q.v=t?(r&n)>>>0!=n:(r&n)>>>0!=0,q.d[e.Dy]=r=(r<<i&4294967295)>>>0):q.v=q.c=!1,q.n=0!=(2147483648&r),q.z=0==r,ne(),[e.cyc[0]+2*i,e.cyc[1],e.cyc[2]]}function Xa(e){var t,n,r=65535&q.d[e.Dy],i=e.ir?63&q.d[e.cr]:e.cr;return i?(t=0!=(32768&r),n=65535&~((1<<16-i)-1),q.x=q.c=0!=(r&1<<16-i),q.v=t?(r&n)!=n:0!=(r&n),q.d[e.Dy]=4294901760&q.d[e.Dy]|(r=(r<<i&65535)>>>0)):q.v=q.c=!1,q.n=0!=(32768&r),q.z=0==r,ne(),[e.cyc[0]+2*i,e.cyc[1],e.cyc[2]]}function qa(e){var t,n,r=255&q.d[e.Dy],i=e.ir?63&q.d[e.cr]:e.cr;return i?(t=0!=(128&r),n=255&~((1<<8-i)-1),q.x=q.c=0!=(r&1<<8-i),q.v=t?(r&n)!=n:0!=(r&n),q.d[e.Dy]=4294967040&q.d[e.Dy]|(r=(r<<i&255)>>>0)):q.v=q.c=!1,q.n=0!=(128&r),q.z=0==r,ne(),[e.cyc[0]+2*i,e.cyc[1],e.cyc[2]]}function Za(e){var t=q.d[e.Dy],n=e.ir?63&q.d[e.cr]:e.cr;return n?(q.x=q.c=0!=(t&1<<n-1),q.d[e.Dy]=t=t>>n>>>0):q.c=!1,q.n=0!=(2147483648&t),q.z=0==t,q.v=!1,ne(),[e.cyc[0]+2*n,e.cyc[1],e.cyc[2]]}function ja(e){var t=65535&q.d[e.Dy],n=e.ir?63&q.d[e.cr]:e.cr;return n?(q.x=q.c=0!=(t&1<<n-1),t=qn(t),q.d[e.Dy]=4294901760&q.d[e.Dy]|(t=(t>>n&65535)>>>0)):q.c=!1,q.n=0!=(32768&t),q.z=0==t,q.v=!1,ne(),[e.cyc[0]+2*n,e.cyc[1],e.cyc[2]]}function Ya(e){var t=255&q.d[e.Dy],n=e.ir?63&q.d[e.cr]:e.cr;return n?(q.x=q.c=0!=(t&1<<n-1),t=Xn(t),q.d[e.Dy]=4294967040&q.d[e.Dy]|(t=(t>>n&255)>>>0)):q.c=!1,q.n=0!=(128&t),q.z=0==t,q.v=!1,ne(),[e.cyc[0]+2*n,e.cyc[1],e.cyc[2]]}function Wa(e){var t=Re[e.ea](2),n=oe(t);return q.x=q.c=0!=(32768&n),q.v=q.c!=(0!=(16384&n)),q.n=0!=(32768&(n=n<<1&65535)),q.z=0==n,_e(t,n),ne(),e.cyc}function Ja(e){var t=Re[e.ea](2),n=oe(t),r=32768&n;return q.x=q.c=0!=(1&n),q.v=!1,q.n=0!=(32768&(n=r|n>>1)),q.z=0==n,_e(t,n),ne(),e.cyc}function Qa(e){var t=q.d[e.Dy],n=e.ir?63&q.d[e.cr]:e.cr;return n?(q.x=q.c=0!=(t&1<<32-n),q.d[e.Dy]=t=(t<<n&4294967295)>>>0):q.c=!1,q.n=0!=(2147483648&t),q.z=0==t,q.v=!1,ne(),[e.cyc[0]+2*n,e.cyc[1],e.cyc[2]]}function $a(e){var t=65535&q.d[e.Dy],n=e.ir?63&q.d[e.cr]:e.cr;return n?(q.x=q.c=0!=(t&1<<16-n),q.d[e.Dy]=4294901760&q.d[e.Dy]|(t=(t<<n&65535)>>>0)):q.c=!1,q.n=0!=(32768&t),q.z=0==t,q.v=!1,ne(),[e.cyc[0]+2*n,e.cyc[1],e.cyc[2]]}function eo(e){var t=255&q.d[e.Dy],n=e.ir?63&q.d[e.cr]:e.cr;return n?(q.x=q.c=0!=(t&1<<8-n),q.d[e.Dy]=4294967040&q.d[e.Dy]|(t=(t<<n&255)>>>0)):q.c=!1,q.n=0!=(128&t),q.z=0==t,q.v=!1,ne(),[e.cyc[0]+2*n,e.cyc[1],e.cyc[2]]}function to(e){var t=q.d[e.Dy],n=e.ir?63&q.d[e.cr]:e.cr;return n?(q.x=q.c=0!=(t&1<<n-1),q.d[e.Dy]=t>>>=n):q.c=!1,q.n=0!=(2147483648&t),q.z=0==t,q.v=!1,ne(),[e.cyc[0]+2*n,e.cyc[1],e.cyc[2]]}function no(e){var t=65535&q.d[e.Dy],n=e.ir?63&q.d[e.cr]:e.cr;return n?(q.x=q.c=0!=(t&1<<n-1),q.d[e.Dy]=4294901760&q.d[e.Dy]|(t>>=n)):q.c=!1,q.n=0!=(32768&t),q.z=0==t,q.v=!1,ne(),[e.cyc[0]+2*n,e.cyc[1],e.cyc[2]]}function ro(e){var t=255&q.d[e.Dy],n=e.ir?63&q.d[e.cr]:e.cr;return n?(q.x=q.c=0!=(t&1<<n-1),q.d[e.Dy]=4294967040&q.d[e.Dy]|(t>>=n)):q.c=!1,q.n=0!=(128&t),q.z=0==t,q.v=!1,ne(),[e.cyc[0]+2*n,e.cyc[1],e.cyc[2]]}function io(e){var t=Re[e.ea](2),n=oe(t);return q.x=q.c=0!=(32768&n),q.n=0!=(32768&(n=n<<1&65535)),q.z=0==n,q.v=!1,_e(t,n),ne(),e.cyc}function ao(e){var t=Re[e.ea](2),n=oe(t);return q.x=q.c=0!=(1&n),q.n=0!=(32768&(n>>=1)),q.z=0==n,q.v=!1,_e(t,n),ne(),e.cyc}function oo(e){var t=q.d[e.Dy],n=e.ir?63&q.d[e.cr]:e.cr;return n?(q.c=0!=(t&1<<32-n),q.d[e.Dy]=t=(4294967295&(t<<n|t>>>32-n))>>>0):q.c=!1,q.n=0!=(2147483648&t),q.z=0==t,q.v=!1,ne(),[e.cyc[0]+2*n,e.cyc[1],e.cyc[2]]}function so(e){var t=65535&q.d[e.Dy],n=e.ir?63&q.d[e.cr]:e.cr;return n?(q.c=0!=(t&1<<16-n),q.d[e.Dy]=4294901760&q.d[e.Dy]|(t=(65535&(t<<n|t>>16-n))>>>0)):q.c=!1,q.n=0!=(32768&t),q.z=0==t,q.v=!1,ne(),[e.cyc[0]+2*n,e.cyc[1],e.cyc[2]]}function co(e){var t=255&q.d[e.Dy],n=e.ir?63&q.d[e.cr]:e.cr;return n?(q.c=0!=(t&1<<8-n),q.d[e.Dy]=4294967040&q.d[e.Dy]|(t=(255&(t<<n|t>>8-n))>>>0)):q.c=!1,q.n=0!=(128&t),q.z=0==t,q.v=!1,ne(),[e.cyc[0]+2*n,e.cyc[1],e.cyc[2]]}function _o(e){var t=q.d[e.Dy],n=e.ir?63&q.d[e.cr]:e.cr;return n?(q.c=0!=(t&1<<n-1),q.d[e.Dy]=t=(4294967295&(t<<32-n|t>>>n))>>>0):q.c=!1,q.n=0!=(2147483648&t),q.z=0==t,q.v=!1,ne(),[e.cyc[0]+2*n,e.cyc[1],e.cyc[2]]}function fo(e){var t=65535&q.d[e.Dy],n=e.ir?63&q.d[e.cr]:e.cr;return n?(q.c=0!=(t&1<<n-1),q.d[e.Dy]=4294901760&q.d[e.Dy]|(t=(65535&(t<<16-n|t>>>n))>>>0)):q.c=!1,q.n=0!=(32768&t),q.z=0==t,q.v=!1,ne(),[e.cyc[0]+2*n,e.cyc[1],e.cyc[2]]}function lo(e){var t=255&q.d[e.Dy],n=e.ir?63&q.d[e.cr]:e.cr;return n?(q.c=0!=(t&1<<n-1),q.d[e.Dy]=4294967040&q.d[e.Dy]|(t=(255&(t<<8-n|t>>>n))>>>0)):q.c=!1,q.n=0!=(128&t),q.z=0==t,q.v=!1,ne(),[e.cyc[0]+2*n,e.cyc[1],e.cyc[2]]}function uo(e){var t=Re[e.ea](2),n=oe(t);return q.c=0!=(32768&n),n=n<<1&65535|(q.c?1:0),q.n=0!=(32768&n),q.z=0==n,q.v=!1,_e(t,n),ne(),e.cyc}function po(e){var t=Re[e.ea](2),n=oe(t);return q.c=0!=(1&n),n=(q.c?32768:0)|n>>1,q.n=0!=(32768&n),q.z=0==n,q.v=!1,_e(t,n),ne(),e.cyc}function Eo(e){var t=q.d[e.Dy],n=e.ir?63&q.d[e.cr]:e.cr;return n?(q.c=0!=(t&1<<32-n),t=(4294967294&(t=(4294967295&(t<<n|t>>>32-n))>>>0)|(q.x?1:0))>>>0,q.d[e.Dy]=t,q.x=q.c):q.c=q.x,q.n=0!=(2147483648&t),q.z=0==t,q.v=!1,ne(),[e.cyc[0]+2*n,e.cyc[1],e.cyc[2]]}function Ao(e){var t=65535&q.d[e.Dy],n=e.ir?63&q.d[e.cr]:e.cr;return n?(q.c=0!=(t&1<<16-n),t=65534&(t=65535&(t<<n|t>>16-n))|(q.x?1:0),q.d[e.Dy]=4294901760&q.d[e.Dy]|t,q.x=q.c):q.c=q.x,q.n=0!=(32768&t),q.z=0==t,q.v=!1,ne(),[e.cyc[0]+2*n,e.cyc[1],e.cyc[2]]}function So(e){var t=255&q.d[e.Dy],n=e.ir?63&q.d[e.cr]:e.cr;return n?(q.c=0!=(t&1<<8-n),t=254&(t=255&(t<<n|t>>8-n))|(q.x?1:0),q.d[e.Dy]=4294967040&q.d[e.Dy]|t,q.x=q.c):q.c=q.x,q.n=0!=(128&t),q.z=0==t,q.v=!1,ne(),[e.cyc[0]+2*n,e.cyc[1],e.cyc[2]]}function mo(e){var t=q.d[e.Dy],n=e.ir?63&q.d[e.cr]:e.cr;return n?(q.c=0!=(t&1<<n-1),t=((q.x?2147483648:0)|2147483647&(t=(4294967295&(t<<32-n|t>>>n))>>>0))>>>0,q.d[e.Dy]=t,q.x=q.c):q.c=q.x,q.n=0!=(2147483648&t),q.z=0==t,q.v=!1,ne(),[e.cyc[0]+2*n,e.cyc[1],e.cyc[2]]}function ho(e){var t=65535&q.d[e.Dy],n=e.ir?63&q.d[e.cr]:e.cr;return n?(q.c=0!=(t&1<<n-1),t=(q.x?32768:0)|32767&(t=65535&(t<<16-n|t>>>n)),q.d[e.Dy]=4294901760&q.d[e.Dy]|t,q.x=q.c):q.c=q.x,q.n=0!=(32768&t),q.z=0==t,q.v=!1,ne(),[e.cyc[0]+2*n,e.cyc[1],e.cyc[2]]}function go(e){var t=255&q.d[e.Dy],n=e.ir?63&q.d[e.cr]:e.cr;return n?(q.c=0!=(t&1<<n-1),t=(q.x?128:0)|127&(t=255&(t<<8-n|t>>>n)),q.d[e.Dy]=4294967040&q.d[e.Dy]|t,q.x=q.c):q.c=q.x,q.n=0!=(128&t),q.z=0==t,q.v=!1,ne(),[e.cyc[0]+2*n,e.cyc[1],e.cyc[2]]}function yo(e){var t=Re[e.ea](2),n=oe(t);return q.c=0!=(32768&n),n=n<<1&65535|(q.x?1:0),q.x=q.c,q.n=0!=(32768&n),q.z=0==n,q.v=!1,_e(t,n),ne(),e.cyc}function vo(e){var t=Re[e.ea](2),n=oe(t);return q.c=0!=(1&n),n=(q.x?32768:0)|n>>1,q.x=q.c,q.n=0!=(32768&n),q.z=0==n,q.v=!1,_e(t,n),ne(),e.cyc}function bo(e){var t=q.d[e.Dn],t=((65535&t)<<16|t>>>16)>>>0;return q.d[e.Dn]=t,q.n=0!=(2147483648&t),q.z=0==t,q.v=q.c=!1,ne(),e.cyc}function Co(e){var t=31&q.d[e.Dn],n=q.d[e.Dd],t=1<<t>>>0;return q.z=0==(n&t),q.d[e.Dd]=(n^t)>>>0,ne(),e.cyc}function ko(e){var t=Re[e.ea](1),n=7&q.d[e.Dn],r=ae(t),n=1<<n;return q.z=0==(r&n),ce(t,r^n),ne(),e.cyc}function Ro(e){var t=31&re(),n=q.d[e.Dd],t=1<<t>>>0;return q.z=0==(n&t),q.d[e.Dd]=(n^t)>>>0,ne(),e.cyc}function wo(e){var t=7&re(),n=Re[e.ea](1),r=ae(n),t=1<<t;return q.z=0==(r&t),ce(n,r^t),ne(),e.cyc}function xo(e){var t=31&q.d[e.Dn],n=q.d[e.Dd],t=1<<t>>>0;return q.z=0==(n&t),q.d[e.Dd]=(n&~t)>>>0,ne(),e.cyc}function Do(e){var t=Re[e.ea](1),n=7&q.d[e.Dn],r=ae(t),n=1<<n;return q.z=0==(r&n),ce(t,r&~n),ne(),e.cyc}function Mo(e){var t=31&re(),n=q.d[e.Dd],t=1<<t>>>0;return q.z=0==(n&t),q.d[e.Dd]=(n&~t)>>>0,ne(),e.cyc}function Fo(e){var t=7&re(),n=Re[e.ea](1),r=ae(n),t=1<<t;return q.z=0==(r&t),ce(n,r&~t),ne(),e.cyc}function To(e){var t=31&q.d[e.Dn],n=q.d[e.Dd],t=1<<t>>>0;return q.z=0==(n&t),q.d[e.Dd]=(n|t)>>>0,ne(),e.cyc}function Vo(e){var t=Re[e.ea](1),n=7&q.d[e.Dn],r=ae(t),n=1<<n;return q.z=0==(r&n),ce(t,r|n),ne(),e.cyc}function Io(e){var t=31&re(),n=q.d[e.Dd],t=1<<t>>>0;return q.z=0==(n&t),q.d[e.Dd]=(n|t)>>>0,ne(),e.cyc}function Po(e){var t=7&re(),n=Re[e.ea](1),r=ae(n),t=1<<t;return q.z=0==(r&t),ce(n,r|t),ne(),e.cyc}function zo(e){var t=31&q.d[e.Dn],n=q.d[e.Dd];return q.z=0==(n&1<<t>>>0),ne(),e.cyc}function Oo(e){var t=7&q.d[e.Dn],n=we[e.ea]();return q.z=0==(n&1<<t),ne(),e.cyc}function Lo(e){var t=31&re(),n=q.d[e.Dd];return q.z=0==(n&1<<t>>>0),ne(),e.cyc}function No(e){var t=7&re(),n=we[e.ea]();return q.z=0==(n&1<<t),ne(),e.cyc}function Bo(e){var t=re(),n=2048&t?q.d[t>>6&7]:t>>6&31,r=32&t?31&q.d[7&t]:31&t;0==r&&(r=32);var i,a,o=[0,0];switch(e.ea>>3==0?(a=q.d[7&e.ea],o[0]=((a=(a<<(n&=31)|a>>>32-n)>>>0)&(1<<32-r)-1)>>>0):(2147483648&n&&(n-=4294967296),addr=Re[e.ea](1),n&&(addr+=Math.truncate(n/8)),a=(i=function(e,t,n){var r,i,a,o=[0,0];switch(offs=7&t,a=4294967295<<32-n>>>0,offs+n+7>>3){case 1:i=(r=ae(e))<<24+offs,o[0]=r&~(a>>>24+offs);break;case 2:i=(r=oe(e))<<16+offs,o[0]=r&~(a>>>16+offs);break;case 3:i=(r=oe(e))<<16+offs,o[0]=r&~(a>>>16+offs),i|=(r=ae(e+2))<<8+offs,o[1]=r&~(a>>>8+offs);break;case 4:i=(r=se(e))<<offs,o[0]=r&~(a>>>offs);break;case 5:i=(r=se(e))<<offs,o[0]=r&~(a>>>offs),i|=(r=ae(e+4))>>8-offs,o[1]=r&~(a<<8-offs);break;default:SAEF_fatal(SAEE_CPU_Internal,"cpu.get_bitfield2() invalid mode (%d)",offs+n+7>>3)}return[i>>>0,o]}(addr,Math.abs(n),r))[0],o=i[1]),q.n=0!=(2147483648&a),e.id==jt?a>>=32-r:a>>>=32-r,q.z=0==a,q.v=!1,q.c=!1,e.id){case $t:break;case Yt:case jt:q.d[t>>12&7]=a;break;case qt:a=(a^4294967295>>>32-r)>>>0;break;case Zt:a=0;break;case Wt:for(var s=1<<r-1>>>0;s&&!(a&s);)s>>>=1,n++;n<0&&(n+=4294967296),q.d[t>>12&7]=n;break;case Qt:a=4294967295>>>32-r;break;case Jt:a=q.d[t>>12&7]&4294967295>>>32-r,q.n=0!=(a&1<<r-1),q.z=0==a}return e.id!=qt&&e.id!=Zt&&e.id!=Qt&&e.id!=Jt||(e.ea>>3==0?(a=o[0]|a<<32-r,q.d[7&e.ea]=a>>>n|a<<32-n):function(e,t,n,r,i){var a,o,s;switch(offs=(7&t)+n,offs+7>>3){case 1:a=(r[0]|i<<8-offs)>>>0&255,ce(e,a);break;case 2:o=(r[0]|i<<16-offs)>>>0&65535,_e(e,o);break;case 3:o=(r[0]|i>>offs-16)>>>0&65535,a=(r[1]|i<<24-offs)>>>0&255,_e(e,o),ce(e+2,a);break;case 4:s=(r[0]|i<<32-offs)>>>0,fe(e,s);break;case 5:s=(r[0]|i>>offs-32)>>>0,a=(r[1]|i<<40-offs)>>>0&255,fe(e,s),ce(e+4,a);break;default:SAEF_fatal(SAEE_CPU_Internal,"cpu.put_bitfield2() invalid mode (%d)",offs+7>>3)}}(addr,Math.abs(n),r,o,a)),ne(),e.cyc}function Uo(e){var t=255&q.d[e.Ry],n=255&q.d[e.Rx],r=(15&t)+(15&n)+(q.x?1:0),n=(240&t)+(240&n)+r;return 9<r&&(n+=6),144<(1008&n)?(n=n+96&255,q.x=q.c=!0):q.x=q.c=!1,n&&(q.z=!1),q.d[e.Rx]=4294967040&q.d[e.Rx]|n,ne(),e.cyc}function Ko(e){q.a[e.Ry]-=Un[1][e.Ry];var t=ae(q.a[e.Ry]);q.a[e.Rx]-=Un[1][e.Rx];var n=ae(q.a[e.Rx]),r=(15&t)+(15&n)+(q.x?1:0),n=(240&t)+(240&n)+r;return 9<r&&(n+=6),144<(1008&n)?(n=n+96&255,q.x=q.c=!0):q.x=q.c=!1,n&&(q.z=!1),ce(q.a[e.Rx],n),ne(),e.cyc}function Go(e){var t=255&q.d[e.Rx],n=255&q.d[e.Ry],r=(15&n)-(15&t)-(q.x?1:0),i=(240&n)-(240&t)+r,a=0;return 240&r&&(i-=6,a=6),255<((255&n)-(255&t)-(q.x?1:0)&256)&&(i=i-96&255),q.x=q.c=255<((255&n)-(255&t)-a-(q.x?1:0)&768),i&&(q.z=!1),q.d[e.Ry]=4294967040&q.d[e.Ry]|i,ne(),e.cyc}function Ho(e){q.a[e.Rx]-=Un[1][e.Rx];var t=ae(q.a[e.Rx]);q.a[e.Ry]-=Un[1][e.Ry];var n=ae(q.a[e.Ry]),r=(15&n)-(15&t)-(q.x?1:0),i=(240&n)-(240&t)+r,a=0;return 240&r&&(i-=6,a=6),255<((255&n)-(255&t)-(q.x?1:0)&256)&&(i=i-96&255),q.x=q.c=255<((255&n)-(255&t)-a-(q.x?1:0)&768),i&&(q.z=!1),ce(q.a[e.Ry],i),ne(),e.cyc}function Xo(e){var t=255&q.d[e.Dd],n=-(15&t)-(q.x?1:0);9<n&&(n-=6);n=-(240&t)+n;return 144<(496&n)?(n=n-96&255,q.x=q.c=!0):q.x=q.c=!1,n&&(q.z=!1),q.d[e.Dd]=4294967040&q.d[e.Dd]|n,ne(),e.cyc}function qo(e){var t=Re[e.ea](1),n=ae(t),r=-(15&n)-(q.x?1:0);9<r&&(r-=6);r=-(240&n)+r;return 144<(496&r)?(r=r-96&255,q.x=q.c=!0):q.x=q.c=!1,r&&(q.z=!1),ce(t,r),ne(),e.cyc}function Zo(e){var t=re(),t=(65535&q.d[e.Rx])+t;return 65535<t&&(t-=65536),q.d[e.Ry]=4294967040&q.d[e.Ry]|(t>>4&240|15&t),ne(),e.cyc}function jo(e){var t=re();q.a[e.Rx]-=Un[1][e.Rx];var n=ae(q.a[e.Rx]);q.a[e.Rx]-=Un[1][e.Rx];t=((15&n)<<8|15&ae(q.a[e.Rx]))+t;65535<t&&(t-=65536);t=t>>4&240|15&t;return q.a[e.Ry]-=Un[1][e.Ry],ce(q.a[e.Ry],t),ne(),e.cyc}function Yo(e){var t=re(),n=65535&q.d[e.Rx],t=(n<<4&3840|15&n)+t;return 65535<t&&(t-=65536),q.d[e.Ry]=4294901760&q.d[e.Ry]|t,ne(),e.cyc}function Wo(e){var t=re();q.a[e.Rx]-=Un[1][e.Rx];var n=ae(q.a[e.Rx]),t=(n<<4&3840|15&n)+t;return 65535<t&&(t-=65536),q.a[e.Ry]-=Un[1][e.Ry],ce(q.a[e.Ry],t>>8),q.a[e.Ry]-=Un[1][e.Ry],ce(q.a[e.Ry],255&t),ne(),e.cyc}function Jo(e){var t,n=ee();return 0==e.dp?t=re():255==e.dp&&(t=ie()),ke[e.cc]()?1&(n=0==e.dp?Zn(n,qn(t)):255==e.dp?Zn(n,t):Zn(n,Xn(e.dp)))?zt(e.op,n):(te(n),e.cycTaken):(ne(),e.cyc)}function Qo(e){var t,n=ee(),r=re();if(ke[e.cc]())t=e.cycNotTakenTrue;else{var i=(65535&q.d[e.Dn])-1;if(i<0&&(i+=65536),q.d[e.Dn]=4294901760&q.d[e.Dn]|i,65535!=i)return 1&(n=Zn(n,qn(r)))?zt(e.op,n):(te(n),e.cyc);t=e.cycNotTakenFalse}return ne(),t}function $o(e){var t,n=e.ea>>3==0,r=ke[e.cc]();return n?(t=7&e.ea,q.d[t]=4294967040&q.d[t]|(r?255:0)):(t=Re[e.ea](1),Ve<68020&&ae(t),ce(t,r?255:0)),ne(),r?n?e.cycTrue:e.cyc:n?e.cycFalse:e.cyc}function es(e){var t=ee(),n=0==e.dp?qn(re()):255==e.dp?ie():Xn(e.dp);return 1&(t=Zn(t,n))?zt(e.op,t):(te(t),e.cyc)}function ts(e){var t=ee(),n=0==e.dp?qn(re()):255==e.dp?ie():Xn(e.dp);return 1&(t=Zn(t,n))?zt(e.op,t):(Ln(ee()),te(t),e.cyc)}function ns(e){var t=Re[e.ea](4);return 1&t?zt(e.op,t):(te(t),e.cyc)}function rs(e){var t=Re[e.ea](4);return 1&t?zt(e.op,t):(Ln(ee()),te(t),e.cyc)}function is(e){return ne(),e.cyc}function as(e){var t;return 1&(t=Zn(t=Bn(),qn(re())))?zt(e.op,t):(te(t),e.cyc)}function os(e){var t=255&Nn(),n=Bn();return wt(t),1&n?zt(e.op,n):(te(n),e.cyc)}function ss(e){var t=Bn();return 1&t?zt(e.op,t):(te(t),e.cyc)}function cs(e){return Qn(we[e.ea](),e.zm),ne(),e.cyc}function _s(e){return Qn(De[e.ea](),e.zm),ne(),e.cyc}function fs(e){return Qn(Fe[e.ea](),e.zm),ne(),e.cyc}function ls(e){return wt(255&re()&Rt()),ne(),e.cyc}function us(e){return wt(255&re()^Rt()),ne(),e.cyc}function ds(e){return wt(255&re()|Rt()),ne(),e.cyc}function ps(e){var t=255&De[e.ea]();return ne(),wt(t),e.cyc}function Es(e){var t=Rt();return Me[e.ea](t),ne(),e.cyc}function As(e){return q.s?(Dt(re()&xt()),ne(),e.cyc):Vt(8)}function Ss(e){return q.s?(Dt(re()^xt()),ne(),e.cyc):Vt(8)}function ms(e){return q.s?(Dt(re()|xt()),ne(),e.cyc):Vt(8)}function hs(e){return q.s?(Dt(De[e.ea]()),ne(),e.cyc):Vt(8)}function gs(e){if(q.s||68e3==Ve){var t=xt();return Me[e.ea](t),ne(),e.cyc}return Vt(8)}function ys(e){return q.s?(q.a[e.An]=q.usp,ne(),e.cyc):Vt(8)}function vs(e){return q.s?(q.usp=q.a[e.An],ne(),e.cyc):Vt(8)}function bs(e){var t=re();if(q.s){var n=4095&t;return en(n)?(function(e,t){switch(e){case 0:q.sfc=7&t;break;case 1:q.dfc=7&t;break;case 2:switch(Ve){case 68020:q.cacr=t&c;break;case 68030:q.cacr=t&F;break;default:q.cacr=0}Ie();break;case 2048:q.usp=t;break;case 2049:q.vbr=t;break;case 2050:q.caar=t;break;case 2051:q.msp=t,q.m&&(q.a[7]=q.msp);break;case 2052:q.isp=t,q.m||(q.a[7]=q.isp);break;default:SAEF_fatal(SAEE_CPU_Internal,"cpu.movec2C() invalid register %d",e)}}(n,(32768&t?q.a:q.d)[t>>12&7]),ne(),e.cyc):Nt(e.op)}return Vt(8)}function Cs(e){var t=re();if(q.s){var n=4095&t;if(en(n)){n=function(e){var t=null;switch(e){case 0:t=q.sfc;break;case 1:t=q.dfc;break;case 2:switch(Ve){case 68020:t=q.cacr&s;break;case 68030:t=q.cacr&M;break;default:t=0}break;case 2048:t=q.usp;break;case 2049:t=q.vbr;break;case 2050:t=q.caar;break;case 2051:t=1==q.m?q.a[7]:q.msp;break;case 2052:t=0==q.m?q.a[7]:q.isp;break;default:SAEF_fatal(SAEE_CPU_Internal,"cpu.movecC2() invalid register %d",e)}return t}(n);return 32768&t?q.a[t>>12&7]=n:q.d[t>>12&7]=n,ne(),e.cyc}return Nt(e.op)}return Vt(8)}function ks(e){if(q.s){var t,n=re();return 2048&n?(t=(32768&n?q.a:q.d)[n>>12&7],Te[e.ea](t)):32768&n?q.a[n>>12&7]=Fe[e.ea]():q.d[n>>12&7]=Fe[e.ea](),ne(),e.cyc}return Vt(8)}function Rs(e){if(q.s){var t,n=re();return 2048&n?(t=(32768&n?q.a:q.d)[n>>12&7],Me[e.ea](65535&t)):(t=De[e.ea](),32768&n?q.a[n>>12&7]=qn(t):q.d[n>>12&7]=4294901760&q.d[n>>12&7]|t),ne(),e.cyc}return Vt(8)}function ws(e){if(q.s){var t,n=re();return 2048&n?(t=(32768&n?q.a:q.d)[n>>12&7],xe[e.ea](255&t)):(t=we[e.ea](),32768&n?q.a[n>>12&7]=Xn(t):q.d[n>>12&7]=4294967040&q.d[n>>12&7]|t),ne(),e.cyc}return Vt(8)}function xs(e){return ne(),e.cyc}function Ds(e){var t=Gn(De[e.ea]()),n=Gn(65535&q.d[e.Dn]);return n<0?(q.n=!0,Vt(6)):t<n?(q.n=!1,Vt(6)):(ne(),e.cyc)}function Ms(e){var t=Hn(Fe[e.ea]()),n=Hn(q.d[e.Dn]);return n<0?(q.n=!0,Vt(6)):t<n?(q.n=!1,Vt(6)):(ne(),e.cyc)}function Fs(e){var t,n=re(),r=Re[e.ea](4),i=se(r),r=se(r+4);return 32768&n?t=q.a[n>>12&7]:(t=Hn(q.d[n>>12&7]),i=Hn(i),r=Hn(r)),q.z=r==t||i==t,q.c=i<=r?t<i||r<t:t<r||i<t,2048&n&&q.c?Vt(6):(ne(),e.cyc)}function Ts(e){var t,n=re(),r=Re[e.ea](2),i=oe(r),r=oe(r+2),r=32768&n?(t=qn(65535&q.a[n>>12&7]),i=qn(i),qn(r)):(t=Gn(65535&q.d[n>>12&7]),i=Gn(i),Gn(r));return q.z=r==t||i==t,q.c=i<=r?t<i||r<t:t<r||i<t,2048&n&&q.c?Vt(6):(ne(),e.cyc)}function Vs(e){var t,n=re(),r=Re[e.ea](1),i=ae(r),r=ae(r+1),r=32768&n?(t=Xn(255&q.a[n>>12&7]),i=Xn(i),Xn(r)):(t=Kn(255&q.d[n>>12&7]),i=Kn(i),Kn(r));return q.z=r==t||i==t,q.c=i<=r?t<i||r<t:t<r||i<t,2048&n&&q.c?Vt(6):(ne(),e.cyc)}function Is(e){return Nt(e.op)}function Ps(e){return q.s?(SAEF_log("I_RESET pc $%08x",q.instruction_pc),SAER.m68k.cpureset(),ne(),e.cyc):Vt(8)}function zs(e){if(q.s){var t=Nn(),n=Bn();if(68e3!=Ve){var r=Nn()>>12;if(0!=r&&1!=r)if(2==r)q.a[7]+=4;else if(4==r)q.a[7]+=8;else if(8==r)q.a[7]+=50;else if(9==r)q.a[7]+=12;else if(10==r)q.a[7]+=24;else{if(11!=r)return q.a[7]+=0,Vt(14);q.a[7]+=84}}return(Dt(t),1&n)?zt(e.op,n):(te(n),e.cyc)}return Vt(8)}function Os(e){return q.s?(Dt(re()),SAER.m68k.m68k_setstopped(),ne(),e.cyc):Vt(8)}function Ls(e){return Vt(32+e.v)}function Ns(e){return ke[e.cc]()?(Ln(ee()),Vt(7)):(ne(),e.cyc)}function Bs(e){re();return ke[e.cc]()?(Ln(ee()),Vt(7)):(ne(),e.cyc)}function Us(e){ie();return ke[e.cc]()?(Ln(ee()),Vt(7)):(ne(),e.cyc)}function Ks(e){return q.v?Vt(7):(ne(),e.cyc)}function Gs(e){var t=re(),n=Re[e.ea](4),r=q.d[7&t],i=se(n),a=i-r;return a<0&&(a+=4294967296),Wn(r,i,a,2147483648),q.z?fe(n,q.d[t>>6&7]):q.d[7&t]=i,ne(),e.cyc}function Hs(e){var t=re(),n=Re[e.ea](2),r=65535&q.d[7&t],i=oe(n),a=i-r;return a<0&&(a+=65536),Wn(r,i,a,32768),q.z?_e(n,65535&q.d[t>>6&7]):q.d[7&t]=4294901760&q.d[7&t]|i,ne(),e.cyc}function Xs(e){var t=re(),n=Re[e.ea](1),r=255&q.d[7&t],i=ae(n),a=i-r;return a<0&&(a+=256),Wn(r,i,a,128),q.z?ce(n,255&q.d[t>>6&7]):q.d[7&t]=4294967040&q.d[7&t]|i,ne(),e.cyc}function qs(e){var t=re(),n=re(),r=t>>12&7,i=n>>12&7,a=t>>6&7,o=n>>6&7,s=7&t,c=7&n,_=q.d[s],f=q.d[c],l=32768&t?se(q.a[r]):q.d[r],u=32768&n?se(q.a[i]):q.d[i],d=!1,p=l-_;return p<0&&(p+=4294967296),Wn(_,l,p,2147483648),q.z&&((p=u-f)<0&&(p+=4294967296),Wn(f,u,p,2147483648),d=q.z),d?(32768&t?fe(q.a[r],q.d[a]):q.d[r]=q.d[a],32768&n?fe(q.a[i],q.d[o]):q.d[i]=q.d[o]):(q.d[s]=l,q.d[c]=u),ne(),e.cyc}function Zs(e){var t=re(),n=re(),r=t>>12&7,i=n>>12&7,a=t>>6&7,o=n>>6&7,s=7&t,c=7&n,_=65535&q.d[s],f=65535&q.d[c],l=32768&t?oe(q.a[r]):65535&q.d[r],u=32768&n?oe(q.a[i]):65535&q.d[i],d=!1,p=l-_;return p<0&&(p+=65536),Wn(_,l,p,32768),q.z&&((p=u-f)<0&&(p+=65536),Wn(f,u,p,32768),d=q.z),d?(32768&t?_e(q.a[r],65535&q.d[a]):q.d[r]=4294901760&q.d[r]|65535&q.d[a],32768&n?_e(q.a[i],65535&q.d[o]):q.d[i]=4294901760&q.d[i]|65535&q.d[o]):(q.d[s]=4294901760&q.d[s]|l,q.d[c]=4294901760&q.d[c]|u),ne(),e.cyc}function js(e){var t=we[e.ea]();return xe[e.ea](128|t),q.n=0!=(128&t),q.z=0==t,q.v=!1,q.c=!1,ne(),e.cyc}function Ys(e){return SAEF_warn("I_CALLM not implemented (ext %d)",255&re()),Nt(e.op)}function Ws(e){return SAEF_warn("I_RTM not implemented"),Nt(e.op)}function Js(e){if(q.s){var t=ee(),n=re(),r=Re[e.ea](4);return nn(t,e.op,n,r)?Nt(e.op):(ne(),e.cyc)}return Vt(8)}function Qs(e){return Nt(e.op)}function $s(e){return Nt(e.op)}function ec(e){return Nt(e.op)}function tc(e){return Nt(e.op)}function nc(e){return Nt(e.op)}function rc(e){return Nt(e.op)}function ic(e){return Nt(e.op)}function ac(e){return Nt(e)}function oc(){var e=0;(ke=new Array(16))[e++]=function(){return!0},ke[e++]=function(){return!1},ke[e++]=function(){return!q.c&&!q.z},ke[e++]=function(){return q.c||q.z},ke[e++]=function(){return!q.c},ke[e++]=function(){return q.c},ke[e++]=function(){return!q.z},ke[e++]=function(){return q.z},ke[e++]=function(){return!q.v},ke[e++]=function(){return q.v},ke[e++]=function(){return!q.n},ke[e++]=function(){return q.n},ke[e++]=function(){return q.n==q.v},ke[e++]=function(){return q.n!=q.v},ke[+e]=function(){return!q.z&&q.n==q.v},ke[15]=function(){return q.z||q.n!=q.v}}function sc(e,t){var n=t>>12&7,r=(32768&t?q.a:q.d)[n],n=t>>9&3;return 0==(2048&t)&&(r=qn(65535&r)),n&&(r=(r<<n&4294967295)>>>0),256&t?(n=0,128&t&&(e=0),64&t&&(r=0),32==(48&t)&&(e=Zn(e,qn(re()))),48==(48&t)&&(e=Zn(e,ie())),2==(3&t)&&(n=qn(re())),3==(3&t)&&(n=ie()),0==(4&t)&&(e=Zn(e,r)),3&t&&(e=se(e)),4&t&&(e=Zn(e,r)),Zn(e,n)):Zn(Zn(e,Xn(255&t)),r)}function cc(){(Re=new Array(64))[16]=function(){return q.a[0]},Re[17]=function(){return q.a[1]},Re[18]=function(){return q.a[2]},Re[19]=function(){return q.a[3]},Re[20]=function(){return q.a[4]},Re[21]=function(){return q.a[5]},Re[22]=function(){return q.a[6]},Re[23]=function(){return q.a[7]},Re[24]=function(e){var t=q.a[0];return q.a[0]+=Un[e][0],t},Re[25]=function(e){var t=q.a[1];return q.a[1]+=Un[e][1],t},Re[26]=function(e){var t=q.a[2];return q.a[2]+=Un[e][2],t},Re[27]=function(e){var t=q.a[3];return q.a[3]+=Un[e][3],t},Re[28]=function(e){var t=q.a[4];return q.a[4]+=Un[e][4],t},Re[29]=function(e){var t=q.a[5];return q.a[5]+=Un[e][5],t},Re[30]=function(e){var t=q.a[6];return q.a[6]+=Un[e][6],t},Re[31]=function(e){var t=q.a[7];return q.a[7]+=Un[e][7],t},Re[32]=function(e){return q.a[0]-=Un[e][0],q.a[0]},Re[33]=function(e){return q.a[1]-=Un[e][1],q.a[1]},Re[34]=function(e){return q.a[2]-=Un[e][2],q.a[2]},Re[35]=function(e){return q.a[3]-=Un[e][3],q.a[3]},Re[36]=function(e){return q.a[4]-=Un[e][4],q.a[4]},Re[37]=function(e){return q.a[5]-=Un[e][5],q.a[5]},Re[38]=function(e){return q.a[6]-=Un[e][6],q.a[6]},Re[39]=function(e){return q.a[7]-=Un[e][7],q.a[7]},Re[40]=function(){return Zn(q.a[0],qn(re()))},Re[41]=function(){return Zn(q.a[1],qn(re()))},Re[42]=function(){return Zn(q.a[2],qn(re()))},Re[43]=function(){return Zn(q.a[3],qn(re()))},Re[44]=function(){return Zn(q.a[4],qn(re()))},Re[45]=function(){return Zn(q.a[5],qn(re()))},Re[46]=function(){return Zn(q.a[6],qn(re()))},Re[47]=function(){return Zn(q.a[7],qn(re()))},Re[48]=function(){return sc(q.a[0],re())},Re[49]=function(){return sc(q.a[1],re())},Re[50]=function(){return sc(q.a[2],re())},Re[51]=function(){return sc(q.a[3],re())},Re[52]=function(){return sc(q.a[4],re())},Re[53]=function(){return sc(q.a[5],re())},Re[54]=function(){return sc(q.a[6],re())},Re[55]=function(){return sc(q.a[7],re())},Re[56]=function(){return qn(re())},Re[57]=function(){return ie()},Re[58]=function(){return Zn(ee(),qn(re()))},Re[59]=function(){return sc(ee(),re())},Re[60]=function(){SAEF_error("cpu.exEAtab() invalid EA 60 (7|4) (imm)")},(we=new Array(64))[0]=function(){return 255&q.d[0]},we[1]=function(){return 255&q.d[1]},we[2]=function(){return 255&q.d[2]},we[3]=function(){return 255&q.d[3]},we[4]=function(){return 255&q.d[4]},we[5]=function(){return 255&q.d[5]},we[6]=function(){return 255&q.d[6]},we[7]=function(){return 255&q.d[7]},we[8]=function(){SAEF_error("cpu.ldEA8tab() invalid EA  8 (1|0)")},we[9]=function(){SAEF_error("cpu.ldEA8tab() invalid EA  9 (1|1)")},we[10]=function(){SAEF_error("cpu.ldEA8tab() invalid EA 10 (1|2)")},we[11]=function(){SAEF_error("cpu.ldEA8tab() invalid EA 11 (1|3)")},we[12]=function(){SAEF_error("cpu.ldEA8tab() invalid EA 12 (1|4)")},we[13]=function(){SAEF_error("cpu.ldEA8tab() invalid EA 13 (1|5)")},we[14]=function(){SAEF_error("cpu.ldEA8tab() invalid EA 14 (1|6)")},we[15]=function(){SAEF_error("cpu.ldEA8tab() invalid EA 15 (1|7)")},we[16]=function(){return ae(q.a[0])},we[17]=function(){return ae(q.a[1])},we[18]=function(){return ae(q.a[2])},we[19]=function(){return ae(q.a[3])},we[20]=function(){return ae(q.a[4])},we[21]=function(){return ae(q.a[5])},we[22]=function(){return ae(q.a[6])},we[23]=function(){return ae(q.a[7])},we[24]=function(){var e=q.a[0];return q.a[0]+=1,ae(e)},we[25]=function(){var e=q.a[1];return q.a[1]+=1,ae(e)},we[26]=function(){var e=q.a[2];return q.a[2]+=1,ae(e)},we[27]=function(){var e=q.a[3];return q.a[3]+=1,ae(e)},we[28]=function(){var e=q.a[4];return q.a[4]+=1,ae(e)},we[29]=function(){var e=q.a[5];return q.a[5]+=1,ae(e)},we[30]=function(){var e=q.a[6];return q.a[6]+=1,ae(e)},we[31]=function(){var e=q.a[7];return q.a[7]+=2,ae(e)},we[32]=function(){return--q.a[0],ae(q.a[0])},we[33]=function(){return--q.a[1],ae(q.a[1])},we[34]=function(){return--q.a[2],ae(q.a[2])},we[35]=function(){return--q.a[3],ae(q.a[3])},we[36]=function(){return--q.a[4],ae(q.a[4])},we[37]=function(){return--q.a[5],ae(q.a[5])},we[38]=function(){return--q.a[6],ae(q.a[6])},we[39]=function(){return q.a[7]-=2,ae(q.a[7])},we[40]=function(){return ae(Zn(q.a[0],qn(re())))},we[41]=function(){return ae(Zn(q.a[1],qn(re())))},we[42]=function(){return ae(Zn(q.a[2],qn(re())))},we[43]=function(){return ae(Zn(q.a[3],qn(re())))},we[44]=function(){return ae(Zn(q.a[4],qn(re())))},we[45]=function(){return ae(Zn(q.a[5],qn(re())))},we[46]=function(){return ae(Zn(q.a[6],qn(re())))},we[47]=function(){return ae(Zn(q.a[7],qn(re())))},we[48]=function(){return ae(sc(q.a[0],re()))},we[49]=function(){return ae(sc(q.a[1],re()))},we[50]=function(){return ae(sc(q.a[2],re()))},we[51]=function(){return ae(sc(q.a[3],re()))},we[52]=function(){return ae(sc(q.a[4],re()))},we[53]=function(){return ae(sc(q.a[5],re()))},we[54]=function(){return ae(sc(q.a[6],re()))},we[55]=function(){return ae(sc(q.a[7],re()))},we[56]=function(){return ae(qn(re()))},we[57]=function(){return ae(ie())},we[58]=function(){return ae(Zn(ee(),qn(re())))},we[59]=function(){return ae(sc(ee(),re()))},we[60]=function(){return 255&re()},(De=new Array(64))[0]=function(){return 65535&q.d[0]},De[1]=function(){return 65535&q.d[1]},De[2]=function(){return 65535&q.d[2]},De[3]=function(){return 65535&q.d[3]},De[4]=function(){return 65535&q.d[4]},De[5]=function(){return 65535&q.d[5]},De[6]=function(){return 65535&q.d[6]},De[7]=function(){return 65535&q.d[7]},De[8]=function(){return 65535&q.a[0]},De[9]=function(){return 65535&q.a[1]},De[10]=function(){return 65535&q.a[2]},De[11]=function(){return 65535&q.a[3]},De[12]=function(){return 65535&q.a[4]},De[13]=function(){return 65535&q.a[5]},De[14]=function(){return 65535&q.a[6]},De[15]=function(){return 65535&q.a[7]},De[16]=function(){return oe(q.a[0])},De[17]=function(){return oe(q.a[1])},De[18]=function(){return oe(q.a[2])},De[19]=function(){return oe(q.a[3])},De[20]=function(){return oe(q.a[4])},De[21]=function(){return oe(q.a[5])},De[22]=function(){return oe(q.a[6])},De[23]=function(){return oe(q.a[7])},De[24]=function(){var e=q.a[0];return q.a[0]+=2,oe(e)},De[25]=function(){var e=q.a[1];return q.a[1]+=2,oe(e)},De[26]=function(){var e=q.a[2];return q.a[2]+=2,oe(e)},De[27]=function(){var e=q.a[3];return q.a[3]+=2,oe(e)},De[28]=function(){var e=q.a[4];return q.a[4]+=2,oe(e)},De[29]=function(){var e=q.a[5];return q.a[5]+=2,oe(e)},De[30]=function(){var e=q.a[6];return q.a[6]+=2,oe(e)},De[31]=function(){var e=q.a[7];return q.a[7]+=2,oe(e)},De[32]=function(){return q.a[0]-=2,oe(q.a[0])},De[33]=function(){return q.a[1]-=2,oe(q.a[1])},De[34]=function(){return q.a[2]-=2,oe(q.a[2])},De[35]=function(){return q.a[3]-=2,oe(q.a[3])},De[36]=function(){return q.a[4]-=2,oe(q.a[4])},De[37]=function(){return q.a[5]-=2,oe(q.a[5])},De[38]=function(){return q.a[6]-=2,oe(q.a[6])},De[39]=function(){return q.a[7]-=2,oe(q.a[7])},De[40]=function(){return oe(Zn(q.a[0],qn(re())))},De[41]=function(){return oe(Zn(q.a[1],qn(re())))},De[42]=function(){return oe(Zn(q.a[2],qn(re())))},De[43]=function(){return oe(Zn(q.a[3],qn(re())))},De[44]=function(){return oe(Zn(q.a[4],qn(re())))},De[45]=function(){return oe(Zn(q.a[5],qn(re())))},De[46]=function(){return oe(Zn(q.a[6],qn(re())))},De[47]=function(){return oe(Zn(q.a[7],qn(re())))},De[48]=function(){return oe(sc(q.a[0],re()))},De[49]=function(){return oe(sc(q.a[1],re()))},De[50]=function(){return oe(sc(q.a[2],re()))},De[51]=function(){return oe(sc(q.a[3],re()))},De[52]=function(){return oe(sc(q.a[4],re()))},De[53]=function(){return oe(sc(q.a[5],re()))},De[54]=function(){return oe(sc(q.a[6],re()))},De[55]=function(){return oe(sc(q.a[7],re()))},De[56]=function(){return oe(qn(re()))},De[57]=function(){return oe(ie())},De[58]=function(){return oe(Zn(ee(),qn(re())))},De[59]=function(){return oe(sc(ee(),re()))},De[60]=function(){return re()},(Fe=new Array(64))[0]=function(){return q.d[0]},Fe[1]=function(){return q.d[1]},Fe[2]=function(){return q.d[2]},Fe[3]=function(){return q.d[3]},Fe[4]=function(){return q.d[4]},Fe[5]=function(){return q.d[5]},Fe[6]=function(){return q.d[6]},Fe[7]=function(){return q.d[7]},Fe[8]=function(){return q.a[0]},Fe[9]=function(){return q.a[1]},Fe[10]=function(){return q.a[2]},Fe[11]=function(){return q.a[3]},Fe[12]=function(){return q.a[4]},Fe[13]=function(){return q.a[5]},Fe[14]=function(){return q.a[6]},Fe[15]=function(){return q.a[7]},Fe[16]=function(){return se(q.a[0])},Fe[17]=function(){return se(q.a[1])},Fe[18]=function(){return se(q.a[2])},Fe[19]=function(){return se(q.a[3])},Fe[20]=function(){return se(q.a[4])},Fe[21]=function(){return se(q.a[5])},Fe[22]=function(){return se(q.a[6])},Fe[23]=function(){return se(q.a[7])},Fe[24]=function(){var e=q.a[0];return q.a[0]+=4,se(e)},Fe[25]=function(){var e=q.a[1];return q.a[1]+=4,se(e)},Fe[26]=function(){var e=q.a[2];return q.a[2]+=4,se(e)},Fe[27]=function(){var e=q.a[3];return q.a[3]+=4,se(e)},Fe[28]=function(){var e=q.a[4];return q.a[4]+=4,se(e)},Fe[29]=function(){var e=q.a[5];return q.a[5]+=4,se(e)},Fe[30]=function(){var e=q.a[6];return q.a[6]+=4,se(e)},Fe[31]=function(){var e=q.a[7];return q.a[7]+=4,se(e)},Fe[32]=function(){return q.a[0]-=4,se(q.a[0])},Fe[33]=function(){return q.a[1]-=4,se(q.a[1])},Fe[34]=function(){return q.a[2]-=4,se(q.a[2])},Fe[35]=function(){return q.a[3]-=4,se(q.a[3])},Fe[36]=function(){return q.a[4]-=4,se(q.a[4])},Fe[37]=function(){return q.a[5]-=4,se(q.a[5])},Fe[38]=function(){return q.a[6]-=4,se(q.a[6])},Fe[39]=function(){return q.a[7]-=4,se(q.a[7])},Fe[40]=function(){return se(Zn(q.a[0],qn(re())))},Fe[41]=function(){return se(Zn(q.a[1],qn(re())))},Fe[42]=function(){return se(Zn(q.a[2],qn(re())))},Fe[43]=function(){return se(Zn(q.a[3],qn(re())))},Fe[44]=function(){return se(Zn(q.a[4],qn(re())))},Fe[45]=function(){return se(Zn(q.a[5],qn(re())))},Fe[46]=function(){return se(Zn(q.a[6],qn(re())))},Fe[47]=function(){return se(Zn(q.a[7],qn(re())))},Fe[48]=function(){return se(sc(q.a[0],re()))},Fe[49]=function(){return se(sc(q.a[1],re()))},Fe[50]=function(){return se(sc(q.a[2],re()))},Fe[51]=function(){return se(sc(q.a[3],re()))},Fe[52]=function(){return se(sc(q.a[4],re()))},Fe[53]=function(){return se(sc(q.a[5],re()))},Fe[54]=function(){return se(sc(q.a[6],re()))},Fe[55]=function(){return se(sc(q.a[7],re()))},Fe[56]=function(){return se(qn(re()))},Fe[57]=function(){return se(ie())},Fe[58]=function(){return se(Zn(ee(),qn(re())))},Fe[59]=function(){return se(sc(ee(),re()))},Fe[60]=function(){return ie()},(xe=new Array(64))[0]=function(e){q.d[0]=4294967040&q.d[0]|e},xe[1]=function(e){q.d[1]=4294967040&q.d[1]|e},xe[2]=function(e){q.d[2]=4294967040&q.d[2]|e},xe[3]=function(e){q.d[3]=4294967040&q.d[3]|e},xe[4]=function(e){q.d[4]=4294967040&q.d[4]|e},xe[5]=function(e){q.d[5]=4294967040&q.d[5]|e},xe[6]=function(e){q.d[6]=4294967040&q.d[6]|e},xe[7]=function(e){q.d[7]=4294967040&q.d[7]|e},xe[8]=function(e){SAEF_error("cpu.stEA8tab() invalid EA  8 (1|0)")},xe[9]=function(e){SAEF_error("cpu.stEA8tab() invalid EA  9 (1|1)")},xe[10]=function(e){SAEF_error("cpu.stEA8tab() invalid EA 10 (1|2)")},xe[11]=function(e){SAEF_error("cpu.stEA8tab() invalid EA 11 (1|3)")},xe[12]=function(e){SAEF_error("cpu.stEA8tab() invalid EA 12 (1|4)")},xe[13]=function(e){SAEF_error("cpu.stEA8tab() invalid EA 13 (1|5)")},xe[14]=function(e){SAEF_error("cpu.stEA8tab() invalid EA 14 (1|6)")},xe[15]=function(e){SAEF_error("cpu.stEA8tab() invalid EA 15 (1|7)")},xe[16]=function(e){ce(q.a[0],e)},xe[17]=function(e){ce(q.a[1],e)},xe[18]=function(e){ce(q.a[2],e)},xe[19]=function(e){ce(q.a[3],e)},xe[20]=function(e){ce(q.a[4],e)},xe[21]=function(e){ce(q.a[5],e)},xe[22]=function(e){ce(q.a[6],e)},xe[23]=function(e){ce(q.a[7],e)},xe[24]=function(e){ce(q.a[0],e),q.a[0]+=1},xe[25]=function(e){ce(q.a[1],e),q.a[1]+=1},xe[26]=function(e){ce(q.a[2],e),q.a[2]+=1},xe[27]=function(e){ce(q.a[3],e),q.a[3]+=1},xe[28]=function(e){ce(q.a[4],e),q.a[4]+=1},xe[29]=function(e){ce(q.a[5],e),q.a[5]+=1},xe[30]=function(e){ce(q.a[6],e),q.a[6]+=1},xe[31]=function(e){ce(q.a[7],e),q.a[7]+=2},xe[32]=function(e){--q.a[0],ce(q.a[0],e)},xe[33]=function(e){--q.a[1],ce(q.a[1],e)},xe[34]=function(e){--q.a[2],ce(q.a[2],e)},xe[35]=function(e){--q.a[3],ce(q.a[3],e)},xe[36]=function(e){--q.a[4],ce(q.a[4],e)},xe[37]=function(e){--q.a[5],ce(q.a[5],e)},xe[38]=function(e){--q.a[6],ce(q.a[6],e)},xe[39]=function(e){q.a[7]-=2,ce(q.a[7],e)},xe[40]=function(e){ce(Zn(q.a[0],qn(re())),e)},xe[41]=function(e){ce(Zn(q.a[1],qn(re())),e)},xe[42]=function(e){ce(Zn(q.a[2],qn(re())),e)},xe[43]=function(e){ce(Zn(q.a[3],qn(re())),e)},xe[44]=function(e){ce(Zn(q.a[4],qn(re())),e)},xe[45]=function(e){ce(Zn(q.a[5],qn(re())),e)},xe[46]=function(e){ce(Zn(q.a[6],qn(re())),e)},xe[47]=function(e){ce(Zn(q.a[7],qn(re())),e)},xe[48]=function(e){ce(sc(q.a[0],re()),e)},xe[49]=function(e){ce(sc(q.a[1],re()),e)},xe[50]=function(e){ce(sc(q.a[2],re()),e)},xe[51]=function(e){ce(sc(q.a[3],re()),e)},xe[52]=function(e){ce(sc(q.a[4],re()),e)},xe[53]=function(e){ce(sc(q.a[5],re()),e)},xe[54]=function(e){ce(sc(q.a[6],re()),e)},xe[55]=function(e){ce(sc(q.a[7],re()),e)},xe[56]=function(e){ce(qn(re()),e)},xe[57]=function(e){ce(ie(),e)},xe[58]=function(e){ce(Zn(ee(),qn(re())),e)},xe[59]=function(e){ce(sc(ee(),re()),e)},xe[60]=function(e){SAEF_error("cpu.stEA8tab() invalid EA 60 (7|4)")},(Me=new Array(64))[0]=function(e){q.d[0]=4294901760&q.d[0]|e},Me[1]=function(e){q.d[1]=4294901760&q.d[1]|e},Me[2]=function(e){q.d[2]=4294901760&q.d[2]|e},Me[3]=function(e){q.d[3]=4294901760&q.d[3]|e},Me[4]=function(e){q.d[4]=4294901760&q.d[4]|e},Me[5]=function(e){q.d[5]=4294901760&q.d[5]|e},Me[6]=function(e){q.d[6]=4294901760&q.d[6]|e},Me[7]=function(e){q.d[7]=4294901760&q.d[7]|e},Me[8]=function(e){q.a[0]=e},Me[9]=function(e){q.a[1]=e},Me[10]=function(e){q.a[2]=e},Me[11]=function(e){q.a[3]=e},Me[12]=function(e){q.a[4]=e},Me[13]=function(e){q.a[5]=e},Me[14]=function(e){q.a[6]=e},Me[15]=function(e){q.a[7]=e},Me[16]=function(e){_e(q.a[0],e)},Me[17]=function(e){_e(q.a[1],e)},Me[18]=function(e){_e(q.a[2],e)},Me[19]=function(e){_e(q.a[3],e)},Me[20]=function(e){_e(q.a[4],e)},Me[21]=function(e){_e(q.a[5],e)},Me[22]=function(e){_e(q.a[6],e)},Me[23]=function(e){_e(q.a[7],e)},Me[24]=function(e){_e(q.a[0],e),q.a[0]+=2},Me[25]=function(e){_e(q.a[1],e),q.a[1]+=2},Me[26]=function(e){_e(q.a[2],e),q.a[2]+=2},Me[27]=function(e){_e(q.a[3],e),q.a[3]+=2},Me[28]=function(e){_e(q.a[4],e),q.a[4]+=2},Me[29]=function(e){_e(q.a[5],e),q.a[5]+=2},Me[30]=function(e){_e(q.a[6],e),q.a[6]+=2},Me[31]=function(e){_e(q.a[7],e),q.a[7]+=2},Me[32]=function(e){q.a[0]-=2,_e(q.a[0],e)},Me[33]=function(e){q.a[1]-=2,_e(q.a[1],e)},Me[34]=function(e){q.a[2]-=2,_e(q.a[2],e)},Me[35]=function(e){q.a[3]-=2,_e(q.a[3],e)},Me[36]=function(e){q.a[4]-=2,_e(q.a[4],e)},Me[37]=function(e){q.a[5]-=2,_e(q.a[5],e)},Me[38]=function(e){q.a[6]-=2,_e(q.a[6],e)},Me[39]=function(e){q.a[7]-=2,_e(q.a[7],e)},Me[40]=function(e){_e(Zn(q.a[0],qn(re())),e)},Me[41]=function(e){_e(Zn(q.a[1],qn(re())),e)},Me[42]=function(e){_e(Zn(q.a[2],qn(re())),e)},Me[43]=function(e){_e(Zn(q.a[3],qn(re())),e)},Me[44]=function(e){_e(Zn(q.a[4],qn(re())),e)},Me[45]=function(e){_e(Zn(q.a[5],qn(re())),e)},Me[46]=function(e){_e(Zn(q.a[6],qn(re())),e)},Me[47]=function(e){_e(Zn(q.a[7],qn(re())),e)},Me[48]=function(e){_e(sc(q.a[0],re()),e)},Me[49]=function(e){_e(sc(q.a[1],re()),e)},Me[50]=function(e){_e(sc(q.a[2],re()),e)},Me[51]=function(e){_e(sc(q.a[3],re()),e)},Me[52]=function(e){_e(sc(q.a[4],re()),e)},Me[53]=function(e){_e(sc(q.a[5],re()),e)},Me[54]=function(e){_e(sc(q.a[6],re()),e)},Me[55]=function(e){_e(sc(q.a[7],re()),e)},Me[56]=function(e){_e(qn(re()),e)},Me[57]=function(e){_e(ie(),e)},Me[58]=function(e){_e(Zn(ee(),qn(re())),e)},Me[59]=function(e){_e(sc(ee(),re()),e)},Me[60]=function(e){SAEF_error("cpu.stEA16tab() invalid EA 60 (7|4)")},(Te=new Array(64))[0]=function(e){q.d[0]=e},Te[1]=function(e){q.d[1]=e},Te[2]=function(e){q.d[2]=e},Te[3]=function(e){q.d[3]=e},Te[4]=function(e){q.d[4]=e},Te[5]=function(e){q.d[5]=e},Te[6]=function(e){q.d[6]=e},Te[7]=function(e){q.d[7]=e},Te[8]=function(e){q.a[0]=e},Te[9]=function(e){q.a[1]=e},Te[10]=function(e){q.a[2]=e},Te[11]=function(e){q.a[3]=e},Te[12]=function(e){q.a[4]=e},Te[13]=function(e){q.a[5]=e},Te[14]=function(e){q.a[6]=e},Te[15]=function(e){q.a[7]=e},Te[16]=function(e){fe(q.a[0],e)},Te[17]=function(e){fe(q.a[1],e)},Te[18]=function(e){fe(q.a[2],e)},Te[19]=function(e){fe(q.a[3],e)},Te[20]=function(e){fe(q.a[4],e)},Te[21]=function(e){fe(q.a[5],e)},Te[22]=function(e){fe(q.a[6],e)},Te[23]=function(e){fe(q.a[7],e)},Te[24]=function(e){fe(q.a[0],e),q.a[0]+=4},Te[25]=function(e){fe(q.a[1],e),q.a[1]+=4},Te[26]=function(e){fe(q.a[2],e),q.a[2]+=4},Te[27]=function(e){fe(q.a[3],e),q.a[3]+=4},Te[28]=function(e){fe(q.a[4],e),q.a[4]+=4},Te[29]=function(e){fe(q.a[5],e),q.a[5]+=4},Te[30]=function(e){fe(q.a[6],e),q.a[6]+=4},Te[31]=function(e){fe(q.a[7],e),q.a[7]+=4},Te[32]=function(e){q.a[0]-=4,fe(q.a[0],e)},Te[33]=function(e){q.a[1]-=4,fe(q.a[1],e)},Te[34]=function(e){q.a[2]-=4,fe(q.a[2],e)},Te[35]=function(e){q.a[3]-=4,fe(q.a[3],e)},Te[36]=function(e){q.a[4]-=4,fe(q.a[4],e)},Te[37]=function(e){q.a[5]-=4,fe(q.a[5],e)},Te[38]=function(e){q.a[6]-=4,fe(q.a[6],e)},Te[39]=function(e){q.a[7]-=4,fe(q.a[7],e)},Te[40]=function(e){fe(Zn(q.a[0],qn(re())),e)},Te[41]=function(e){fe(Zn(q.a[1],qn(re())),e)},Te[42]=function(e){fe(Zn(q.a[2],qn(re())),e)},Te[43]=function(e){fe(Zn(q.a[3],qn(re())),e)},Te[44]=function(e){fe(Zn(q.a[4],qn(re())),e)},Te[45]=function(e){fe(Zn(q.a[5],qn(re())),e)},Te[46]=function(e){fe(Zn(q.a[6],qn(re())),e)},Te[47]=function(e){fe(Zn(q.a[7],qn(re())),e)},Te[48]=function(e){fe(sc(q.a[0],re()),e)},Te[49]=function(e){fe(sc(q.a[1],re()),e)},Te[50]=function(e){fe(sc(q.a[2],re()),e)},Te[51]=function(e){fe(sc(q.a[3],re()),e)},Te[52]=function(e){fe(sc(q.a[4],re()),e)},Te[53]=function(e){fe(sc(q.a[5],re()),e)},Te[54]=function(e){fe(sc(q.a[6],re()),e)},Te[55]=function(e){fe(sc(q.a[7],re()),e)},Te[56]=function(e){fe(qn(re()),e)},Te[57]=function(e){fe(ie(),e)},Te[58]=function(e){fe(Zn(ee(),qn(re())),e)},Te[59]=function(e){fe(sc(ee(),re()),e)},Te[60]=function(e){SAEF_error("cpu.stEA32tab() invalid EA 60 (7|4)")}}function _c(e){var t=e>>3;if(7==t)switch(7&e){case 0:return ge;case 1:return ye;case 2:return me;case 3:return he;case 4:return ve}else switch(t){case 0:return le;case 1:return ue;case 2:return de;case 3:return pe;case 4:return Ee;case 5:return Ae;case 6:return Se}return SAEF_error("cpu.getEAMode() ERROR ea "+e),-1}function fc(e,t){var n=e>>3;if(7==n){e=7&e;if(0==e&&-1!=t.indexOf(ge))return 1;if(1==e&&-1!=t.indexOf(ye))return 1;if(2==e&&-1!=t.indexOf(me))return 1;if(3==e&&-1!=t.indexOf(he))return 1;if(4==e&&-1!=t.indexOf(ve))return 1}else{if(0==n&&-1!=t.indexOf(le))return 1;if(1==n&&-1!=t.indexOf(ue))return 1;if(2==n&&-1!=t.indexOf(de))return 1;if(3==n&&-1!=t.indexOf(pe))return 1;if(4==n&&-1!=t.indexOf(Ee))return 1;if(5==n&&-1!=t.indexOf(Ae))return 1;if(6==n&&-1!=t.indexOf(Se))return 1}}function lc(e,t){var n=e>>3;if(7==n)switch(7&e){case 0:return 4==t?[12,3,0]:[8,2,0];case 1:return 4==t?[16,4,0]:[12,3,0];case 2:return 4==t?[12,3,0]:[8,2,0];case 3:return 4==t?[14,3,0]:[10,2,0];case 4:return 4==t?[8,2,0]:[4,1,0]}else switch(n){case 0:case 1:return[0,0,0];case 2:case 3:return 4==t?[8,2,0]:[4,1,0];case 4:return 4==t?[10,2,0]:[6,1,0];case 5:return 4==t?[12,3,0]:[8,2,0];case 6:return 4==t?[14,3,0]:[10,2,0]}}function uc(e,t){return e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e}function dc(e,t,n){return{op:e,mn:t,p:{op:e,cyc:n}}}function pc(e,t,n,r,i,a,o){return t&&r?{ext:e,sm:t,s:n,dm:r,d:i,z:a,z2:o}:r?{ext:e,dm:r,d:i,z:a,z2:o}:{ext:e,z:a,z2:o}}function Ec(){var e=0;for(Ce=new Array(65536),E=0;E<65536;E++)Ce[E]={op:-1,mn:"ILLEGAL",p:E,f:ac};for(var t=0;t<3;t++)for(var n=0==t?8:1==t?9:17,r=0;r<8;r++)for(var i=0;i<8;i++){if(-1!==Ce[E=49408|r<<9|n<<3|i].op)return void SAEF_error("cpu.mkITab() op exists EXG "+E);Ce[E]=dc(E,"EXG",[6,1,0]),Ce[E].p.Rx=r,Ce[E].p.Ry=i,0==t?(Ce[E].f=$n,Ce[E].d=pc(0,rn,r,rn,i,4,0)):1==t?(Ce[E].f=er,Ce[E].d=pc(0,an,r,an,i,4,0)):(Ce[E].f=tr,Ce[E].d=pc(0,rn,r,an,i,4,0)),e++}for(var a=[de,Ae,Se,me,he,ge,ye],o=0;o<8;o++)for(var s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=16832|o<<9|s].op)return void SAEF_error("cpu.mkITab() op exists LEA "+E);switch(_c(s)){case de:y=[4,1,0];break;case Ae:y=[8,2,0];break;case Se:y=[12,2,0];break;case me:y=[8,2,0];break;case he:y=[12,2,0];break;case ge:y=[8,2,0];break;case ye:y=[12,3,0]}Ce[E]=dc(E,"LEA",y),Ce[E].p.An=o,Ce[E].p.ea=s,Ce[E].f=nr,Ce[E].d=pc(0,un,s,an,o,4,0),e++}for(a=[de,Ae,Se,me,he,ge,ye],s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=18496|s].op)return void SAEF_error("cpu.mkITab() op exists PEA "+E);switch(_c(s)){case de:y=[12,1,2];break;case Ae:y=[16,2,2];break;case Se:y=[20,2,2];break;case me:y=[16,2,2];break;case he:y=[20,2,2];break;case ge:y=[16,2,2];break;case ye:y=[20,3,2]}Ce[E]=dc(E,"PEA",y),Ce[E].p.ea=s,Ce[E].f=rr,Ce[E].d=pc(0,!1,!1,un,s,4,0),e++}for(o=0;o<8;o++){if(-1!==Ce[E=20048|o].op)return void SAEF_error("cpu.mkITab() op exists LINK "+E);Ce[E]=dc(E,"LINK",[16,2,2]),Ce[E].p.An=o,Ce[E].f=ir,Ce[E].d=pc(0,an,o,fn,1,2,0),e++}if(68020<=Ve)for(o=0;o<8;o++){if(-1!==Ce[E=18440|o].op)return void SAEF_error("cpu.mkITab() op exists LINK "+E);Ce[E]=dc(E,"LINK",[16,2,2]),Ce[E].p.An=o,Ce[E].f=ar,Ce[E].d=pc(0,an,o,fn,2,4,0),e++}for(o=0;o<8;o++){if(-1!==Ce[E=20056|o].op)return void SAEF_error("cpu.mkITab() op exists UNLK "+E);Ce[E]=dc(E,"UNLK",[12,3,0]),Ce[E].p.An=o,Ce[E].f=or,Ce[E].d=pc(0,!1,!1,an,o,0,0),e++}for(var c=[[[4,1,0],null,[8,1,1],[8,1,1],[8,1,1],[12,2,1],[14,2,1],null,null,[12,2,1],[16,3,1],null],[[4,1,0],null,[8,1,1],[8,1,1],[8,1,1],[12,2,1],[14,2,1],null,null,[12,2,1],[16,3,1],null],[[8,2,0],null,[12,2,1],[12,2,1],[12,2,1],[16,3,1],[18,3,1],null,null,[16,3,1],[20,4,1],null],[[8,2,0],null,[12,2,1],[12,2,1],[12,2,1],[16,3,1],[18,3,1],null,null,[16,3,1],[20,4,1],null],[[10,2,0],null,[14,2,1],[14,2,1],[14,2,1],[18,3,1],[20,4,1],null,null,[18,3,1],[22,4,1],null],[[12,3,0],null,[16,3,1],[16,3,1],[16,3,1],[20,4,1],[22,4,1],null,null,[20,4,1],[24,5,1],null],[[14,3,0],null,[18,3,1],[18,3,1],[18,3,1],[22,4,1],[24,4,1],null,null,[22,4,1],[26,5,1],null],[[12,3,0],null,[16,3,1],[16,3,1],[16,3,1],[20,4,1],[22,4,1],null,null,[20,4,1],[24,5,1],null],[[14,3,0],null,[18,3,1],[18,3,1],[18,3,1],[22,4,1],[24,4,1],null,null,[22,4,1],[26,5,1],null],[[12,3,0],null,[16,3,1],[16,3,1],[16,3,1],[20,4,1],[22,4,1],null,null,[20,4,1],[24,5,1],null],[[16,4,0],null,[20,4,1],[20,4,1],[20,4,1],[24,5,1],[26,5,1],null,null,[24,5,1],[28,6,1],null],[[8,2,0],null,[12,2,1],[12,2,1],[12,2,1],[16,3,1],[18,3,1],null,null,[16,3,1],[20,4,1],null]],_=[[[4,1,0],null,[12,1,2],[12,1,2],[12,1,2],[16,2,2],[18,2,2],null,null,[16,2,2],[20,3,2],null],[[4,1,0],null,[12,1,2],[12,1,2],[12,1,2],[16,2,2],[18,2,2],null,null,[16,2,2],[20,3,2],null],[[12,3,0],null,[20,3,2],[20,3,2],[20,3,2],[24,4,2],[26,4,2],null,null,[24,4,2],[28,5,2],null],[[12,3,0],null,[20,3,2],[20,3,2],[20,3,2],[24,4,2],[26,4,2],null,null,[24,4,2],[28,5,2],null],[[14,3,0],null,[22,3,2],[22,3,2],[22,3,2],[26,4,2],[28,4,2],null,null,[26,4,2],[30,5,2],null],[[16,4,0],null,[24,4,2],[24,4,2],[24,4,2],[28,5,2],[30,5,2],null,null,[28,5,2],[32,6,2],null],[[18,4,0],null,[26,4,2],[26,4,2],[26,4,2],[30,5,2],[32,5,2],null,null,[30,5,2],[34,6,2],null],[[16,4,0],null,[24,4,2],[24,4,2],[24,4,2],[28,5,2],[30,5,2],null,null,[28,5,2],[32,5,2],null],[[18,4,0],null,[26,4,2],[26,4,2],[26,4,2],[30,5,2],[32,5,2],null,null,[30,5,2],[34,6,2],null],[[16,4,0],null,[24,4,2],[24,4,2],[24,4,2],[28,5,2],[30,5,2],null,null,[28,5,2],[32,6,2],null],[[20,5,0],null,[28,5,2],[28,5,2],[28,5,2],[32,6,2],[34,6,2],null,null,[32,6,2],[36,7,2],null],[[12,3,0],null,[20,3,2],[20,3,2],[20,3,2],[24,4,2],[26,4,2],null,null,[24,4,2],[28,5,2],null]],f=[le,de,pe,Ee,Ae,Se,ge,ye],l=0;l<3;l++)for(var u=0==l?1:1==l?2:4,d=0==l?1:1==l?3:2,p=0;p<61;p++)if(fc(p,f))for(var E,A=0;A<61;A++)if(1!=u||A>>3!=1){if(-1!==Ce[E=d<<12|((7&p)<<3|p>>3)<<6|A].op)return void SAEF_error("cpu.mkITab() op exists MOVE "+E);Ce[E]=dc(E,"MOVE",(4==u?_:c)[_c(A)-1][_c(p)-1]),Ce[E].p.sea=A,Ce[E].p.dea=p,Ce[E].p.zm=1==u?128:2==u?32768:2147483648,Ce[E].f=4==u?_r:2==u?cr:sr,Ce[E].d=pc(0,un,A,un,p,u,0),e++}for(c=[[4,1,0],[4,1,0],[8,2,0],[8,2,0],[10,2,0],[12,3,0],[14,3,0],[12,3,0],[14,3,0],[12,3,0],[16,4,0],[8,2,0]],_=[[4,1,0],[4,1,0],[12,3,0],[12,3,0],[14,3,0],[16,4,0],[18,4,0],[16,4,0],[18,4,0],[16,4,0],[20,5,0],[12,3,0]],l=1;l<3;l++)for(u=1==l?2:4,d=1==l?3:2,o=0;o<8;o++)for(s=0;s<61;s++){if(-1!==Ce[E=d<<12|o<<9|64|s].op)return void SAEF_error("cpu.mkITab() op exists MOVEA "+E);Ce[E]=dc(E,"MOVEA",(4==u?_:c)[_c(s)-1]),Ce[E].p.An=o,Ce[E].p.ea=s,Ce[E].f=4==u?lr:fr,Ce[E].d=pc(0,un,s,an,o,u,0),e++}for(var S=0;S<8;S++)for(var m=0;m<256;m++){if(-1!==Ce[E=28672|S<<9|m].op)return void SAEF_error("cpu.mkITab() op exists MOVEQ "+E);Ce[E]=dc(E,"MOVEQ",[4,1,0]),Ce[E].p.Dn=S,Ce[E].p.data=m,Ce[E].p.zm=2147483648,Ce[E].f=ur,Ce[E].d=pc(0,_n,m,rn,S,4,0),e++}for(l=0;l<2;l++)for(var u=0==l?2:4,h=0;h<2;h++){a=0==h?[de,Ee,Ae,Se,ge,ye]:[de,pe,Ae,Se,me,he,ge,ye];for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=18560|h<<10|l<<6|s].op)return void SAEF_error("cpu.mkITab() op exists MOVEM "+E);t=_c(s);if(0==h){switch(t){case de:case Ee:y=[8,2,0];break;case Ae:y=[12,3,0];break;case Se:y=[14,3,0];break;case ge:y=[12,3,0];break;case ye:y=[16,4,0]}Ce[E]=dc(E,"MOVEM",y),Ce[E].f=2==u?dr:pr,Ce[E].d=pc(1,Sn,t==Ee,un,s,u,0)}else{switch(t){case de:case pe:y=[12,3,0];break;case Ae:y=[16,4,0];break;case Se:y=[18,4,0];break;case me:y=[16,4,0];break;case he:y=[20,5,0];break;case ge:y=[16,4,0];break;case ye:y=[18,4,0]}Ce[E]=dc(E,"MOVEM",y),Ce[E].f=2==u?Er:Ar,Ce[E].d=pc(1,un,s,Sn,t==Ee,u,0)}Ce[E].p.ea=s,e++}}for(t=4;t<8;t++)for(S=0;S<8;S++)for(o=0;o<8;o++){if(-1!==Ce[E=S<<9|t<<6|8|o].op)return void SAEF_error("cpu.mkITab() op exists MOVEP "+E);4==t?(Ce[E]=dc(E,"MOVEP",[16,4,0]),Ce[E].f=hr,Ce[E].d=pc(0,cn,o,rn,S,2,0)):5==t?(Ce[E]=dc(E,"MOVEP",[24,6,0]),Ce[E].f=gr,Ce[E].d=pc(0,cn,o,rn,S,4,0)):6==t?(Ce[E]=dc(E,"MOVEP",[16,2,2]),Ce[E].f=Sr,Ce[E].d=pc(0,rn,S,cn,o,2,0)):(Ce[E]=dc(E,"MOVEP",[24,2,4]),Ce[E].f=mr,Ce[E].d=pc(0,rn,S,cn,o,4,0)),Ce[E].p.Dn=S,Ce[E].p.An=o,e++}for(a=[de,pe,Ee,Ae,Se,ge,ye],l=0;l<3;l++)for(var u=0==l?1:1==l?2:4,g=0;g<2;g++)for(S=0;S<8;S++)for(s=0;s<61;s++)if(0==g||1==g&&fc(s,a)){t=_c(s);if(0!=g||t!=ue||0!=l){if(-1!==Ce[E=53248|S<<9|g<<8|l<<6|s].op)return void SAEF_error("cpu.mkITab() op exists ADD "+E);Ce[E]=dc(E,"ADD",[]),Ce[E].p.Dn=S,Ce[E].p.ea=s,Ce[E].p.zm=4==u?2147483648:2==u?32768:128,0==g?(Ce[E].p.cyc=uc(4==u?t==le||t==ve?[8,1,0]:[6,1,0]:[4,1,0],lc(s,u)),Ce[E].f=4==u?yr:2==u?br:kr,Ce[E].d=pc(0,un,s,rn,S,u,0)):(Ce[E].p.cyc=uc(4==u?[12,1,2]:[8,1,1],lc(s,u)),Ce[E].f=4==u?vr:2==u?Cr:Rr,Ce[E].d=pc(0,rn,S,un,s,u,0)),e++}}for(a=[de,pe,Ee,Ae,Se,ge,ye],l=0;l<3;l++)for(u=0==l?1:1==l?2:4,g=0;g<2;g++)for(S=0;S<8;S++)for(s=0;s<61;s++)if(0==g||1==g&&fc(s,a)){t=_c(s);if(0!=g||t!=ue||0!=l){if(-1!==Ce[E=36864|S<<9|g<<8|l<<6|s].op)return void SAEF_error("cpu.mkITab() op exists SUB "+E);Ce[E]=dc(E,"SUB",[]),Ce[E].p.Dn=S,Ce[E].p.ea=s,Ce[E].p.zm=4==u?2147483648:2==u?32768:128,0==g?(Ce[E].p.cyc=uc(4==u?t==le||t==ve?[8,1,0]:[6,1,0]:[4,1,0],lc(s,u)),Ce[E].f=4==u?wr:2==u?Dr:Fr,Ce[E].d=pc(0,un,s,rn,S,u,0)):(Ce[E].p.cyc=uc(4==u?[12,1,2]:[8,1,1],lc(s,u)),Ce[E].f=4==u?xr:2==u?Mr:Tr,Ce[E].d=pc(0,rn,S,un,s,u,0)),e++}}for(l=0;l<3;l++)for(u=0==l?1:1==l?2:4,S=0;S<8;S++)for(s=0;s<61;s++)if((t=_c(s))!=ue||0!=l){if(-1!==Ce[E=45056|S<<9|l<<6|s].op)return void SAEF_error("cpu.mkITab() op exists CMP "+E);var y=4==u?[6,1,0]:[4,1,0];t!=le&&t!=ue&&(y=uc(y,lc(s,u))),Ce[E]=dc(E,"CMP",y),Ce[E].p.Dn=S,Ce[E].p.ea=s,Ce[E].f=4==u?Vr:2==u?Ir:Pr,Ce[E].d=pc(0,un,s,rn,S,u,0),e++}for(a=[le,de,pe,Ee,Ae,Se,ge,ye],l=0;l<3;l++)for(u=0==l?1:1==l?2:4,s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=16896|l<<6|s].op)return void SAEF_error("cpu.mkITab() op exists CLR "+E);y=(t=_c(s))==le?4==u?[6,1,0]:[4,1,0]:4==u?[12,1,2]:[8,1,1];t==le&&(y=uc(y,lc(s,u))),Ce[E]=dc(E,"CLR",y),Ce[E].p.ea=s,Ce[E].f=4==u?zr:2==u?Or:Lr,Ce[E].d=pc(0,!1,!1,un,s,u,0),e++}for(a=[le,de,pe,Ee,Ae,Se,ge,ye],l=0;l<3;l++){u=0==l?1:1==l?2:4;for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=17408|l<<6|s].op)return void SAEF_error("cpu.mkITab() op exists NEG "+E);y=(t=_c(s))==le?4==u?[6,1,0]:[4,1,0]:4==u?[12,1,2]:[8,1,1];Ce[E]=dc(E,"NEG",y),t==le?(Ce[E].p.Dn=7&s,Ce[E].f=4==u?Nr:2==u?Br:Ur):(Ce[E].p.ea=s,Ce[E].p.cyc=uc(Ce[E].p.cyc,lc(s,u)),Ce[E].f=4==u?Kr:2==u?Gr:Hr),Ce[E].d=pc(0,!1,!1,un,s,u,0),e++}}for(a=[le,de,pe,Ee,Ae,Se,me,he,ge,ye,ve],S=0;S<8;S++)for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=49600|S<<9|s].op)return void SAEF_error("cpu.mkITab() op exists MULS "+E);var v=54,y=_c(s)==le?[70,1,0]:uc([70,1,0],lc(s,u));Ce[E]=dc(E,"MULS",y),Ce[E].p.Dn=S,Ce[E].p.ea=s,Ce[E].f=Xr,Ce[E].d=pc(0,un,s,rn,S,2,0),e++}for(a=[le,de,pe,Ee,Ae,Se,me,he,ge,ye,ve],S=0;S<8;S++)for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=49344|S<<9|s].op)return void SAEF_error("cpu.mkITab() op exists MULU "+E);v=54,y=_c(s)==le?[v,1,0]:uc([v,1,0],lc(s,u));Ce[E]=dc(E,"MULU",y),Ce[E].p.Dn=S,Ce[E].p.ea=s,Ce[E].f=qr,Ce[E].d=pc(0,un,s,rn,S,2,0),e++}if(68020<=Ve)for(a=[le,de,pe,Ee,Ae,Se,me,he,ge,ye,ve],s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=19456|s].op)return void SAEF_error("cpu.mkITab() op exists MULx "+E);Ce[E]=dc(E,"MULx",[40,0,0]),Ce[E].p.ea=s,Ce[E].f=Zr,Ce[E].d=pc(1,un,s,hn,0,4,0),e++}for(a=[le,de,pe,Ee,Ae,Se,me,he,ge,ye,ve],S=0;S<8;S++)for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=33216|S<<9|s].op)return void SAEF_error("cpu.mkITab() op exists DIVS "+E);v=138,y=_c(s)==le?[v,1,0]:uc([v,1,0],lc(s,u));Ce[E]=dc(E,"DIVS",y),Ce[E].p.Dn=S,Ce[E].p.ea=s,Ce[E].f=jr,Ce[E].d=pc(0,un,s,rn,S,2,0),e++}for(a=[le,de,pe,Ee,Ae,Se,me,he,ge,ye,ve],S=0;S<8;S++)for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=32960|S<<9|s].op)return void SAEF_error("cpu.mkITab() op exists DIVU "+E);v=106,y=_c(s)==le?[v,1,0]:uc([v,1,0],lc(s,u));Ce[E]=dc(E,"DIVU",y),Ce[E].p.Dn=S,Ce[E].p.ea=s,Ce[E].f=Yr,Ce[E].d=pc(0,un,s,rn,S,2,0),e++}if(68020<=Ve)for(a=[le,de,pe,Ee,Ae,Se,me,he,ge,ye,ve],s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=19520|s].op)return void SAEF_error("cpu.mkITab() op exists DIVx "+E);Ce[E]=dc(E,"DIVx",[70,0,0]),Ce[E].p.ea=s,Ce[E].f=Wr,Ce[E].d=pc(1,un,s,gn,0,4,0),e++}for(l=0;l<3;l++)for(var u=0==l?1:1==l?2:4,b=0;b<2;b++)for(r=0;r<8;r++)for(i=0;i<8;i++){if(-1!==Ce[E=53504|r<<9|l<<6|b<<3|i].op)return void SAEF_error("cpu.mkITab() op exists ADDX "+E);y=0==b?4==u?[8,1,0]:[4,1,0]:4==u?[30,5,2]:[18,3,1];Ce[E]=dc(E,"ADDX",y),Ce[E].p.Rx=r,Ce[E].p.Ry=i,0==b?(Ce[E].f=4==u?Jr:2==u?Qr:$r,Ce[E].d=pc(0,rn,i,rn,r,u,0)):(Ce[E].f=4==u?ei:2==u?ti:ni,Ce[E].d=pc(0,on,i,on,r,u,0)),e++}for(l=0;l<3;l++)for(u=0==l?1:1==l?2:4,b=0;b<2;b++)for(r=0;r<8;r++)for(i=0;i<8;i++){if(-1!==Ce[E=37120|i<<9|l<<6|b<<3|r].op)return void SAEF_error("cpu.mkITab() op exists SUBX "+E);y=0==b?4==u?[8,1,0]:[4,1,0]:4==u?[30,5,2]:[18,3,1];Ce[E]=dc(E,"SUBX",y),Ce[E].p.Rx=r,Ce[E].p.Ry=i,0==b?(Ce[E].f=4==u?ri:2==u?ii:ai,Ce[E].d=pc(0,rn,r,rn,i,u,0)):(Ce[E].f=4==u?oi:2==u?si:ci,Ce[E].d=pc(0,on,r,on,i,u,0)),e++}for(a=[le,de,pe,Ee,Ae,Se,ge,ye],l=0;l<3;l++)for(u=0==l?1:1==l?2:4,s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=16384|l<<6|s].op)return void SAEF_error("cpu.mkITab() op exists NEGX "+E);y=(t=_c(s))==le?4==u?[6,1,0]:[4,1,0]:4==u?[12,1,2]:[8,1,1];Ce[E]=dc(E,"NEGX",y),t==le?(Ce[E].p.Dn=7&s,Ce[E].f=4==u?_i:2==u?fi:li):(Ce[E].p.ea=s,Ce[E].p.cyc=uc(Ce[E].p.cyc,lc(s,u)),Ce[E].f=4==u?ui:2==u?di:pi),Ce[E].d=pc(0,!1,!1,un,s,u,0),e++}for(l=1;l<3;l++)for(u=1==l?2:4,d=1==l?3:7,o=0;o<8;o++)for(s=0;s<61;s++){if(-1!==Ce[E=53248|o<<9|d<<6|s].op)return void SAEF_error("cpu.mkITab() op exists ADDA "+E);y=4!=u||t==le||t==ue||t==ve?[8,1,0]:[6,1,0];t!=le&&t!=ue&&(y=uc(y,lc(s,u))),Ce[E]=dc(E,"ADDA",y),Ce[E].p.An=o,Ce[E].p.ea=s,Ce[E].f=4==u?Ei:Ai,Ce[E].d=pc(0,un,s,an,o,u,0),e++}for(l=1;l<3;l++)for(u=1==l?2:4,d=1==l?3:7,o=0;o<8;o++)for(s=0;s<61;s++){if(-1!==Ce[E=36864|o<<9|d<<6|s].op)return void SAEF_error("cpu.mkITab() op exists SUBA "+E);y=4!=u||t==le||t==ue||t==ve?[8,1,0]:[6,1,0];t!=le&&t!=ue&&(y=uc(y,lc(s,u))),Ce[E]=dc(E,"SUBA",y),Ce[E].p.An=o,Ce[E].p.ea=s,Ce[E].f=4==u?Si:mi,Ce[E].d=pc(0,un,s,an,o,u,0),e++}for(l=1;l<3;l++)for(u=1==l?2:4,d=1==l?3:7,o=0;o<8;o++)for(s=0;s<61;s++){if(-1!==Ce[E=45056|o<<9|d<<6|s].op)return void SAEF_error("cpu.mkITab() op exists CMPA "+E);y=[6,1,0];t!=le&&t!=ue&&(y=uc(y,lc(s,u))),Ce[E]=dc(E,"CMPA",y),Ce[E].p.An=o,Ce[E].p.ea=s,Ce[E].f=4==u?hi:gi,Ce[E].d=pc(0,un,s,an,o,u,0),e++}for(a=[le,de,pe,Ee,Ae,Se,ge,ye],l=0;l<3;l++)for(u=0==l?1:1==l?2:4,s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=1536|l<<6|s].op)return void SAEF_error("cpu.mkITab() op exists ADDI "+E);y=(t=_c(s))==le?4==u?[16,3,0]:[8,2,0]:4==u?[20,3,2]:[12,2,1];Ce[E]=dc(E,"ADDI",y),t==le?(Ce[E].p.Dn=7&s,Ce[E].f=4==u?yi:2==u?vi:bi):(Ce[E].p.ea=s,Ce[E].p.cyc=uc(Ce[E].p.cyc,lc(s,u)),Ce[E].f=4==u?Ci:2==u?ki:Ri),Ce[E].d=pc(0,fn,4==u?2:1,un,s,u,0),e++}for(a=[le,de,pe,Ee,Ae,Se,ge,ye],l=0;l<3;l++)for(u=0==l?1:1==l?2:4,s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=1024|l<<6|s].op)return void SAEF_error("cpu.mkITab() op exists SUBI "+E);y=(t=_c(s))==le?4==u?[16,3,0]:[8,2,0]:4==u?[20,3,2]:[12,2,1];Ce[E]=dc(E,"SUBI",y),t==le?(Ce[E].p.Dn=7&s,Ce[E].f=4==u?wi:2==u?xi:Di):(Ce[E].p.ea=s,Ce[E].p.cyc=uc(Ce[E].p.cyc,lc(s,u)),Ce[E].f=4==u?Mi:2==u?Fi:Ti),Ce[E].d=pc(0,fn,4==u?2:1,un,s,u,0),e++}a=[le,de,pe,Ee,Ae,Se,ge,ye];68020<=Ve&&a.push(me,he);for(l=0;l<3;l++)for(u=0==l?1:1==l?2:4,s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=3072|l<<6|s].op)return void SAEF_error("cpu.mkITab() op exists CMPI "+E);y=(t=_c(s))==le?4==u?[14,3,0]:[8,2,0]:4==u?[12,3,0]:[8,2,0];t!=le&&(y=uc(y,lc(s,u))),Ce[E]=dc(E,"CMPI",y),Ce[E].p.ea=s,Ce[E].f=4==u?Vi:2==u?Ii:Pi,Ce[E].d=pc(0,fn,4==u?2:1,un,s,u,0),e++}for(a=[le,ue,de,pe,Ee,Ae,Se,ge,ye],l=0;l<3;l++)for(var u=0==l?1:1==l?2:4,C=0;C<8;C++)for(s=0;s<61;s++)if(fc(s,a))if((t=_c(s))!=ue||0!=l){if(-1!==Ce[E=20480|C<<9|l<<6|s].op)return void SAEF_error("cpu.mkITab() op exists ADDQ "+E);y=t==ue?[8,1,0]:t==le?4==u?[8,1,0]:[4,1,0]:4==u?[12,1,2]:[8,1,1];Ce[E]=dc(E,"ADDQ",y),Ce[E].p.data=0==C?8:C,t==le?(Ce[E].p.Dn=7&s,Ce[E].f=4==u?zi:2==u?Ni:Ui):t==ue?(Ce[E].p.An=7&s,Ce[E].f=Oi):(Ce[E].p.ea=s,Ce[E].p.cyc=uc(Ce[E].p.cyc,lc(s,u)),Ce[E].f=4==u?Li:2==u?Bi:Ki),Ce[E].d=pc(0,_n,0==C?8:C,un,s,u,0),e++}for(a=[le,ue,de,pe,Ee,Ae,Se,ge,ye],l=0;l<3;l++)for(u=0==l?1:1==l?2:4,C=0;C<8;C++)for(s=0;s<61;s++)if(fc(s,a))if((t=_c(s))!=ue||0!=l){if(-1!==Ce[E=20736|C<<9|l<<6|s].op)return void SAEF_error("cpu.mkITab() op exists SUBQ "+E);y=t==ue?[8,1,0]:t==le?4==u?[8,1,0]:[4,1,0]:4==u?[12,1,2]:[8,1,1];Ce[E]=dc(E,"SUBQ",y),Ce[E].p.data=0==C?8:C,t==le?(Ce[E].p.Dn=7&s,Ce[E].f=4==u?Gi:2==u?qi:ji):t==ue?(Ce[E].p.An=7&s,Ce[E].f=Hi):(Ce[E].p.ea=s,Ce[E].p.cyc=uc(Ce[E].p.cyc,lc(s,u)),Ce[E].f=4==u?Xi:2==u?Zi:Yi),Ce[E].d=pc(0,_n,0==C?8:C,un,s,u,0),e++}for(l=0;l<3;l++)for(var u=0==l?1:1==l?2:4,k=0;k<8;k++)for(var R=0;R<8;R++){if(-1!==Ce[E=45312|k<<9|l<<6|8|R].op)return void SAEF_error("cpu.mkITab() op exists CMPM "+E);Ce[E]=dc(E,"CMPM",4==u?[20,5,0]:[12,3,0]),Ce[E].p.Ax=k,Ce[E].p.Ay=R,Ce[E].f=4==u?Wi:2==u?Ji:Qi,Ce[E].d=pc(0,sn,R,sn,k,u,0),e++}for(l=1;l<3;l++)for(u=1==l?2:4,n=1==l?2:3,S=0;S<8;S++){if(-1!==Ce[E=18432|n<<6|S].op)return void SAEF_error("cpu.mkITab() op exists EXT "+E);Ce[E]=dc(E,"EXT",[4,1,0]),Ce[E].p.Dn=S,Ce[E].f=4==u?ea:$i,Ce[E].d=pc(0,!1,!1,rn,S,u,0),e++}if(68020<=Ve)for(S=0;S<8;S++){if(-1!==Ce[E=18880|S].op)return void SAEF_error("cpu.mkITab() op exists EXTB "+E);Ce[E]=dc(E,"EXTB",[4,1,0]),Ce[E].p.Dn=S,Ce[E].f=ta,Ce[E].d=pc(0,!1,!1,rn,S,4,0),e++}for(var w=[le,de,pe,Ee,Ae,Se,me,he,ge,ye,ve],x=[de,pe,Ee,Ae,Se,ge,ye],l=0;l<3;l++)for(u=0==l?1:1==l?2:4,g=0;g<2;g++)for(S=0;S<8;S++)for(s=0;s<61;s++)if(fc(s,0==g?w:x)){if(-1!==Ce[E=49152|S<<9|g<<8|l<<6|s].op)return void SAEF_error("cpu.mkITab() op exists AND "+E);Ce[E]=dc(E,"AND",[]),Ce[E].p.Dn=S,Ce[E].p.ea=s,Ce[E].p.zm=4==u?2147483648:2==u?32768:128,0==g?(t=_c(s),Ce[E].p.cyc=uc(4==u?t==le||t==ve?[8,1,0]:[6,1,0]:[4,1,0],lc(s,u)),Ce[E].f=4==u?na:2==u?ra:ia,Ce[E].d=pc(0,un,s,rn,S,u,0)):(Ce[E].p.cyc=uc(4==u?[12,1,2]:[8,1,1],lc(s,u)),Ce[E].f=4==u?aa:2==u?oa:sa,Ce[E].d=pc(0,rn,S,un,s,u,0)),e++}for(a=[le,de,pe,Ee,Ae,Se,ge,ye],l=0;l<3;l++)for(u=0==l?1:1==l?2:4,d=0==l?4:1==l?5:6,S=0;S<8;S++)for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=45056|S<<9|d<<6|s].op)return void SAEF_error("cpu.mkITab() op exists EOR "+E);t=_c(s);Ce[E]=dc(E,"EOR",4==u?[8,1,0]:[4,1,0]),Ce[E].p.Dn=S,Ce[E].p.zm=4==u?2147483648:2==u?32768:128,t==le?(Ce[E].p.Dd=7&s,Ce[E].f=4==u?ca:2==u?_a:fa):(Ce[E].p.ea=s,Ce[E].p.cyc=uc(Ce[E].p.cyc,lc(s,u)),Ce[E].f=4==u?la:2==u?ua:da),Ce[E].d=pc(0,rn,S,un,s,u,0),e++}for(w=[le,de,pe,Ee,Ae,Se,me,he,ge,ye,ve],x=[de,pe,Ee,Ae,Se,ge,ye],l=0;l<3;l++)for(u=0==l?1:1==l?2:4,g=0;g<2;g++)for(S=0;S<8;S++)for(s=0;s<61;s++)if(fc(s,0==g?w:x)){if(-1!==Ce[E=32768|S<<9|g<<8|l<<6|s].op)return void SAEF_error("cpu.mkITab() op exists OR "+E);Ce[E]=dc(E,"OR",[]),Ce[E].p.Dn=S,Ce[E].p.ea=s,Ce[E].p.zm=4==u?2147483648:2==u?32768:128,0==g?(t=_c(s),Ce[E].p.cyc=uc(4==u?t==le||t==ve?[8,1,0]:[6,1,0]:[4,1,0],lc(s,u)),Ce[E].f=4==u?ga:2==u?ya:va,Ce[E].d=pc(0,un,s,rn,S,u,0)):(Ce[E].p.cyc=uc(4==u?[12,1,2]:[8,1,1],lc(s,u)),Ce[E].f=4==u?ba:2==u?Ca:ka,Ce[E].d=pc(0,rn,S,un,s,u,0)),e++}for(a=[le,de,pe,Ee,Ae,Se,ge,ye],l=0;l<3;l++)for(u=0==l?1:1==l?2:4,s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=17920|l<<6|s].op)return void SAEF_error("cpu.mkITab() op exists NOT "+E);y=(t=_c(s))==le?4==u?[6,1,0]:[4,1,0]:4==u?[12,1,2]:[8,1,1];Ce[E]=dc(E,"NOT",y),t==le?(Ce[E].p.Dn=7&s,Ce[E].f=4==u?pa:2==u?Ea:Aa):(Ce[E].p.ea=s,Ce[E].p.cyc=uc(Ce[E].p.cyc,lc(s,u)),Ce[E].f=4==u?Sa:2==u?ma:ha),Ce[E].p.m=4==u?4294967295:2==u?65535:255,Ce[E].p.zm=4==u?2147483648:2==u?32768:128,Ce[E].d=pc(0,!1,!1,un,s,u,0),e++}for(a=[le,de,pe,Ee,Ae,Se,ge,ye],l=0;l<3;l++)for(u=0==l?1:1==l?2:4,s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=512|l<<6|s].op)return void SAEF_error("cpu.mkITab() op exists ANDI "+E);y=(t=_c(s))==le?4==u?[16,3,0]:[8,2,0]:4==u?[20,3,1]:[12,2,1];Ce[E]=dc(E,"ANDI",y),t==le?(Ce[E].p.Dn=7&s,Ce[E].f=4==u?Ra:2==u?wa:xa):(Ce[E].p.ea=s,Ce[E].p.cyc=uc(Ce[E].p.cyc,lc(s,u)),Ce[E].f=4==u?Da:2==u?Ma:Fa),Ce[E].p.zm=4==u?2147483648:2==u?32768:128,Ce[E].d=pc(0,fn,4==u?2:1,un,s,u,0),e++}for(a=[le,de,pe,Ee,Ae,Se,ge,ye],l=0;l<3;l++)for(u=0==l?1:1==l?2:4,s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=2560|l<<6|s].op)return void SAEF_error("cpu.mkITab() op exists EORI "+E);y=(t=_c(s))==le?4==u?[16,3,0]:[8,2,0]:4==u?[20,3,1]:[12,2,1];Ce[E]=dc(E,"EORI",y),t==le?(Ce[E].p.Dn=7&s,Ce[E].f=4==u?Ta:2==u?Va:Ia):(Ce[E].p.ea=s,Ce[E].p.cyc=uc(Ce[E].p.cyc,lc(s,u)),Ce[E].f=4==u?Pa:2==u?za:Oa),Ce[E].p.zm=4==u?2147483648:2==u?32768:128,Ce[E].d=pc(0,fn,4==u?2:1,un,s,u,0),e++}for(a=[le,de,pe,Ee,Ae,Se,ge,ye],l=0;l<3;l++)for(u=0==l?1:1==l?2:4,s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=l<<6|s].op)return void SAEF_error("cpu.mkITab() op exists ORI "+E);y=(t=_c(s))==le?4==u?[16,3,0]:[8,2,0]:4==u?[20,3,1]:[12,2,1];Ce[E]=dc(E,"ORI",y),t==le?(Ce[E].p.Dn=7&s,Ce[E].f=4==u?La:2==u?Na:Ba):(Ce[E].p.ea=s,Ce[E].p.cyc=uc(Ce[E].p.cyc,lc(s,u)),Ce[E].f=4==u?Ua:2==u?Ka:Ga),Ce[E].p.zm=4==u?2147483648:2==u?32768:128,Ce[E].d=pc(0,fn,4==u?2:1,un,s,u,0),e++}for(l=0;l<3;l++)for(u=0==l?1:1==l?2:4,h=0;h<2;h++)for(var D=0;D<2;D++)for(var M=0;M<8;M++)for(var F=0;F<8;F++){if(-1!==Ce[E=57344|M<<9|h<<8|l<<6|D<<5|F].op)return void SAEF_error("cpu.mkITab() op exists ASx "+E);Ce[E]=dc(E,0==h?"ASR":"ASL",4==u?[8,1,0]:[6,1,0]),Ce[E].p.ir=D,Ce[E].p.cr=0==D&&0==M?8:M,Ce[E].p.Dy=F,Ce[E].f=0==h?4==u?Za:2==u?ja:Ya:4==u?Ha:2==u?Xa:qa,Ce[E].d=pc(0,0==D?_n:rn,0==D&&0==M?8:M,rn,F,u,0),e++}for(a=[de,pe,Ee,Ae,Se,ge,ye],h=0;h<2;h++)for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=57536|h<<8|s].op)return void SAEF_error("cpu.mkITab() op exists ASx "+E);Ce[E]=dc(E,0==h?"ASR":"ASL",uc([8,1,1],lc(s,2))),Ce[E].p.ea=s,Ce[E].f=0==h?Ja:Wa,Ce[E].d=pc(0,!1,!1,un,s,2,0),e++}for(l=0;l<3;l++){u=0==l?1:1==l?2:4;for(h=0;h<2;h++)for(D=0;D<2;D++)for(M=0;M<8;M++)for(F=0;F<8;F++){if(-1!==Ce[E=57344|M<<9|h<<8|l<<6|D<<5|8|F].op)return void SAEF_error("cpu.mkITab() op exists LSx "+E);Ce[E]=dc(E,0==h?"LSR":"LSL",4==u?[8,1,0]:[6,1,0]),Ce[E].p.ir=D,Ce[E].p.cr=0==D&&0==M?8:M,Ce[E].p.Dy=F,Ce[E].f=0==h?4==u?to:2==u?no:ro:4==u?Qa:2==u?$a:eo,Ce[E].d=pc(0,0==D?_n:rn,0==D&&0==M?8:M,rn,F,u,0),e++}}for(a=[de,pe,Ee,Ae,Se,ge,ye],h=0;h<2;h++)for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=58048|h<<8|s].op)return void SAEF_error("cpu.mkITab() op exists LSx "+E);Ce[E]=dc(E,0==h?"LSR":"LSL",uc([8,1,1],lc(s,2))),Ce[E].p.ea=s,Ce[E].f=0==h?ao:io,Ce[E].d=pc(0,!1,!1,un,s,2,0),e++}for(l=0;l<3;l++)for(u=0==l?1:1==l?2:4,h=0;h<2;h++)for(D=0;D<2;D++)for(M=0;M<8;M++)for(F=0;F<8;F++){if(-1!==Ce[E=57344|M<<9|h<<8|l<<6|D<<5|24|F].op)return void SAEF_error("cpu.mkITab() op exists ROx "+E);Ce[E]=dc(E,0==h?"ROR":"ROL",4==u?[8,1,0]:[6,1,0]),Ce[E].p.ir=D,Ce[E].p.cr=0==D&&0==M?8:M,Ce[E].p.Dy=F,Ce[E].f=0==h?4==u?_o:2==u?fo:lo:4==u?oo:2==u?so:co,Ce[E].d=pc(0,0==D?_n:rn,0==D&&0==M?8:M,rn,F,u,0),e++}for(a=[de,pe,Ee,Ae,Se,ge,ye],h=0;h<2;h++)for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=59072|h<<8|s].op)return void SAEF_error("cpu.mkITab() op exists ROx "+E);Ce[E]=dc(E,0==h?"ROR":"ROL",uc([8,1,1],lc(s,2))),Ce[E].p.ea=s,Ce[E].f=0==h?po:uo,Ce[E].d=pc(0,!1,!1,un,s,2,0),e++}for(l=0;l<3;l++)for(u=0==l?1:1==l?2:4,h=0;h<2;h++)for(D=0;D<2;D++)for(M=0;M<8;M++)for(F=0;F<8;F++){if(-1!==Ce[E=57344|M<<9|h<<8|l<<6|D<<5|16|F].op)return void SAEF_error("cpu.mkITab() op exists ROx "+E);Ce[E]=dc(E,0==h?"ROR":"ROL",4==u?[8,1,0]:[6,1,0]),Ce[E].p.ir=D,Ce[E].p.cr=0==D&&0==M?8:M,Ce[E].p.Dy=F,Ce[E].f=0==h?4==u?mo:2==u?ho:go:4==u?Eo:2==u?Ao:So,Ce[E].d=pc(0,0==D?_n:rn,0==D&&0==M?8:M,rn,F,u,0),e++}for(a=[de,pe,Ee,Ae,Se,ge,ye],h=0;h<2;h++)for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=58560|h<<8|s].op)return void SAEF_error("cpu.mkITab() op exists ROx "+E);Ce[E]=dc(E,0==h?"ROXR":"ROXL",uc([8,1,1],lc(s,2))),Ce[E].p.ea=s,Ce[E].f=0==h?vo:yo,Ce[E].d=pc(0,!1,!1,un,s,2,0),e++}for(S=0;S<8;S++){if(-1!==Ce[E=18496|S].op)return void SAEF_error("cpu.mkITab() op exists SWAP "+E);Ce[E]=dc(E,"SWAP",[4,1,0]),Ce[E].p.Dn=S,Ce[E].f=bo,Ce[E].d=pc(0,!1,!1,rn,S,2,0),e++}for(a=[le,de,pe,Ee,Ae,Se,ge,ye],S=0;S<8;S++)for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=S<<9|320|s].op)return void SAEF_error("cpu.mkITab() op exists BCHG1 "+E);t=_c(s);Ce[E]=dc(E,"BCHG",t==le?[8,1,0]:[8,1,1]),Ce[E].p.Dn=S,t==le?(Ce[E].p.Dd=7&s,Ce[E].f=Co):(Ce[E].p.ea=s,Ce[E].p.cyc=uc(Ce[E].p.cyc,lc(s,1)),Ce[E].f=ko),Ce[E].d=pc(0,rn,S,un,s,t==le?4:1,0),e++}for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=2112|s].op)return void SAEF_error("cpu.mkITab() op exists BCHG "+E);t=_c(s);Ce[E]=dc(E,"BCHG",t==le?[12,2,0]:[12,2,1]),t==le?(Ce[E].p.Dd=7&s,Ce[E].f=Ro):(Ce[E].p.ea=s,Ce[E].p.cyc=uc(Ce[E].p.cyc,lc(s,1)),Ce[E].f=wo),Ce[E].d=pc(0,fn,1,un,s,t==le?4:1,0),e++}for(a=[le,de,pe,Ee,Ae,Se,ge,ye],S=0;S<8;S++)for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=S<<9|384|s].op)return void SAEF_error("cpu.mkITab() op exists BCLR "+E);t=_c(s);Ce[E]=dc(E,"BCLR",t==le?[10,1,0]:[8,1,1]),Ce[E].p.Dn=S,t==le?(Ce[E].p.Dd=7&s,Ce[E].f=xo):(Ce[E].p.ea=s,Ce[E].p.cyc=uc(Ce[E].p.cyc,lc(s,1)),Ce[E].f=Do),Ce[E].d=pc(0,rn,S,un,s,t==le?4:1,0),e++}for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=2176|s].op)return void SAEF_error("cpu.mkITab() op exists BCLR "+E);t=_c(s);Ce[E]=dc(E,"BCLR",t==le?[14,2,0]:[12,2,1]),t==le?(Ce[E].p.Dd=7&s,Ce[E].f=Mo):(Ce[E].p.ea=s,Ce[E].p.cyc=uc(Ce[E].p.cyc,lc(s,1)),Ce[E].f=Fo),Ce[E].d=pc(0,fn,1,un,s,t==le?4:1,0),e++}for(a=[le,de,pe,Ee,Ae,Se,ge,ye],S=0;S<8;S++)for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=S<<9|448|s].op)return void SAEF_error("cpu.mkITab() op exists BSET "+E);t=_c(s);Ce[E]=dc(E,"BSET",t==le?[8,1,0]:[8,1,1]),Ce[E].p.Dn=S,t==le?(Ce[E].p.Dd=7&s,Ce[E].f=To):(Ce[E].p.ea=s,Ce[E].p.cyc=uc(Ce[E].p.cyc,lc(s,1)),Ce[E].f=Vo),Ce[E].d=pc(0,rn,S,un,s,t==le?4:1,0),e++}for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=2240|s].op)return void SAEF_error("cpu.mkITab() op exists BSET "+E);t=_c(s);Ce[E]=dc(E,"BSET",t==le?[12,2,0]:[12,2,1]),t==le?(Ce[E].p.Dd=7&s,Ce[E].f=Io):(Ce[E].p.ea=s,Ce[E].p.cyc=uc(Ce[E].p.cyc,lc(s,1)),Ce[E].f=Po),Ce[E].d=pc(0,fn,1,un,s,t==le?4:1,0),e++}for(a=[le,de,pe,Ee,Ae,Se,me,he,ge,ye,ve],S=0;S<8;S++)for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=S<<9|256|s].op)return void SAEF_error("cpu.mkITab() op exists BTST "+E);t=_c(s);Ce[E]=dc(E,"BTST",t==le?[6,1,0]:[4,1,0]),Ce[E].p.Dn=S,t==le?(Ce[E].p.Dd=7&s,Ce[E].f=zo):(Ce[E].p.ea=s,Ce[E].p.cyc=uc(Ce[E].p.cyc,lc(s,1)),Ce[E].f=Oo),Ce[E].d=pc(0,rn,S,un,s,t==le?4:1,0),e++}a=[le,de,pe,Ee,Ae,Se,me,he,ge,ye];for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=2048|s].op)return void SAEF_error("cpu.mkITab() op exists BTST "+E);t=_c(s);Ce[E]=dc(E,"BTST",t==le?[12,2,0]:[8,2,0]),t==le?(Ce[E].p.Dd=7&s,Ce[E].f=Lo):(Ce[E].p.ea=s,Ce[E].p.cyc=uc(Ce[E].p.cyc,lc(s,1)),Ce[E].f=No),Ce[E].d=pc(0,fn,1,un,s,t==le?4:1,0),e++}if(68020<=Ve)for(a=[le,de,Ae,Se,me,he,ge,ye],s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=60096|s].op)return void SAEF_error("cpu.mkITab() op exists BFCHG "+E);Ce[E]=dc(E,"BFCHG",[4,1,0]),Ce[E].p.id=qt,Ce[E].p.ea=s,Ce[E].f=Bo,Ce[E].d=pc(1,un,s,An,0,0,0),e++}if(68020<=Ve)for(a=[le,de,Ae,Se,me,he,ge,ye],s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=60608|s].op)return void SAEF_error("cpu.mkITab() op exists BFCLR "+E);Ce[E]=dc(E,"BFCLR",[4,1,0]),Ce[E].p.id=Zt,Ce[E].p.ea=s,Ce[E].f=Bo,Ce[E].d=pc(1,un,s,An,0,0,0),e++}if(68020<=Ve)for(a=[le,de,Ae,Se,me,he,ge,ye],s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=60352|s].op)return void SAEF_error("cpu.mkITab() op exists BFEXTS "+E);Ce[E]=dc(E,"BFEXTS",[4,1,0]),Ce[E].p.id=jt,Ce[E].p.ea=s,Ce[E].f=Bo,Ce[E].d=pc(1,un,s,An,0,0,0),e++}if(68020<=Ve)for(a=[le,de,Ae,Se,me,he,ge,ye],s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=59840|s].op)return void SAEF_error("cpu.mkITab() op exists BFEXTU "+E);Ce[E]=dc(E,"BFEXTU",[4,1,0]),Ce[E].p.id=Yt,Ce[E].p.ea=s,Ce[E].f=Bo,Ce[E].d=pc(1,un,s,An,0,0,0),e++}if(68020<=Ve)for(a=[le,de,Ae,Se,me,he,ge,ye],s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=60864|s].op)return void SAEF_error("cpu.mkITab() op exists BFFFO "+E);Ce[E]=dc(E,"BFFFO",[4,1,0]),Ce[E].p.id=Wt,Ce[E].p.ea=s,Ce[E].f=Bo,Ce[E].d=pc(1,un,s,An,0,0,0),e++}if(68020<=Ve)for(a=[le,de,Ae,Se,ge,ye],s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=61376|s].op)return void SAEF_error("cpu.mkITab() op exists BFINS "+E);Ce[E]=dc(E,"BFINS",[4,1,0]),Ce[E].p.id=Jt,Ce[E].p.ea=s,Ce[E].f=Bo,Ce[E].d=pc(1,un,s,An,0,0,0),e++}if(68020<=Ve)for(a=[le,de,Ae,Se,ge,ye],s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=61120|s].op)return void SAEF_error("cpu.mkITab() op exists BFSET "+E);Ce[E]=dc(E,"BFSET",[4,1,0]),Ce[E].p.id=Qt,Ce[E].p.ea=s,Ce[E].f=Bo,Ce[E].d=pc(1,un,s,An,0,0,0),e++}if(68020<=Ve)for(a=[le,de,Ae,Se,me,he,ge,ye],s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=59584|s].op)return void SAEF_error("cpu.mkITab() op exists BFTST "+E);Ce[E]=dc(E,"BFTST",[4,1,0]),Ce[E].p.id=$t,Ce[E].p.ea=s,Ce[E].f=Bo,Ce[E].d=pc(1,un,s,An,0,0,0),e++}for(r=0;r<8;r++)for(b=0;b<2;b++)for(i=0;i<8;i++){if(-1!==Ce[E=49408|r<<9|b<<3|i].op)return void SAEF_error("cpu.mkITab() op exists ABCD "+E);Ce[E]=dc(E,"ABCD",0==b?[6,1,0]:[18,3,1]),Ce[E].p.Rx=r,Ce[E].p.Ry=i,0==b?(Ce[E].f=Uo,Ce[E].d=pc(0,rn,i,rn,r,1,0)):(Ce[E].f=Ko,Ce[E].d=pc(0,on,i,on,r,1,0)),e++}for(i=0;i<8;i++)for(b=0;b<2;b++)for(r=0;r<8;r++){if(-1!==Ce[E=33024|i<<9|b<<3|r].op)return void SAEF_error("cpu.mkITab() op exists SBCD "+E);Ce[E]=dc(E,"SBCD",0==b?[6,1,0]:[18,3,1]),Ce[E].p.Ry=i,Ce[E].p.Rx=r,0==b?(Ce[E].f=Go,Ce[E].d=pc(0,rn,r,rn,i,1,0)):(Ce[E].f=Ho,Ce[E].d=pc(0,on,r,on,i,1,0)),e++}for(a=[le,de,pe,Ee,Ae,Se,ge,ye],s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=18432|s].op)return void SAEF_error("cpu.mkITab() op exists NBCD "+E);t=_c(s);Ce[E]=dc(E,"NBCD",t==le?[6,1,0]:[8,1,1]),t==le?(Ce[E].p.Dd=7&s,Ce[E].f=Xo):(Ce[E].p.ea=s,Ce[E].p.cyc=uc(Ce[E].p.cyc,lc(s,1)),Ce[E].f=qo),Ce[E].d=pc(0,!1,!1,un,s,1,0),e++}if(68020<=Ve)for(i=0;i<8;i++)for(b=0;b<2;b++)for(r=0;r<8;r++){if(-1!==Ce[E=33088|i<<9|b<<3|r].op)return void SAEF_error("cpu.mkITab() op exists PACK "+E);Ce[E]=dc(E,"PACK",[4,0,0]),Ce[E].p.Ry=i,Ce[E].p.Rx=r,0==b?(Ce[E].f=Zo,Ce[E].d=pc(1,rn,r,rn,i,0,0)):(Ce[E].f=jo,Ce[E].d=pc(1,on,r,on,i,0,0)),e++}if(68020<=Ve)for(i=0;i<8;i++)for(b=0;b<2;b++)for(r=0;r<8;r++){if(-1!==Ce[E=33152|i<<9|b<<3|r].op)return void SAEF_error("cpu.mkITab() op exists UNPK "+E);Ce[E]=dc(E,"PACK",[4,0,0]),Ce[E].p.Ry=i,Ce[E].p.Rx=r,0==b?(Ce[E].f=Yo,Ce[E].d=pc(1,rn,r,rn,i,0,0)):(Ce[E].f=Wo,Ce[E].d=pc(1,on,r,on,i,0,0)),e++}for(var T=2;T<16;T++)for(var V=0;V<(68020<=Ve?256:255);V++){if(-1!==Ce[E=24576|T<<8|V].op)return void SAEF_error("cpu.mkITab() op exists B"+be[T]+" "+E);Ce[E]=dc(E,"B"+be[T],255==V?[12,1,0]:[8,1,0]),Ce[E].p.cc=T,Ce[E].p.dp=V,Ce[E].p.cycTaken=[10,2,2],Ce[E].f=Jo,Ce[E].d=pc(0,!1,!1,ln,V,255==V?2:1,0),e++}for(T=0;T<16;T++)for(S=0;S<8;S++){if(-1!==Ce[E=20680|T<<8|S].op)return void SAEF_error("cpu.mkITab() op exists DB"+be[T]+" "+E);Ce[E]=dc(E,"DB"+be[T],[10,2,0]),Ce[E].p.cc=T,Ce[E].p.Dn=S,Ce[E].p.cycNotTakenTrue=[12,2,0],Ce[E].p.cycNotTakenFalse=[14,3,0],Ce[E].f=Qo,Ce[E].d=pc(0,rn,S,ln,0,2,0),e++}for(a=[le,de,pe,Ee,Ae,Se,ge,ye],T=0;T<16;T++)for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=20672|T<<8|s].op)return void SAEF_error("cpu.mkITab() op exists S"+be[T]+" "+E);y=_c(s)==le?[8,1,1]:uc([8,1,1],lc(s,1));Ce[E]=dc(E,"S"+be[T],y),Ce[E].p.cc=T,Ce[E].p.ea=s,Ce[E].p.cycFalse=[4,1,0],Ce[E].p.cycTrue=[6,1,0],Ce[E].f=$o,Ce[E].d=pc(0,!1,!1,un,s,1,0),e++}for(V=0;V<(68020<=Ve?256:255);V++){if(-1!==Ce[E=24576|V].op)return void SAEF_error("cpu.mkITab() op exists BRA "+E);Ce[E]=dc(E,"BRA",[10,2,0]),Ce[E].p.dp=V,Ce[E].f=es,Ce[E].d=pc(0,!1,!1,ln,V,0==V?2:255==V?4:1,0),e++}for(V=0;V<(68020<=Ve?256:255);V++){if(-1!==Ce[E=24832|V].op)return void SAEF_error("cpu.mkITab() op exists BSR "+E);Ce[E]=dc(E,"BSR",[18,2,2]),Ce[E].p.dp=V,Ce[E].f=ts,Ce[E].d=pc(0,!1,!1,ln,V,0==V?2:255==V?4:1,0),e++}for(a=[de,Ae,Se,me,he,ge,ye],s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=20160|s].op)return void SAEF_error("cpu.mkITab() op exists JMP "+E);switch(_c(s)){case de:y=[8,2,0];break;case Ae:y=[10,2,0];break;case Se:y=[14,3,0];break;case me:y=[10,2,0];break;case he:y=[14,3,0];break;case ge:y=[10,2,0];break;case ye:y=[12,3,0]}Ce[E]=dc(E,"JMP",y),Ce[E].p.ea=s,Ce[E].f=ns,Ce[E].d=pc(0,!1,!1,un,s,0,0),e++}for(a=[de,Ae,Se,me,he,ge,ye],s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=20096|s].op)return void SAEF_error("cpu.mkITab() op exists JSR "+E);switch(_c(s)){case de:y=[16,2,2];break;case Ae:y=[18,2,2];break;case Se:y=[22,2,2];break;case me:y=[18,2,2];break;case he:y=[22,2,2];break;case ge:y=[18,2,2];break;case ye:y=[20,3,2]}Ce[E]=dc(E,"JSR",y),Ce[E].p.ea=s,Ce[E].f=rs,Ce[E].d=pc(0,!1,!1,un,s,0,0),e++}if(-1===Ce[E=20081].op){if(Ce[E]=dc(E,"NOP",[4,1,0]),Ce[E].f=is,Ce[E].d=pc(0,!1,!1,!1,!1,0,0),e++,68010<=Ve){if(-1!==Ce[E=20084].op)return void SAEF_error("cpu.mkITab() op exists RTD "+E);Ce[E]=dc(E,"RTD",[4,0,0]),Ce[E].f=as,Ce[E].d=pc(0,!1,!1,fn,1,0,0),e++}if(-1===Ce[E=20087].op)if(Ce[E]=dc(E,"RTR",[20,5,0]),Ce[E].f=os,Ce[E].d=pc(0,!1,!1,!1,!1,0,0),e++,-1===Ce[E=20085].op){Ce[E]=dc(E,"RTS",[16,4,0]),Ce[E].f=ss,Ce[E].d=pc(0,!1,!1,!1,!1,0,0),e++;a=[le,ue,de,pe,Ee,Ae,Se,ge,ye,ve];68020<=Ve&&a.push(me,he);for(l=0;l<3;l++)for(u=0==l?1:1==l?2:4,s=0;s<61;s++)if(fc(s,a)){t=_c(s);if(!(68020<=Ve&&0==l&&t==ue)){if(-1!==Ce[E=18944|l<<6|s].op)return void SAEF_error("cpu.mkITab() op exists TST "+E);y=t==le||t==ue?[4,1,0]:uc([4,1,0],lc(s,u)),Ce[E]=dc(E,"TST",y),Ce[E].p.ea=s,Ce[E].p.zm=4==u?2147483648:2==u?32768:128,Ce[E].f=4==u?fs:2==u?_s:cs,Ce[E].d=pc(0,!1,!1,un,s,u,0),e++}}if(-1===Ce[E=572].op)if(Ce[E]=dc(E,"ANDI",[20,3,0]),Ce[E].f=ls,Ce[E].d=pc(0,fn,1,dn,0,1,0),e++,-1===Ce[E=2620].op)if(Ce[E]=dc(E,"EORI",[20,3,0]),Ce[E].f=us,Ce[E].d=pc(0,fn,1,dn,0,1,0),e++,-1===Ce[E=60].op){if(Ce[E]=dc(E,"ORI",[20,3,0]),Ce[E].f=ds,Ce[E].d=pc(0,fn,1,dn,0,1,0),e++,68010<=Ve)for(a=[le,de,pe,Ee,Ae,Se,ge,ye],s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=17088|s].op)return void SAEF_error("cpu.mkITab() op exists MOVE_CCR2 "+E);Ce[E]=dc(E,"MOVE",[4,1,0]),Ce[E].p.ea=s,Ce[E].f=Es,Ce[E].d=pc(0,dn,0,un,s,2,0),e++}for(a=[le,de,pe,Ee,Ae,Se,me,he,ge,ye,ve],s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=17600|s].op)return void SAEF_error("cpu.mkITab() op exists MOVE_2CCR "+E);y=_c(s)==le?[12,1,0]:uc([12,1,0],lc(s,2));Ce[E]=dc(E,"MOVE",y),Ce[E].p.ea=s,Ce[E].f=ps,Ce[E].d=pc(0,un,s,dn,0,2,0),e++}if(-1===Ce[E=636].op)if(Ce[E]=dc(E,"ANDI",[20,3,0]),Ce[E].f=As,Ce[E].d=pc(0,fn,1,pn,0,2,0),e++,-1===Ce[E=2684].op)if(Ce[E]=dc(E,"EORI",[20,3,0]),Ce[E].f=Ss,Ce[E].d=pc(0,fn,1,pn,0,2,0),e++,-1===Ce[E=124].op){Ce[E]=dc(E,"ORI",[20,3,0]),Ce[E].f=ms,Ce[E].d=pc(0,fn,1,pn,0,2,0),e++;for(a=[le,de,pe,Ee,Ae,Se,ge,ye],s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=16576|s].op)return void SAEF_error("cpu.mkITab() op exists MOVE_SR2 "+E);y=_c(s)==le?[6,1,0]:uc([8,1,1],lc(s,2));Ce[E]=dc(E,"MOVE",y),Ce[E].p.ea=s,Ce[E].f=gs,Ce[E].d=pc(0,pn,0,un,s,2,0),e++}for(a=[le,de,pe,Ee,Ae,Se,me,he,ge,ye,ve],s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=18112|s].op)return void SAEF_error("cpu.mkITab() op exists MOVE_2SR "+E);y=_c(s)==le?[12,1,0]:uc([12,1,0],lc(s,2));Ce[E]=dc(E,"MOVE",y),Ce[E].p.ea=s,Ce[E].f=hs,Ce[E].d=pc(0,un,s,pn,0,2,0),e++}for(h=0;h<2;h++)for(o=0;o<8;o++){if(-1!==Ce[E=20064|h<<3|o].op)return void SAEF_error("cpu.mkITab() op exists MOVE_USP "+E);Ce[E]=dc(E,"MOVE",[4,1,0]),Ce[E].p.An=o,0==h?(Ce[E].f=vs,Ce[E].d=pc(0,an,o,En,0,4,0)):(Ce[E].f=ys,Ce[E].d=pc(0,En,0,an,o,4,0)),e++}if(68010<=Ve)for(h=0;h<2;h++){if(-1!==Ce[E=20090|h].op)return void SAEF_error("cpu.mkITab() op exists MOVEC "+E);Ce[E]=dc(E,"MOVEC",[4,0,0]),Ce[E].f=0==h?Cs:bs,Ce[E].d=pc(1,!1,!1,mn,0==h,4,0),e++}if(68010<=Ve)for(a=[de,pe,Ee,Ae,Se,ge,ye],l=0;l<3;l++)for(u=0==l?1:1==l?2:4,s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=3584|l<<6|s].op)return void SAEF_error("cpu.mkITab() op exists MOVES "+E);Ce[E]=dc(E,"MOVES",[4,0,0]),Ce[E].p.ea=s,Ce[E].f=4==u?ks:2==u?Rs:ws,Ce[E].d=pc(1,!1,!1,un,s,u,0),e++}if(68010<=Ve)for(var I=0;I<8;I++){if(-1!==Ce[E=18504|I].op)return void SAEF_error("cpu.mkITab() op exists BKPT "+E);Ce[E]=dc(E,"BKPT",[45,5,4]),Ce[E].p.v=I,Ce[E].f=xs,Ce[E].d=pc(0,!1,!1,_n,I,0,0),e++}for(a=[le,de,pe,Ee,Ae,Se,me,he,ge,ye,ve],S=0;S<8;S++)for(l=0;l<(68020<=Ve?2:1);l++)for(u=0==l?2:4,d=0==l?3:2,s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=16384|S<<9|d<<7|s].op)return void SAEF_error("cpu.mkITab() op exists CHK "+E);y=_c(s)==le?[10,1,0]:uc([10,1,0],lc(s,u));Ce[E]=dc(E,"CHK",y),Ce[E].p.Dn=S,Ce[E].p.ea=s,Ce[E].f=2==u?Ds:Ms,Ce[E].d=pc(0,un,s,rn,S,u,0),e++}if(68020<=Ve)for(a=[de,Ae,Se,me,he,ge,ye],l=0;l<3;l++)for(u=0==l?1:1==l?2:4,s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=l<<9|192|s].op)return void SAEF_error("cpu.mkITab() op exists CHK2 "+E);y=_c(s)==le?[10,1,0]:uc([10,1,0],lc(s,u));Ce[E]=dc(E,"CHK2",y),Ce[E].p.ea=s,Ce[E].f=4==u?Fs:2==u?Ts:Vs,Ce[E].d=pc(1,!1,!1,un,s,u,0),e++}if(-1===Ce[E=19196].op)if(Ce[E]=dc(E,"ILLEGAL",[0,0,0]),Ce[E].f=Is,Ce[E].d=pc(0,!1,!1,!1,!1,0,0),e++,-1===Ce[E=20080].op)if(Ce[E]=dc(E,"RESET",[132,1,0]),Ce[E].f=Ps,Ce[E].d=pc(0,!1,!1,!1,!1,0,0),e++,-1===Ce[E=20083].op)if(Ce[E]=dc(E,"RTE",[20,5,0]),Ce[E].f=zs,Ce[E].d=pc(0,!1,!1,!1,!1,0,0),e++,-1===Ce[E=20082].op){Ce[E]=dc(E,"STOP",[4,0,0]),Ce[E].f=Os,Ce[E].d=pc(0,!1,!1,fn,1,0,0),e++;for(var P=0;P<16;P++){if(-1!==Ce[E=20032|P].op)return void SAEF_error("cpu.mkITab() op exists TRAP "+E);Ce[E]=dc(E,"TRAP",[38,4,3]),Ce[E].p.v=P,Ce[E].f=Ls,Ce[E].d=pc(0,!1,!1,_n,P,0,0),e++}if(68020<=Ve)for(l=0;l<3;l++)for(u=0==l?0:1==l?2:4,n=0==l?4:1==l?2:3,T=0;T<16;T++){if(-1!==Ce[E=20728|T<<8|n].op)return void SAEF_error("cpu.mkITab() op exists TRAP"+be[T]+" "+E);Ce[E]=dc(E,"TRAP"+be[T],[4,1,0]),Ce[E].p.cc=T,Ce[E].f=4==u?Us:2==u?Bs:Ns,u&&(Ce[E].d=pc(0,!1,!1,_n,2==u?1:2,u,0)),e++}if(-1===Ce[E=20086].op){if(Ce[E]=dc(E,"TRAPV",[4,1,0]),Ce[E].f=Ks,Ce[E].d=pc(0,!1,!1,!1,!1,0,0),e++,68020<=Ve)for(a=[de,pe,Ee,Ae,Se,ge,ye],l=1;l<=3;l++)for(u=1==l?1:2==l?2:4,s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=2240|l<<9|s].op)return void SAEF_error("cpu.mkITab() op exists CAS "+E);Ce[E]=dc(E,"CAS",[4,0,0]),Ce[E].p.ea=s,Ce[E].f=4==u?Gs:2==u?Hs:Xs,Ce[E].d=pc(1,!1,!1,un,s,u,0),e++}if(68020<=Ve)for(l=2;l<=3;l++){u=2==l?2:4;if(-1!==Ce[E=2300|l<<9].op)return void SAEF_error("cpu.mkITab() op exists CAS2 "+E);Ce[E]=dc(E,"CAS2",[4,0,0]),Ce[E].f=4==u?qs:Zs,Ce[E].d=pc(2,!1,!1,!1,!1,u,0),e++}for(a=[le,de,pe,Ee,Ae,Se,ge,ye],s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=19136|s].op)return void SAEF_error("cpu.mkITab() op exists TAS "+E);y=_c(s)==le?[4,1,0]:uc([10,1,1],lc(s,1));Ce[E]=dc(E,"TAS",y),Ce[E].p.ea=s,Ce[E].f=js,Ce[E].d=pc(0,!1,!1,un,s,1,0),e++}if(68020==Ve)for(a=[de,Ae,Se,me,he,ge,ye],s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=1728|s].op)return void SAEF_error("cpu.mkITab() op exists CALLM "+E);Ce[E]=dc(E,"CALLM",[4,0,0]),Ce[E].p.ea=s,Ce[E].f=Ys,Ce[E].d=pc(0,fn,1,un,s,0,0),e++}if(68020==Ve)for(var z=0;z<1;z++)for(var O=0;O<8;O++){if(-1!==Ce[E=1728|z<<3|O].op)return void SAEF_error("cpu.mkITab() op exists RTM "+E);Ce[E]=dc(E,"RTM",[4,0,0]),Ce[E].p.da=z,Ce[E].p.Rn=O,Ce[E].f=Ws,Ce[E].d=pc(0,!1,!1,z?rn:an,O,0,0),e++}if(68030==Ve)for(var L=0,a=[de,Ae,Se,ge,ye],s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=61440|L<<9|s].op)return void SAEF_error("cpu.mkITab() op exists PFLUSH "+E);Ce[E]=dc(E,"MMU",[4,0,0]),Ce[E].p.ea=s,Ce[E].f=Js,Ce[E].d=pc(1,un,s,yn,!1,0,0),e++}if(68020==Ve||68030==Ve)for(L=0;L<8;L++)if(0!=L||68030!=Ve)for(l=0;l<2;l++)for(var u=0==l?2:4,N=0;N<64;N++){if(-1!==Ce[E=61568|L<<9|l<<6|N].op)return void SAEF_error("cpu.mkITab() op exists cpBcc "+E);Ce[E]=dc(E,"cpBcc",[4,0,0]),Ce[E].p.cid=L,Ce[E].p.ccc=N,Ce[E].p.z=u,Ce[E].f=Qs,Ce[E].d=pc(1+(2==u?1:2),!1,!1,ln,0==l?0:255,u,0),e++}if(68020==Ve||68030==Ve)for(L=0;L<8;L++)if(0!=L||68030!=Ve)for(var B=0;B<8;B++){if(-1!==Ce[E=61512|L<<9|B].op)return void SAEF_error("cpu.mkITab() op exists cpDBcc "+E);Ce[E]=dc(E,"cpDBcc",[4,0,0]),Ce[E].p.cid=L,Ce[E].p.dn=B,Ce[E].f=$s,Ce[E].d=pc(2,rn,B,!1,!1,2,0),e++}if(68020==Ve||68030==Ve)for(L=0;L<8;L++)if(0!=L||68030!=Ve)for(s=0;s<61;s++){if(-1!==Ce[E=61440|L<<9|s].op)return void SAEF_error("cpu.mkITab() op exists cpGEN "+E);Ce[E]=dc(E,"cpGEN",[4,0,0]),Ce[E].p.cid=L,Ce[E].p.ea=s,Ce[E].f=ec,Ce[E].d=pc(2,!1,!1,!1,!1,0,0),e++}if(68020==Ve||68030==Ve)for(a=[de,pe,Ae,Se,me,he,ge,ye,ve],L=0;L<8;L++)if(0!=L||68030!=Ve)for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=61760|L<<9|s].op)return void SAEF_error("cpu.mkITab() op exists cpRESTORE "+E);Ce[E]=dc(E,"cpRESTORE",[4,0,0]),Ce[E].p.cid=L,Ce[E].p.ea=s,Ce[E].f=tc,Ce[E].d=pc(0,!1,!1,un,s,0,0),e++}if(68020==Ve||68030==Ve)for(a=[de,pe,Ae,Se,ge,ye],L=0;L<8;L++)if(0!=L||68030!=Ve)for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=61696|L<<9|s].op)return void SAEF_error("cpu.mkITab() op exists cpSAVE "+E);Ce[E]=dc(E,"cpSAVE",[4,0,0]),Ce[E].p.cid=L,Ce[E].p.ea=s,Ce[E].f=nc,Ce[E].d=pc(0,!1,!1,un,s,0,0),e++}if(68020==Ve||68030==Ve)for(a=[le,de,pe,Ee,Ae,Se,ge,ye],L=0;L<8;L++)if(0!=L||68030!=Ve)for(s=0;s<61;s++)if(fc(s,a)){if(-1!==Ce[E=61504|L<<9|s].op)return void SAEF_error("cpu.mkITab() op exists cpScc "+E);Ce[E]=dc(E,"cpScc",[4,0,0]),Ce[E].p.cid=L,Ce[E].p.ea=s,Ce[E].f=rc,Ce[E].d=pc(2,!1,!1,un,s,1,0),e++}if(68020==Ve||68030==Ve)for(L=0;L<8;L++)if(0!=L||68030!=Ve)for(n=2;n<=4;n++){u=2==n?2:n=4;if(-1!==Ce[E=61560|L<<9|n].op)return void SAEF_error("cpu.mkITab() op exists cpTRAPcc "+E);Ce[E]=dc(E,"cpTRAPcc",[4,0,0]),Ce[E].p.cid=L,Ce[E].p.opm=n,Ce[E].f=ic,Ce[E].d=pc(1+(1==u?0:2==u?2:4),!1,!1,!1,!1,u,0),e++}return void 0!==SAER&&SAEF_log("cpu.mkiTab() %d instructions created",e),1}SAEF_error("cpu.mkITab() op exists TRAPV "+E)}else SAEF_error("cpu.mkITab() op exists STOP "+E);else SAEF_error("cpu.mkITab() op exists RTE "+E);else SAEF_error("cpu.mkITab() op exists RESET "+E);else SAEF_error("cpu.mkITab() op exists ILLEGAL "+E)}else SAEF_error("cpu.mkITab() op exists ORI_SR "+E);else SAEF_error("cpu.mkITab() op exists EORI "+E);else SAEF_error("cpu.mkITab() op exists ANDI_SR "+E)}else SAEF_error("cpu.mkITab() op exists ORI_CCR "+E);else SAEF_error("cpu.mkITab() op exists EORI "+E);else SAEF_error("cpu.mkITab() op exists ANDI_CCR "+E)}else SAEF_error("cpu.mkITab() op exists RTS "+E);else SAEF_error("cpu.mkITab() op exists RTR "+E)}else SAEF_error("cpu.mkITab() op exists NOP "+E)}}const SAEC_Version=0,SAEC_Revision=9,SAEC_Patch=12;function SAEO_Error(e,t){this.err=e,this.msg=t}SAEO_Error.prototype=new Error;const SAEE_None=0,SAEE_AlreadyRunning=1,SAEE_NotRunning=2,SAEE_NoTimer=3,SAEE_NoMemory=4,SAEE_Assert=5,SAEE_Internal=6,SAEE_Config_Invalid=10,SAEE_Config_Compressed=11,SAEE_CPU_Internal=20,SAEE_CPU_Requires68020=21,SAEE_CPU_Requires680EC20=22,SAEE_CPU_Requires68030=23,SAEE_CPU_Requires68040=24,SAEE_Memory_NoKickstartRom=30,SAEE_Memory_NoExtendedRom=31,SAEE_Memory_RomSize=32,SAEE_Memory_RomKey=33,SAEE_Memory_RomDecode=34,SAEE_Memory_RomChecksum=35,SAEE_Memory_RomUnknown=36,SAEE_Video_ElementNotFound=40,SAEE_Video_RequiresCanvas=41,SAEE_Video_RequiresWegGl=42,SAEE_Video_ComphileShader=43,SAEE_Video_LinkShader=44,SAEE_Video_RequiresFullscreen=45,SAEE_Audio_RequiresWebAudio=50,SAEE_Input_GamepadNotReady=60;var SAER=null;const SAEC_spcflag_STOP=2,SAEC_spcflag_COPPER=4,SAEC_spcflag_INT=8,SAEC_spcflag_BRK=16,SAEC_spcflag_TRACE=64,SAEC_spcflag_DOTRACE=128,SAEC_spcflag_DOINT=256,SAEC_spcflag_BLTNASTY=512,SAEC_spcflag_MODE_CHANGE=8192,SAEC_spcflag_CHECK=32768,SAEC_command_Quit=1,SAEC_command_Reset=2,SAEC_command_KeyboardReset=3,SAEC_command_HardReset=4,SAEC_command_Pause=5,SAEC_command_Resume=6,SAEC_Info_Brower_ID_Unknown=0,SAEC_Info_Brower_ID_Chrome=1,SAEC_Info_Brower_ID_Safari=2,SAEC_Info_Brower_ID_Opera=3,SAEC_Info_Brower_ID_Firefox=4,SAEC_Info_Brower_ID_InternetExplorer=5,SAEC_info=function(){var e={browser:{id:SAEC_Info_Brower_ID_Unknown,name:"Unknown",plat:"Unknown",lang:"en"},memory:{maxSize:0},audio:{webAudio:!1},video:{canvas:!1,webGL:!1,pointerLock:!1,requestFullScreen:!1},input:{gamepad:!0}};-1<navigator.userAgent.indexOf("Chrome")?(e.browser.id=SAEC_Info_Brower_ID_Chrome,e.browser.name="Google Chrome"):-1<navigator.userAgent.indexOf("Safari")?(e.browser.id=SAEC_Info_Brower_ID_Safari,e.browser.name="Apple Safari"):-1<navigator.userAgent.indexOf("Opera")?(e.browser.id=SAEC_Info_Brower_ID_Opera,e.browser.name="Opera"):-1<navigator.userAgent.indexOf("Firefox")?(e.browser.id=SAEC_Info_Brower_ID_Firefox,e.browser.name="Mozilla Firefox"):-1<navigator.userAgent.indexOf("MSIE")&&(e.browser.id=SAEC_Info_Brower_ID_InternetExplorer,e.browser.name="Microsoft Internet Explorer"),e.browser.plat=navigator.platform,e.browser.lang=navigator.language,e.memory.maxSize=1073741824,void 0===window.webkitAudioContext&&void 0===window.AudioContext||(e.audio.webAudio=!0);var t=document.createElement("canvas");if(t&&t.getContext)try{t.getContext("2d").createImageData(16,16);e.video.canvas=!0;try{var n={alpha:!1,depth:!0,stencil:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!0,failIfMajorPerformanceCaveat:!1};t.getContext("webgl",n)||t.getContext("experimental-webgl",n);e.video.webGL=!0}catch(e){}void 0===t.webkitRequestPointerLock&&void 0===t.mozRequestPointerLock&&void 0===t.msRequestPointerLock&&void 0===t.requestPointerLock||(e.video.pointerLock=!0),void 0===t.webkitRequestFullscreen&&void 0===t.mozRequestFullScreen&&void 0===t.msRequestFullscreen&&void 0===t.requestFullScreen||(e.video.requestFullScreen=!0)}catch(e){}return e}();var SAEV_spcflags=0,SAEV_command=0;function SAEF_setSpcFlags(e){SAEV_spcflags|=e}function SAEF_clrSpcFlags(e){SAEV_spcflags&=~e}function SAEF_now(){return Math.floor(1e3*performance.now())}function SAEF_sleep(e){for(var t=performance.now();performance.now()-t<e;);}function SAEF_log(){var e;SAEV_config.debug.level>=SAEC_Config_Debug_Level_Log&&arguments.length&&(e=sprintf.apply(this,arguments),console.log&&console.log(e))}function SAEF_info(){var e;SAEV_config.debug.level>=SAEC_Config_Debug_Level_Info&&arguments.length&&(e=sprintf.apply(this,arguments),console.info&&console.info(e))}function SAEF_warn(){var e;SAEV_config.debug.level>=SAEC_Config_Debug_Level_Warn&&arguments.length&&(e=sprintf.apply(this,arguments),console.warn&&console.warn(e))}function SAEF_error(){var e;SAEV_config.debug.level>=SAEC_Config_Debug_Level_Error&&arguments.length&&(e=sprintf.apply(this,arguments),console.error&&console.error(e))}function SAEF_fatal(){var e=Array.prototype.slice.call(arguments),t=e[0],e=sprintf.apply(this,e.slice(1));throw console.error&&console.error(e),new SAEO_Error(t,e)}function SAEF_assert(e){if(!e){var t=SAEE_Assert,e="Assertion failed. This is a bug in SAE.";throw console.error&&console.error(e),new SAEO_Error(t,e)}}function ScriptedAmigaEmulator(){(SAER=this).audio=new SAEO_Audio,this.autoconf=new SAEO_AutoConf,this.blitter=new SAEO_Blitter,this.cia=new SAEO_CIA,this.config=new SAEO_Configuration,this.copper=new SAEO_Copper,this.cpu=new SAEO_CPU,this.custom=new SAEO_Custom,this.devices=new SAEO_Devices,this.disk=new SAEO_Disk,this.dongle=new SAEO_Dongle,this.events=new SAEO_Events,this.expansion=new SAEO_Expansion,this.filesys=new SAEO_Filesys,this.gayle=new SAEO_Gayle,this.gui=new SAEO_GUI,this.hardfile=new SAEO_Hardfile,this.ide=new SAEO_IDE,this.input=new SAEO_Input,this.m68k=new SAEO_M68K,this.memory=new SAEO_Memory,this.parallel=new SAEO_Parallel,this.playfield=new SAEO_Playfield,this.roms=new SAEO_Roms,this.rtc=new SAEO_RTC,this.serial=new SAEO_Serial,this.video=new SAEO_Video,this.running=!1,this.paused=!1,this.dump=function(){this.m68k.dump()},this.do_start_program=function(){0<=SAEV_command&&(SAEV_command=SAEC_command_Reset),this.m68k.m68k_go(!0)},this.do_leave_program=function(){this.video.cleanup(),this.input.cleanup(),this.disk.cleanup(),this.audio.cleanup(),this.serial.cleanup(),this.expansion.cleanup(),this.filesys.cleanup(),this.gayle.cleanup(),this.memory.cleanup(),this.autoconf.cleanup()},this.start_program=function(){this.do_start_program(),"function"==typeof SAEV_config.hook.event.started&&SAEV_config.hook.event.started()},this.leave_program=function(){this.dump(),this.do_leave_program(),"function"==typeof SAEV_config.hook.event.stopped&&SAEV_config.hook.event.stopped()},this.pause_program=function(e){this.audio.pauseResume(e),this.events.pauseResume(e),"function"==typeof SAEV_config.hook.event.paused&&SAEV_config.hook.event.paused(e)},this.getVersion=function(e){return e?sprintf("%d.%d.%d",SAEC_Version,SAEC_Revision,SAEC_Patch):[SAEC_Version,SAEC_Revision,SAEC_Patch]},this.getInfo=function(){return SAEC_info},this.getConfig=function(){return SAEV_config},this.setDefaults=function(){return this.config.setDefaults()},this.setModel=function(e,t){return this.config.setModel(e,t)},this.setMountInfoDefaults=function(e){e=SAEV_config.mount.config[e].ci;this.filesys.uci_set_defaults(e,!1)},this.start=function(){if(SAER.running)return SAEF_warn("sae.start() emulation already running"),SAEE_AlreadyRunning;var e;if(SAEF_info("sae.start() starting..."),(e=this.config.setup())!=SAEE_None)return e;if((e=this.video.obtain())!=SAEE_None)return e;if((e=this.audio.obtain())!=SAEE_None)return e;if((e=this.input.setup())!=SAEE_None)return e;if((e=this.gui.setup())!=SAEE_None)return e;if(this.memory.hardreset(2),(e=this.memory.reset(!0))==SAEE_None&&(this.custom.setup(),this.blitter.setup(),this.playfield.setup(),this.disk.setup(),this.events.reset_frame_rate_hack(),(e=this.m68k.setup())==SAEE_None&&(e=this.video.setup(!0))==SAEE_None)){if((e=this.audio.setup())==SAEE_None)return this.start_program(),SAEF_info("sae.start() ...done"),SAEE_None;this.video.cleanup()}return this.input.cleanup(),SAEF_error("sae.start() ...error %d",e),e},this.stop=function(){return this.running?(SAEF_info("sae.stop()"),SAEV_command!=-SAEC_command_Quit&&(SAEV_command=-SAEC_command_Quit),SAEE_None):(SAEF_warn("sae.stop() emulation not running"),SAEE_NotRunning)},this.reset=function(e,t){return void 0===e&&(e=!1),void 0===t&&(t=!1),this.running?(SAEF_info("sae.reset() hard %d, keyboard %d",e?1:0,t?1:0),0==SAEV_command&&(SAEV_command=-SAEC_command_Reset,t&&(SAEV_command=-SAEC_command_KeyboardReset),e&&(SAEV_command=-SAEC_command_HardReset)),SAEE_None):(SAEF_warn("sae.reset() emulation not running"),SAEE_NotRunning)},this.pause=function(e){return this.running?(!this.paused&&e?(SAEF_info("sae.pause() pausing emulation"),SAEV_command=SAEC_command_Pause):this.paused&&!e&&(SAEF_info("sae.pause() resuming emulation"),SAEV_command=SAEC_command_Resume),SAEE_None):(SAEF_warn("sae.pause() emulation not running"),SAEE_NotRunning)},this.mute=function(e){return this.running?(this.audio.mute(e),SAEF_log(e?"sae.mute() audio muted":"sae.mute() playing audio"),SAEE_None):(SAEF_warn("sae.mute() emulation not running"),SAEE_NotRunning)},this.screen=function(e){return this.running?SAEC_info.video.requestFullScreen?(this.video.screen(e),SAEF_log(e?"sae.screen() screen-mode":"sae.screen() window-mode"),SAEE_None):(SAEF_error("sae.screen() screen-api not supported"),SAEE_Video_RequiresFullscreen):(SAEF_warn("sae.screen() emulation not running"),SAEE_NotRunning)},this.insert=function(e){if(this.running){var t=SAEV_config.floppy.drive[e].file;return this.disk.insert(e,t),SAEF_info("sae.insert() unit %d inserted, name '%s', size %d, protected %d",e,t.name,t.size,t.prot?1:0),SAEE_None}return SAEF_warn("sae.insert() emulation not running"),SAEE_NotRunning},this.eject=function(e){return this.running?(this.disk.eject(e),SAEF_info("sae.eject() unit %d ejected",e),SAEE_None):(SAEF_warn("sae.eject() emulation not running"),SAEE_NotRunning)},this.getRomInfo=function(e,t){return this.roms.examine(e,t)},this.getDiskInfo=function(e,t){return this.disk.examine(e,t)},this.createDisk=function(e,t,n,r,i,a,o){return this.disk.create(e,t,n,r,i,a,o)?SAEE_None:SAEE_NoMemory},this.keyPress=function(e,t){return this.input.keyPress(e,t),SAEE_None},SAEF_info("SAE %d.%d.%d",SAEC_Version,SAEC_Revision,SAEC_Patch)}function guiButton(e,t,n=!0,r){var i,a="string"==typeof e||e instanceof String?s(e):e,o="guiBtn-pressed";function c(){return!a.classList.contains("disabled")}null!=r&&(o=r),a.addEventListener("touchstart",e=>{c()&&(i=!0,n&&a.classList.add(o))}),a.addEventListener("touchmove",e=>{c()&&(document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY)!=e.target?i&&(i=!1,n&&a.classList.remove(o)):i||(i=!0,n&&a.classList.add(o)))}),a.addEventListener("touchcancel",e=>{e.preventDefault(),c()&&(i=!1,n&&a.classList.remove(o))}),a.addEventListener("touchend",e=>{e.preventDefault(),c()&&(i&&t(),n&&a.classList.remove(o))})}function domReady(e){document.addEventListener("DOMContentLoaded",e),"interactive"!==document.readyState&&"complete"!==document.readyState||e()}function s(e){return document.querySelector(e)}function insert(e,t){(e="string"==typeof e||e instanceof String?s(e):e).insertAdjacentHTML("beforeend",t)}function show(e,t){null==t&&(t="block"),s(e).style.display=t}function hide(e){s(e).style.display="none"}function toggle(e){"block"!==window.getComputedStyle(e).display?e.style.display="block":e.style.display="none"}function isStandalone(){return"standalone"in window.navigator&&window.navigator.standalone}!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Dexie=t()}(this,function(){"use strict";var S=function(){return(S=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function k(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r}var g=Object.keys,l=Array.isArray,u="undefined"!=typeof self?self:"undefined"!=typeof window?window:global;function s(t,n){return"object"!=typeof n||g(n).forEach(function(e){t[e]=n[e]}),t}"undefined"==typeof Promise||u.Promise||(u.Promise=Promise);var r=Object.getPrototypeOf,n={}.hasOwnProperty;function m(e,t){return n.call(e,t)}function i(t,n){"function"==typeof n&&(n=n(r(t))),g(n).forEach(function(e){c(t,e,n[e])})}var o=Object.defineProperty;function c(e,t,n,r){o(e,t,s(n&&m(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function a(t){return{from:function(e){return t.prototype=Object.create(e.prototype),c(t.prototype,"constructor",t),{extend:i.bind(null,t.prototype)}}}}var _=Object.getOwnPropertyDescriptor;function f(e,t){return _(e,t)||(e=r(e))&&f(e,t)}var d=[].slice;function p(e,t,n){return d.call(e,t,n)}function E(e,t){return t(e)}function A(e){if(!e)throw new Error("Assertion Failed")}function h(e){u.setImmediate?setImmediate(e):setTimeout(e,0)}function y(e,r){return e.reduce(function(e,t,n){n=r(t,n);return n&&(e[n[0]]=n[1]),e},{})}function v(e,t){if(m(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,i=t.length;r<i;++r){var a=v(e,t[r]);n.push(a)}return n}var o=t.indexOf(".");if(-1!==o){var s=e[t.substr(0,o)];return void 0===s?void 0:v(s,t.substr(o+1))}}function b(e,t,n){if(e&&void 0!==t&&!("isFrozen"in Object&&Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){A("string"!=typeof n&&"length"in n);for(var r=0,i=t.length;r<i;++r)b(e,t[r],n[r])}else{var a,o=t.indexOf(".");-1!==o?(a=t.substr(0,o),""===(o=t.substr(o+1))?void 0===n?l(e)&&!isNaN(parseInt(a))?e.splice(a,1):delete e[a]:e[a]=n:b(e[a]||(e[a]={}),o,n)):void 0===n?l(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function C(t,e){"string"==typeof e?b(t,e,void 0):"length"in e&&[].map.call(e,function(e){b(t,e,void 0)})}function R(e){var t,n={};for(t in e)m(e,t)&&(n[t]=e[t]);return n}var t=[].concat;function w(e){return t.apply([],e)}var e="Boolean,String,Date,RegExp,Blob,File,FileList,ArrayBuffer,DataView,Uint8ClampedArray,ImageData,Map,Set".split(",").concat(w([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(e){return e+t+"Array"})}))).filter(function(e){return u[e]}),x=e.map(function(e){return u[e]}),D=y(e,function(e){return[e,!0]});function M(e){if(!e||"object"!=typeof e)return e;if(l(e))for(var t=[],n=0,r=e.length;n<r;++n)t.push(M(e[n]));else if(0<=x.indexOf(e.constructor))t=e;else for(var i in t=e.constructor?Object.create(e.constructor.prototype):{},e)m(e,i)&&(t[i]=M(e[i]));return t}var F={}.toString;function T(e){return F.call(e).slice(8,-1)}var V=function(e,t){return"Array"===t?""+e.map(function(e){return V(e,T(e))}):"ArrayBuffer"===t?""+new Uint8Array(e):"Date"===t?e.getTime():ArrayBuffer.isView(e)?""+new Uint8Array(e.buffer):e};function I(a,o,s,c){return s=s||{},c=c||"",g(a).forEach(function(e){var t,n,r,i;m(o,e)?(t=a[e],n=o[e],"object"==typeof t&&"object"==typeof n&&t&&n?(r=T(t))===(i=T(n))?D[r]?V(t,r)!==V(n,i)&&(s[c+e]=o[e]):I(t,n,s,c+e+"."):s[c+e]=o[e]:t!==n&&(s[c+e]=o[e])):s[c+e]=void 0}),g(o).forEach(function(e){m(a,e)||(s[c+e]=o[e])}),s}var P="undefined"!=typeof Symbol&&Symbol.iterator,z=P?function(e){var t;return null!=e&&(t=e[P])&&t.apply(e)}:function(){return null},O={};function L(e){var t,n,r,i;if(1===arguments.length){if(l(e))return e.slice();if(this===O&&"string"==typeof e)return[e];if(i=z(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"!=typeof(t=e.length))return[e];for(n=new Array(t);t--;)n[t]=e[t];return n}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var N="undefined"!=typeof Symbol?function(e){return"AsyncFunction"===e[Symbol.toStringTag]}:function(){return!1},B="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function U(e,t){B=e,K=t}var K=function(){return!0},G=!new Error("").stack;function H(){if(G)try{throw new Error}catch(e){return e}return new Error}function X(e,t){var n=e.stack;return n?(t=t||0,0===n.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),n.split("\n").slice(t).filter(K).map(function(e){return"\n"+e}).join("")):""}var q=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Z=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(q),j={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed"};function Y(e,t){this._e=H(),this.name=e,this.message=t}function W(e,t){return e+". Errors: "+Object.keys(t).map(function(e){return t[e].toString()}).filter(function(e,t,n){return n.indexOf(e)===t}).join("\n")}function J(e,t,n,r){this._e=H(),this.failures=t,this.failedKeys=r,this.successCount=n,this.message=W(e,t)}function Q(e,t){this._e=H(),this.name="BulkError",this.failures=t,this.message=W(e,t)}a(Y).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+X(this._e,2))}},toString:function(){return this.name+": "+this.message}}),a(J).from(Y),a(Q).from(Y);var e=Z.reduce(function(e,t){return e[t]=t+"Error",e},{}),$=Y,ee=Z.reduce(function(e,n){var r=n+"Error";function t(e,t){this._e=H(),this.name=r,e?"string"==typeof e?(this.message=e+(t?"\n "+t:""),this.inner=t||null):"object"==typeof e&&(this.message=e.name+" "+e.message,this.inner=e):(this.message=j[n]||r,this.inner=null)}return a(t).from($),e[n]=t,e},{});ee.Syntax=SyntaxError,ee.Type=TypeError,ee.Range=RangeError;var te=q.reduce(function(e,t){return e[t+"Error"]=ee[t],e},{});q=Z.reduce(function(e,t){return-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=ee[t]),e},{});function ne(){}function re(e){return e}function ie(t,n){return null==t||t===re?n:function(e){return n(t(e))}}function ae(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function oe(i,a){return i===ne?a:function(){var e=i.apply(this,arguments);void 0!==e&&(arguments[0]=e);var t=this.onsuccess,n=this.onerror;this.onsuccess=null,this.onerror=null;var r=a.apply(this,arguments);return t&&(this.onsuccess=this.onsuccess?ae(t,this.onsuccess):t),n&&(this.onerror=this.onerror?ae(n,this.onerror):n),void 0!==r?r:e}}function se(n,r){return n===ne?r:function(){n.apply(this,arguments);var e=this.onsuccess,t=this.onerror;this.onsuccess=this.onerror=null,r.apply(this,arguments),e&&(this.onsuccess=this.onsuccess?ae(e,this.onsuccess):e),t&&(this.onerror=this.onerror?ae(t,this.onerror):t)}}function ce(i,a){return i===ne?a:function(e){var t=i.apply(this,arguments);s(e,t);var n=this.onsuccess,r=this.onerror;this.onsuccess=null,this.onerror=null;e=a.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?ae(n,this.onsuccess):n),r&&(this.onerror=this.onerror?ae(r,this.onerror):r),void 0===t?void 0===e?void 0:e:s(t,e)}}function _e(e,t){return e===ne?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function fe(i,a){return i===ne?a:function(){var e=i.apply(this,arguments);if(e&&"function"==typeof e.then){for(var t=this,n=arguments.length,r=new Array(n);n--;)r[n]=arguments[n];return e.then(function(){return a.apply(t,r)})}return a.apply(this,arguments)}}q.ModifyError=J,q.DexieError=Y,q.BulkError=Q;var le={},ue=100,de=100,Z="undefined"==typeof Promise?[]:function(){var e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,e.__proto__,e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,t.__proto__,e]}(),pe=Z[0],Ee=Z[1],Ae=Z[2],Se=Ee&&Ee.then,me=pe&&pe.constructor,he=!!Ae,ge=!1,ye=Ae?function(){Ae.then(Ke)}:u.setImmediate?setImmediate.bind(null,Ke):u.MutationObserver?function(){var e=document.createElement("div");new MutationObserver(function(){Ke(),e=null}).observe(e,{attributes:!0}),e.setAttribute("i","1")}:function(){setTimeout(Ke,0)},ve=function(e,t){Fe.push([e,t]),Ce&&(ye(),Ce=!1)},be=!0,Ce=!0,ke=[],Re=[],we=null,xe=re,De={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ut,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(e){try{ut(e[0],e[1])}catch(e){}})}},Me=De,Fe=[],Te=0,Ve=[];function Ie(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=ne,this._lib=!1;var t=this._PSD=Me;if(B&&(this._stackHolder=H(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==le)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Oe(this,this._value))}this._state=null,this._value=null,++t.ref,function t(r,e){try{e(function(n){if(null===r._state){if(n===r)throw new TypeError("A promise cannot be resolved with itself.");var e=r._lib&&Ge();n&&"function"==typeof n.then?t(r,function(e,t){n instanceof Ie?n._then(e,t):n.then(e,t)}):(r._state=!0,r._value=n,Le(r)),e&&He()}},Oe.bind(null,r))}catch(e){Oe(r,e)}}(this,e)}var Pe={get:function(){var s=Me,t=Qe;function e(n,r){var i=this,a=!s.global&&(s!==Me||t!==Qe),o=a&&!nt(),e=new Ie(function(e,t){Ne(i,new ze(_t(n,s,a,o),_t(r,s,a,o),e,t,s))});return B&&Ue(e,this),e}return e.prototype=le,e},set:function(e){c(this,"then",e&&e.prototype===le?Pe:{get:function(){return e},set:Pe.set})}};function ze(e,t,n,r,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=i}function Oe(t,n){var e,r;Re.push(n),null===t._state&&(e=t._lib&&Ge(),n=xe(n),t._state=!1,t._value=n,B&&null!==n&&"object"==typeof n&&!n._promise&&function(e,t,n){try{e.apply(null,n)}catch(e){t&&t(e)}}(function(){var e=f(n,"stack");n._promise=t,c(n,"stack",{get:function(){return ge?e&&(e.get?e.get.apply(n):e.value):t.stack}})}),r=t,ke.some(function(e){return e._value===r._value})||ke.push(r),Le(t),e&&He())}function Le(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)Ne(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),0===Te&&(++Te,ve(function(){0==--Te&&Xe()},[]))}function Ne(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Te,ve(Be,[n,e,t])}else e._listeners.push(t)}function Be(e,t,n){try{var r,i=(we=t)._value;t._state?r=e(i):(Re.length&&(Re=[]),r=e(i),-1===Re.indexOf(i)&&function(e){var t=ke.length;for(;t;)if(ke[--t]._value===e._value)return ke.splice(t,1)}(t)),n.resolve(r)}catch(e){n.reject(e)}finally{we=null,0==--Te&&Xe(),--n.psd.ref||n.psd.finalize()}}function Ue(e,t){var n=t?t._numPrev+1:0;n<ue&&(e._prev=t,e._numPrev=n)}function Ke(){Ge()&&He()}function Ge(){var e=be;return Ce=be=!1,e}function He(){var e,t,n;do{for(;0<Fe.length;)for(e=Fe,Fe=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(0<Fe.length);Ce=be=!0}function Xe(){var e=ke;ke=[],e.forEach(function(e){e._PSD.onunhandled.call(null,e._value,e)});for(var t=Ve.slice(0),n=t.length;n;)t[--n]()}function qe(e){return new Ie(le,!1,e)}function Ze(n,r){var i=Me;return function(){var e=Ge(),t=Me;try{return at(i,!0),n.apply(this,arguments)}catch(e){r&&r(e)}finally{at(t,!1),e&&He()}}}i(Ie.prototype,{then:Pe,_then:function(e,t){Ne(this,new ze(null,null,e,t,Me))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=e,n=arguments[1];return"function"==typeof t?this.then(null,function(e){return(e instanceof t?n:qe)(e)}):this.then(null,function(e){return(e&&e.name===t?n:qe)(e)})},finally:function(t){return this.then(function(e){return t(),e},function(e){return t(),qe(e)})},stack:{get:function(){if(this._stack)return this._stack;try{ge=!0;var e=function e(t,n,r){if(n.length===r)return n;var i="";{var a,o,s;!1===t._state&&(null!=(a=t._value)?(o=a.name||"Error",s=a.message||a,i=X(a,0)):(o=a,s=""),n.push(o+(s?": "+s:"")+i))}B&&((i=X(t._stackHolder,2))&&-1===n.indexOf(i)&&n.push(i),t._prev&&e(t._prev,n,r));return n}(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{ge=!1}}},timeout:function(r,i){var a=this;return r<1/0?new Ie(function(e,t){var n=setTimeout(function(){return t(new ee.Timeout(i))},r);a.then(e,t).finally(clearTimeout.bind(null,n))}):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&c(Ie.prototype,Symbol.toStringTag,"Dexie.Promise"),De.env=ot(),i(Ie,{all:function(){var a=L.apply(null,arguments).map(rt);return new Ie(function(n,r){0===a.length&&n([]);var i=a.length;a.forEach(function(e,t){return Ie.resolve(e).then(function(e){a[t]=e,--i||n(a)},r)})})},resolve:function(n){if(n instanceof Ie)return n;if(n&&"function"==typeof n.then)return new Ie(function(e,t){n.then(e,t)});var e=new Ie(le,!0,n);return Ue(e,we),e},reject:qe,race:function(){var e=L.apply(null,arguments).map(rt);return new Ie(function(t,n){e.map(function(e){return Ie.resolve(e).then(t,n)})})},PSD:{get:function(){return Me},set:function(e){return Me=e}},totalEchoes:{get:function(){return Qe}},newPSD:et,usePSD:st,scheduler:{get:function(){return ve},set:function(e){ve=e}},rejectionMapper:{get:function(){return xe},set:function(e){xe=e}},follow:function(i,n){return new Ie(function(e,t){return et(function(n,r){var e=Me;e.unhandleds=[],e.onunhandled=r,e.finalize=ae(function(){var t,e=this;t=function(){0===e.unhandleds.length?n():r(e.unhandleds[0])},Ve.push(function e(){t(),Ve.splice(Ve.indexOf(e),1)}),++Te,ve(function(){0==--Te&&Xe()},[])},e.finalize),i()},n,e,t)})}}),me&&(me.allSettled&&c(Ie,"allSettled",function(){var e=L.apply(null,arguments).map(rt);return new Ie(function(n){0===e.length&&n([]);var r=e.length,i=new Array(r);e.forEach(function(e,t){return Ie.resolve(e).then(function(e){return i[t]={status:"fulfilled",value:e}},function(e){return i[t]={status:"rejected",reason:e}}).then(function(){return--r||n(i)})})})}),me.any&&"undefined"!=typeof AggregateError&&c(Ie,"any",function(){var e=L.apply(null,arguments).map(rt);return new Ie(function(n,r){0===e.length&&r(new AggregateError([]));var i=e.length,a=new Array(i);e.forEach(function(e,t){return Ie.resolve(e).then(function(e){return n(e)},function(e){a[t]=e,--i||r(new AggregateError(a))})})})}));var je={awaits:0,echoes:0,id:0},Ye=0,We=[],Je=0,Qe=0,$e=0;function et(e,t,n,r){var i=Me,a=Object.create(i);a.parent=i,a.ref=0,a.global=!1,a.id=++$e;var o=De.env;a.env=he?{Promise:Ie,PromiseProp:{value:Ie,configurable:!0,writable:!0},all:Ie.all,race:Ie.race,allSettled:Ie.allSettled,any:Ie.any,resolve:Ie.resolve,reject:Ie.reject,nthen:ft(o.nthen,a),gthen:ft(o.gthen,a)}:{},t&&s(a,t),++i.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()};r=st(a,e,n,r);return 0===a.ref&&a.finalize(),r}function tt(){return je.id||(je.id=++Ye),++je.awaits,je.echoes+=de,je.id}function nt(){return!!je.awaits&&(0==--je.awaits&&(je.id=0),je.echoes=je.awaits*de,!0)}function rt(e){return je.echoes&&e&&e.constructor===me?(tt(),e.then(function(e){return nt(),e},function(e){return nt(),dt(e)})):e}function it(){var e=We[We.length-1];We.pop(),at(e,!1)}function at(e,t){var n,r=Me;(t?!je.echoes||Je++&&e===Me:!Je||--Je&&e===Me)||ct(t?function(e){++Qe,je.echoes&&0!=--je.echoes||(je.echoes=je.id=0),We.push(Me),at(e,!0)}.bind(null,e):it),e!==Me&&(Me=e,r===De&&(De.env=ot()),he&&(n=De.env.Promise,t=e.env,Ee.then=t.nthen,n.prototype.then=t.gthen,(r.global||e.global)&&(Object.defineProperty(u,"Promise",t.PromiseProp),n.all=t.all,n.race=t.race,n.resolve=t.resolve,n.reject=t.reject,t.allSettled&&(n.allSettled=t.allSettled),t.any&&(n.any=t.any))))}function ot(){var e=u.Promise;return he?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(u,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:Ee.then,gthen:e.prototype.then}:{}}function st(e,t,n,r,i){var a=Me;try{return at(e,!0),t(n,r,i)}finally{at(a,!1)}}function ct(e){Se.call(pe,e)}function _t(t,n,r,i){return"function"!=typeof t?t:function(){var e=Me;r&&tt(),at(n,!0);try{return t.apply(this,arguments)}finally{at(e,!1),i&&ct(nt)}}}function ft(n,r){return function(e,t){return n.call(this,_t(e,r),_t(t,r))}}-1===(""+Se).indexOf("[native code]")&&(tt=nt=ne);var lt="unhandledrejection";function ut(e,t){var n;try{n=t.onuncatched(e)}catch(e){}if(!1!==n)try{var r,i={promise:t,reason:e};if(u.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(lt,!0,!0),s(r,i)):u.CustomEvent&&s(r=new CustomEvent(lt,{detail:i}),i),r&&u.dispatchEvent&&(dispatchEvent(r),!u.PromiseRejectionEvent&&u.onunhandledrejection))try{u.onunhandledrejection(r)}catch(e){}B&&r&&!r.defaultPrevented&&console.warn("Unhandled rejection: "+(e.stack||e))}catch(e){}}var dt=Ie.reject;function pt(e){return!/(dexie\.js|dexie\.min\.js)/.test(e)}var Et=String.fromCharCode(65535),At="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",St="String expected.",mt=[],ht="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),gt=ht,yt=ht,vt="__dbnames",bt="readonly",Ct="readwrite";function kt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var Rt={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function wt(t){return function(e){return void 0===v(e,t)&&C(e=M(e),t),e}}var xt=(Dt.prototype._trans=function(e,r,t){var n=this._tx||Me.trans,i=this.name;function a(e,t,n){if(!n.schema[i])throw new ee.NotFound("Table "+i+" not part of transaction");return r(n.idbtrans,n)}var o=Ge();try{return n&&n.db===this.db?n===Me.trans?n._promise(e,a,t):et(function(){return n._promise(e,a,t)},{trans:n,transless:Me.transless||Me}):function e(t,n,r,i){if(t._state.openComplete||Me.letThrough){var a=t._createTransaction(n,r,t._dbSchema);try{a.create()}catch(e){return dt(e)}return a._promise(n,function(e,t){return et(function(){return Me.trans=a,i(e,t,a)})}).then(function(e){return a._completion.then(function(){return e})})}if(!t._state.isBeingOpened){if(!t._options.autoOpen)return dt(new ee.DatabaseClosed);t.open().catch(ne)}return t._state.dbReadyPromise.then(function(){return e(t,n,r,i)})}(this.db,e,[this.name],a)}finally{o&&He()}},Dt.prototype.get=function(t,e){var n=this;return t&&t.constructor===Object?this.where(t).first(e):this._trans("readonly",function(e){return n.core.get({trans:e,key:t}).then(function(e){return n.hook.reading.fire(e)})}).then(e)},Dt.prototype.where=function(a){if("string"==typeof a)return new this.db.WhereClause(this,a);if(l(a))return new this.db.WhereClause(this,"["+a.join("+")+"]");var n=g(a);if(1===n.length)return this.where(n[0]).equals(a[n[0]]);var e=this.schema.indexes.concat(this.schema.primKey).filter(function(t){return t.compound&&n.every(function(e){return 0<=t.keyPath.indexOf(e)})&&t.keyPath.every(function(e){return 0<=n.indexOf(e)})})[0];if(e&&this.db._maxKey!==Et)return this.where(e.name).equals(e.keyPath.map(function(e){return a[e]}));!e&&B&&console.warn("The query "+JSON.stringify(a)+" on "+this.name+" would benefit of a compound index ["+n.join("+")+"]");var o=this.schema.idxByName,r=this.db._deps.indexedDB;function s(e,t){try{return 0===r.cmp(e,t)}catch(e){return!1}}var t=n.reduce(function(e,t){var n=e[0],r=e[1],e=o[t],i=a[t];return[n||e,n||!e?kt(r,e&&e.multi?function(e){e=v(e,t);return l(e)&&e.some(function(e){return s(i,e)})}:function(e){return s(i,v(e,t))}):r]},[null,null]),i=t[0],t=t[1];return i?this.where(i.name).equals(a[i.keyPath]).filter(t):e?this.filter(t):this.where(n).equals("")},Dt.prototype.filter=function(e){return this.toCollection().and(e)},Dt.prototype.count=function(e){return this.toCollection().count(e)},Dt.prototype.offset=function(e){return this.toCollection().offset(e)},Dt.prototype.limit=function(e){return this.toCollection().limit(e)},Dt.prototype.each=function(e){return this.toCollection().each(e)},Dt.prototype.toArray=function(e){return this.toCollection().toArray(e)},Dt.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Dt.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,l(e)?"["+e.join("+")+"]":e))},Dt.prototype.reverse=function(){return this.toCollection().reverse()},Dt.prototype.mapToClass=function(r){this.schema.mappedClass=r;function e(e){if(!e)return e;var t,n=Object.create(r.prototype);for(t in e)if(m(e,t))try{n[t]=e[t]}catch(e){}return n}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=e,this.hook("reading",e),r},Dt.prototype.defineClass=function(){return this.mapToClass(function(e){s(this,e)})},Dt.prototype.add=function(t,n){var r=this,e=this.schema.primKey,i=e.auto,a=e.keyPath,o=t;return a&&i&&(o=wt(a)(t)),this._trans("readwrite",function(e){return r.core.mutate({trans:e,type:"add",keys:null!=n?[n]:null,values:[o]})}).then(function(e){return e.numFailures?Ie.reject(e.failures[0]):e.lastResult}).then(function(e){if(a)try{b(t,a,e)}catch(e){}return e})},Dt.prototype.update=function(t,n){if("object"!=typeof n||l(n))throw new ee.InvalidArgument("Modifications must be an object.");if("object"!=typeof t||l(t))return this.where(":id").equals(t).modify(n);g(n).forEach(function(e){b(t,e,n[e])});var e=v(t,this.schema.primKey.keyPath);return void 0===e?dt(new ee.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(n)},Dt.prototype.put=function(t,n){var r=this,e=this.schema.primKey,i=e.auto,a=e.keyPath,o=t;return a&&i&&(o=wt(a)(t)),this._trans("readwrite",function(e){return r.core.mutate({trans:e,type:"put",values:[o],keys:null!=n?[n]:null})}).then(function(e){return e.numFailures?Ie.reject(e.failures[0]):e.lastResult}).then(function(e){if(a)try{b(t,a,e)}catch(e){}return e})},Dt.prototype.delete=function(t){var n=this;return this._trans("readwrite",function(e){return n.core.mutate({trans:e,type:"delete",keys:[t]})}).then(function(e){return e.numFailures?Ie.reject(e.failures[0]):void 0})},Dt.prototype.clear=function(){var t=this;return this._trans("readwrite",function(e){return t.core.mutate({trans:e,type:"deleteRange",range:Rt})}).then(function(e){return e.numFailures?Ie.reject(e.failures[0]):void 0})},Dt.prototype.bulkGet=function(t){var n=this;return this._trans("readonly",function(e){return n.core.getMany({keys:t,trans:e}).then(function(e){return e.map(function(e){return n.hook.reading.fire(e)})})})},Dt.prototype.bulkAdd=function(r,e,t){var o=this,i=Array.isArray(e)?e:void 0,s=(t=t||(i?void 0:e))?t.allKeys:void 0;return this._trans("readwrite",function(e){var t=o.schema.primKey,n=t.auto,t=t.keyPath;if(t&&i)throw new ee.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==r.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");var a=r.length,t=t&&n?r.map(wt(t)):r;return o.core.mutate({trans:e,type:"add",keys:i,values:t,wantResults:s}).then(function(e){var t=e.numFailures,n=e.results,r=e.lastResult,i=e.failures;if(0===t)return s?n:r;throw new Q(o.name+".bulkAdd(): "+t+" of "+a+" operations failed",Object.keys(i).map(function(e){return i[e]}))})})},Dt.prototype.bulkPut=function(r,e,t){var o=this,i=Array.isArray(e)?e:void 0,s=(t=t||(i?void 0:e))?t.allKeys:void 0;return this._trans("readwrite",function(e){var t=o.schema.primKey,n=t.auto,t=t.keyPath;if(t&&i)throw new ee.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==r.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");var a=r.length,t=t&&n?r.map(wt(t)):r;return o.core.mutate({trans:e,type:"put",keys:i,values:t,wantResults:s}).then(function(e){var t=e.numFailures,n=e.results,r=e.lastResult,i=e.failures;if(0===t)return s?n:r;throw new Q(o.name+".bulkPut(): "+t+" of "+a+" operations failed",Object.keys(i).map(function(e){return i[e]}))})})},Dt.prototype.bulkDelete=function(t){var r=this,i=t.length;return this._trans("readwrite",function(e){return r.core.mutate({trans:e,type:"delete",keys:t})}).then(function(e){var t=e.numFailures,n=e.lastResult,e=e.failures;if(0===t)return n;throw new Q(r.name+".bulkDelete(): "+t+" of "+i+" operations failed",e)})},Dt);function Dt(){}function Mt(i){var o={},t=function(e,t){if(t){for(var n=arguments.length,r=new Array(n-1);--n;)r[n-1]=arguments[n];return o[e].subscribe.apply(null,r),i}if("string"==typeof e)return o[e]};t.addEventType=s;for(var e=1,n=arguments.length;e<n;++e)s(arguments[e]);return t;function s(e,n,r){if("object"!=typeof e){var i;n=n||_e;var a={subscribers:[],fire:r=r||ne,subscribe:function(e){-1===a.subscribers.indexOf(e)&&(a.subscribers.push(e),a.fire=n(a.fire,e))},unsubscribe:function(t){a.subscribers=a.subscribers.filter(function(e){return e!==t}),a.fire=a.subscribers.reduce(n,r)}};return o[e]=t[e]=a}g(i=e).forEach(function(e){var t=i[e];if(l(t))s(e,i[e][0],i[e][1]);else{if("asap"!==t)throw new ee.InvalidArgument("Invalid event config");var n=s(e,re,function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];n.subscribers.forEach(function(e){h(function(){e.apply(null,t)})})})}})}}function Ft(e,t){return a(t).from({prototype:e}),t}function Tt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Vt(e,t){e.filter=kt(e.filter,t)}function It(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return kt(r(),t())}:t,e.justLimit=n&&!r}function Pt(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new ee.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function zt(e,t,n){var r=Pt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function Ot(e,a,t,n){var o=e.replayFilter?kt(e.filter,e.replayFilter()):e.filter;if(e.or){var s={},r=function(e,t,n){var r,i;o&&!o(t,n,function(e){return t.stop(e)},function(e){return t.fail(e)})||("[object ArrayBuffer]"===(i=""+(r=t.primaryKey))&&(i=""+new Uint8Array(r)),m(s,i)||(s[i]=!0,a(e,t,n)))};return Promise.all([e.or._iterate(r,t),Lt(zt(e,n,t),e.algorithm,r,!e.keysOnly&&e.valueMapper)])}return Lt(zt(e,n,t),kt(e.algorithm,o),a,!e.keysOnly&&e.valueMapper)}function Lt(e,r,i,a){var o=Ze(a?function(e,t,n){return i(a(e),t,n)}:i);return e.then(function(n){if(n)return n.start(function(){var t=function(){return n.continue()};r&&!r(n,function(e){return t=e},function(e){n.stop(e),t=ne},function(e){n.fail(e),t=ne})||o(n.value,n,function(e){return t=e}),t()})})}var Nt=(Bt.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,dt.bind(null,n.error)):n.table._trans("readonly",e).then(t)},Bt.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,dt.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},Bt.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=kt(t.algorithm,e)},Bt.prototype._iterate=function(e,t){return Ot(this._ctx,e,t,this._ctx.table.core)},Bt.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&s(n,e),t._ctx=n,t},Bt.prototype.raw=function(){return this._ctx.valueMapper=null,this},Bt.prototype.each=function(t){var n=this._ctx;return this._read(function(e){return Ot(n,t,e,n.table.core)})},Bt.prototype.count=function(e){var i=this;return this._read(function(e){var t=i._ctx,n=t.table.core;if(Tt(t,!0))return n.count({trans:e,query:{index:Pt(t,n.schema),range:t.range}}).then(function(e){return Math.min(e,t.limit)});var r=0;return Ot(t,function(){return++r,!1},e,n).then(function(){return r})}).then(e)},Bt.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),r=n[0],i=n.length-1;function a(e,t){return t?a(e[n[t]],t-1):e[r]}var o="next"===this._ctx.dir?1:-1;function s(e,t){e=a(e,i),t=a(t,i);return e<t?-o:t<e?o:0}return this.toArray(function(e){return e.sort(s)}).then(t)},Bt.prototype.toArray=function(e){var a=this;return this._read(function(e){var t=a._ctx;if("next"===t.dir&&Tt(t,!0)&&0<t.limit){var n=t.valueMapper,r=Pt(t,t.table.core.schema);return t.table.core.query({trans:e,limit:t.limit,values:!0,query:{index:r,range:t.range}}).then(function(e){e=e.result;return n?e.map(n):e})}var i=[];return Ot(t,function(e){return i.push(e)},e,t.table.core).then(function(){return i})},e)},Bt.prototype.offset=function(t){var e=this._ctx;return t<=0||(e.offset+=t,Tt(e)?It(e,function(){var n=t;return function(e,t){return 0===n||(1===n?--n:t(function(){e.advance(n),n=0}),!1)}}):It(e,function(){var e=t;return function(){return--e<0}})),this},Bt.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),It(this._ctx,function(){var r=e;return function(e,t,n){return--r<=0&&t(n),0<=r}},!0),this},Bt.prototype.until=function(r,i){return Vt(this._ctx,function(e,t,n){return!r(e.value)||(t(n),i)}),this},Bt.prototype.first=function(e){return this.limit(1).toArray(function(e){return e[0]}).then(e)},Bt.prototype.last=function(e){return this.reverse().first(e)},Bt.prototype.filter=function(t){var e;return Vt(this._ctx,function(e){return t(e.value)}),(e=this._ctx).isMatch=kt(e.isMatch,t),this},Bt.prototype.and=function(e){return this.filter(e)},Bt.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},Bt.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Bt.prototype.desc=function(){return this.reverse()},Bt.prototype.eachKey=function(n){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(e,t){n(t.key,t)})},Bt.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},Bt.prototype.eachPrimaryKey=function(n){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(e,t){n(t.primaryKey,t)})},Bt.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each(function(e,t){n.push(t.key)}).then(function(){return n}).then(e)},Bt.prototype.primaryKeys=function(e){var n=this._ctx;if("next"===n.dir&&Tt(n,!0)&&0<n.limit)return this._read(function(e){var t=Pt(n,n.table.core.schema);return n.table.core.query({trans:e,values:!1,limit:n.limit,query:{index:t,range:n.range}})}).then(function(e){return e.result}).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(e,t){r.push(t.primaryKey)}).then(function(){return r}).then(e)},Bt.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},Bt.prototype.firstKey=function(e){return this.limit(1).keys(function(e){return e[0]}).then(e)},Bt.prototype.lastKey=function(e){return this.reverse().firstKey(e)},Bt.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var n={};return Vt(this._ctx,function(e){var t=e.primaryKey.toString(),e=m(n,t);return n[t]=!0,!e}),this},Bt.prototype.modify=function(_){var n=this,r=this._ctx;return this._write(function(u){var a,o,d;d="function"==typeof _?_:(a=g(_),o=a.length,function(e){for(var t=!1,n=0;n<o;++n){var r=a[n],i=_[r];v(e,r)!==i&&(b(e,r,i),t=!0)}return t});function p(e,t){var n=t.failures,t=t.numFailures;c+=e-t;for(var r=0,i=g(n);r<i.length;r++){var a=i[r];s.push(n[a])}}var E=r.table.core,e=E.schema.primaryKey,A=e.outbound,S=e.extractKey,m="testmode"in Tn?1:2e3,h=n.db.core.cmp,s=[],c=0,t=[];return n.clone().primaryKeys().then(function(f){var l=function(c){var _=Math.min(m,f.length-c);return E.getMany({trans:u,keys:f.slice(c,c+_)}).then(function(e){for(var n=[],t=[],r=A?[]:null,i=[],a=0;a<_;++a){var o=e[a],s={value:M(o),primKey:f[c+a]};!1!==d.call(s,s.value,s)&&(null==s.value?i.push(f[c+a]):A||0===h(S(o),S(s.value))?(t.push(s.value),A&&r.push(f[c+a])):(i.push(f[c+a]),n.push(s.value)))}return Promise.resolve(0<n.length&&E.mutate({trans:u,type:"add",values:n}).then(function(e){for(var t in e.failures)i.splice(parseInt(t),1);p(n.length,e)})).then(function(e){return 0<t.length&&E.mutate({trans:u,type:"put",keys:r,values:t}).then(function(e){return p(t.length,e)})}).then(function(){return 0<i.length&&E.mutate({trans:u,type:"delete",keys:i}).then(function(e){return p(i.length,e)})}).then(function(){return f.length>c+_&&l(c+m)})})};return l(0).then(function(){if(0<s.length)throw new J("Error modifying one or more objects",s,c,t);return f.length})})})},Bt.prototype.delete=function(){var i=this._ctx,n=i.range;return Tt(i)&&(i.isPrimKey&&!yt||3===n.type)?this._write(function(e){var t=i.table.core.schema.primaryKey,r=n;return i.table.core.count({trans:e,query:{index:t,range:r}}).then(function(n){return i.table.core.mutate({trans:e,type:"deleteRange",range:r}).then(function(e){var t=e.failures,e=(e.lastResult,e.results,e.numFailures);if(e)throw new J("Could not delete some values",Object.keys(t).map(function(e){return t[e]}),n-e);return n-e})})}):this.modify(function(e,t){return t.value=null})},Bt);function Bt(){}function Ut(e,t){return e<t?-1:e===t?0:1}function Kt(e,t){return t<e?-1:e===t?0:1}function Gt(e,t,n){e=e instanceof jt?new e.Collection(e):e;return e._ctx.error=new(n||TypeError)(t),e}function Ht(e){return new e.Collection(e,function(){return Zt("")}).limit(0)}function Xt(e,c,n,r){var i,_,f,l,u,d,p,E=n.length;if(!n.every(function(e){return"string"==typeof e}))return Gt(e,St);function t(e){i="next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()},_="next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()},f="next"===e?Ut:Kt;var t=n.map(function(e){return{lower:_(e),upper:i(e)}}).sort(function(e,t){return f(e.lower,t.lower)});l=t.map(function(e){return e.upper}),u=t.map(function(e){return e.lower}),p="next"===(d=e)?"":r}t("next");e=new e.Collection(e,function(){return qt(l[0],u[E-1]+r)});e._ondirectionchange=function(e){t(e)};var A=0;return e._addAlgorithm(function(e,t,n){var r=e.key;if("string"!=typeof r)return!1;var i=_(r);if(c(i,u,A))return!0;for(var a=null,o=A;o<E;++o){var s=function(e,t,n,r,i,a){for(var o=Math.min(e.length,r.length),s=-1,c=0;c<o;++c){var _=t[c];if(_!==r[c])return i(e[c],n[c])<0?e.substr(0,c)+n[c]+n.substr(c+1):i(e[c],r[c])<0?e.substr(0,c)+r[c]+n.substr(c+1):0<=s?e.substr(0,s)+t[s]+n.substr(s+1):null;i(e[c],_)<0&&(s=c)}return o<r.length&&"next"===a?e+n.substr(e.length):o<e.length&&"prev"===a?e.substr(0,n.length):s<0?null:e.substr(0,s)+r[s]+n.substr(s+1)}(r,i,l[o],u[o],f,d);null===s&&null===a?A=o+1:(null===a||0<f(a,s))&&(a=s)}return t(null!==a?function(){e.continue(a+p)}:n),!1}),e}function qt(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function Zt(e){return{type:1,lower:e,upper:e}}var jt=(Object.defineProperty(Yt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!0,configurable:!0}),Yt.prototype.between=function(e,t,n,r){n=!1!==n,r=!0===r;try{return 0<this._cmp(e,t)||0===this._cmp(e,t)&&(n||r)&&(!n||!r)?Ht(this):new this.Collection(this,function(){return qt(e,t,!n,!r)})}catch(e){return Gt(this,At)}},Yt.prototype.equals=function(e){return null==e?Gt(this,At):new this.Collection(this,function(){return Zt(e)})},Yt.prototype.above=function(e){return null==e?Gt(this,At):new this.Collection(this,function(){return qt(e,void 0,!0)})},Yt.prototype.aboveOrEqual=function(e){return null==e?Gt(this,At):new this.Collection(this,function(){return qt(e,void 0,!1)})},Yt.prototype.below=function(e){return null==e?Gt(this,At):new this.Collection(this,function(){return qt(void 0,e,!1,!0)})},Yt.prototype.belowOrEqual=function(e){return null==e?Gt(this,At):new this.Collection(this,function(){return qt(void 0,e)})},Yt.prototype.startsWith=function(e){return"string"!=typeof e?Gt(this,St):this.between(e,e+Et,!0,!0)},Yt.prototype.startsWithIgnoreCase=function(e){return""===e?this.startsWith(e):Xt(this,function(e,t){return 0===e.indexOf(t[0])},[e],Et)},Yt.prototype.equalsIgnoreCase=function(e){return Xt(this,function(e,t){return e===t[0]},[e],"")},Yt.prototype.anyOfIgnoreCase=function(){var e=L.apply(O,arguments);return 0===e.length?Ht(this):Xt(this,function(e,t){return-1!==t.indexOf(e)},e,"")},Yt.prototype.startsWithAnyOfIgnoreCase=function(){var e=L.apply(O,arguments);return 0===e.length?Ht(this):Xt(this,function(t,e){return e.some(function(e){return 0===t.indexOf(e)})},e,Et)},Yt.prototype.anyOf=function(){var t=this,i=L.apply(O,arguments),a=this._cmp;try{i.sort(a)}catch(e){return Gt(this,At)}if(0===i.length)return Ht(this);var e=new this.Collection(this,function(){return qt(i[0],i[i.length-1])});e._ondirectionchange=function(e){a="next"===e?t._ascending:t._descending,i.sort(a)};var o=0;return e._addAlgorithm(function(e,t,n){for(var r=e.key;0<a(r,i[o]);)if(++o===i.length)return t(n),!1;return 0===a(r,i[o])||(t(function(){e.continue(i[o])}),!1)}),e},Yt.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Yt.prototype.noneOf=function(){var e=L.apply(O,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return Gt(this,At)}var t=e.reduce(function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[-1/0,t]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},Yt.prototype.inAnyRange=function(e,t){var a=this,o=this._cmp,s=this._ascending,n=this._descending,c=this._min,_=this._max;if(0===e.length)return Ht(this);if(!e.every(function(e){return void 0!==e[0]&&void 0!==e[1]&&s(e[0],e[1])<=0}))return Gt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ee.InvalidArgument);var r=!t||!1!==t.includeLowers,i=t&&!0===t.includeUppers;var f,l=s;function u(e,t){return l(e[0],t[0])}try{(f=e.reduce(function(e,t){for(var n=0,r=e.length;n<r;++n){var i=e[n];if(o(t[0],i[1])<0&&0<o(t[1],i[0])){i[0]=c(i[0],t[0]),i[1]=_(i[1],t[1]);break}}return n===r&&e.push(t),e},[])).sort(u)}catch(e){return Gt(this,At)}var d=0,p=i?function(e){return 0<s(e,f[d][1])}:function(e){return 0<=s(e,f[d][1])},E=r?function(e){return 0<n(e,f[d][0])}:function(e){return 0<=n(e,f[d][0])};var A=p,e=new this.Collection(this,function(){return qt(f[0][0],f[f.length-1][1],!r,!i)});return e._ondirectionchange=function(e){l="next"===e?(A=p,s):(A=E,n),f.sort(u)},e._addAlgorithm(function(e,t,n){for(var r,i=e.key;A(i);)if(++d===f.length)return t(n),!1;return!p(r=i)&&!E(r)||(0===a._cmp(i,f[d][1])||0===a._cmp(i,f[d][0])||t(function(){l===s?e.continue(f[d][0]):e.continue(f[d][1])}),!1)}),e},Yt.prototype.startsWithAnyOf=function(){var e=L.apply(O,arguments);return e.every(function(e){return"string"==typeof e})?0===e.length?Ht(this):this.inAnyRange(e.map(function(e){return[e,e+Et]})):Gt(this,"startsWithAnyOf() only works with strings")},Yt);function Yt(){}function Wt(e){return 1===e.length?e[0]:e}function Jt(e){try{return e.only([[]]),[[]]}catch(e){return Et}}function Qt(t){return Ze(function(e){return $t(e),t(e.target.error),!1})}function $t(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var en=(tn.prototype._lock=function(){return A(!Me.global),++this._reculock,1!==this._reculock||Me.global||(Me.lockOwnerFor=this),this},tn.prototype._unlock=function(){if(A(!Me.global),0==--this._reculock)for(Me.global||(Me.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{st(e[1],e[0])}catch(e){}}return this},tn.prototype._locked=function(){return this._reculock&&Me.lockOwnerFor!==this},tn.prototype.create=function(t){var n=this;if(!this.mode)return this;var e=this.db.idbdb,r=this.db._state.dbOpenError;if(A(!this.idbtrans),!t&&!e)switch(r&&r.name){case"DatabaseClosedError":throw new ee.DatabaseClosed(r);case"MissingAPIError":throw new ee.MissingAPI(r.message,r);default:throw new ee.OpenFailed(r)}if(!this.active)throw new ee.TransactionInactive;return A(null===this._completion._state),(t=this.idbtrans=t||e.transaction(Wt(this.storeNames),this.mode)).onerror=Ze(function(e){$t(e),n._reject(t.error)}),t.onabort=Ze(function(e){$t(e),n.active&&n._reject(new ee.Abort(t.error)),n.active=!1,n.on("abort").fire(e)}),t.oncomplete=Ze(function(){n.active=!1,n._resolve()}),this},tn.prototype._promise=function(n,r,i){var a=this;if("readwrite"===n&&"readwrite"!==this.mode)return dt(new ee.ReadOnly("Transaction is readonly"));if(!this.active)return dt(new ee.TransactionInactive);if(this._locked())return new Ie(function(e,t){a._blockedFuncs.push([function(){a._promise(n,r,i).then(e,t)},Me])});if(i)return et(function(){var e=new Ie(function(e,t){a._lock();var n=r(e,t,a);n&&n.then&&n.then(e,t)});return e.finally(function(){return a._unlock()}),e._lib=!0,e});var e=new Ie(function(e,t){var n=r(e,t,a);n&&n.then&&n.then(e,t)});return e._lib=!0,e},tn.prototype._root=function(){return this.parent?this.parent._root():this},tn.prototype.waitFor=function(e){var t,r=this._root(),i=Ie.resolve(e);r._waitingFor?r._waitingFor=r._waitingFor.then(function(){return i}):(r._waitingFor=i,r._waitingQueue=[],t=r.idbtrans.objectStore(r.storeNames[0]),function e(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(t.get(-1/0).onsuccess=e)}());var a=r._waitingFor;return new Ie(function(t,n){i.then(function(e){return r._waitingQueue.push(Ze(t.bind(null,e)))},function(e){return r._waitingQueue.push(Ze(n.bind(null,e)))}).finally(function(){r._waitingFor===a&&(r._waitingFor=null)})})},tn.prototype.abort=function(){this.active&&this._reject(new ee.Abort),this.active=!1},tn.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(m(t,e))return t[e];var n=this.schema[e];if(!n)throw new ee.NotFound("Table "+e+" not part of transaction");n=new this.db.Table(e,n,this);return n.core=this.db.core.table(e),t[e]=n},tn);function tn(){}function nn(e,t,n,r,i,a,o){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:a,src:(n&&!o?"&":"")+(r?"*":"")+(i?"++":"")+rn(t)}}function rn(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function an(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:y(n,function(e){return[e.name,e]})}}function on(t){return null==t?function(){}:"string"==typeof t?1===(n=t).split(".").length?function(e){return e[n]}:function(e){return v(e,n)}:function(e){return v(e,t)};var n}function sn(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}function cn(e){return[].slice.call(e)}var _n=0;function fn(e){return null==e?":id":"string"==typeof e?e:"["+e.join("+")+"]"}function ln(e,t,i,n){var r=t.cmp.bind(t);function C(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");var t=e.lower,n=e.upper,r=e.lowerOpen,e=e.upperOpen;return void 0===t?void 0===n?null:i.upperBound(n,!!e):void 0===n?i.lowerBound(t,!!r):i.bound(t,n,!!r,!!e)}function a(v){var u,b=v.name;return{name:b,schema:v,mutate:function(e){var A=e.trans,S=e.type,m=e.keys,h=e.values,g=e.range,y=e.wantResults;return new Promise(function(t,e){t=Ze(t);var n=A.objectStore(b),r=null==n.keyPath,i="put"===S||"add"===S;if(!i&&"delete"!==S&&"deleteRange"!==S)throw new Error("Invalid operation type: "+S);var a=(m||h||{length:1}).length;if(m&&h&&m.length!==h.length)throw new Error("Given keys array must have same length as given values array.");if(0===a)return t({numFailures:0,failures:{},results:[],lastResult:void 0});function o(e){++l,$t(e),_&&(_[e.target._reqno]=void 0),f[e.target._reqno]=e.target.error}function s(e){e=e.target,_[e._reqno]=e.result}var c,_=y&&k(m||sn(v.primaryKey,{type:S,keys:m,values:h})),f=[],l=0;if("deleteRange"===S){if(4===g.type)return t({numFailures:l,failures:f,results:_,lastResult:void 0});c=3===g.type?n.clear():n.delete(C(g))}else{var r=i?r?[h,m]:[h,null]:[m,null],u=r[0],d=r[1];if(i)for(var p=0;p<a;++p)(c=d&&void 0!==d[p]?n[S](u[p],d[p]):n[S](u[p]))._reqno=p,_&&void 0===_[p]&&(c.onsuccess=s),c.onerror=o;else for(p=0;p<a;++p)(c=n[S](u[p]))._reqno=p,c.onerror=o}function E(e){e=e.target.result,_&&(_[a-1]=e),t({numFailures:l,failures:f,results:_,lastResult:e})}c.onerror=function(e){o(e),E(e)},c.onsuccess=E})},getMany:function(e){var l=e.trans,u=e.keys;return new Promise(function(t,e){t=Ze(t);for(var n,r=l.objectStore(b),i=u.length,a=new Array(i),o=0,s=0,c=function(e){e=e.target;null!=(a[e._pos]=e.result)&&0,++s===o&&t(a)},_=Qt(e),f=0;f<i;++f)null!=u[f]&&((n=r.get(u[f]))._pos=f,n.onsuccess=c,n.onerror=_,++o);0===o&&t(a)})},get:function(e){var r=e.trans,i=e.key;return new Promise(function(t,e){t=Ze(t);var n=r.objectStore(b).get(i);n.onsuccess=function(e){return t(e.target.result)},n.onerror=Qt(e)})},query:(u=_,function(l){return new Promise(function(n,e){n=Ze(n);var r,i,a,t=l.trans,o=l.values,s=l.limit,c=l.query,_=s===1/0?void 0:s,f=c.index,c=c.range,t=t.objectStore(b),f=f.isPrimaryKey?t:t.index(f.name),c=C(c);if(0===s)return n({result:[]});u?((_=o?f.getAll(c,_):f.getAllKeys(c,_)).onsuccess=function(e){return n({result:e.target.result})},_.onerror=Qt(e)):(r=0,i=!o&&"openKeyCursor"in f?f.openKeyCursor(c):f.openCursor(c),a=[],i.onsuccess=function(e){var t=i.result;return t?(a.push(o?t.value:t.primaryKey),++r===s?n({result:a}):void t.continue()):n({result:a})},i.onerror=Qt(e))})}),openCursor:function(e){var _=e.trans,a=e.values,o=e.query,s=e.reverse,f=e.unique;return new Promise(function(t,n){t=Ze(t);var e=o.index,r=o.range,i=_.objectStore(b),i=e.isPrimaryKey?i:i.index(e.name),e=s?f?"prevunique":"prev":f?"nextunique":"next",c=!a&&"openKeyCursor"in i?i.openKeyCursor(C(r),e):i.openCursor(C(r),e);c.onerror=Qt(n),c.onsuccess=Ze(function(e){var r,i,a,o,s=c.result;s?(s.___id=++_n,s.done=!1,r=s.continue.bind(s),i=(i=s.continuePrimaryKey)&&i.bind(s),a=s.advance.bind(s),o=function(){throw new Error("Cursor not stopped")},s.trans=_,s.stop=s.continue=s.continuePrimaryKey=s.advance=function(){throw new Error("Cursor not started")},s.fail=Ze(n),s.next=function(){var e=this,t=1;return this.start(function(){return t--?e.continue():e.stop()}).then(function(){return e})},s.start=function(e){function t(){if(c.result)try{e()}catch(e){s.fail(e)}else s.done=!0,s.start=function(){throw new Error("Cursor behind last entry")},s.stop()}var n=new Promise(function(t,e){t=Ze(t),c.onerror=Qt(e),s.fail=e,s.stop=function(e){s.stop=s.continue=s.continuePrimaryKey=s.advance=o,t(e)}});return c.onsuccess=Ze(function(e){c.onsuccess=t,t()}),s.continue=r,s.continuePrimaryKey=i,s.advance=a,t(),n},t(s)):t(null)},n)})},count:function(e){var t=e.query,i=e.trans,a=t.index,o=t.range;return new Promise(function(t,e){var n=i.objectStore(b),r=a.isPrimaryKey?n:n.index(a.name),n=C(o),r=n?r.count(n):r.count();r.onsuccess=Ze(function(e){return t(e.target.result)}),r.onerror=Qt(e)})}}}var o,s,c,t=(s=n,c=cn((o=e).objectStoreNames),{schema:{name:o.name,tables:c.map(function(e){return s.objectStore(e)}).map(function(t){var e=t.keyPath,n=t.autoIncrement,r=l(e),i={},n={name:t.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:null==e,compound:r,keyPath:e,autoIncrement:n,unique:!0,extractKey:on(e)},indexes:cn(t.indexNames).map(function(e){return t.index(e)}).map(function(e){var t=e.name,n=e.unique,r=e.multiEntry,e=e.keyPath,r={name:t,compound:l(e),keyPath:e,unique:n,multiEntry:r,extractKey:on(e)};return i[fn(e)]=r}),getIndexByKeyPath:function(e){return i[fn(e)]}};return i[":id"]=n.primaryKey,null!=e&&(i[fn(e)]=n.primaryKey),n})},hasGetAll:0<c.length&&"getAll"in s.objectStore(c[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),n=t.schema,_=t.hasGetAll,t=n.tables.map(a),f={};return t.forEach(function(e){return f[e.name]=e}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(e){if(!f[e])throw new Error("Table '"+e+"' not found");return f[e]},cmp:r,MIN_KEY:-1/0,MAX_KEY:Jt(i),schema:n}}function un(e,t,n,r){var i=n.IDBKeyRange,n=n.indexedDB;return{dbcore:(r=ln(t,n,i,r),e.dbcore.reduce(function(e,t){t=t.create;return S(S({},e),t(e))},r))}}function dn(n,e){var t=e.db,e=un(n._middlewares,t,n._deps,e);n.core=e.dbcore,n.tables.forEach(function(e){var t=e.name;n.core.schema.tables.some(function(e){return e.name===t})&&(e.core=n.core.table(t),n[t]instanceof n.Table&&(n[t].core=e.core))})}function pn(i,e,t,a){t.forEach(function(n){var r=a[n];e.forEach(function(e){var t=f(e,n);(!t||"value"in t&&void 0===t.value)&&(e===i.Transaction.prototype||e instanceof i.Transaction?c(e,n,{get:function(){return this.table(n)},set:function(e){o(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):e[n]=new i.Table(n,r))})})}function En(n,e){e.forEach(function(e){for(var t in e)e[t]instanceof n.Table&&delete e[t]})}function An(e,t){return e._cfg.version-t._cfg.version}function Sn(n,r,i,e){var a=n._dbSchema,o=n._createTransaction("readwrite",n._storeNames,a);o.create(i),o._completion.catch(e);var s=o._reject.bind(o),p=Me.transless||Me;et(function(){var c,_,f,l,t,e,u,d;Me.trans=o,Me.transless=p,0===r?(g(a).forEach(function(e){hn(i,e,a[e].primKey,a[e].indexes)}),dn(n,i),Ie.follow(function(){return n.on.populate.fire(o)}).catch(s)):(_=r,f=o,l=i,t=[],e=(c=n)._versions,u=c._dbSchema=yn(0,c.idbdb,l),d=!1,e.filter(function(e){return e._cfg.version>=_}).forEach(function(s){t.push(function(){var t=u,e=s._cfg.dbschema;vn(c,t,l),vn(c,e,l),u=c._dbSchema=e;var n=mn(t,e);n.add.forEach(function(e){hn(l,e[0],e[1].primKey,e[1].indexes)}),n.change.forEach(function(e){if(e.recreate)throw new ee.Upgrade("Not yet support for changing primary key");var t=l.objectStore(e.name);e.add.forEach(function(e){return gn(t,e)}),e.change.forEach(function(e){t.deleteIndex(e.name),gn(t,e)}),e.del.forEach(function(e){return t.deleteIndex(e)})});var r=s._cfg.contentUpgrade;if(r&&s._cfg.version>_){dn(c,l),f._memoizedTables={},d=!0;var i=R(e);n.del.forEach(function(e){i[e]=t[e]}),En(c,[c.Transaction.prototype]),pn(c,[c.Transaction.prototype],g(i),i),f.schema=i;var a,o=N(r);o&&tt();n=Ie.follow(function(){var e;(a=r(f))&&o&&(e=nt.bind(null,null),a.then(e,e))});return a&&"function"==typeof a.then?Ie.resolve(a):n.then(function(){return a})}}),t.push(function(e){d&&gt||function(e,t){for(var n=0;n<t.db.objectStoreNames.length;++n){var r=t.db.objectStoreNames[n];null==e[r]&&t.db.deleteObjectStore(r)}}(s._cfg.dbschema,e),En(c,[c.Transaction.prototype]),pn(c,[c.Transaction.prototype],c._storeNames,c._dbSchema),f.schema=c._dbSchema})}),function e(){return t.length?Ie.resolve(t.shift()(f.idbtrans)).then(e):Ie.resolve()}().then(function(){var t,n;n=l,g(t=u).forEach(function(e){n.db.objectStoreNames.contains(e)||hn(n,e,t[e].primKey,t[e].indexes)})}).catch(s))})}function mn(e,t){var n,r={del:[],add:[],change:[]};for(n in e)t[n]||r.del.push(n);for(n in t){var i=e[n],a=t[n];if(i){var o={name:n,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||i.primKey.auto!==a.primKey.auto&&!ht)o.recreate=!0,r.change.push(o);else{var s=i.idxByName,c=a.idxByName,_=void 0;for(_ in s)c[_]||o.del.push(_);for(_ in c){var f=s[_],l=c[_];f?f.src!==l.src&&o.change.push(l):o.add.push(l)}(0<o.del.length||0<o.add.length||0<o.change.length)&&r.change.push(o)}}else r.add.push([n,a])}return r}function hn(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(e){return gn(i,e)}),i}function gn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function yn(e,t,s){var c={};return p(t.objectStoreNames,0).forEach(function(e){for(var t=s.objectStore(e),n=nn(rn(o=t.keyPath),o||"",!1,!1,!!t.autoIncrement,o&&"string"!=typeof o,!0),r=[],i=0;i<t.indexNames.length;++i){var a=t.index(t.indexNames[i]),o=a.keyPath,a=nn(a.name,o,!!a.unique,!!a.multiEntry,!1,o&&"string"!=typeof o,!1);r.push(a)}c[e]=an(e,n,r)}),c}function vn(e,t,n){for(var r=n.db.objectStoreNames,i=0;i<r.length;++i){var a=r[i],o=n.objectStore(a);e._hasGetAll="getAll"in o;for(var s=0;s<o.indexNames.length;++s){var c=o.indexNames[s],_=o.index(c).keyPath,f="string"==typeof _?_:"["+p(_).join("+")+"]";!t[a]||(_=t[a].idxByName[f])&&(_.name=c,delete t[a].idxByName[f],t[a].idxByName[c]=_)}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&u.WorkerGlobalScope&&u instanceof u.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}var bn,Cn=(kn.prototype._parseStoresSpec=function(r,i){g(r).forEach(function(e){if(null!==r[e]){var t=r[e].split(",").map(function(e,t){var n=(e=e.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return nn(n,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),l(r),0===t)}),n=t.shift();if(n.multi)throw new ee.Schema("Primary key cannot be multi-valued");t.forEach(function(e){if(e.auto)throw new ee.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new ee.Schema("Index must have a name and cannot be an empty string")}),i[e]=an(e,n,t)}})},kn.prototype.stores=function(e){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?s(this._cfg.storesSource,e):e;var e=t._versions,n={},r={};return e.forEach(function(e){s(n,e._cfg.storesSource),r=e._cfg.dbschema={},e._parseStoresSpec(n,r)}),t._dbSchema=r,En(t,[t._allTables,t,t.Transaction.prototype]),pn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],g(r),r),t._storeNames=g(r),this},kn.prototype.upgrade=function(e){return this._cfg.contentUpgrade=e,this},kn);function kn(){}function Rn(e){return et(function(){return Me.letThrough=!0,e()})}function wn(f){var l=f._state,r=f._deps.indexedDB;if(l.isBeingOpened||f.idbdb)return l.dbReadyPromise.then(function(){return l.dbOpenError?dt(l.dbOpenError):f});B&&(l.openCanceller._stackHolder=H()),l.isBeingOpened=!0,l.dbOpenError=null,l.openComplete=!1;var e=l.dbReadyResolve,u=null;return Ie.race([l.openCanceller,new Ie(function(s,n){if(!r)throw new ee.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using old Safari versions, make sure to include indexedDB polyfill.");var c=f.name,_=l.autoSchema?r.open(c):r.open(c,Math.round(10*f.verno));if(!_)throw new ee.MissingAPI("IndexedDB API not available");_.onerror=Qt(n),_.onblocked=Ze(f._fireOnBlocked),_.onupgradeneeded=Ze(function(e){var t;u=_.transaction,l.autoSchema&&!f._options.allowEmptyDB?(_.onerror=$t,u.abort(),_.result.close(),(t=r.deleteDatabase(c)).onsuccess=t.onerror=Ze(function(){n(new ee.NoSuchDatabase("Database "+c+" doesnt exist"))})):(u.onerror=Qt(n),e=e.oldVersion>Math.pow(2,62)?0:e.oldVersion,f.idbdb=_.result,Sn(f,e/10,u,n))},n),_.onsuccess=Ze(function(){u=null;var e,t,n,r,i=f.idbdb=_.result,a=p(i.objectStoreNames);if(0<a.length)try{var o=i.transaction(Wt(a),"readonly");l.autoSchema?(n=i,r=o,(t=f).verno=n.version/10,r=t._dbSchema=yn(0,n,r),t._storeNames=p(n.objectStoreNames,0),pn(t,[t._allTables],g(r),r)):(vn(f,f._dbSchema,o),((e=mn(yn(0,(e=f).idbdb,o),e._dbSchema)).add.length||e.change.some(function(e){return e.add.length||e.change.length}))&&console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),dn(f,o)}catch(e){}mt.push(f),i.onversionchange=Ze(function(e){l.vcFired=!0,f.on("versionchange").fire(e)}),bn.add(c),s()},n)})]).then(function(){return l.onReadyBeingFired=[],Ie.resolve(Rn(f.on.ready.fire)).then(function e(){if(0<l.onReadyBeingFired.length){var t=l.onReadyBeingFired.reduce(fe,ne);return l.onReadyBeingFired=[],Ie.resolve(Rn(t)).then(e)}})}).finally(function(){l.onReadyBeingFired=null}).then(function(){return l.isBeingOpened=!1,f}).catch(function(e){try{u&&u.abort()}catch(e){}return l.isBeingOpened=!1,f.close(),l.dbOpenError=e,dt(l.dbOpenError)}).finally(function(){l.openComplete=!0,e()})}function xn(t){function e(e){return t.next(e)}var r=n(e),i=n(function(e){return t.throw(e)});function n(n){return function(e){var t=n(e),e=t.value;return t.done?e:e&&"function"==typeof e.then?e.then(r,i):l(e)?Promise.all(e).then(r,i):r(e)}}return n(e)()}function Dn(e,t,n){for(var r=l(e)?e.slice():[e],i=0;i<n;++i)r.push(t);return r}var Mn={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(l){return S(S({},l),{table:function(e){var o=l.table(e),t=o.schema,s={},c=[];function _(e,t,n){var r=fn(e),i=s[r]=s[r]||[],a=null==e?0:"string"==typeof e?1:e.length,r=0<t,r=S(S({},n),{isVirtual:r,isPrimaryKey:!r&&n.isPrimaryKey,keyTail:t,keyLength:a,extractKey:on(e),unique:!r&&n.unique});return i.push(r),r.isPrimaryKey||c.push(r),1<a&&_(2===a?e[0]:e.slice(0,a-1),t+1,n),i.sort(function(e,t){return e.keyTail-t.keyTail}),r}e=_(t.primaryKey.keyPath,0,t.primaryKey);s[":id"]=[e];for(var n=0,r=t.indexes;n<r.length;n++){var i=r[n];_(i.keyPath,0,i)}function f(e){var t,n=e.query.index;return n.isVirtual?S(S({},e),{query:{index:n,range:(t=e.query.range,n=n.keyTail,{type:1===t.type?2:t.type,lower:Dn(t.lower,t.lowerOpen?l.MAX_KEY:l.MIN_KEY,n),lowerOpen:!0,upper:Dn(t.upper,t.upperOpen?l.MIN_KEY:l.MAX_KEY,n),upperOpen:!0})}}):e}return S(S({},o),{schema:S(S({},t),{primaryKey:e,indexes:c,getIndexByKeyPath:function(e){return(e=s[fn(e)])&&e[0]}}),count:function(e){return o.count(f(e))},query:function(e){return o.query(f(e))},openCursor:function(t){var e=t.query.index,r=e.keyTail,n=e.isVirtual,i=e.keyLength;return n?o.openCursor(f(t)).then(function(e){return e&&a(e)}):o.openCursor(t);function a(n){return Object.create(n,{continue:{value:function(e){null!=e?n.continue(Dn(e,t.reverse?l.MAX_KEY:l.MIN_KEY,r)):t.unique?n.continue(Dn(n.key,t.reverse?l.MIN_KEY:l.MAX_KEY,r)):n.continue()}},continuePrimaryKey:{value:function(e,t){n.continuePrimaryKey(Dn(e,l.MAX_KEY,r),t)}},key:{get:function(){var e=n.key;return 1===i?e[0]:e.slice(0,i)}},value:{get:function(){return n.value}}})}}})}})}},Fn={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return S(S({},e),{table:function(r){var E=e.table(r),A=E.schema.primaryKey;return S(S({},E),{mutate:function(e){var t=Me.trans,n=t.table(r).hook,u=n.deleting,d=n.creating,p=n.updating;switch(e.type){case"add":if(d.fire===ne)break;return t._promise("readwrite",function(){return o(e)},!0);case"put":if(d.fire===ne&&p.fire===ne)break;return t._promise("readwrite",function(){return o(e)},!0);case"delete":if(u.fire===ne)break;return t._promise("readwrite",function(){return o(e)},!0);case"deleteRange":if(u.fire===ne)break;return t._promise("readwrite",function(){return function n(r,i,a){return E.query({trans:r,values:!1,query:{index:A,range:i},limit:a}).then(function(e){var t=e.result;return o({type:"delete",keys:t,trans:r}).then(function(e){return 0<e.numFailures?Promise.reject(e.failures[0]):t.length<a?{failures:[],numFailures:0,lastResult:void 0}:n(r,S(S({},i),{lower:t[t.length-1],lowerOpen:!0}),a)})})}(e.trans,e.range,1e4)},!0)}return E.mutate(e);function o(_){var e,t,n,f=Me.trans,l=_.keys||sn(A,_);if(!l)throw new Error("Keys missing");return"delete"!==(_="add"===_.type||"put"===_.type?S(S({},_),{keys:l,wantResults:!0}):S({},_)).type&&(_.values=k(_.values)),_.keys&&(_.keys=k(_.keys)),e=E,n=l,("add"===(t=_).type?Promise.resolve(new Array(t.values.length)):e.getMany({trans:t.trans,keys:n})).then(function(s){var c=l.map(function(e,t){var n,r,i,a=s[t],o={onerror:null,onsuccess:null};return"delete"===_.type?u.fire.call(o,e,a,f):"add"===_.type||void 0===a?(n=d.fire.call(o,e,_.values[t],f),null==e&&null!=n&&(_.keys[t]=e=n,A.outbound||b(_.values[t],A.keyPath,e))):(n=I(a,_.values[t]),(r=p.fire.call(o,n,e,a,f))&&(i=_.values[t],Object.keys(r).forEach(function(e){m(i,e)?i[e]=r[e]:b(i,e,r[e])}))),o});return E.mutate(_).then(function(e){for(var t=e.failures,n=e.results,r=e.numFailures,e=e.lastResult,i=0;i<l.length;++i){var a=(n||l)[i],o=c[i];null==a?o.onerror&&o.onerror(t[i]):o.onsuccess&&o.onsuccess("put"===_.type&&s[i]?_.values[i]:a)}return{failures:t,results:n,numFailures:r,lastResult:e}}).catch(function(t){return c.forEach(function(e){return e.onerror&&e.onerror(t)}),Promise.reject(t)})})}}})}})}},Tn=(Vn.prototype.version=function(t){if(isNaN(t)||t<.1)throw new ee.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new ee.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var e=this._versions,n=e.filter(function(e){return e._cfg.version===t})[0];return n||(n=new this.Version(t),e.push(n),e.sort(An),n.stores({}),this._state.autoSchema=!1,n)},Vn.prototype._whenReady=function(e){var n=this;return this._state.openComplete||Me.letThrough?e():new Ie(function(e,t){if(!n._state.isBeingOpened){if(!n._options.autoOpen)return void t(new ee.DatabaseClosed);n.open().catch(ne)}n._state.dbReadyPromise.then(e,t)}).then(e)},Vn.prototype.use=function(e){var t=e.stack,n=e.create,r=e.level,i=e.name;i&&this.unuse({stack:t,name:i});e=this._middlewares[t]||(this._middlewares[t]=[]);return e.push({stack:t,create:n,level:null==r?10:r,name:i}),e.sort(function(e,t){return e.level-t.level}),this},Vn.prototype.unuse=function(e){var t=e.stack,n=e.name,r=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(e){return r?e.create!==r:!!n&&e.name!==n})),this},Vn.prototype.open=function(){return wn(this)},Vn.prototype.close=function(){var e=mt.indexOf(this),n=this._state;if(0<=e&&mt.splice(e,1),this.idbdb){try{this.idbdb.close()}catch(e){}this.idbdb=null}this._options.autoOpen=!1,n.dbOpenError=new ee.DatabaseClosed,n.isBeingOpened&&n.cancelOpen(n.dbOpenError),n.dbReadyPromise=new Ie(function(e){n.dbReadyResolve=e}),n.openCanceller=new Ie(function(e,t){n.cancelOpen=t})},Vn.prototype.delete=function(){var r=this,i=0<arguments.length,a=this._state;return new Ie(function(t,n){function e(){r.close();var e=r._deps.indexedDB.deleteDatabase(r.name);e.onsuccess=Ze(function(){bn.remove(r.name),t()}),e.onerror=Qt(n),e.onblocked=r._fireOnBlocked}if(i)throw new ee.InvalidArgument("Arguments not allowed in db.delete()");a.isBeingOpened?a.dbReadyPromise.then(e):e()})},Vn.prototype.backendDB=function(){return this.idbdb},Vn.prototype.isOpen=function(){return null!==this.idbdb},Vn.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name},Vn.prototype.hasFailed=function(){return null!==this._state.dbOpenError},Vn.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Vn.prototype,"tables",{get:function(){var t=this;return g(this._allTables).map(function(e){return t._allTables[e]})},enumerable:!0,configurable:!0}),Vn.prototype.transaction=function(){var e=function(e,t,n){var r=arguments.length;if(r<2)throw new ee.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];return n=i.pop(),[e,w(i),n]}.apply(this,arguments);return this._transaction.apply(this,e)},Vn.prototype._transaction=function(e,t,n){var r=this,i=Me.trans;i&&i.db===this&&-1===e.indexOf("!")||(i=null);var a,o,s=-1!==e.indexOf("?");e=e.replace("!","").replace("?","");try{if(o=t.map(function(e){e=e instanceof r.Table?e.name:e;if("string"!=typeof e)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return e}),"r"==e||e===bt)a=bt;else{if("rw"!=e&&e!=Ct)throw new ee.InvalidArgument("Invalid transaction mode: "+e);a=Ct}if(i){if(i.mode===bt&&a===Ct){if(!s)throw new ee.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&o.forEach(function(e){if(i&&-1===i.storeNames.indexOf(e)){if(!s)throw new ee.SubTransaction("Table "+e+" not included in parent transaction.");i=null}}),s&&i&&!i.active&&(i=null)}}catch(n){return i?i._promise(null,function(e,t){t(n)}):dt(n)}var c=function(i,a,o,s,c){return Ie.resolve().then(function(){var e=Me.transless||Me,t=i._createTransaction(a,o,i._dbSchema,s),e={trans:t,transless:e};s?t.idbtrans=s.idbtrans:t.create();var n,r=N(c);r&&tt();e=Ie.follow(function(){var e;(n=c.call(t,t))&&(r?(e=nt.bind(null,null),n.then(e,e)):"function"==typeof n.next&&"function"==typeof n.throw&&(n=xn(n)))},e);return(n&&"function"==typeof n.then?Ie.resolve(n).then(function(e){return t.active?e:dt(new ee.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):e.then(function(){return n})).then(function(e){return s&&t._resolve(),t._completion.then(function(){return e})}).catch(function(e){return t._reject(e),dt(e)})})}.bind(null,this,a,o,i,n);return i?i._promise(a,c,"lock"):Me.trans?st(Me.transless,function(){return r._whenReady(c)}):this._whenReady(c)},Vn.prototype.table=function(e){if(!m(this._allTables,e))throw new ee.InvalidTable("Table "+e+" does not exist");return this._allTables[e]},Vn);function Vn(e,t){var a=this;this._middlewares={},this.verno=0;var n=Vn.dependencies;this._options=t=S({addons:Vn.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};n=t.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={};var o,r,s,i,c,_={dbOpenError:this.idbdb=null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ne,dbReadyPromise:null,cancelOpen:ne,openCanceller:null,autoSchema:!0};_.dbReadyPromise=new Ie(function(e){_.dbReadyResolve=e}),_.openCanceller=new Ie(function(e,t){_.cancelOpen=t}),this._state=_,this.name=e,this.on=Mt(this,"populate","blocked","versionchange",{ready:[fe,ne]}),this.on.ready.subscribe=E(this.on.ready.subscribe,function(i){return function(n,r){Vn.vip(function(){var t,e=a._state;e.openComplete?(e.dbOpenError||Ie.resolve().then(n),r&&i(n)):e.onReadyBeingFired?(e.onReadyBeingFired.push(n),r&&i(n)):(i(n),t=a,r||i(function e(){t.on.ready.unsubscribe(n),t.on.ready.unsubscribe(e)}))})}}),this.Collection=(o=this,Ft(Nt.prototype,function(e,t){this.db=o;var n=Rt,r=null;if(t)try{n=t()}catch(e){r=e}var i=e._ctx,t=i.table,e=t.hook.reading.fire;this._ctx={table:t,index:i.index,isPrimKey:!i.index||t.schema.primKey.keyPath&&i.index===t.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueMapper:e!==re?e:null}})),this.Table=(r=this,Ft(xt.prototype,function(e,t,n){this.db=r,this._tx=n,this.name=e,this.schema=t,this.hook=r._allTables[e]?r._allTables[e].hook:Mt(null,{creating:[oe,ne],reading:[ie,re],updating:[ce,ne],deleting:[se,ne]})})),this.Transaction=(s=this,Ft(en.prototype,function(e,t,n,r){var i=this;this.db=s,this.mode=e,this.storeNames=t,this.schema=n,this.idbtrans=null,this.on=Mt(this,"complete","error","abort"),this.parent=r||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ie(function(e,t){i._resolve=e,i._reject=t}),this._completion.then(function(){i.active=!1,i.on.complete.fire()},function(e){var t=i.active;return i.active=!1,i.on.error.fire(e),i.parent?i.parent._reject(e):t&&i.idbtrans&&i.idbtrans.abort(),dt(e)})})),this.Version=(i=this,Ft(Cn.prototype,function(e){this.db=i,this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(c=this,Ft(jt.prototype,function(e,t,n){this.db=c,this._ctx={table:e,index:":id"===t?null:t,or:n};var r=c._deps.indexedDB;if(!r)throw new ee.MissingAPI("indexedDB API missing");this._cmp=this._ascending=r.cmp.bind(r),this._descending=function(e,t){return r.cmp(t,e)},this._max=function(e,t){return 0<r.cmp(e,t)?e:t},this._min=function(e,t){return r.cmp(e,t)<0?e:t},this._IDBKeyRange=c._deps.IDBKeyRange})),this.on("versionchange",function(e){0<e.newVersion?console.warn("Another connection wants to upgrade database '"+a.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+a.name+"'. Closing db now to resume the delete request."),a.close()}),this.on("blocked",function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('"+a.name+"') was blocked"):console.warn("Upgrade '"+a.name+"' blocked by other connection holding version "+e.oldVersion/10)}),this._maxKey=Jt(t.IDBKeyRange),this._createTransaction=function(e,t,n,r){return new a.Transaction(e,t,n,r)},this._fireOnBlocked=function(t){a.on("blocked").fire(t),mt.filter(function(e){return e.name===a.name&&e!==a&&!e._state.vcFired}).map(function(e){return e.on("versionchange").fire(t)})},this.use(Mn),this.use(Fn),n.forEach(function(e){return e(a)})}var In=Tn;return i(In,S(S({},q),{delete:function(e){return new In(e).delete()},exists:function(e){return new In(e,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){return bn?bn.getDatabaseNames().then(e):Ie.resolve([])},defineClass:function(){return function(e){s(this,e)}},ignoreTransaction:function(e){return Me.trans?st(Me.transless,e):e()},vip:Rn,async:function(t){return function(){try{var e=xn(t.apply(this,arguments));return e&&"function"==typeof e.then?e:Ie.resolve(e)}catch(e){return dt(e)}}},spawn:function(e,t,n){try{var r=xn(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:Ie.resolve(r)}catch(e){return dt(e)}},currentTransaction:{get:function(){return Me.trans||null}},waitFor:function(e,t){t=Ie.resolve("function"==typeof e?In.ignoreTransaction(e):e).timeout(t||6e4);return Me.trans?Me.trans.waitFor(t):t},Promise:Ie,debug:{get:function(){return B},set:function(e){U(e,"dexie"===e?function(){return!0}:pt)}},derive:a,extend:s,props:i,override:E,Events:Mt,getByKeyPath:v,setByKeyPath:b,delByKeyPath:C,shallowClone:R,deepClone:M,getObjectDiff:I,asap:h,minKey:-1/0,addons:[],connections:mt,errnames:e,dependencies:function(){try{return{indexedDB:u.indexedDB||u.mozIndexedDB||u.webkitIndexedDB||u.msIndexedDB,IDBKeyRange:u.IDBKeyRange||u.webkitIDBKeyRange}}catch(e){return{indexedDB:null,IDBKeyRange:null}}}(),semVer:"3.0.3",version:"3.0.3".split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,2*n)}),default:In,Dexie:In})),In.maxKey=Jt(In.dependencies.IDBKeyRange),function(e){try{(i=(t=e)&&"function"==typeof t.databases)||((r=new Tn(vt,{addons:[]})).version(1).stores({dbnames:"name"}),n=r.table("dbnames")),bn={getDatabaseNames:function(){return i?Ie.resolve(t.databases()).then(function(e){return e.map(function(e){return e.name}).filter(function(e){return e!==vt})}):n.toCollection().primaryKeys()},add:function(e){return!i&&e!==vt&&n.put({name:e}).catch(ne)},remove:function(e){return!i&&e!==vt&&n.delete(e).catch(ne)}}}catch(e){}var t,n,r,i}(Tn.dependencies.indexedDB),Ie.rejectionMapper=function(e,t){return!e||e instanceof Y||e instanceof TypeError||e instanceof SyntaxError||!e.name||!te[e.name]?e:(t=new te[e.name](t||e.message,e),"stack"in e&&c(t,"stack",{get:function(){return this.inner.stack}}),t)},U(B,pt),Tn});const QJ_IDLE_COLOR="#88888855",QJ_ACTIVE_COLOR="#88888866";class TouchButtonListener{trigger(e){}}class SingleTouchButton{constructor(e,t,n,r){this.container=s(e),this.el=s(t),this.label=n,this.state=!1,this.elListener=r;var i=this;null!=this.el&&(this.el.textContent=this.label),this.container.addEventListener("touchstart",function(e){i.touch(e,!0)}),this.container.addEventListener("touchmove",function(e){i.touch(e,!0)}),this.container.addEventListener("touchend",function(e){e.preventDefault(),i.touch(e,!1)})}touch(e,t){t=!!t;t!=this.state&&(this.state=t,this.elListener.trigger(this.state),this.el.style.background=this.state?QJ_ACTIVE_COLOR:QJ_IDLE_COLOR)}}class DualTouchButton{constructor(e,t,n,r,i,a,o){this.container=s(e),this.el1=s(t),this.el2=s(r),this.label1=n,this.label2=i,this.isHorizontal=a,this.elListener=o,this.state=0;var c=this;null!=this.el1&&(this.el1.textContent=this.label1),null!=this.el2&&(this.el2.textContent=this.label2),this.container.addEventListener("touchstart",function(e){c.touch(e,!0)}),this.container.addEventListener("touchmove",function(e){c.touch(e,!0)}),this.container.addEventListener("touchend",function(e){e.preventDefault(),c.touch(e,!1)})}touch(e,t){var n,r=0;(r=t?(this.isHorizontal?(n=this.container.offsetWidth,e.changedTouches[0].clientX-this.container.getBoundingClientRect().left):(n=this.container.offsetHeight,e.changedTouches[0].clientY-this.container.getBoundingClientRect().top))<n/2?1:2:0)!=this.state&&(this.state=r,this.elListener.trigger(this.state),this.el1.style.background=1==this.state?QJ_ACTIVE_COLOR:QJ_IDLE_COLOR,this.el2.style.background=2==this.state?QJ_ACTIVE_COLOR:QJ_IDLE_COLOR)}}class SingleTouchButtonJoyListener extends TouchButtonListener{constructor(e,t,n){super(),this.controller=e,this.action=t,this.callback=n.bind(n),this.trigger=this.trigger.bind(this)}trigger(e){this.callback(this.controller,this.action,e)}}class DualTouchButtonJoyListener extends TouchButtonListener{constructor(e,t,n,r){super(),this.controller=e,this.action1=t,this.action2=n,this.previous=0,this.callback=r.bind(r),this.trigger=this.trigger.bind(this)}trigger(e){0<e&&this.callback(this.controller,1==e?this.action1:this.action2,!0),0<this.previous&&this.callback(this.controller,1==this.previous?this.action1:this.action2,!1),this.previous=e}}function loadFile(e,t){var n=new FileReader;n.onload=t,n.readAsBinaryString(e)}function loadFileAsBuffer(e,t){var n=new FileReader;n.onload=t,n.readAsArrayBuffer(e)}var FileProvider=function(){this.provider=null};FileProvider.prototype={setFileProvider:function(e){null!=this.provider&&this.provider.unload(),this.provider=e,this.provider.init()},selectFile:function(e){this.provider.selectFile(e)},openPrefs:function(){this.provider.openPrefs()},init:function(){this.provider.init()},unload:function(){this.provider.unload()}};const Themes={WB13:{"--color0":"#0055AD","--color1":"#FFFFFF","--color2":"#FF8800","--color3":"#000000","--color4":"#FFFFFF","--color-btn-pressed":"#0055AD","--color-warn":"#FF8800","--options-bg":"#FFFFFF","--options-text":"#0055ad","--options-border":"1px solid #CCC","--options-highlight":"#0055AD","--ic-disk":'url("assets/DefDisk.png")',"--ic-disk-inv":'url("assets/DefDisk-inv.png")',"--dim-disk-w":"32px","--dim-disk-h":"32px","--ic-eject":'url("assets/eject.png")',"--dim-eject-w":"44px","--dim-eject-h":"22px","--font":"Topaz500","loading-img":"assets/Busy13.png"},WB31:{"--color0":"#A7A7A7","--color1":"#FFFFFF","--color2":"#6C88B7","--color3":"#000000","--color4":"#000000","--color-btn-pressed":"#000000","--color-warn":"#000000","--options-bg":"#FFFFFF","--options-text":"#000000","--options-border":"2px solid #000000","--options-highlight":"#000000","--ic-disk":'url("assets/DefDisk2.png")',"--ic-disk-inv":'url("assets/DefDisk2-inv.png")',"--dim-disk-w":"36px","--dim-disk-h":"34px","--ic-eject":'url("assets/eject2.png")',"--dim-eject-w":"44px","--dim-eject-h":"22px","--font":"Topaz1200","loading-img":"assets/Busy31.png"}},KnownKickstarts={KICK_30:{KEY:"KICK_30",FAMILY:"1",NAME:"v1.0",REVISION:"30.???",YEAR:"1985",MACHINES:[SAEC_Model_A1000],VIDEO:["PAL","NTSC"],CRC:697798911,SIZE:262144},KICK_31_034_NTSC:{KEY:"KICK_31_034_NTSC",FAMILY:"1",NAME:"v1.1",REVISION:"31.034",YEAR:"1985",MACHINES:[SAEC_Model_A1000],VIDEO:["NTSC"],CRC:3495974698,SIZE:262144},KICK_31_034_PAL:{KEY:"KICK_31_034_NTSC",FAMILY:"1",NAME:"v1.1",REVISION:"31.034",YEAR:"1986",MACHINES:[SAEC_Model_A1000],VIDEO:["PAL"],CRC:3968260834,SIZE:262144},KICK_33_166:{KEY:"KICK_33_166",FAMILY:"1",NAME:"v1.2",REVISION:"33.166",YEAR:"1986",MACHINES:[SAEC_Model_A1000],VIDEO:["PAL","NTSC"],CRC:2664924112,SIZE:262144},KICK_33_180:{KEY:"KICK_33_180",FAMILY:"1",NAME:"v1.2",REVISION:"33.180",YEAR:"1986",MACHINES:[SAEC_Model_A2000],VIDEO:["PAL","NTSC"],CRC:2798523958,SIZE:262144},KICK_34_005_A:{KEY:"KICK_34_005_A",FAMILY:"1",NAME:"v1.3",REVISION:"33.005",YEAR:"1987",MACHINES:[SAEC_Model_A1000,SAEC_Model_A500,SAEC_Model_A2000,SAEC_Model_CDTV],VIDEO:["PAL","NTSC"],CRC:3304125791,SIZE:262144},KICK_34_005_B:{KEY:"KICK_34_005_B",FAMILY:"1",NAME:"v1.3",REVISION:"33.005",YEAR:"1987",MACHINES:[SAEC_Model_A1000,SAEC_Model_A500,SAEC_Model_A2000,SAEC_Model_CDTV],VIDEO:["PAL","NTSC"],CRC:3774050904,SIZE:262144},KICK_37_175:{KEY:"KICK_37_175",FAMILY:"2",NAME:"v2.04",REVISION:"37.175",YEAR:"1991",MACHINES:[],VIDEO:["PAL","NTSC"],CRC:3283989056,SIZE:524288},KICK_37_350:{KEY:"KICK_37_350",FAMILY:"2",NAME:"v2.05",REVISION:"37.240",YEAR:"1992",MACHINES:[],VIDEO:["PAL","NTSC"],CRC:1135665019,SIZE:524288},KICK_39_106_A1200:{KEY:"KICK_39_106_A1200",FAMILY:"3",NAME:"v3.0",REVISION:"39.106",YEAR:"1992",MACHINES:[SAEC_Model_A1200],VIDEO:["PAL","NTSC"],CRC:1822099410,SIZE:524288},KICK_39_106_A4000:{KEY:"KICK_39_106_A4000",FAMILY:"3",NAME:"v3.0",REVISION:"39.106",YEAR:"1992",MACHINES:[SAEC_Model_A4000],VIDEO:["PAL","NTSC"],CRC:2657796434,SIZE:524288},KICK_40_063_A600:{KEY:"KICK_40_063_A600",FAMILY:"3",NAME:"v3.1",REVISION:"40.063",YEAR:"1993",MACHINES:[SAEC_Model_A600],VIDEO:["PAL","NTSC"],CRC:4230262285,SIZE:524288},KICK_40_068_A1200:{KEY:"KICK_40_068_A1200",FAMILY:"3",NAME:"v3.1",REVISION:"40.068",YEAR:"1993",MACHINES:[SAEC_Model_A1200],VIDEO:["PAL","NTSC"],CRC:344170641,SIZE:524288},KICK_40_068_A4000:{KEY:"KICK_40_068_A4000",FAMILY:"3",NAME:"v3.1",REVISION:"40.068",YEAR:"1993",MACHINES:[SAEC_Model_A4000],VIDEO:["PAL","NTSC"],CRC:3602572084,SIZE:524288},KICK_40_068_A3000:{KEY:"KICK_40_068_A3000",FAMILY:"3",NAME:"v3.1",REVISION:"40.068",YEAR:"1993",MACHINES:[SAEC_Model_A3000],VIDEO:["PAL","NTSC"],CRC:4021434828,SIZE:524288},KICK_40_070_A4000T:{KEY:"KICK_40_070_A4000T",FAMILY:"3",NAME:"v3.1",REVISION:"40.068",YEAR:"1994",MACHINES:[SAEC_Model_A4000],VIDEO:["PAL","NTSC"],CRC:1972579386,SIZE:524288}},COL_GRAY="#88888888",COL_GREEN="#00880088",COL_RED="#88000088",COL_ORANGE="#ffa50088",CFG_AMIGA_REGION_PAL=SAEC_Config_Chipset_CR_PAL,CFG_AMIGA_REGION_NTSC=SAEC_Config_Chipset_CR_NTSC;let slideUp=(e,t=500)=>{e.style.transitionProperty="height, margin, padding",e.style.transitionDuration=t+"ms",e.style.boxSizing="border-box",e.style.height=e.offsetHeight+"px",e.offsetHeight,e.style.overflow="hidden",e.style.height=0,e.style.paddingTop=0,e.style.paddingBottom=0,e.style.marginTop=0,e.style.marginBottom=0,window.setTimeout(()=>{e.style.display="none",e.style.removeProperty("height"),e.style.removeProperty("padding-top"),e.style.removeProperty("padding-bottom"),e.style.removeProperty("margin-top"),e.style.removeProperty("margin-bottom"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")},t)},slideDown=(e,t=500)=>{e.style.removeProperty("display");let n=window.getComputedStyle(e).display;"none"===n&&(n="grid"),e.style.display=n;var r=e.offsetHeight;e.style.overflow="hidden",e.style.height=0,e.style.paddingTop=0,e.style.paddingBottom=0,e.style.marginTop=0,e.style.marginBottom=0,e.offsetHeight,e.style.boxSizing="border-box",e.style.transitionProperty="height, margin, padding",e.style.transitionDuration=t+"ms",e.style.height=r+"px",e.style.removeProperty("padding-top"),e.style.removeProperty("padding-bottom"),e.style.removeProperty("margin-top"),e.style.removeProperty("margin-bottom"),window.setTimeout(()=>{e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property")},t)};var slideToggle=(e,t=500)=>("none"===window.getComputedStyle(e).display?slideDown:slideUp)(e,t);const updateCombo=(e,n,t)=>{for(var r=s("#"+e+" ul");r.firstChild;)r.removeChild(r.firstChild);var i=s("#"+e+"-select");null!=t&&(i.textContent=n[t],prefs[e]=t),Object.keys(n).forEach(function(e){var t=document.createElement("li");t.id=e,t.classList.add("optionitem"),t.textContent=n[e],t.setAttribute("rel",e),r.append(t)})},addCombo=(e,r,t,n,a,o,c,_,f)=>{var l=s(e);insert(e,"<span id='"+r+"_caption' class='cellItem alignRight'>"+t+"</span>");e=document.createElement("div");e.id=r,e.className="select";var u=document.createElement("select");u.classList.add("s-hidden"),e.appendChild(u);var d=document.createElement("div");d.className="styledSelect",d.id=r+"-select",u.after(d);var p=localStorage.getItem(r);null!=p?d.textContent=o[p]:(p=a,localStorage.setItem(r,a),d.textContent=o[a]),prefs[r]=p;var E,A=document.createElement("ul");function S(e){e.stopPropagation(),s("#"+r).classList.contains("disabled")||(e.target.classList.remove("guiBtn-pressed"),d.classList.remove("active"),null!=E?(e=E.getAttribute("rel"),p=e,d.textContent=o[e],prefs[r]=e,localStorage.setItem(r,e),u.value=e,A.style.display="none",n&&prefsChange(!0),null!=f&&f(e)):A.style.display="none")}A.className="options options_"+r,d.after(A),Object.keys(o).forEach(function(e){var t=document.createElement("li");t.id=e,t.classList.add("optionitem"),t.textContent=o[e],t.setAttribute("rel",e),A.append(t)}),d.addEventListener("touchstart",e=>function(e){e.preventDefault(),s("#"+r).classList.contains("disabled")||(function(){o={};var e=s("#"+r+" ul").querySelectorAll("li");for(i=0;i<e.length;i++){var t=e[i].getAttribute("rel"),n=e[i].textContent;o[t]=n}}(),e.target.classList.toggle("active"),toggle(s(".options_"+r)),s("#"+p).classList.add("options-selected"))}(e)),d.addEventListener("touchmove",e=>function(e){if(e.preventDefault(),!s("#"+r).classList.contains("disabled"))for(option in tgt=document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY),E=null!=tgt&&tgt.classList.contains("optionitem")?tgt:void 0,o)null!=E&&option==E.getAttribute("rel")?E.classList.add("options-selected"):s("#"+option).classList.remove("options-selected")}(e)),d.addEventListener("touchend",e=>S(e)),d.addEventListener("touchcancel",e=>S(e)),null==c&&null==c?l.appendChild(e):((t=document.createElement("div")).style.display="flex",t.style.margin="-2px",e.style.paddingRight="2em",(a=document.createElement("div")).className="guiBtn2",a.textContent=c.label,a.id=c.id,t.appendChild(e),t.appendChild(a),l.appendChild(t),guiButton("#"+c.id,c.listener),n&&combosRequiringReset.push(a)),n&&combosRequiringReset.push(e)},initQuickJoy=()=>{new DualTouchButton("#lr","#l","LEFT","#r","RIGHT",!0,new DualTouchButtonJoyListener(1,SAEC_Input_Direction_Left,SAEC_Input_Direction_Right,moveEvent)),new DualTouchButton("#ud","#u","UP","#d","DOWN",!1,new DualTouchButtonJoyListener(1,SAEC_Input_Direction_Up,SAEC_Input_Direction_Down,moveEvent)),new SingleTouchButton("#fire","#f","FIRE",new SingleTouchButtonJoyListener(1,SAEC_Input_Button_1,pressEvent))},moveEvent=(e,t,n)=>{sae.input.registerEvent(e,SAEC_Input_Event_JoystickMove,t,n)},pressEvent=(e,t,n)=>{sae.input.registerEvent(e,SAEC_Input_Event_Press,t,n)};var fLongTouch,hLongTouch,timeTouch,qsActive=[!1,!1,!1,!1,!1,!1,!1,!1,!1];class QuickShot{static DIRECTION={UP_LEFT:0,LEFT:1,DOWN_LEFT:2,UP:3,IDLE:4,DOWN:5,UP_RIGHT:6,RIGHT:7,DOWN_RIGHT:8};static#cssState=["qs2_ul","qs2_l","qs2_dl","qs2_u","qs2_idle","qs2_d","qs2_ur","qs2_r","qs2_dr"];constructor(e,t){this.dpadCallback=e,this.fireCallback=t,this.dpad=s("#qs2_dpad"),this.dpad.classList.add("qs2_idle"),this.fire=s("#qs2_fire"),this.fire.classList.add("qs2_fire_idle"),this.dpad.addEventListener("touchstart",e=>this.move(e,!0),!1),this.dpad.addEventListener("touchend",e=>this.move(e,!1),!1),this.dpad.addEventListener("touchmove",e=>this.move(e,!0),!1),this.fire.addEventListener("touchstart",e=>this.press(e,!0),!1),this.fire.addEventListener("touchend",e=>this.press(e,!1),!1),this.currentState=QuickShot.DIRECTION.IDLE}press(e,t){e.preventDefault(),this.currentFireState!=t&&(this.currentFireState=t,this.fireCallback(t),this.fire.className="",this.fire.classList.add(t?"qs2_fire_active":"qs2_fire_idle"))}move(e,t){var n,r;e.preventDefault(),t?(n=this.dpad.clientHeight/3,r=this.dpad.offsetWidth/3,t=e.changedTouches[0].clientX,e=e.changedTouches[0].clientY-this.dpad.getBoundingClientRect().top,this.newState=t<r?e<n?QuickShot.DIRECTION.UP_LEFT:e<2*n?QuickShot.DIRECTION.LEFT:QuickShot.DIRECTION.DOWN_LEFT:t<2*r?e<n?QuickShot.DIRECTION.UP:e<2*n?QuickShot.DIRECTION.IDLE:QuickShot.DIRECTION.DOWN:e<n?QuickShot.DIRECTION.UP_RIGHT:e<2*n?QuickShot.DIRECTION.RIGHT:QuickShot.DIRECTION.DOWN_RIGHT):this.newState=QuickShot.DIRECTION.IDLE,this.currentState!=this.newState&&(this.dpadCallback(this.currentState,this.newState),this.currentState=this.newState,this.dpad.className="",this.dpad.classList.add(QuickShot.#cssState[this.newState]))}}const initQuickShot=()=>{const i={0:[SAEC_Input_Direction_Left,SAEC_Input_Direction_Up],1:[SAEC_Input_Direction_Left],2:[SAEC_Input_Direction_Left,SAEC_Input_Direction_Down],3:[SAEC_Input_Direction_Up],4:[],5:[SAEC_Input_Direction_Down],6:[SAEC_Input_Direction_Right,SAEC_Input_Direction_Up],7:[SAEC_Input_Direction_Right],8:[SAEC_Input_Direction_Right,SAEC_Input_Direction_Down]};new QuickShot((e,t)=>{var n,r;e=e,t=t,n=i[e],r=i[t],e=n.filter(e=>!r.includes(e)),t=r.filter(e=>!n.includes(e)),e.forEach(e=>{sae.input.registerEvent(1,SAEC_Input_Event_JoystickMove,e,!1)}),t.forEach(e=>{sae.input.registerEvent(1,SAEC_Input_Event_JoystickMove,e,!0)})},e=>{sae.input.registerEvent(1,SAEC_Input_Event_Press,SAEC_Input_Button_1,e)})};var lx=-1,ly=-1,mouseSpeed=3;const initMouse=()=>{new SingleTouchButton("#lmb","#lmbBtn","LMB",new SingleTouchButtonJoyListener(0,SAEC_Input_Button_1,pressEvent)),new SingleTouchButton("#rmb","#rmbBtn","RMB",new SingleTouchButtonJoyListener(0,SAEC_Input_Button_2,pressEvent)),s("#pad2").addEventListener("touchmove",e=>mousetouch(e)),s("#pad2").addEventListener("touchstart",e=>mousetouch(e,!0)),s("#pad2").addEventListener("touchend",e=>{e.preventDefault(),mousetouch(e,!1)}),s("#pad2").addEventListener("touchcancel",e=>mousestoptouch(e,!1)),mouseSpeed=localStorage.getItem("cfg_mouse_speed")},setMouseMode=e=>{switch(e){case"cfg_mouse_mode_buttons":s("#mousepad").style.display="grid",mouseTapsEnabled=!1;break;case"cfg_mouse_mode_taps":s("#mousepad").style.display="none",mouseTapsEnabled=!0}},mousetouch=(e,t)=>{var n,r;ly=!1===t?lx=-1:(n=(r=e.changedTouches[0]).clientX*mouseSpeed,r=r.clientY*mouseSpeed,-1!=lx&&sae.input.registerEvent(0,SAEC_Input_Event_MouseMove,n-lx,r-ly),lx=n,r),mouseTapsEnabled&&(r=e.timeStamp-timeTouch,!0===t?(timeTouch=e.timeStamp,hLongTouch=setTimeout(onLongTouch,500)):null!=hLongTouch&&(clearTimeout(hLongTouch),hLongTouch=null),!1===t&&(endLongTouch()||r<200&&(sae.input.registerEvent(0,SAEC_Input_Event_Press,SAEC_Input_Button_1,!0),setTimeout(()=>{sae.input.registerEvent(0,SAEC_Input_Event_Press,SAEC_Input_Button_1,!1)},20))))},onLongTouch=()=>{fLongTouch=!0,sae.input.registerEvent(0,SAEC_Input_Event_Press,SAEC_Input_Button_1,!0)},endLongTouch=()=>!!fLongTouch&&(sae.input.registerEvent(0,SAEC_Input_Event_Press,SAEC_Input_Button_1,!1),!(fLongTouch=!1)),KeyboardView=["#keybmain","#keybsecondary"],KB_IDLE_COLOR="#88888855",KB_ACTIVE_COLOR="#88888888";var keyStates=[],keyboardMode="#keybmain";const initKeyboard=()=>{s("#keyboard").addEventListener("touchstart",e=>{var t=e.target.id;""!=t&&("kswitch"!=t?(e.target.style.background=KB_ACTIVE_COLOR,t=t.substr(1),keyStates[t]=!0,sae.input.touchKey(t,!0)):"#keybmain"==keyboardMode?(keyboardMode="#keybsecondary",hide("#keybmain"),show("#keybsecondary")):(keyboardMode="#keybmain",hide("#keybsecondary"),show("#keybmain")))}),s("#keyboard").addEventListener("touchmove",e=>{var t=e.target.id;""!=t&&(e.target.style.background=KB_ACTIVE_COLOR,"kswitch"!=t&&(t=t.substr(1),keyStates[t]||(keyStates[t]=!0,sae.input.touchKey(t,!0))))}),s("#keyboard").addEventListener("touchend",e=>{e.preventDefault();var t=e.target.id;""!=t&&(e.target.style.background=KB_IDLE_COLOR,t=t.substr(1),keyStates[t]=!1,sae.input.touchKey(t,!1))})};var gamepads={};function initGamepad(){gamepads=navigator.getGamepads(),window.addEventListener("gamepadconnected",function(e){}),window.addEventListener("gamepaddisconnected",function(e){})}var sae,cfg,activeTheme,controlMode,storedColor,DefaultDiskProvider=function(){this.init=function(){s("#provider_setup").classList.add("disabled")},this.unload=function(){s("#provider_setup").classList.remove("disabled")},this.selectFile=function(e){s("#cfg_df"+e+"_file").click()},this.openPrefs=function(){}},CORSProvider=function(){var i,r=[],n=!1;function a(){s("#importedCors").style.display="block",s("#corsfiles").innerHTML="<p>Disk database: "+r.length+" items.</p>"}function o(){s("#cors_import_msg").style.display="inline",s("#cors_import_msg").textContent="Selected file cannot be imported."}function c(e){var r=s("#corset_results");r.innerHTML="",e.sort((e,t)=>e.txt>t.txt?1:-1),e.forEach(e=>{var t=document.createElement("div");t.classList.add("corsrow");var n=document.createElement("a");n.href=e.url,n.textContent=e.txt,guiButton(t,()=>function(e,t){disabler(!0,!0),s("#corset_query").blur(),e=encodeURI(e);const n=new XMLHttpRequest;e.toLowerCase().endsWith(".rar")||e.toLowerCase().endsWith(".zip")?n.responseType="blob":n.responseType="arraybuffer";e="https://imiga-cors-proxy.gitgalu.workers.dev/?"+e;n.open("GET",e),n.onreadystatechange=function(){var e;4==this.readyState&&(200==this.status?"blob"==n.responseType?((e=new FileReader).onload=function(){var e=this.result;try{var t=archiveOpenArrayBuffer("temp_file",null,e),n=null;t.entries.forEach(function(e){e.is_file&&(e.name.toLowerCase().endsWith(".adf")||e.name.toLowerCase().endsWith(".dms"))&&(n=e)}),null!=n?n.readData(function(e,t){e=window.Uint8Array?new Uint8Array(e):e.toArray();testDisk(i,n.name,e)}):guru("Error unpacking file.",!0),show("#diskProviderModal")}catch(e){guru("Error unpacking file.",!0)}t||(guru("Error downloading file.",!0),hide("#diskProviderModal"))},e.readAsArrayBuffer(n.response)):(e=window.Uint8Array?new Uint8Array(n.response):n.responseBody.toArray(),testDisk(i,t,e),hide("#diskProviderModal")):guru("Error downloading file.",!0))},n.send()}(e.url,e.txt),!0,"corset_result_pressed"),t.appendChild(n),r.append(t)})}this.init=function(){db.cors.get({key:"default"}).then(e=>{e&&(r=e.data,a(),n=!0)}).catch(e=>{guru("Error initializing Disk Provider.")}),loadArchiveFormats(["rar","zip"],()=>{}),null==s("#corset_wrapper_1")&&(insert("#browserModal","<div id='corset_wrapper_1' />"),insert("#browserModal","<input type='file' id='corset_file' />"),insert("#corset_wrapper_1","<div style='align-self: center; margin-right: 8px;'><div>Search:</div></div>"),insert("#corset_wrapper_1","<div id='corset_query_border' class='borderOutset'><input type='text' id='corset_query' class='borderInset'></input></div>"),insert("#corset_wrapper_1","<div id='corset_query_clear' class='guiBtn2'>Clear</div>"),insert("#corset_wrapper_1","<div id='corset_close' class='guiBtn2' style='margin-left: auto'>Close</div>"),insert("#browserModal","<div style='height: 16px'></div>"),insert("#browserModal","<div id='corset_wrapper_2' style='height: 100%; width: 100%; display: flex; align-items: stretch;'></div>"),insert("#corset_wrapper_2","<table id='corset_results' class='borderOutset' style='margin: 0px; margin-top: 16px; height: 100%; width: 100%;'></table>"),guiButton("#corset_query_clear",()=>{s("#corset_query").value="",s("#corset_query").focus(),c([])}),guiButton("#corset_close",()=>{s("#corset_query").blur(),hide("#diskProviderModal")}),s("#corset_query").addEventListener("input",e=>{!function(e){e=e.target.value;{var t,n;t=3<e.trim().length?(t=e.split(" ").filter(Boolean).join(".*"),n=new RegExp(t,"i"),r.filter(e=>n.test(e.txt[0]))):[]}c(t)}(e)}),s("#corset_file").addEventListener("change",e=>{disabler(!0,!0);var t=new FileReader;t.onload=e=>function(e){try{null!=(r=JSON.parse(e.target.result))&&null!=r&&0<r.length?(n=!0,function(e,t){db.cors.put({key:e,data:t},e).then(e=>{disabler(!1)}).catch(e=>{console.log(e)})}("default",r),disabler(!1),s("#importedCors").style.display="block",s("#cors_import_msg").style.display="inline",s("#cors_import_msg").textContent="Successfully imported "+r.length+" items.",a()):(o(),disabler(!1))}catch(e){o(),disabler(!1)}}(e),null!=e.target.files?t.readAsText(e.target.files[0]):(o(),disabler(!1))})),null==s("#corsSettingsModalWrapper")&&(insert("#settings","<div id='corsSettingsModalWrapper' style='display: none' class='custom-modal-wrapper'></div>"),insert("#corsSettingsModalWrapper","<div id='corsSettingsModal' class='reveal-modal'><p>The Internet Disk Provider allows you to import a list of external URLs pointing to ADFs or compressed ADZ/ZIP/RAR files with single compressed ADF images or executable files.</p><p>The files will be downloaded through a private proxy server.</p><br/><div style='display: flex;'><span class='guiBtn' id='cors_import_btn' style='width: 150px' disabled='true'>Import</span><input id='cors_import' type='file' accept='' style='position:absolute;left:-10000px;top:-10000px;' /><span id='cors_import_msg' class='accent' style='align-self: center; padding-left: 24px;'></span></div><br /><div id='warningCorsOk'><br /><div id='importedCors' style='display: none'><p id='importedCorsFiles'>Internet Disk Provider is ready.</p><div id='corsfiles'></div></div><div class='guiBtn' id='cors_apply_btn' style='width: 150px; float: right;' disabled='true'>Continue</div></div></div>"),guiButton("#cors_apply_btn",()=>{s("#corsSettingsModalWrapper").style.display="none",s("#cors_import_msg").style.display="none"}),guiButton("#cors_import_btn",()=>{s("#corset_file").click()}))},this.unload=function(){s("#browserModal").innerHTML=""},this.selectFile=function(e){n?(i=e,show("#diskProviderModal"),s("#corset_query").focus()):guru("Please setup your Disk Provider in Emulator Preferences.",!0)},this.openPrefs=function(){s("#corsSettingsModalWrapper").style.display="block"}},initCounter=0;const loadDiskDb=c=>{db.drives.get({drive:c}).then(e=>{if(null!=e){for(var t=cfg.floppy.drive[c].file,n="",r=e.data,i=r.byteLength,a=0;a<i;a++)n+=String.fromCharCode(r[a]);var o=localStorage.getItem("cfg_df"+c+"_name"),s=localStorage.getItem("cfg_df"+c+"_size"),e=localStorage.getItem("cfg_df"+c+"_crc");""!=o&&0!=s?(t.name=o,t.data=n,t.size=s,t.crc32=e):ejectDisk(c),setFloppyName(c)}4==++initCounter&&init2()}).catch(e=>{console.log("Disk load transaction failed."),console.log(e)})};function saveDiskDb(e,t){db.drives.put({drive:e,data:new Uint8Array(t),driveNum:e}).then(e=>{disabler(!1),hide("#diskProviderModal")}).catch(e=>{console.log(e),guru("Error loading disk.",!0)})}const insertDisk=n=>{console.log("DBX insertDisk"+n);var r=document.getElementById("cfg_df"+n+"_file").files[0];r&&loadFileAsBuffer(r,function(e){var t=e.target.result,e=r.name,t=new Uint8Array(t);testDisk(n,e,t)})},testDisk=(e,t,n)=>{for(var r=cfg.floppy.drive[e].file,i=n.length,a="",o=0;o<i;o++)a+=String.fromCharCode(n[o]);r.name=t,r.data=a,r.size=a.length,r.crc32=crc32(a),setFloppyName(e),s("#cfg_df"+e+"_enabled").checked||(s("#cfg_df"+e+"_enabled").checked=!0),localStorage.setItem("cfg_df"+e+"_enabled","true"),localStorage.setItem("cfg_df"+e+"_name",r.name),localStorage.setItem("cfg_df"+e+"_size",r.size),localStorage.setItem("cfg_df"+e+"_crc",r.crc32),saveDiskDb(e,n)},ejectDisk=e=>{var t=document.getElementById("cfg_df"+e+"_file");null!=t&&(cfg.floppy.drive[e].file.clr(),t.value="",document.getElementById("cfg_df"+e+"_name").innerHTML="&lt;&lt; No disk in drive &gt;&gt;",(t=cfg.floppy.drive[e].file).name="",t.data="",t.size=0,t.crc32=!1,t.prot=!1,running&&sae.eject(e),saveDiskDb(e,null),localStorage.setItem("cfg_df"+e+"_name",""),localStorage.setItem("cfg_df"+e+"_file",""),localStorage.setItem("cfg_df"+e+"_size",0),localStorage.setItem("cfg_df"+e+"_data",""),localStorage.setItem("cfg_df"+e+"_crc",!1))},setFloppyName=e=>{var t=document.getElementById("cfg_df"+e+"_name");if(null!=t){var n=""+cfg.floppy.drive[e].file.name;if(""!=n&&null!=n){var r="";if(n.length>MAX_FILENAME){let e=/\(Disk (\d+) of (\d+)\)/g;var i=e.exec(n);null!=i&&i.length,r=n.substr(0,MAX_FILENAME-16)+" [...] "}else r=n;t.innerHTML='<div class="cellItem" id="cfg_df'+e+'_file" style="display: inline-flex; overflow: hidden; text-wrap: nowrap;"><img src="assets/null.png" class="cellItem eject" onclick="ejectDisk('+e+');" id="cfg_df"'+e+'_eject" /><span style="white-space: nowrap;   overflow: hidden;   text-overflow: ellipsis;" class="imageName">'+r+"</span></div>"}else ejectDisk(e)}},CURRENT_VERSION=1,MAX_FILENAME=64,db=new Dexie("iMigaDb"),DATABASE_VERSION=4,diskProvider=new FileProvider,tempRom=new SAEO_Config_File;var e_led_power,prefsChanged=!1,availableRoms={},guiInitialized=!1,disablerActive=!1,running=!1,paused=!1,muted=!1,resetted=!0,resetQueued=!1,hardReset=!1,e_led_df=[null,null,null,null];const ControlModes={JOYSTICK:"joystick",MOUSE:"mouse",KEYBOARD:"keyboard",NONE:"none"};var combosRequiringReset=[],prefs={cfg_joy_extra:"cfg_joy_extra_disabled",cfg_external_gamepad:"cfg_external_gamepad_1x",cfg_floppy_drive_speed:"cfg_floppy_drive_speed_normal",cfg_amiga_region:"cfg_amiga_region_pal",cfg_amiga_model:"cfg_amiga_model_a500",cfg_amiga_memory:"cfg_amiga_memory_512k_512k",cfg_amiga_kick:null,cfg_mouse_mode:"cfg_mouse_mode_buttons",cfg_joy_type:"cfg_joy_type_qj",cfg_file_provider:"cfg_file_provider_os",cfg_joy_type_qj_extra:"cfg_joy_type_qj_extra_disabled",cfg_theme:"cfg_theme_31",cfg_audio_buffer:"cfg_audio_buffer_8192"};function setBgColor(e,t){t||(storedColor=e),s("body").style.background=e,s("html").style.background=e}function disabler(e,t,n="Loading..."){e?(disablerActive=!0,s("#disablerImageImg").src=activeTheme["loading-img"],show("#disablerMessage","block"),show("#disablerImage","block"),show("#disabler","flex"),s("#disabler").style.opacity=t?.75:0,s("#disablerMessage").textContent=n):(setBgColor(storedColor,!(disablerActive=!1)),hide("#disabler"))}function setupOverlay(){hide("#settings"),show("#screen","block"),show("#overlay","block")}function setControlsMode(e){var t="hidden",n="hidden",r="none",i=!1;switch(this.controlMode=e){case ControlModes.JOYSTICK:r="grid";break;case ControlModes.KEYBOARD:n="visible";break;case ControlModes.MOUSE:t="visible";break;case ControlModes.NONE:i=!0}s("#mousepad").style.visibility=t,s("#pad2").style.visibility=t,s("#mouse_container").style.visibility=t,s("#keyboard").style.visibility=n,s("#joystick_container").style.display=r,i&&(s("#overlay").classList.add("theater-mode"),show("#theater-mode"))}function initJoystick(){initQuickJoy(),initQuickShot()}function reconfigureJoy(){switch(prefs.cfg_joy_type){case"cfg_joy_type_qj":s("#quickshot").style.display="none",s("#quickjoy").style.display="grid",cfg.ports[1].type=SAEC_Config_Ports_Type_JoyEmu,cfg.ports[1].device=SAEC_Config_Ports_Device_None;break;case"cfg_joy_type_qs":s("#quickshot").style.display="grid",s("#quickjoy").style.display="none",cfg.ports[1].type=SAEC_Config_Ports_Type_JoyEmu,cfg.ports[1].device=SAEC_Config_Ports_Device_None;break;case"cfg_joy_type_ext":s("#quickjoy").style.display="none",s("#quickshot").style.display="none",cfg.ports[0].type=SAEC_Config_Ports_Type_Joy,null!=gamepads[0]&&(cfg.ports[0].device=gamepads[0].index,SAER.input.joystick[0].enable()),cfg.ports[1].type=SAEC_Config_Ports_Type_Joy,null!=gamepads[1]&&(cfg.ports[1].device=gamepads[1].index,SAER.input.joystick[1].enable())}}function reconfigureInput(){setMouseMode(prefs.cfg_mouse_mode),reconfigureJoy()}function loadKickDb(a){db.roms.get({family:a}).then(e=>{for(var t="",n=e.data,r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);e=localStorage.getItem(a);tempRom.name=KnownKickstarts[e].NAME,tempRom.data=t,tempRom.size=KnownKickstarts[e].SIZE,tempRom.crc32=KnownKickstarts[e].CRC}).catch(e=>{console.log("Kickstart load transaction failed."),guru("Error loading Kickstart ROM.")})}function initGui(){guiButton("#switchJoy",()=>{setControlsMode(ControlModes.JOYSTICK)},!(s("#switchJoy").textContent="JOY")),guiButton("#switchMouse",()=>{setControlsMode(ControlModes.MOUSE)},!(s("#switchMouse").textContent="MOUSE")),guiButton("#switchKb",()=>{setControlsMode(ControlModes.KEYBOARD)},!(s("#switchKb").textContent="KEYB")),guiButton("#switchNone",()=>{setControlsMode(ControlModes.NONE)},!(s("#switchNone").textContent="NONE")),s("#powerBtn").textContent="POWER",guiButton("#menuBtn",()=>{pause(!0)},!(s("#menuBtn").textContent="MENU"))}function initPrefs(){addCombo("#inputPrefsContent","cfg_mouse_mode","Mouse mode",!1,"cfg_mouse_mode_buttons",{cfg_mouse_mode_buttons:"Touchpad + buttons",cfg_mouse_mode_taps:"Touchpad + taps"},null,null,e=>{}),addCombo("#inputPrefsContent","cfg_joy_type","Joystick mode",!1,"cfg_joy_type_qj",{cfg_joy_type_qj:"QuickJoy (touch)",cfg_joy_type_qs:"QuickShot (touch)"},null,{cfg_joy_type_qj:["cfg_joy_type_qj_extra"]}),addCombo("#inputPrefsContent","cfg_kb_type","Keyboard mode",!1,"cfg_kb_type_generic",{cfg_kb_type_generic:"iMiga Qwerty (touch)"}),addCombo("#emuPrefsContent","cfg_floppy_drive_speed","Floppy speed",!0,"cfg_floppy_drive_speed_normal",{cfg_floppy_drive_speed_normal:"Normal (100%)",cfg_floppy_drive_speed_turbo:"Turbo (less compatible)"}),addCombo("#amigaPrefsContent","cfg_amiga_region","Region",!0,"cfg_amiga_region_pal",{cfg_amiga_region_pal:"PAL (50Hz, Europe)",cfg_amiga_region_ntsc:"NTSC (60Hz, USA)"}),addCombo("#amigaPrefsContent","cfg_amiga_model","Model",!0,"cfg_amiga_model_a500",{cfg_amiga_model_a500:"A500 (OCS, 68000/7MHz)",cfg_amiga_model_a600:"A600 (ECS, 68000/7MHz)",cfg_amiga_model_a1200:"A1200 (AGA, 68020/14MHz)"}),addCombo("#amigaPrefsContent","cfg_amiga_memory","RAM",!0,"cfg_amiga_memory_512k_512k",{cfg_amiga_memory_512k:"512 KiB Chip",cfg_amiga_memory_512k_512k:"512 KiB Chip + 512 KiB Slow",cfg_amiga_memory_1m:"1 MiB Chip",cfg_amiga_memory_2m:"2 MiB Chip",cfg_amiga_memory_2m_4m:"2 MiB Chip, 8 MiB Fast"}),addCombo("#amigaPrefsContent","cfg_amiga_kick","ROM",!0,null,availableRoms,{id:"rom_button",label:"Files",listener:e=>{kick()}}),addCombo("#emuPrefsContent","cfg_file_provider","Disk provider",!1,"cfg_file_provider_os",{cfg_file_provider_os:"Operating system",cfg_file_provider_cors:"Internet"},{id:"provider_setup",label:"Setup",listener:e=>{diskProvider.openPrefs()}},null,e=>{setFileProvider(e)}),addCombo("#emuPrefsContent","cfg_theme","Theme",!1,"cfg_theme_31",{cfg_theme_13:"1.x (1980s)",cfg_theme_31:"2.x (1990s)"},null,null,e=>{setTheme(e)})}function setFileProvider(e){prov=new("cfg_file_provider_cors"===e?CORSProvider:DefaultDiskProvider),diskProvider.setFileProvider(prov)}function myInit(){show("#portrait-disabler-wrapper"),combosRequiringReset.forEach(e=>{e.classList.add("disabled")}),setBgColor("#000000",!1),resetQueued&&disabler(!0,!0),resetted=!1,reconfigureInput(),running||(setControlsMode(ControlModes.JOYSTICK),startEmulation(),initJoystick(),initMouse(),initKeyboard(),initGui()),recreateDriveButtons(),reconfigureDrivesGui(!1),paused&&pause(!1),setupOverlay()}function reconfigureDrivesGui(e){var t=s("#drives"),n="";for(i=0;i<4;i++){var r="cfg_df"+i+"_enabled",a="true"==localStorage.getItem(r);(e||a)&&(n+='<label class="checkboxcontainer">',n+="<input id="+r+' type="checkbox"',0<i?(n+=' class="drivecheckbox"',a&&(n+=" checked")):n+=" checked disabled",n+=">",n+='<span id="cfg_df'+i+'_checkmark" class="checkmark '+(e?"checkmark-active":"checkmark-active disabled")+'" checked></span>',n+="</label>",n+='<span class="cellItem" style="padding-left: 16px;">DF'+i+":</span>",n+='<img id="cfg_df'+i+'_img" class="cellItem disk" src="assets/null.png" />',n+='<input id="cfg_df'+i+'_file" type="file" style="position:absolute;left:-10000px;top:-10000px;" onchange="insertDisk('+i+')" />',n+='<div class="cellItem" id="cfg_df'+i+'_name"></div>')}for(t.innerHTML=n,i=0;i<4;i++)setFloppyName(i),initDiskFileButton(i);localStorage.setItem("cfg_df0_enabled",!0),document.querySelectorAll("input[type=checkbox]").forEach(t=>{t.addEventListener("change",e=>{localStorage.setItem(t.id,t.checked)})})}function recreateDriveButtons(){var e=6,t=s("#topbar");[].slice.call(document.querySelectorAll(".drivebar")).forEach(function(e){e.parentNode.removeChild(e)});var n,r,a,o=[!(e_led_df=[null,null,null,null]),!1,!1,!1],c=0;for(i=0;i<4;i++){var _=s("#cfg_df"+i+"_enabled"),_=null!=_&&_.checked;cfg.floppy.drive[i].type=_?SAEC_Config_Floppy_Type_35_DD:SAEC_Config_Floppy_Type_None,(o[i]=_)&&c++}if(2<c)for((n=document.createElement("div")).id="df"+i+"bar",n.className="drivebar",n.style.gridRow=e,t.appendChild(n),i=0;i<c;i++)(a=document.createElement("div")).id="df"+i+"barState",a.className="drivebar-item"+c+" drive-state",a.textContent="00",n.appendChild(a),e_led_df[i]=a;else for(i=0;i<4;i++)o[i]&&((n=document.createElement("div")).id="df"+i+"bar",n.className="drivebar",n.style.gridRow=e,t.appendChild(n),(r=document.createElement("div")).id="df"+i+"barLabel",r.className="drivebar-item drive-id",r.textContent="DF"+i,(a=document.createElement("div")).id="df"+i+"barState",a.className="drivebar-item drive-state",a.textContent="00",n.appendChild(r),n.appendChild(a),e_led_df[i]=a,e++)}function startEmulation(){prepareConfig(),cfg.memory.rom=tempRom,recreateDriveButtons(),setHooks(),start()}function start(){var e=sae.start();e!=SAEE_None&&guru(saee2text(e))}function hook_event_started(){running=!0}function hook_event_stopped(){paused&&(paused=!1,switchPauseResume(paused)),muted&&(muted=!1,switchMutePlay(muted)),dskchg&&dskchgClose(),mode==MODE_Advanced&&setAdvandedConfig()}function hook_event_reseted(e){paused=paused&&!1,disablerActive&&disabler(!1)}function hook_event_paused(e){(paused=e)?showMenu():resetQueued&&(resetQueued=!1,reset())}function hook_error(){resetMessage(!0,"<-- Amiga has crashed."),showMenu()}function resetMessage(e,t,n){var r=s("#resetMsg");r.textContent=t,r.style.display=e?n?"inline-block":"span":"none"}function showMenu(){hide("#portrait-disabler-wrapper"),setBgColor(activeTheme["--color0"],!1),s("#startBtn").textContent="RESUME",hide("#screen"),show("#settings","block"),show("#container1","block")}function setHooks(){e_led_power=document.getElementById("powerBtn"),cfg.hook.log.error=hook_error,cfg.hook.event.started=hook_event_started,cfg.hook.led.df=hook_led_df,cfg.hook.led.power=hook_led_power,cfg.hook.event.reseted=hook_event_reseted,cfg.hook.event.paused=hook_event_paused}function pause(e){sae.pause(e);e&&(resetted=!1)}function hook_led_df(e,t,n,r,i){t||null!=e_led_df[e]&&(e_led_df[e].style.borderColor=1==i?COL_GREEN:2==i?COL_RED:COL_GRAY,e_led_df[e].style.color=1==i?COL_GREEN:2==i?COL_RED:COL_GRAY,e_led_df[e].textContent=(""+n).padStart(2,"0"))}function hook_led_power(e){e_led_power.style.color=e?COL_GREEN:COL_GRAY,e_led_power.style.borderColor=e?COL_GREEN:COL_GRAY}function setPrefsFloppySpeed(e){switch(e){case"cfg_floppy_drive_speed_normal":cfg.floppy.speed=SAEC_Config_Floppy_Speed_Original;break;case"cfg_floppy_drive_speed_turbo":cfg.floppy.speed=SAEC_Config_Floppy_Speed_Turbo}}function getPrefsModel(e){switch(e){case"cfg_amiga_model_a1000":return SAEC_Model_A1000;case"cfg_amiga_model_a500":return SAEC_Model_A500;case"cfg_amiga_model_a500p":return SAEC_Model_A500P;case"cfg_amiga_model_a600":return SAEC_Model_A600;case"cfg_amiga_model_a2000":return SAEC_Model_A2000;case"cfg_amiga_model_a1200":return SAEC_Model_A1200;default:return console.log("Invalid config"),SAEC_Model_A500}}function setRegion(e){switch(e){case"cfg_amiga_region_pal":cfg.chipset.ntsc=!1;break;case"cfg_amiga_region_ntsc":cfg.chipset.ntsc=!0}}function setAudioBuffer(e){switch(e){case"cfg_audio_buffer_1024":cfg.audio.bufferFrames=1024;break;case"cfg_audio_buffer_2048":cfg.audio.bufferFrames=2048;break;case"cfg_audio_buffer_4096":cfg.audio.bufferFrames=4096;break;case"cfg_audio_buffer_8192":default:cfg.audio.bufferFrames=8192}}function setTheme(e){theme("cfg_theme_13"===e?Themes.WB13:Themes.WB31)}function setPrefsMemory(e){switch(cfg.memory.z2FastSize=0,e){case"cfg_amiga_memory_256k":cfg.memory.chipSize=262144,cfg.memory.bogoSize=0,cfg.memory.z2FastSize=0;break;case"cfg_amiga_memory_512k":cfg.memory.chipSize=524288,cfg.memory.bogoSize=0,cfg.memory.z2FastSize=0;break;case"cfg_amiga_memory_512k_512k":cfg.memory.chipSize=524288,cfg.memory.bogoSize=524288,cfg.memory.z2FastSize=0;break;case"cfg_amiga_memory_1m":cfg.memory.chipSize=1048576,cfg.memory.bogoSize=0,cfg.memory.z2FastSize=0;break;case"cfg_amiga_memory_2m":cfg.memory.chipSize=2097152,cfg.memory.bogoSize=0,cfg.memory.z2FastSize=0;break;case"cfg_amiga_memory_2m_4m":cfg.memory.chipSize=2097152,cfg.memory.bogoSize=0,cfg.memory.z2FastSize=4194304}}function updateAmigaConfig(){sae.setModel(getPrefsModel(prefs.cfg_amiga_model),0),setPrefsMemory(prefs.cfg_amiga_memory),setRegion(prefs.cfg_amiga_region),setAudioBuffer(prefs.cfg_audio_buffer),setPrefsFloppySpeed(prefs.cfg_floppy_drive_speed),cfg.cpu.compatible=!0,cfg.cpu.speed=0}function prepareConfig(){cfg.audio.mode=SAEC_Config_Audio_Mode_On_Best,cfg.audio.channels=1,cfg.video.framerate=1,cfg.video.id="amigaScreen",updateAmigaConfig()}function getModelString(e){switch(e){case SAEC_Model_A500:return"A500";case SAEC_Model_A500P:return"A500+";case SAEC_Model_A600:return"A600";case SAEC_Model_A1000:return"A1000";case SAEC_Model_A1200:return"A1200";case SAEC_Model_A2000:return"A2000";case SAEC_Model_A3000:return"A3000";case SAEC_Model_A4000:return"A4000";case SAEC_Model_A4000T:return"A4000T";case SAEC_Model_CDTV:return"CDTV";case SAEC_Model_CD32:return"CD32"}return null}function saee2text(e){switch(e){case SAEE_AlreadyRunning:return"The emulator is already running.";case SAEE_NotRunning:return"The emulator is not running.";case SAEE_NoTimer:return"No timing-functions avail. Please upgrade your browser.";case SAEE_NoMemory:return"Out of memory.";case SAEE_Assert:return"Assertiation failed.";case SAEE_Internal:return"Internal emulator error.";case SAEE_Config_Invalid:return"Invalid configuration.";case SAEE_Config_Compressed:return"A ZIP file was detected. Compressed files are not yet supported.";case SAEE_CPU_Internal:return"Internal CPU-error.";case SAEE_CPU_Requires68020:return"The selected kickstart-rom does require a 68020 and 32bit address-space";case SAEE_CPU_Requires680EC20:return"The selected kickstart-rom does require a 68020.";case SAEE_CPU_Requires68030:return"The selected kickstart-rom does require a 68030.";case SAEE_CPU_Requires68040:return"The selected kickstart-rom does require a 68040/68060.";case SAEE_Memory_NoKickstartRom:return"The Kickstart ROM is missing.";case SAEE_Memory_NoExtendedRom:return"An extended-rom is required but missing.\n\nGo to the ROM-page and select a rom from disk...";case SAEE_Memory_RomSize:return"The kickstart- or extended-rom does have an invalid size.";case SAEE_Memory_RomKey:return"A ROM-keyfile is required. (Cloanto)";case SAEE_Memory_RomDecode:return"Invalid ROM-keyfile. (Cloanto)";case SAEE_Memory_RomChecksum:return"Checksum-error at the kickstart- or extended-rom.";case SAEE_Memory_RomUnknown:return"Unknown ROM.";case SAEE_Video_ElementNotFound:return"Video DIV-element not found. Check 'cfg.video.id'";case SAEE_Video_RequiresCanvas:return"Cannot initlialize 'Canvas'. Please upgrade your OS / browser.";case SAEE_Video_RequiresWegGl:return"Cannot initialize 'WebGL'. Please upgrade your OS / browser.";case SAEE_Video_ComphileShader:return"Can not compile the required shader-program.";case SAEE_Video_LinkShader:return"Can not link the required shader-program.";case SAEE_Video_RequiresFullscreen:return"This browser does not support the 'Fullscreen-API'. Please upgrade to an actual version.";case SAEE_Audio_RequiresWebAudio:return"This browser does not support 'WebAudio'. Please upgrade to an actual version.";default:return"("+e+")"}}function stop(){var e=sae.stop();e==SAEE_None||guru(saee2text(e))}function reset(){var e=hardReset;hardReset=!1;sae.reset(e,!1);prefsChanged&&(updateAmigaConfig(),recreateDriveButtons(),prefsChange(!1),prefsChanged=!1),resetted=!0}function notok(){hide("#settings"),hide("#screen"),show("#warning","block"),show("#warningStandalone","block"),show("#container1","block")}function getMouseSpeedLabel(e){switch(e){case 1:return"25%";case 2:return"50%";case 3:return"75%";case 4:return"100%";case 5:return"150%";case 6:return"200%";case 7:return"250%";case 8:return"300%";case 9:return"400%";case 10:return"700%"}}function kick(){disabler(!1),hide("#settings"),hide("#screen"),show("#warning","block"),show("#warningKickstart","block"),show("#container1","block"),hide("#warningStandalone"),s("#kick_import_msg").textContent="Only uncompressed files are supported.",refreshKicks()}function applyKicks(){hide("#warningKickstart"),ok()}function isAtLeastOneKickValid(){for(family of["1","2","3"])if(null!=localStorage.getItem("cfg_amiga_kick_"+family))return!0;return!1}function refreshKicks(){var e=[];for(family of["1","2","3"]){var t=localStorage.getItem("cfg_amiga_kick_"+family);null!=t&&e.push(t)}refreshKicksTable(e),refreshKicksCombo(e)}function refreshKicksTable(e){s("#kicks").innerHTML="",e.forEach(e=>{insert("#kicks",'<span class="cellItem">Kick '+KnownKickstarts[e].NAME+'</span><span class="cellItem">r'+KnownKickstarts[e].REVISION+'</span><span class="cellItem">'+KnownKickstarts[e].VIDEO.join(" + ")+'</span><span class="cellItem">'+KnownKickstarts[e].YEAR+'</span><span class="cellItem" style="border: bottom 1px white solid;">'+KnownKickstarts[e].MACHINES.map(getModelString).join(", ")+"</span>")}),isAtLeastOneKickValid()?s("#warningKickstartOk").style.display="block":s("#warningKickstartOk").style.display="none"}function refreshKicksCombo(e){var t={};e.forEach(e=>{t["cfg_amiga_kick_"+KnownKickstarts[e].FAMILY]="Kick "+KnownKickstarts[e].NAME});e=localStorage.getItem("cfg_amiga_kick");updateCombo("cfg_amiga_kick",t,e)}function guru(e,t=!1){if(hide("#screen"),hide("#overlay"),hide("#warning"),show("#settings","block"),disablerActive?(hide("#disablerMessage"),hide("#disablerImage")):disabler(!0,!1,""),s("#guruWrapper0").addEventListener("click",function e(){t?(disabler(!1),showMenu(),hide("#guruWrapper0"),s("#guruWrapper0").removeEventListener("click",this),document.removeEventListener("click",e,!0)):window.location.reload(!1)},!0),!t)throw s("#guruMessage").textContent="Software Failure. "+e,s("#guruMessage2").textContent="Guru Meditation #000000000.000000001",show("#guruWrapper0","block"),new Error("Guru Meditation: "+e);s("#guru").style.color="#F4AD46",s("#guru").style.borderColor="#F4AD46",s("#guru").style.animation="guru-yellow 1.5s infinite",s("#guruMessage").textContent="Recoverable Alert. "+e,s("#guruMessage2").textContent="Error: 0000 0000 Task: 00000001",show("#guruWrapper0","block")}function importKick(){s("#kick_import_msg").style.display="none",s("#kick_import_msg").textContent="";var _=document.getElementById("kick_import").files[0];_&&loadFileAsBuffer(_,function(e){for(var t=e.target.result,n="",r=new Uint8Array(t),i=r.byteLength,a=0;a<i;a++)n+=String.fromCharCode(r[a]);_.name;var o=_.size,c=crc32(n);Object.keys(KnownKickstarts).forEach(e=>{c==KnownKickstarts[e].CRC&&o==KnownKickstarts[e].SIZE&&saveKickDb(KnownKickstarts[e],t)}),s("#kick_import_msg").style.display="inline",s("#kick_import_msg").textContent="Selected file cannot be imported."})}function saveKickDb(t,e){db.roms.add({family:"cfg_amiga_kick_"+t.FAMILY,data:new Uint8Array(e)},"cfg_amiga_kick_"+t.FAMILY).then(e=>{s("#kick_import_msg").style.display="inline",s("#kick_import_msg").textContent="Successfully imported Kickstart "+t.NAME+" rev. "+t.REVISION,localStorage.setItem("cfg_amiga_kick","cfg_amiga_kick_"+t.FAMILY),localStorage.setItem("cfg_amiga_kick_"+t.FAMILY,t.KEY),refreshKicks()}).catch(e=>{s("#kick_import_msg").style.display="inline",s("#kick_import_msg").textContent="Selected file cannot be imported."})}function prefsChange(e){e?prefsChanged=!0:resetMessage(!1)}function initDiskFileButton(t){var e=s("#cfg_df"+t+"_img");null!=e&&e.addEventListener("click",function(e){diskProvider.selectFile(t)},!1)}function category(e){var t=s(".custom");null!=t&&t.classList.remove("custom"),e.classList.add("custom"),hide("#inputPrefsContent"),hide("#emuPrefsContent"),hide("#amigaPrefsContent"),hide("#cloudPrefsContent"),show("#"+e.id+"Content","grid")}function init2(){setFileProvider(prefs.cfg_file_provider),setTheme(prefs.cfg_theme),reconfigureDrivesGui(!0),guiButton("#startBtn",()=>{myInit()}),refreshKicks();var e=s("#cfg_mouse_speed_label");null==localStorage.getItem("cfg_mouse_speed")&&(localStorage.setItem("cfg_mouse_speed",3),mouseSpeed=3),s("input#cfg_mouse_speed").addEventListener("input",function(){localStorage.setItem("cfg_mouse_speed",this.value),e.innerHTML=getMouseSpeedLabel(parseInt(this.value)),mouseSpeed=this.value},!1),mouseSpeed=null==localStorage.getItem("cfg_mouse_speed")?0:localStorage.getItem("cfg_mouse_speed"),s("input#cfg_mouse_speed").value=mouseSpeed,s("#cfg_mouse_speed_label").textContent=getMouseSpeedLabel(parseInt(mouseSpeed)),s("#theater-mode").addEventListener("click",()=>{hide("#theater-mode"),s("#overlay").classList.remove("theater-mode")}),guiButton("#logo",()=>{s("#aboutModalWrapper").style.display="block"},!1),guiButton("#about_close_btn",()=>{s("#aboutModalWrapper").style.display="none"}),guiButton("#resetBtn",()=>{resetQueued&&(hardReset=!0),running&&(reconfigureDrivesGui(resetQueued=!0),setFloppyName(0),setFloppyName(1),setFloppyName(2),setFloppyName(3),s("#startBtn").textContent="START",combosRequiringReset.forEach(e=>{e.classList.remove("disabled")}))});const t=document.querySelectorAll(".guiBtn3");t.forEach(e=>{guiButton("#"+e.id,()=>{category(e)},!1)}),category(s("#inputPrefs")),guiButton("#prefsRestore",()=>{document.getElementById("prefsRestore").style.display="none",document.getElementById("drives").style.display="none",document.getElementById("drivesRestore").style.display="block",document.getElementById("prefsWrapper").style.display="flex"}),guiButton("#drivesRestore",()=>{document.getElementById("drivesRestore").style.display="none",document.getElementById("prefsWrapper").style.display="none",slideDown(document.getElementById("drives"),100),document.getElementById("prefsRestore").style.display="block"}),guiInitialized||(disabler(!1),guiInitialized=!0)}function initDb(){db.version(DATABASE_VERSION).stores({roms:"family",drives:"drive",cors:"key"}),db.open().then(function(e){initPrefs(),guiButton("#kick_import_btn",()=>{document.getElementById("kick_import").click()}),(isAtLeastOneKickValid()?ok:kick)()}).catch(function(e){guru("Cannot access local browser storage.")})}function ok(){disabler(!0,!0),hide("#warning"),hide("#screen"),show("#container1","block"),show("#settings","block"),null==sae&&(sae=new ScriptedAmigaEmulator),cfg=sae.getConfig(),loadKickDb(localStorage.getItem("cfg_amiga_kick")),loadDiskDb(0),loadDiskDb(1),loadDiskDb(2),loadDiskDb(3)}domReady(()=>{setTheme(null),initGamepad(),s("#kick_import").addEventListener("change",function(e){importKick()}),guiButton("#kick_apply_btn",()=>{applyKicks()}),("standalone"in window.navigator&&window.navigator.standalone?initDb:notok)()});const crc32Table=function(){for(var e,t,n=new Uint32Array(256),r=0;r<256;r++){for(e=r,t=0;t<8;t++)e=(e>>>1^(1&e?3988292384:0))>>>0;n[r]=e}return n}();function crc32(e){for(var t=e.length,n=0,r=4294967295;0<t--;)r=crc32Table[255&(r^e.charCodeAt(n++))]^r>>>8;return(4294967295^r)>>>0}function theme(t){activeTheme=t,Object.keys(t).forEach(e=>{document.documentElement.style.setProperty(e,t[e])}),setBgColor(t["--color0"],!1)}